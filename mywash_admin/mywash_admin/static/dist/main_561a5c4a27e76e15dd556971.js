/*! jQuery v2.1.3 | (c) 2005, 2014 jQuery Foundation, Inc. | jquery.org/license */

/*!
 * CanJS - 2.1.4
 * http://canjs.us/
 * Copyright (c) 2014 Bitovi
 * Fri, 21 Nov 2014 22:25:48 GMT
 * Licensed MIT
 * Includes: CanJS default build
 * Download from: http://canjs.us/
 */

/*!
 * Bootstrap v3.3.2 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 */

/*
 * DC jQuery Vertical Accordion Menu - jQuery vertical accordion menu plugin
 * Copyright (c) 2011 Design Chemical
 *
 * Dual licensed under the MIT and GPL licenses:
 * 	http://www.opensource.org/licenses/mit-license.php
 * 	http://www.gnu.org/licenses/gpl.html
 *
 */

/**
 * Copyright (c) 2007-2013 Ariel Flesler - aflesler<a>gmail<d>com | http://flesler.blogspot.com
 * Dual licensed under MIT and GPL.
 * @author Ariel Flesler
 * @version 1.4.6
 */

// -----------------------------------
// Slidebars
// Version 0.10 Development
// http://plugins.adchsm.me/slidebars/
//
// Written by Adam Smith
// http://www.adchsm.me/
//
// Released under MIT License
// http://plugins.adchsm.me/slidebars/license.txt
//
// ---------------------
// Index of Slidebars.js
//
// 001 - Default Settings
// 002 - Feature Detection
// 003 - User Agents
// 004 - Setup
// 005 - Animation
// 006 - Operations
// 007 - API
// 008 - User Input

/*! matchMedia() polyfill - Test a CSS media type/query in JS. Authors & copyright (c) 2012: Scott Jehl, Paul Irish, Nicholas Zakas. Dual MIT/BSD license */

/*! NOTE: If you're already including a window.matchMedia polyfill via Modernizr or otherwise, you don't need this part */

/*! Respond.js v1.3.0: min/max-width media query polyfill. (c) Scott Jehl. MIT/GPLv2 Lic. j.mp/respondjs  */

// moment.js
// version : 2.0.0
// author : Tim Wood
// license : MIT
// momentjs.com

/*!
 * Datepicker for Bootstrap v1.4.0 (https://github.com/eternicode/bootstrap-datepicker)
 *
 * Copyright 2012 Stefan Petre
 * Improvements by Andrew Rowls
 * Licensed under the Apache License v2.0 (http://www.apache.org/licenses/LICENSE-2.0)
 */

/**
 * sifter.js
 * Copyright (c) 2013 Brian Reavis & contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at:
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 *
 * @author Brian Reavis <brian@thirdroute.com>
 */

/**
 * microplugin.js
 * Copyright (c) 2013 Brian Reavis & contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at:
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 *
 * @author Brian Reavis <brian@thirdroute.com>
 */

/**
 * selectize.js (v0.12.0)
 * Copyright (c) 2013–2015 Brian Reavis & contributors
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not use this
 * file except in compliance with the License. You may obtain a copy of the License at:
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software distributed under
 * the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF
 * ANY KIND, either express or implied. See the License for the specific language
 * governing permissions and limitations under the License.
 *
 * @author Brian Reavis <brian@thirdroute.com>
 */

/** @license
 * RequireJS plugin for async dependency load like JSONP and Google Maps
 * Author: Miller Medeiros
 * Version: 0.1.2 (2014/02/24)
 * Released under the MIT license
 */

/*!
xCharts v0.3.0 Copyright (c) 2012, tenXer, Inc. All Rights Reserved.
@license MIT license. http://github.com/tenXer/xcharts for details
*/

!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(a,b){function s(e){var t=e.length,r=n.type(e);return"function"===r||n.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}function x(e,t,r){if(n.isFunction(t))return n.grep(e,function(e,n){return!!t.call(e,n,e)!==r});if(t.nodeType)return n.grep(e,function(e){return e===t!==r});if("string"==typeof t){if(w.test(t))return n.filter(t,e,r);t=n.filter(t,e)}return n.grep(e,function(e){return g.call(t,e)>=0!==r})}function D(e,t){while((e=e[t])&&1!==e.nodeType);return e}function G(e){var t=F[e]={};return n.each(e.match(E)||[],function(e,n){t[n]=!0}),t}function I(){l.removeEventListener("DOMContentLoaded",I,!1),a.removeEventListener("load",I,!1),n.ready()}function K(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=n.expando+K.uid++}function P(e,t,r){var i;if(void 0===r&&1===e.nodeType)if(i="data-"+t.replace(O,"-$1").toLowerCase(),r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:N.test(r)?n.parseJSON(r):r}catch(s){}M.set(e,t,r)}else r=void 0;return r}function Z(){return!0}function $(){return!1}function _(){try{return l.activeElement}catch(e){}}function jb(e,t){return n.nodeName(e,"table")&&n.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function kb(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function lb(e){var t=gb.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function mb(e,t){for(var n=0,r=e.length;r>n;n++)L.set(e[n],"globalEval",!t||L.get(t[n],"globalEval"))}function nb(e,t){var r,i,s,o,u,a,f,l;if(1===t.nodeType){if(L.hasData(e)&&(o=L.access(e),u=L.set(t,o),l=o.events)){delete u.handle,u.events={};for(s in l)for(r=0,i=l[s].length;i>r;r++)n.event.add(t,s,l[s][r])}M.hasData(e)&&(a=M.access(e),f=n.extend({},a),M.set(t,f))}}function ob(e,t){var r=e.getElementsByTagName?e.getElementsByTagName(t||"*"):e.querySelectorAll?e.querySelectorAll(t||"*"):[];return void 0===t||t&&n.nodeName(e,t)?n.merge([e],r):r}function pb(e,t){var n=t.nodeName.toLowerCase();"input"===n&&T.test(e.type)?t.checked=e.checked:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}function sb(e,t){var r,i=n(t.createElement(e)).appendTo(t.body),s=a.getDefaultComputedStyle&&(r=a.getDefaultComputedStyle(i[0]))?r.display:n.css(i[0],"display");return i.detach(),s}function tb(e){var t=l,r=rb[e];return r||(r=sb(e,t),"none"!==r&&r||(qb=(qb||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=qb[0].contentDocument,t.write(),t.close(),r=sb(e,t),qb.detach()),rb[e]=r),r}function xb(e,t,r){var i,s,o,u,a=e.style;return r=r||wb(e),r&&(u=r.getPropertyValue(t)||r[t]),r&&(""!==u||n.contains(e.ownerDocument,e)||(u=n.style(e,t)),vb.test(u)&&ub.test(t)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=u,u=r.width,a.width=i,a.minWidth=s,a.maxWidth=o)),void 0!==u?u+"":u}function yb(e,t){return{get:function(){return e()?void delete this.get:(this.get=t).apply(this,arguments)}}}function Fb(e,t){if(t in e)return t;var n=t[0].toUpperCase()+t.slice(1),r=t,i=Eb.length;while(i--)if(t=Eb[i]+n,t in e)return t;return r}function Gb(e,t,n){var r=Ab.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function Hb(e,t,r,i,s){for(var o=r===(i?"border":"content")?4:"width"===t?1:0,u=0;4>o;o+=2)"margin"===r&&(u+=n.css(e,r+R[o],!0,s)),i?("content"===r&&(u-=n.css(e,"padding"+R[o],!0,s)),"margin"!==r&&(u-=n.css(e,"border"+R[o]+"Width",!0,s))):(u+=n.css(e,"padding"+R[o],!0,s),"padding"!==r&&(u+=n.css(e,"border"+R[o]+"Width",!0,s)));return u}function Ib(e,t,r){var i=!0,s="width"===t?e.offsetWidth:e.offsetHeight,o=wb(e),u="border-box"===n.css(e,"boxSizing",!1,o);if(0>=s||null==s){if(s=xb(e,t,o),(0>s||null==s)&&(s=e.style[t]),vb.test(s))return s;i=u&&(k.boxSizingReliable()||s===e.style[t]),s=parseFloat(s)||0}return s+Hb(e,t,r||(u?"border":"content"),i,o)+"px"}function Jb(e,t){for(var r,i,s,o=[],u=0,a=e.length;a>u;u++)i=e[u],i.style&&(o[u]=L.get(i,"olddisplay"),r=i.style.display,t?(o[u]||"none"!==r||(i.style.display=""),""===i.style.display&&S(i)&&(o[u]=L.access(i,"olddisplay",tb(i.nodeName)))):(s=S(i),"none"===r&&s||L.set(i,"olddisplay",s?r:n.css(i,"display"))));for(u=0;a>u;u++)i=e[u],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?o[u]||"":"none"));return e}function Kb(e,t,n,r,i){return new Kb.prototype.init(e,t,n,r,i)}function Sb(){return setTimeout(function(){Lb=void 0}),Lb=n.now()}function Tb(e,t){var n,r=0,i={height:e};for(t=t?1:0;4>r;r+=2-t)n=R[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function Ub(e,t,n){for(var r,i=(Rb[t]||[]).concat(Rb["*"]),s=0,o=i.length;o>s;s++)if(r=i[s].call(n,t,e))return r}function Vb(e,t,r){var i,s,o,u,a,f,l,c,h=this,p={},d=e.style,v=e.nodeType&&S(e),m=L.get(e,"fxshow");r.queue||(a=n._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,f=a.empty.fire,a.empty.fire=function(){a.unqueued||f()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,n.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(r.overflow=[d.overflow,d.overflowX,d.overflowY],l=n.css(e,"display"),c="none"===l?L.get(e,"olddisplay")||tb(e.nodeName):l,"inline"===c&&"none"===n.css(e,"float")&&(d.display="inline-block")),r.overflow&&(d.overflow="hidden",h.always(function(){d.overflow=r.overflow[0],d.overflowX=r.overflow[1],d.overflowY=r.overflow[2]}));for(i in t)if(s=t[i],Nb.exec(s)){if(delete t[i],o=o||"toggle"===s,s===(v?"hide":"show")){if("show"!==s||!m||void 0===m[i])continue;v=!0}p[i]=m&&m[i]||n.style(e,i)}else l=void 0;if(n.isEmptyObject(p))"inline"===("none"===l?tb(e.nodeName):l)&&(d.display=l);else{m?"hidden"in m&&(v=m.hidden):m=L.access(e,"fxshow",{}),o&&(m.hidden=!v),v?n(e).show():h.done(function(){n(e).hide()}),h.done(function(){var t;L.remove(e,"fxshow");for(t in p)n.style(e,t,p[t])});for(i in p)u=Ub(v?m[i]:0,i,h),i in m||(m[i]=u.start,v&&(u.end=u.start,u.start="width"===i||"height"===i?1:0))}}function Wb(e,t){var r,i,s,o,u;for(r in e)if(i=n.camelCase(r),s=t[i],o=e[r],n.isArray(o)&&(s=o[1],o=e[r]=o[0]),r!==i&&(e[i]=o,delete e[r]),u=n.cssHooks[i],u&&"expand"in u){o=u.expand(o),delete e[i];for(r in o)r in e||(e[r]=o[r],t[r]=s)}else t[i]=s}function Xb(e,t,r){var i,s,o=0,u=Qb.length,a=n.Deferred().always(function(){delete f.elem}),f=function(){if(s)return!1;for(var t=Lb||Sb(),n=Math.max(0,l.startTime+l.duration-t),r=n/l.duration||0,i=1-r,o=0,u=l.tweens.length;u>o;o++)l.tweens[o].run(i);return a.notifyWith(e,[l,i,n]),1>i&&u?n:(a.resolveWith(e,[l]),!1)},l=a.promise({elem:e,props:n.extend({},t),opts:n.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:Lb||Sb(),duration:r.duration,tweens:[],createTween:function(t,r){var i=n.Tween(e,l.opts,t,r,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var n=0,r=t?l.tweens.length:0;if(s)return this;for(s=!0;r>n;n++)l.tweens[n].run(1);return t?a.resolveWith(e,[l,t]):a.rejectWith(e,[l,t]),this}}),c=l.props;for(Wb(c,l.opts.specialEasing);u>o;o++)if(i=Qb[o].call(l,e,c,l.opts))return i;return n.map(c,Ub,l),n.isFunction(l.opts.start)&&l.opts.start.call(e,l),n.fx.timer(n.extend(f,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function qc(e){return function(t,r){"string"!=typeof t&&(r=t,t="*");var i,s=0,o=t.toLowerCase().match(E)||[];if(n.isFunction(r))while(i=o[s++])"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(r)):(e[i]=e[i]||[]).push(r)}}function rc(e,t,r,i){function u(l){var h;return s[l]=!0,n.each(e[l]||[],function(e,n){var a=n(t,r,i);return"string"!=typeof a||o||s[a]?o?!(h=a):void 0:(t.dataTypes.unshift(a),u(a),!1)}),h}var s={},o=e===mc;return u(t.dataTypes[0])||!s["*"]&&u("*")}function sc(e,t){var r,i,s=n.ajaxSettings.flatOptions||{};for(r in t)void 0!==t[r]&&((s[r]?e:i||(i={}))[r]=t[r]);return i&&n.extend(!0,e,i),e}function tc(e,t,n){var r,i,s,o,u=e.contents,a=e.dataTypes;while("*"===a[0])a.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in u)if(u[i]&&u[i].test(r)){a.unshift(i);break}if(a[0]in n)s=a[0];else{for(i in n){if(!a[0]||e.converters[i+" "+a[0]]){s=i;break}o||(o=i)}s=s||o}return s?(s!==a[0]&&a.unshift(s),n[s]):void 0}function uc(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function Ac(e,t,r,i){var s;if(n.isArray(t))n.each(t,function(t,n){r||wc.test(e)?i(e,n):Ac(e+"["+("object"==typeof n?t:"")+"]",n,r,i)});else if(r||"object"!==n.type(t))i(e,t);else for(s in t)Ac(e+"["+s+"]",t[s],r,i)}function Jc(e){return n.isWindow(e)?e:9===e.nodeType&&e.defaultView}var c=[],d=c.slice,e=c.concat,f=c.push,g=c.indexOf,h={},i=h.toString,j=h.hasOwnProperty,k={},l=a.document,m="2.1.3",n=function(e,t){return new n.fn.init(e,t)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(e,t){return t.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return d.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:d.call(this)},pushStack:function(e){var t=n.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return n.each(this,e,t)},map:function(e){return this.pushStack(n.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(d.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var e,t,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[a]||{},a++),"object"==typeof u||n.isFunction(u)||(u={}),a===f&&(u=this,a--);f>a;a++)if(null!=(e=arguments[a]))for(t in e)r=u[t],i=e[t],u!==i&&(l&&i&&(n.isPlainObject(i)||(s=n.isArray(i)))?(s?(s=!1,o=r&&n.isArray(r)?r:[]):o=r&&n.isPlainObject(r)?r:{},u[t]=n.extend(l,o,i)):void 0!==i&&(u[t]=i));return u},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===n.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!n.isArray(e)&&e-parseFloat(e)+1>=0},isPlainObject:function(e){return"object"!==n.type(e)||e.nodeType||n.isWindow(e)?!1:e.constructor&&!j.call(e.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?h[i.call(e)]||"object":typeof e},globalEval:function(a){var b,c=eval;a=n.trim(a),a&&(1===a.indexOf("use strict")?(b=l.createElement("script"),b.text=a,l.head.appendChild(b).parentNode.removeChild(b)):c(a))},camelCase:function(e){return e.replace(p,"ms-").replace(q,r)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,o=e.length,u=s(e);if(n){if(u){for(;o>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(u){for(;o>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:function(e){return null==e?"":(e+"").replace(o,"")},makeArray:function(e,t){var r=t||[];return null!=e&&(s(Object(e))?n.merge(r,"string"==typeof e?[e]:e):f.call(r,e)),r},inArray:function(e,t,n){return null==t?-1:g.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;n>r;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r,i=[],s=0,o=e.length,u=!n;o>s;s++)r=!t(e[s],s),r!==u&&i.push(e[s]);return i},map:function(t,n,r){var i,o=0,u=t.length,a=s(t),f=[];if(a)for(;u>o;o++)i=n(t[o],o,r),null!=i&&f.push(i);else for(o in t)i=n(t[o],o,r),null!=i&&f.push(i);return e.apply([],f)},guid:1,proxy:function(e,t){var r,i,s;return"string"==typeof t&&(r=e[t],t=e,e=r),n.isFunction(e)?(i=d.call(arguments,2),s=function(){return e.apply(t||this,i.concat(d.call(arguments)))},s.guid=e.guid=e.guid||n.guid++,s):void 0},now:Date.now,support:k}),n.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){h["[object "+t+"]"]=t.toLowerCase()});var t=function(e){function ot(e,t,r,i){var s,u,f,l,c,d,g,y,S,x;if((t?t.ownerDocument||t:E)!==p&&h(t),t=t||p,r=r||[],l=t.nodeType,"string"!=typeof e||!e||1!==l&&9!==l&&11!==l)return r;if(!i&&v){if(11!==l&&(s=Z.exec(e)))if(f=s[1]){if(9===l){if(u=t.getElementById(f),!u||!u.parentNode)return r;if(u.id===f)return r.push(u),r}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&b(t,u)&&u.id===f)return r.push(u),r}else{if(s[2])return D.apply(r,t.getElementsByTagName(e)),r;if((f=s[3])&&n.getElementsByClassName)return D.apply(r,t.getElementsByClassName(f)),r}if(n.qsa&&(!m||!m.test(e))){if(y=g=w,S=t,x=1!==l&&e,1===l&&"object"!==t.nodeName.toLowerCase()){d=o(e),(g=t.getAttribute("id"))?y=g.replace(tt,"\\$&"):t.setAttribute("id",y),y="[id='"+y+"'] ",c=d.length;while(c--)d[c]=y+gt(d[c]);S=et.test(e)&&vt(t.parentNode)||t,x=d.join(",")}if(x)try{return D.apply(r,S.querySelectorAll(x)),r}catch(T){}finally{g||t.removeAttribute("id")}}}return a(e.replace(z,"$1"),t,r,i)}function ut(){function t(n,i){return e.push(n+" ")>r.cacheLength&&delete t[e.shift()],t[n+" "]=i}var e=[];return t}function at(e){return e[w]=!0,e}function ft(e){var t=p.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t){var n=e.split("|"),i=e.length;while(i--)r.attrHandle[n[i]]=t}function ct(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||L)-(~e.sourceIndex||L);if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function dt(e){return at(function(t){return t=+t,at(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function vt(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function mt(){}function gt(e){for(var t=0,n=e.length,r="";n>t;t++)r+=e[t].value;return r}function yt(e,t,n){var r=t.dir,i=n&&"parentNode"===r,s=x++;return t.first?function(t,n,s){while(t=t[r])if(1===t.nodeType||i)return e(t,n,s)}:function(t,n,o){var u,a,f=[S,s];if(o){while(t=t[r])if((1===t.nodeType||i)&&e(t,n,o))return!0}else while(t=t[r])if(1===t.nodeType||i){if(a=t[w]||(t[w]={}),(u=a[r])&&u[0]===S&&u[1]===s)return f[2]=u[2];if(a[r]=f,f[2]=e(t,n,o))return!0}}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function wt(e,t,n){for(var r=0,i=t.length;i>r;r++)ot(e,t[r],n);return n}function Et(e,t,n,r,i){for(var s,o=[],u=0,a=e.length,f=null!=t;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push(u));return o}function St(e,t,n,r,i,s){return r&&!r[w]&&(r=St(r)),i&&!i[w]&&(i=St(i,s)),at(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||wt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:Et(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=Et(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?H(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=Et(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):D.apply(o,g)})}function xt(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],u=o||r.relative[" "],a=o?1:0,l=yt(function(e){return e===t},u,!0),c=yt(function(e){return H(t,e)>-1},u,!0),h=[function(e,n,r){var i=!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r));return t=null,i}];s>a;a++)if(n=r.relative[e[a].type])h=[yt(bt(h),n)];else{if(n=r.filter[e[a].type].apply(null,e[a].matches),n[w]){for(i=++a;s>i;i++)if(r.relative[e[i].type])break;return St(a>1&&bt(h),a>1&&gt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(z,"$1"),n,i>a&&xt(e.slice(a,i)),s>i&&xt(e=e.slice(i)),s>i&&gt(e))}h.push(n)}return bt(h)}function Tt(e,t){var n=t.length>0,i=e.length>0,s=function(s,o,u,a,l){var c,h,d,v=0,m="0",g=s&&[],y=[],b=f,w=s||i&&r.find.TAG("*",l),E=S+=null==b?1:Math.random()||.1,x=w.length;for(l&&(f=o!==p&&o);m!==x&&null!=(c=w[m]);m++){if(i&&c){h=0;while(d=e[h++])if(d(c,o,u)){a.push(c);break}l&&(S=E)}n&&((c=!d&&c)&&v--,s&&g.push(c))}if(v+=m,n&&m!==v){h=0;while(d=t[h++])d(g,y,o,u);if(s){if(v>0)while(m--)g[m]||y[m]||(y[m]=M.call(a));y=Et(y)}D.apply(a,y),l&&!s&&y.length>0&&v+t.length>1&&ot.uniqueSort(a)}return l&&(S=E,f=b),g};return n?at(s):s}var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w="sizzle"+1*new Date,E=e.document,S=0,x=0,T=ut(),N=ut(),C=ut(),k=function(e,t){return e===t&&(c=!0),0},L=1<<31,A={}.hasOwnProperty,O=[],M=O.pop,_=O.push,D=O.push,P=O.slice,H=function(e,t){for(var n=0,r=e.length;r>n;n++)if(e[n]===t)return n;return-1},B="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",j="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",I=F.replace("w","w#"),q="\\["+j+"*("+F+")(?:"+j+"*([*^$|!~]?=)"+j+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+j+"*\\]",R=":("+F+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+q+")*)|.*)\\)|)",U=new RegExp(j+"+","g"),z=new RegExp("^"+j+"+|((?:^|[^\\\\])(?:\\\\.)*)"+j+"+$","g"),W=new RegExp("^"+j+"*,"+j+"*"),X=new RegExp("^"+j+"*([>+~]|"+j+")"+j+"*"),V=new RegExp("="+j+"*([^\\]'\"]*?)"+j+"*\\]","g"),$=new RegExp(R),J=new RegExp("^"+I+"$"),K={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+q),PSEUDO:new RegExp("^"+R),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+j+"*(even|odd|(([+-]|)(\\d*)n|)"+j+"*(?:([+-]|)"+j+"*(\\d+)|))"+j+"*\\)|)","i"),bool:new RegExp("^(?:"+B+")$","i"),needsContext:new RegExp("^"+j+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+j+"*((?:-\\d)?\\d*)"+j+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,G=/^h\d$/i,Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/[+~]/,tt=/'|\\/g,nt=new RegExp("\\\\([\\da-f]{1,6}"+j+"?|("+j+")|.)","ig"),rt=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},it=function(){h()};try{D.apply(O=P.call(E.childNodes),E.childNodes),O[E.childNodes.length].nodeType}catch(st){D={apply:O.length?function(e,t){_.apply(e,P.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}n=ot.support={},s=ot.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},h=ot.setDocument=function(e){var t,i,o=e?e.ownerDocument||e:E;return o!==p&&9===o.nodeType&&o.documentElement?(p=o,d=o.documentElement,i=o.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",it,!1):i.attachEvent&&i.attachEvent("onunload",it)),v=!s(o),n.attributes=ft(function(e){return e.className="i",!e.getAttribute("className")}),n.getElementsByTagName=ft(function(e){return e.appendChild(o.createComment("")),!e.getElementsByTagName("*").length}),n.getElementsByClassName=Y.test(o.getElementsByClassName),n.getById=ft(function(e){return d.appendChild(e).id=w,!o.getElementsByName||!o.getElementsByName(w).length}),n.getById?(r.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&v){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){return e.getAttribute("id")===t}}):(delete r.find.ID,r.filter.ID=function(e){var t=e.replace(nt,rt);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),r.find.TAG=n.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):n.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},r.find.CLASS=n.getElementsByClassName&&function(e,t){return v?t.getElementsByClassName(e):void 0},g=[],m=[],(n.qsa=Y.test(o.querySelectorAll))&&(ft(function(e){d.appendChild(e).innerHTML="<a id='"+w+"'></a><select id='"+w+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&m.push("[*^$]="+j+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||m.push("\\["+j+"*(?:value|"+B+")"),e.querySelectorAll("[id~="+w+"-]").length||m.push("~="),e.querySelectorAll(":checked").length||m.push(":checked"),e.querySelectorAll("a#"+w+"+*").length||m.push(".#.+[+~]")}),ft(function(e){var t=o.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&m.push("name"+j+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||m.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),m.push(",.*:")})),(n.matchesSelector=Y.test(y=d.matches||d.webkitMatchesSelector||d.mozMatchesSelector||d.oMatchesSelector||d.msMatchesSelector))&&ft(function(e){n.disconnectedMatch=y.call(e,"div"),y.call(e,"[s!='']:x"),g.push("!=",R)}),m=m.length&&new RegExp(m.join("|")),g=g.length&&new RegExp(g.join("|")),t=Y.test(d.compareDocumentPosition),b=t||Y.test(d.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},k=t?function(e,t){if(e===t)return c=!0,0;var r=!e.compareDocumentPosition-!t.compareDocumentPosition;return r?r:(r=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&r||!n.sortDetached&&t.compareDocumentPosition(e)===r?e===o||e.ownerDocument===E&&b(E,e)?-1:t===o||t.ownerDocument===E&&b(E,t)?1:l?H(l,e)-H(l,t):0:4&r?-1:1)}:function(e,t){if(e===t)return c=!0,0;var n,r=0,i=e.parentNode,s=t.parentNode,u=[e],a=[t];if(!i||!s)return e===o?-1:t===o?1:i?-1:s?1:l?H(l,e)-H(l,t):0;if(i===s)return ct(e,t);n=e;while(n=n.parentNode)u.unshift(n);n=t;while(n=n.parentNode)a.unshift(n);while(u[r]===a[r])r++;return r?ct(u[r],a[r]):u[r]===E?-1:a[r]===E?1:0},o):p},ot.matches=function(e,t){return ot(e,null,null,t)},ot.matchesSelector=function(e,t){if((e.ownerDocument||e)!==p&&h(e),t=t.replace(V,"='$1']"),!(!n.matchesSelector||!v||g&&g.test(t)||m&&m.test(t)))try{var r=y.call(e,t);if(r||n.disconnectedMatch||e.document&&11!==e.document.nodeType)return r}catch(i){}return ot(t,p,null,[e]).length>0},ot.contains=function(e,t){return(e.ownerDocument||e)!==p&&h(e),b(e,t)},ot.attr=function(e,t){(e.ownerDocument||e)!==p&&h(e);var i=r.attrHandle[t.toLowerCase()],s=i&&A.call(r.attrHandle,t.toLowerCase())?i(e,t,!v):void 0;return void 0!==s?s:n.attributes||!v?e.getAttribute(t):(s=e.getAttributeNode(t))&&s.specified?s.value:null},ot.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},ot.uniqueSort=function(e){var t,r=[],i=0,s=0;if(c=!n.detectDuplicates,l=!n.sortStable&&e.slice(0),e.sort(k),c){while(t=e[s++])t===e[s]&&(i=r.push(s));while(i--)e.splice(r[i],1)}return l=null,e},i=ot.getText=function(e){var t,n="",r=0,s=e.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=i(e)}else if(3===s||4===s)return e.nodeValue}else while(t=e[r++])n+=i(t);return n},r=ot.selectors={cacheLength:50,createPseudo:at,match:K,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(nt,rt),e[3]=(e[3]||e[4]||e[5]||"").replace(nt,rt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ot.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ot.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return K.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&$.test(n)&&(t=o(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(nt,rt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=new RegExp("(^|"+j+")"+e+"("+j+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ot.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i.replace(U," ")+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[w]||(m[w]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[w]||(t[w]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[w]||(c[w]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||h%r===0&&h/r>=0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||ot.error("unsupported pseudo: "+e);return i[w]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var r,s=i(e,t),o=s.length;while(o--)r=H(e,s[o]),e[r]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:at(function(e){var t=[],n=[],r=u(e.replace(z,"$1"));return r[w]?at(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),t[0]=null,!n.pop()}}),has:at(function(e){return function(t){return ot(e,t).length>0}}),contains:at(function(e){return e=e.replace(nt,rt),function(t){return(t.textContent||t.innerText||i(t)).indexOf(e)>-1}}),lang:at(function(e){return J.test(e||"")||ot.error("unsupported lang: "+e),e=e.replace(nt,rt).toLowerCase(),function(t){var n;do if(n=v?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===d},focus:function(e){return e===p.activeElement&&(!p.hasFocus||p.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!r.pseudos.empty(e)},header:function(e){return G.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:dt(function(){return[0]}),last:dt(function(e,t){return[t-1]}),eq:dt(function(e,t,n){return[0>n?n+t:n]}),even:dt(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:dt(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:dt(function(e,t,n){for(var r=0>n?n+t:n;--r>=0;)e.push(r);return e}),gt:dt(function(e,t,n){for(var r=0>n?n+t:n;++r<t;)e.push(r);return e})}},r.pseudos.nth=r.pseudos.eq;for(t in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})r.pseudos[t]=ht(t);for(t in{submit:!0,reset:!0})r.pseudos[t]=pt(t);return mt.prototype=r.filters=r.pseudos,r.setFilters=new mt,o=ot.tokenize=function(e,t){var n,i,s,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=r.preFilter;while(u){(!n||(i=W.exec(u)))&&(i&&(u=u.slice(i[0].length)||u),a.push(s=[])),n=!1,(i=X.exec(u))&&(n=i.shift(),s.push({value:n,type:i[0].replace(z," ")}),u=u.slice(n.length));for(o in r.filter)!(i=K[o].exec(u))||f[o]&&!(i=f[o](i))||(n=i.shift(),s.push({value:n,type:o,matches:i}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ot.error(e):N(e,a).slice(0)},u=ot.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=o(e)),n=t.length;while(n--)s=xt(t[n]),s[w]?r.push(s):i.push(s);s=C(e,Tt(i,r)),s.selector=e}return s},a=ot.select=function(e,t,i,s){var a,f,l,c,h,p="function"==typeof e&&e,d=!s&&o(e=p.selector||e);if(i=i||[],1===d.length){if(f=d[0]=d[0].slice(0),f.length>2&&"ID"===(l=f[0]).type&&n.getById&&9===t.nodeType&&v&&r.relative[f[1].type]){if(t=(r.find.ID(l.matches[0].replace(nt,rt),t)||[])[0],!t)return i;p&&(t=t.parentNode),e=e.slice(f.shift().value.length)}a=K.needsContext.test(e)?0:f.length;while(a--){if(l=f[a],r.relative[c=l.type])break;if((h=r.find[c])&&(s=h(l.matches[0].replace(nt,rt),et.test(f[0].type)&&vt(t.parentNode)||t))){if(f.splice(a,1),e=s.length&&gt(f),!e)return D.apply(i,s),i;break}}}return(p||u(e,d))(s,t,!v,i,et.test(e)&&vt(t.parentNode)||t),i},n.sortStable=w.split("").sort(k).join("")===w,n.detectDuplicates=!!c,h(),n.sortDetached=ft(function(e){return 1&e.compareDocumentPosition(p.createElement("div"))}),ft(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||lt("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),n.attributes&&ft(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||lt("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),ft(function(e){return null==e.getAttribute("disabled")})||lt(B,function(e,t,n){var r;return n?void 0:e[t]===!0?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),ot}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=n.expr.match.needsContext,v=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,w=/^.[^:#\[\.,]*$/;n.filter=function(e,t,r){var i=t[0];return r&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?n.find.matchesSelector(i,e)?[i]:[]:n.find.matches(e,n.grep(t,function(e){return 1===e.nodeType}))},n.fn.extend({find:function(e){var t,r=this.length,i=[],s=this;if("string"!=typeof e)return this.pushStack(n(e).filter(function(){for(t=0;r>t;t++)if(n.contains(s[t],this))return!0}));for(t=0;r>t;t++)n.find(e,s[t],i);return i=this.pushStack(r>1?n.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},filter:function(e){return this.pushStack(x(this,e||[],!1))},not:function(e){return this.pushStack(x(this,e||[],!0))},is:function(e){return!!x(this,"string"==typeof e&&u.test(e)?n(e):e||[],!1).length}});var y,z=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,A=n.fn.init=function(e,t){var r,i;if(!e)return this;if("string"==typeof e){if(r="<"===e[0]&&">"===e[e.length-1]&&e.length>=3?[null,e,null]:z.exec(e),!r||!r[1]&&t)return!t||t.jquery?(t||y).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof n?t[0]:t,n.merge(this,n.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:l,!0)),v.test(r[1])&&n.isPlainObject(t))for(r in t)n.isFunction(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return i=l.getElementById(r[2]),i&&i.parentNode&&(this.length=1,this[0]=i),this.context=l,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):n.isFunction(e)?"undefined"!=typeof y.ready?y.ready(e):e(n):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),n.makeArray(e,this))};A.prototype=n.fn,y=n(l);var B=/^(?:parents|prev(?:Until|All))/,C={children:!0,contents:!0,next:!0,prev:!0};n.extend({dir:function(e,t,r){var i=[],s=void 0!==r;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(s&&n(e).is(r))break;i.push(e)}return i},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),n.fn.extend({has:function(e){var t=n(e,this),r=t.length;return this.filter(function(){for(var e=0;r>e;e++)if(n.contains(this,t[e]))return!0})},closest:function(e,t){for(var r,i=0,s=this.length,o=[],a=u.test(e)||"string"!=typeof e?n(e,t||this.context):0;s>i;i++)for(r=this[i];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(a?a.index(r)>-1:1===r.nodeType&&n.find.matchesSelector(r,e))){o.push(r);break}return this.pushStack(o.length>1?n.unique(o):o)},index:function(e){return e?"string"==typeof e?g.call(n(e),this[0]):g.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(n.unique(n.merge(this.get(),n(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),n.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return n.dir(e,"parentNode")},parentsUntil:function(e,t,r){return n.dir(e,"parentNode",r)},next:function(e){return D(e,"nextSibling")},prev:function(e){return D(e,"previousSibling")},nextAll:function(e){return n.dir(e,"nextSibling")},prevAll:function(e){return n.dir(e,"previousSibling")},nextUntil:function(e,t,r){return n.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return n.dir(e,"previousSibling",r)},siblings:function(e){return n.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return n.sibling(e.firstChild)},contents:function(e){return e.contentDocument||n.merge([],e.childNodes)}},function(e,t){n.fn[e]=function(r,i){var s=n.map(this,t,r);return"Until"!==e.slice(-5)&&(i=r),i&&"string"==typeof i&&(s=n.filter(i,s)),this.length>1&&(C[e]||n.unique(s),B.test(e)&&s.reverse()),this.pushStack(s)}});var E=/\S+/g,F={};n.Callbacks=function(e){e="string"==typeof e?F[e]||G(e):n.extend({},e);var t,r,i,s,o,u,a=[],f=!e.once&&[],l=function(n){for(t=e.memory&&n,r=!0,u=s||0,s=0,o=a.length,i=!0;a&&o>u;u++)if(a[u].apply(n[0],n[1])===!1&&e.stopOnFalse){t=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):t?a=[]:c.disable())},c={add:function(){if(a){var r=a.length;!function u(t){n.each(t,function(t,r){var i=n.type(r);"function"===i?e.unique&&c.has(r)||a.push(r):r&&r.length&&"string"!==i&&u(r)})}(arguments),i?o=a.length:t&&(s=r,l(t))}return this},remove:function(){return a&&n.each(arguments,function(e,t){var r;while((r=n.inArray(t,a,r))>-1)a.splice(r,1),i&&(o>=r&&o--,u>=r&&u--)}),this},has:function(e){return e?n.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],o=0,this},disable:function(){return a=f=t=void 0,this},disabled:function(){return!a},lock:function(){return f=void 0,t||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return!a||r&&!f||(t=t||[],t=[e,t.slice?t.slice():t],i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},n.extend({Deferred:function(e){var t=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],r="pending",i={state:function(){return r},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var e=arguments;return n.Deferred(function(r){n.each(t,function(t,o){var u=n.isFunction(e[t])&&e[t];s[o[1]](function(){var e=u&&u.apply(this,arguments);e&&n.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[o[0]+"With"](this===i?r.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?n.extend(e,i):i}},s={};return i.pipe=i.then,n.each(t,function(e,n){var o=n[2],u=n[3];i[n[1]]=o.add,u&&o.add(function(){r=u},t[1^e][2].disable,t[2][2].lock),s[n[0]]=function(){return s[n[0]+"With"](this===s?i:this,arguments),this},s[n[0]+"With"]=o.fireWith}),i.promise(s),e&&e.call(s,s),s},when:function(e){var t=0,r=d.call(arguments),i=r.length,s=1!==i||e&&n.isFunction(e.promise)?i:0,o=1===s?e:n.Deferred(),u=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?d.call(arguments):r,n===a?o.notifyWith(t,n):--s||o.resolveWith(t,n)}},a,f,l;if(i>1)for(a=new Array(i),f=new Array(i),l=new Array(i);i>t;t++)r[t]&&n.isFunction(r[t].promise)?r[t].promise().done(u(t,l,r)).fail(o.reject).progress(u(t,f,a)):--s;return s||o.resolveWith(l,r),o.promise()}});var H;n.fn.ready=function(e){return n.ready.promise().done(e),this},n.extend({isReady:!1,readyWait:1,holdReady:function(e){e?n.readyWait++:n.ready(!0)},ready:function(e){(e===!0?--n.readyWait:n.isReady)||(n.isReady=!0,e!==!0&&--n.readyWait>0||(H.resolveWith(l,[n]),n.fn.triggerHandler&&(n(l).triggerHandler("ready"),n(l).off("ready"))))}}),n.ready.promise=function(e){return H||(H=n.Deferred(),"complete"===l.readyState?setTimeout(n.ready):(l.addEventListener("DOMContentLoaded",I,!1),a.addEventListener("load",I,!1))),H.promise(e)},n.ready.promise();var J=n.access=function(e,t,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===n.type(r)){s=!0;for(a in r)n.access(e,t,a,r[a],!0,o,u)}else if(void 0!==i&&(s=!0,n.isFunction(i)||(u=!0),l&&(u?(t.call(e,i),t=null):(l=t,t=function(e,t,r){return l.call(n(e),r)})),t))for(;f>a;a++)t(e[a],r,u?i:i.call(e[a],a,t(e[a],r)));return s?e:l?t.call(e):f?t(e[0],r):o};n.acceptData=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType},K.uid=1,K.accepts=n.acceptData,K.prototype={key:function(e){if(!K.accepts(e))return 0;var t={},r=e[this.expando];if(!r){r=K.uid++;try{t[this.expando]={value:r},Object.defineProperties(e,t)}catch(i){t[this.expando]=r,n.extend(e,t)}}return this.cache[r]||(this.cache[r]={}),r},set:function(e,t,r){var i,s=this.key(e),o=this.cache[s];if("string"==typeof t)o[t]=r;else if(n.isEmptyObject(o))n.extend(this.cache[s],t);else for(i in t)o[i]=t[i];return o},get:function(e,t){var n=this.cache[this.key(e)];return void 0===t?n:n[t]},access:function(e,t,r){var i;return void 0===t||t&&"string"==typeof t&&void 0===r?(i=this.get(e,t),void 0!==i?i:this.get(e,n.camelCase(t))):(this.set(e,t,r),void 0!==r?r:t)},remove:function(e,t){var r,i,s,o=this.key(e),u=this.cache[o];if(void 0===t)this.cache[o]={};else{n.isArray(t)?i=t.concat(t.map(n.camelCase)):(s=n.camelCase(t),t in u?i=[t,s]:(i=s,i=i in u?[i]:i.match(E)||[])),r=i.length;while(r--)delete u[i[r]]}},hasData:function(e){return!n.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}};var L=new K,M=new K,N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;n.extend({hasData:function(e){return M.hasData(e)||L.hasData(e)},data:function(e,t,n){return M.access(e,t,n)},removeData:function(e,t){M.remove(e,t)},_data:function(e,t,n){return L.access(e,t,n)},_removeData:function(e,t){L.remove(e,t)}}),n.fn.extend({data:function(e,t){var r,i,s,o=this[0],u=o&&o.attributes;if(void 0===e){if(this.length&&(s=M.get(o),1===o.nodeType&&!L.get(o,"hasDataAttrs"))){r=u.length;while(r--)u[r]&&(i=u[r].name,0===i.indexOf("data-")&&(i=n.camelCase(i.slice(5)),P(o,i,s[i])));L.set(o,"hasDataAttrs",!0)}return s}return"object"==typeof e?this.each(function(){M.set(this,e)}):J(this,function(t){var r,i=n.camelCase(e);if(o&&void 0===t){if(r=M.get(o,e),void 0!==r)return r;if(r=M.get(o,i),void 0!==r)return r;if(r=P(o,i,void 0),void 0!==r)return r}else this.each(function(){var n=M.get(this,i);M.set(this,i,t),-1!==e.indexOf("-")&&void 0!==n&&M.set(this,e,t)})},null,t,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){M.remove(this,e)})}}),n.extend({queue:function(e,t,r){var i;return e?(t=(t||"fx")+"queue",i=L.get(e,t),r&&(!i||n.isArray(r)?i=L.access(e,t,n.makeArray(r)):i.push(r)),i||[]):void 0},dequeue:function(e,t){t=t||"fx";var r=n.queue(e,t),i=r.length,s=r.shift(),o=n._queueHooks(e,t),u=function(){n.dequeue(e,t)};"inprogress"===s&&(s=r.shift(),i--),s&&("fx"===t&&r.unshift("inprogress"),delete o.stop,s.call(e,u,o)),!i&&o&&o.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return L.get(e,r)||L.access(e,r,{empty:n.Callbacks("once memory").add(function(){L.remove(e,[t+"queue",r])})})}}),n.fn.extend({queue:function(e,t){var r=2;return"string"!=typeof e&&(t=e,e="fx",r--),arguments.length<r?n.queue(this[0],e):void 0===t?this:this.each(function(){var r=n.queue(this,e,t);n._queueHooks(this,e),"fx"===e&&"inprogress"!==r[0]&&n.dequeue(this,e)})},dequeue:function(e){return this.each(function(){n.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var r,i=1,s=n.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(u--)r=L.get(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(t)}});var Q=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,R=["Top","Right","Bottom","Left"],S=function(e,t){return e=t||e,"none"===n.css(e,"display")||!n.contains(e.ownerDocument,e)},T=/^(?:checkbox|radio)$/i;!function(){var e=l.createDocumentFragment(),t=e.appendChild(l.createElement("div")),n=l.createElement("input");n.setAttribute("type","radio"),n.setAttribute("checked","checked"),n.setAttribute("name","t"),t.appendChild(n),k.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,t.innerHTML="<textarea>x</textarea>",k.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue}();var U="undefined";k.focusinBubbles="onfocusin"in a;var V=/^key/,W=/^(?:mouse|pointer|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Y=/^([^.]*)(?:\.(.+)|)$/;n.event={global:{},add:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.get(e);if(g){r.handler&&(o=r,r=o.handler,s=o.selector),r.guid||(r.guid=n.guid++),(f=g.events)||(f=g.events={}),(u=g.handle)||(u=g.handle=function(t){return typeof n!==U&&n.event.triggered!==t.type?n.event.dispatch.apply(e,arguments):void 0}),t=(t||"").match(E)||[""],l=t.length;while(l--)a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d&&(h=n.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,h=n.event.special[d]||{},c=n.extend({type:d,origType:m,data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&n.expr.match.needsContext.test(s),namespace:v.join(".")},o),(p=f[d])||(p=f[d]=[],p.delegateCount=0,h.setup&&h.setup.call(e,i,v,u)!==!1||e.addEventListener&&e.addEventListener(d,u,!1)),h.add&&(h.add.call(e,c),c.handler.guid||(c.handler.guid=r.guid)),s?p.splice(p.delegateCount++,0,c):p.push(c),n.event.global[d]=!0)}},remove:function(e,t,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g=L.hasData(e)&&L.get(e);if(g&&(f=g.events)){t=(t||"").match(E)||[""],l=t.length;while(l--)if(a=Y.exec(t[l])||[],d=m=a[1],v=(a[2]||"").split(".").sort(),d){h=n.event.special[d]||{},d=(i?h.delegateType:h.bindType)||d,p=f[d]||[],a=a[2]&&new RegExp("(^|\\.)"+v.join("\\.(?:.*\\.|)")+"(\\.|$)"),u=o=p.length;while(o--)c=p[o],!s&&m!==c.origType||r&&r.guid!==c.guid||a&&!a.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,h.remove&&h.remove.call(e,c));u&&!p.length&&(h.teardown&&h.teardown.call(e,v,g.handle)!==!1||n.removeEvent(e,d,g.handle),delete f[d])}else for(d in f)n.event.remove(e,d+t[l],r,i,!0);n.isEmptyObject(f)&&(delete g.handle,L.remove(e,"events"))}},trigger:function(e,t,r,i){var s,o,u,f,c,h,p,d=[r||l],v=j.call(e,"type")?e.type:e,m=j.call(e,"namespace")?e.namespace.split("."):[];if(o=u=r=r||l,3!==r.nodeType&&8!==r.nodeType&&!X.test(v+n.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),c=v.indexOf(":")<0&&"on"+v,e=e[n.expando]?e:new n.Event(v,"object"==typeof e&&e),e.isTrigger=i?2:3,e.namespace=m.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=r),t=null==t?[e]:n.makeArray(t,[e]),p=n.event.special[v]||{},i||!p.trigger||p.trigger.apply(r,t)!==!1)){if(!i&&!p.noBubble&&!n.isWindow(r)){for(f=p.delegateType||v,X.test(f+v)||(o=o.parentNode);o;o=o.parentNode)d.push(o),u=o;u===(r.ownerDocument||l)&&d.push(u.defaultView||u.parentWindow||a)}s=0;while((o=d[s++])&&!e.isPropagationStopped())e.type=s>1?f:p.bindType||v,h=(L.get(o,"events")||{})[e.type]&&L.get(o,"handle"),h&&h.apply(o,t),h=c&&o[c],h&&h.apply&&n.acceptData(o)&&(e.result=h.apply(o,t),e.result===!1&&e.preventDefault());return e.type=v,i||e.isDefaultPrevented()||p._default&&p._default.apply(d.pop(),t)!==!1||!n.acceptData(r)||c&&n.isFunction(r[v])&&!n.isWindow(r)&&(u=r[c],u&&(r[c]=null),n.event.triggered=v,r[v](),n.event.triggered=void 0,u&&(r[c]=u)),e.result}},dispatch:function(e){e=n.event.fix(e);var t,r,i,s,o,u=[],a=d.call(arguments),f=(L.get(this,"events")||{})[e.type]||[],l=n.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=n.event.handlers.call(this,e,f),t=0;while((s=u[t++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,r=0;while((o=s.handlers[r++])&&!e.isImmediatePropagationStopped())(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,i=((n.event.special[o.origType]||{}).handle||o.handler).apply(s.elem,a),void 0!==i&&(e.result=i)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,t){var r,i,s,o,u=[],a=t.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!==this;f=f.parentNode||this)if(f.disabled!==!0||"click"!==e.type){for(i=[],r=0;a>r;r++)o=t[r],s=o.selector+" ",void 0===i[s]&&(i[s]=o.needsContext?n(s,this).index(f)>=0:n.find(s,this,null,[f]).length),i[s]&&i.push(o);i.length&&u.push({elem:f,handlers:i})}return a<t.length&&u.push({elem:this,handlers:t.slice(a)}),u},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,r,i,s=t.button;return null==e.pageX&&null!=t.clientX&&(n=e.target.ownerDocument||l,r=n.documentElement,i=n.body,e.pageX=t.clientX+(r&&r.scrollLeft||i&&i.scrollLeft||0)-(r&&r.clientLeft||i&&i.clientLeft||0),e.pageY=t.clientY+(r&&r.scrollTop||i&&i.scrollTop||0)-(r&&r.clientTop||i&&i.clientTop||0)),e.which||void 0===s||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[n.expando])return e;var t,r,i,s=e.type,o=e,u=this.fixHooks[s];u||(this.fixHooks[s]=u=W.test(s)?this.mouseHooks:V.test(s)?this.keyHooks:{}),i=u.props?this.props.concat(u.props):this.props,e=new n.Event(o),t=i.length;while(t--)r=i[t],e[r]=o[r];return e.target||(e.target=l),3===e.target.nodeType&&(e.target=e.target.parentNode),u.filter?u.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==_()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===_()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&n.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return n.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,r,i){var s=n.extend(new n.Event,r,{type:e,isSimulated:!0,originalEvent:{}});i?n.event.trigger(s,null,t):n.event.dispatch.call(t,s),s.isDefaultPrevented()&&r.preventDefault()}},n.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},n.Event=function(e,t){return this instanceof n.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&e.returnValue===!1?Z:$):this.type=e,t&&n.extend(this,t),this.timeStamp=e&&e.timeStamp||n.now(),void (this[n.expando]=!0)):new n.Event(e,t)},n.Event.prototype={isDefaultPrevented:$,isPropagationStopped:$,isImmediatePropagationStopped:$,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=Z,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=Z,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=Z,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){n.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,i=this,s=e.relatedTarget,o=e.handleObj;return(!s||s!==i&&!n.contains(i,s))&&(e.type=o.origType,r=o.handler.apply(this,arguments),e.type=t),r}}}),k.focusinBubbles||n.each({focus:"focusin",blur:"focusout"},function(e,t){var r=function(e){n.event.simulate(t,e.target,n.event.fix(e),!0)};n.event.special[t]={setup:function(){var n=this.ownerDocument||this,i=L.access(n,t);i||n.addEventListener(e,r,!0),L.access(n,t,(i||0)+1)},teardown:function(){var n=this.ownerDocument||this,i=L.access(n,t)-1;i?L.access(n,t,i):(n.removeEventListener(e,r,!0),L.remove(n,t))}}}),n.fn.extend({on:function(e,t,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof t&&(r=r||t,t=void 0);for(u in e)this.on(u,t,r,e[u],s);return this}if(null==r&&null==i?(i=t,r=t=void 0):null==i&&("string"==typeof t?(i=r,r=void 0):(i=r,r=t,t=void 0)),i===!1)i=$;else if(!i)return this;return 1===s&&(o=i,i=function(e){return n().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=n.guid++)),this.each(function(){n.event.add(this,e,i,r,t)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,t,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,n(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,t,e[s]);return this}return(t===!1||"function"==typeof t)&&(r=t,t=void 0),r===!1&&(r=$),this.each(function(){n.event.remove(this,e,r,t)})},trigger:function(e,t){return this.each(function(){n.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];return r?n.event.trigger(e,t,r,!0):void 0}});var ab=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bb=/<([\w:]+)/,cb=/<|&#?\w+;/,db=/<(?:script|style|link)/i,eb=/checked\s*(?:[^=]|=\s*.checked.)/i,fb=/^$|\/(?:java|ecma)script/i,gb=/^true\/(.*)/,hb=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ib={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ib.optgroup=ib.option,ib.tbody=ib.tfoot=ib.colgroup=ib.caption=ib.thead,ib.th=ib.td,n.extend({clone:function(e,t,r){var i,s,o,u,a=e.cloneNode(!0),f=n.contains(e.ownerDocument,e);if(!(k.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||n.isXMLDoc(e)))for(u=ob(a),o=ob(e),i=0,s=o.length;s>i;i++)pb(o[i],u[i]);if(t)if(r)for(o=o||ob(e),u=u||ob(a),i=0,s=o.length;s>i;i++)nb(o[i],u[i]);else nb(e,a);return u=ob(a,"script"),u.length>0&&mb(u,!f&&ob(e,"script")),a},buildFragment:function(e,t,r,i){for(var s,o,u,a,f,l,c=t.createDocumentFragment(),h=[],p=0,d=e.length;d>p;p++)if(s=e[p],s||0===s)if("object"===n.type(s))n.merge(h,s.nodeType?[s]:s);else if(cb.test(s)){o=o||c.appendChild(t.createElement("div")),u=(bb.exec(s)||["",""])[1].toLowerCase(),a=ib[u]||ib._default,o.innerHTML=a[1]+s.replace(ab,"<$1></$2>")+a[2],l=a[0];while(l--)o=o.lastChild;n.merge(h,o.childNodes),o=c.firstChild,o.textContent=""}else h.push(t.createTextNode(s));c.textContent="",p=0;while(s=h[p++])if((!i||-1===n.inArray(s,i))&&(f=n.contains(s.ownerDocument,s),o=ob(c.appendChild(s),"script"),f&&mb(o),r)){l=0;while(s=o[l++])fb.test(s.type||"")&&r.push(s)}return c},cleanData:function(e){for(var t,r,i,s,o=n.event.special,u=0;void 0!==(r=e[u]);u++){if(n.acceptData(r)&&(s=r[L.expando],s&&(t=L.cache[s]))){if(t.events)for(i in t.events)o[i]?n.event.remove(r,i):n.removeEvent(r,i,t.handle);L.cache[s]&&delete L.cache[s]}delete M.cache[r[M.expando]]}}}),n.fn.extend({text:function(e){return J(this,function(e){return void 0===e?n.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=e)})},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=jb(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,i=e?n.filter(e,this):this,s=0;null!=(r=i[s]);s++)t||1!==r.nodeType||n.cleanData(ob(r)),r.parentNode&&(t&&n.contains(r.ownerDocument,r)&&mb(ob(r,"script")),r.parentNode.removeChild(r));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(n.cleanData(ob(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return n.clone(this,e,t)})},html:function(e){return J(this,function(e){var t=this[0]||{},r=0,i=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!db.test(e)&&!ib[(bb.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(ab,"<$1></$2>");try{for(;i>r;r++)t=this[r]||{},1===t.nodeType&&(n.cleanData(ob(t,!1)),t.innerHTML=e);t=0}catch(s){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,n.cleanData(ob(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(t,r){t=e.apply([],t);var i,s,o,u,a,f,l=0,c=this.length,h=this,p=c-1,d=t[0],v=n.isFunction(d);if(v||c>1&&"string"==typeof d&&!k.checkClone&&eb.test(d))return this.each(function(e){var n=h.eq(e);v&&(t[0]=d.call(this,e,n.html())),n.domManip(t,r)});if(c&&(i=n.buildFragment(t,this[0].ownerDocument,!1,this),s=i.firstChild,1===i.childNodes.length&&(i=s),s)){for(o=n.map(ob(i,"script"),kb),u=o.length;c>l;l++)a=i,l!==p&&(a=n.clone(a,!0,!0),u&&n.merge(o,ob(a,"script"))),r.call(this[l],a,l);if(u)for(f=o[o.length-1].ownerDocument,n.map(o,lb),l=0;u>l;l++)a=o[l],fb.test(a.type||"")&&!L.access(a,"globalEval")&&n.contains(f,a)&&(a.src?n._evalUrl&&n._evalUrl(a.src):n.globalEval(a.textContent.replace(hb,"")))}return this}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){n.fn[e]=function(e){for(var r,i=[],s=n(e),o=s.length-1,u=0;o>=u;u++)r=u===o?this:this.clone(!0),n(s[u])[t](r),f.apply(i,r.get());return this.pushStack(i)}});var qb,rb={},ub=/^margin/,vb=new RegExp("^("+Q+")(?!px)[a-z%]+$","i"),wb=function(e){return e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):a.getComputedStyle(e,null)};!function(){var e,t,r=l.documentElement,i=l.createElement("div"),s=l.createElement("div");if(s.style){s.style.backgroundClip="content-box",s.cloneNode(!0).style.backgroundClip="",k.clearCloneStyle="content-box"===s.style.backgroundClip,i.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",i.appendChild(s);function o(){s.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",s.innerHTML="",r.appendChild(i);var n=a.getComputedStyle(s,null);e="1%"!==n.top,t="4px"===n.width,r.removeChild(i)}a.getComputedStyle&&n.extend(k,{pixelPosition:function(){return o(),e},boxSizingReliable:function(){return null==t&&o(),t},reliableMarginRight:function(){var e,t=s.appendChild(l.createElement("div"));return t.style.cssText=s.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",t.style.marginRight=t.style.width="0",s.style.width="1px",r.appendChild(i),e=!parseFloat(a.getComputedStyle(t,null).marginRight),r.removeChild(i),s.removeChild(t),e}})}}(),n.swap=function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i};var zb=/^(none|table(?!-c[ea]).+)/,Ab=new RegExp("^("+Q+")(.*)$","i"),Bb=new RegExp("^([+-])=("+Q+")","i"),Cb={position:"absolute",visibility:"hidden",display:"block"},Db={letterSpacing:"0",fontWeight:"400"},Eb=["Webkit","O","Moz","ms"];n.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=xb(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,t,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=n.camelCase(t),f=e.style;return t=n.cssProps[a]||(n.cssProps[a]=Fb(f,a)),u=n.cssHooks[t]||n.cssHooks[a],void 0===r?u&&"get"in u&&void 0!==(s=u.get(e,!1,i))?s:f[t]:(o=typeof r,"string"===o&&(s=Bb.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(n.css(e,t)),o="number"),null!=r&&r===r&&("number"!==o||n.cssNumber[a]||(r+="px"),k.clearCloneStyle||""!==r||0!==t.indexOf("background")||(f[t]="inherit"),u&&"set"in u&&void 0===(r=u.set(e,r,i))||(f[t]=r)),void 0)}},css:function(e,t,r,i){var s,o,u,a=n.camelCase(t);return t=n.cssProps[a]||(n.cssProps[a]=Fb(e.style,a)),u=n.cssHooks[t]||n.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,r)),void 0===s&&(s=xb(e,t,i)),"normal"===s&&t in Db&&(s=Db[t]),""===r||r?(o=parseFloat(s),r===!0||n.isNumeric(o)?o||0:s):s}}),n.each(["height","width"],function(e,t){n.cssHooks[t]={get:function(e,r,i){return r?zb.test(n.css(e,"display"))&&0===e.offsetWidth?n.swap(e,Cb,function(){return Ib(e,t,i)}):Ib(e,t,i):void 0},set:function(e,r,i){var s=i&&wb(e);return Gb(e,r,i?Hb(e,t,i,"border-box"===n.css(e,"boxSizing",!1,s),s):0)}}}),n.cssHooks.marginRight=yb(k.reliableMarginRight,function(e,t){return t?n.swap(e,{display:"inline-block"},xb,[e,"marginRight"]):void 0}),n.each({margin:"",padding:"",border:"Width"},function(e,t){n.cssHooks[e+t]={expand:function(n){for(var r=0,i={},s="string"==typeof n?n.split(" "):[n];4>r;r++)i[e+R[r]+t]=s[r]||s[r-2]||s[0];return i}},ub.test(e)||(n.cssHooks[e+t].set=Gb)}),n.fn.extend({css:function(e,t){return J(this,function(e,t,r){var i,s,o={},u=0;if(n.isArray(t)){for(i=wb(e),s=t.length;s>u;u++)o[t[u]]=n.css(e,t[u],!1,i);return o}return void 0!==r?n.style(e,t,r):n.css(e,t)},e,t,arguments.length>1)},show:function(){return Jb(this,!0)},hide:function(){return Jb(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){S(this)?n(this).show():n(this).hide()})}}),n.Tween=Kb,Kb.prototype={constructor:Kb,init:function(e,t,r,i,s,o){this.elem=e,this.prop=r,this.easing=s||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=o||(n.cssNumber[r]?"":"px")},cur:function(){var e=Kb.propHooks[this.prop];return e&&e.get?e.get(this):Kb.propHooks._default.get(this)},run:function(e){var t,r=Kb.propHooks[this.prop];return this.pos=t=this.options.duration?n.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),r&&r.set?r.set(this):Kb.propHooks._default.set(this),this}},Kb.prototype.init.prototype=Kb.prototype,Kb.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=n.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){n.fx.step[e.prop]?n.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[n.cssProps[e.prop]]||n.cssHooks[e.prop])?n.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Kb.propHooks.scrollTop=Kb.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},n.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},n.fx=Kb.prototype.init,n.fx.step={};var Lb,Mb,Nb=/^(?:toggle|show|hide)$/,Ob=new RegExp("^(?:([+-])=|)("+Q+")([a-z%]*)$","i"),Pb=/queueHooks$/,Qb=[Vb],Rb={"*":[function(e,t){var r=this.createTween(e,t),i=r.cur(),s=Ob.exec(t),o=s&&s[3]||(n.cssNumber[e]?"":"px"),u=(n.cssNumber[e]||"px"!==o&&+i)&&Ob.exec(n.css(r.elem,e)),a=1,f=20;if(u&&u[3]!==o){o=o||u[3],s=s||[],u=+i||1;do a=a||".5",u/=a,n.style(r.elem,e,u+o);while(a!==(a=r.cur()/i)&&1!==a&&--f)}return s&&(u=r.start=+u||+i||0,r.unit=o,r.end=s[1]?u+(s[1]+1)*s[2]:+s[2]),r}]};n.Animation=n.extend(Xb,{tweener:function(e,t){n.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var r,i=0,s=e.length;s>i;i++)r=e[i],Rb[r]=Rb[r]||[],Rb[r].unshift(t)},prefilter:function(e,t){t?Qb.unshift(e):Qb.push(e)}}),n.speed=function(e,t,r){var i=e&&"object"==typeof e?n.extend({},e):{complete:r||!r&&t||n.isFunction(e)&&e,duration:e,easing:r&&t||t&&!n.isFunction(t)&&t};return i.duration=n.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in n.fx.speeds?n.fx.speeds[i.duration]:n.fx.speeds._default,(null==i.queue||i.queue===!0)&&(i.queue="fx"),i.old=i.complete,i.complete=function(){n.isFunction(i.old)&&i.old.call(this),i.queue&&n.dequeue(this,i.queue)},i},n.fn.extend({fadeTo:function(e,t,n,r){return this.filter(S).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,r,i){var s=n.isEmptyObject(e),o=n.speed(t,r,i),u=function(){var t=Xb(this,n.extend({},e),o);(s||L.get(this,"finish"))&&t.stop(!0)};return u.finish=u,s||o.queue===!1?this.each(u):this.queue(o.queue,u)},stop:function(e,t,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=t,t=e,e=void 0),t&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,s=null!=e&&e+"queueHooks",o=n.timers,u=L.get(this);if(s)u[s]&&u[s].stop&&i(u[s]);else for(s in u)u[s]&&u[s].stop&&Pb.test(s)&&i(u[s]);for(s=o.length;s--;)o[s].elem!==this||null!=e&&o[s].queue!==e||(o[s].anim.stop(r),t=!1,o.splice(s,1));(t||!r)&&n.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,r=L.get(this),i=r[e+"queue"],s=r[e+"queueHooks"],o=n.timers,u=i?i.length:0;for(r.finish=!0,n.queue(this,e,[]),s&&s.stop&&s.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;u>t;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete r.finish})}}),n.each(["toggle","show","hide"],function(e,t){var r=n.fn[t];n.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(Tb(t,!0),e,n,i)}}),n.each({slideDown:Tb("show"),slideUp:Tb("hide"),slideToggle:Tb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){n.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),n.timers=[],n.fx.tick=function(){var e,t=0,r=n.timers;for(Lb=n.now();t<r.length;t++)e=r[t],e()||r[t]!==e||r.splice(t--,1);r.length||n.fx.stop(),Lb=void 0},n.fx.timer=function(e){n.timers.push(e),e()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){Mb||(Mb=setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){clearInterval(Mb),Mb=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(e,t){return e=n.fx?n.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},function(){var e=l.createElement("input"),t=l.createElement("select"),n=t.appendChild(l.createElement("option"));e.type="checkbox",k.checkOn=""!==e.value,k.optSelected=n.selected,t.disabled=!0,k.optDisabled=!n.disabled,e=l.createElement("input"),e.value="t",e.type="radio",k.radioValue="t"===e.value}();var Yb,Zb,$b=n.expr.attrHandle;n.fn.extend({attr:function(e,t){return J(this,n.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){n.removeAttr(this,e)})}}),n.extend({attr:function(e,t,r){var i,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===U?n.prop(e,t,r):(1===o&&n.isXMLDoc(e)||(t=t.toLowerCase(),i=n.attrHooks[t]||(n.expr.match.bool.test(t)?Zb:Yb)),void 0===r?i&&"get"in i&&null!==(s=i.get(e,t))?s:(s=n.find.attr(e,t),null==s?void 0:s):null!==r?i&&"set"in i&&void 0!==(s=i.set(e,r,t))?s:(e.setAttribute(t,r+""),r):void n.removeAttr(e,t))},removeAttr:function(e,t){var r,i,s=0,o=t&&t.match(E);if(o&&1===e.nodeType)while(r=o[s++])i=n.propFix[r]||r,n.expr.match.bool.test(r)&&(e[i]=!1),e.removeAttribute(r)},attrHooks:{type:{set:function(e,t){if(!k.radioValue&&"radio"===t&&n.nodeName(e,"input")){var r=e.value;return e.setAttribute("type",t),r&&(e.value=r),t}}}}}),Zb={set:function(e,t,r){return t===!1?n.removeAttr(e,r):e.setAttribute(r,r),r}},n.each(n.expr.match.bool.source.match(/\w+/g),function(e,t){var r=$b[t]||n.find.attr;$b[t]=function(e,t,n){var i,s;return n||(s=$b[t],$b[t]=i,i=null!=r(e,t,n)?t.toLowerCase():null,$b[t]=s),i}});var _b=/^(?:input|select|textarea|button)$/i;n.fn.extend({prop:function(e,t){return J(this,n.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[n.propFix[e]||e]})}}),n.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!n.isXMLDoc(e),o&&(t=n.propFix[t]||t,s=n.propHooks[t]),void 0!==r?s&&"set"in s&&void 0!==(i=s.set(e,r,t))?i:e[t]=r:s&&"get"in s&&null!==(i=s.get(e,t))?i:e[t]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||_b.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),k.optSelected||(n.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this});var ac=/[\t\r\n\f]/g;n.fn.extend({addClass:function(e){var t,r,i,s,o,u,a="string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):" ")){o=0;while(s=t[o++])i.indexOf(" "+s+" ")<0&&(i+=s+" ");u=n.trim(i),r.className!==u&&(r.className=u)}return this},removeClass:function(e){var t,r,i,s,o,u,a=0===arguments.length||"string"==typeof e&&e,f=0,l=this.length;if(n.isFunction(e))return this.each(function(t){n(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(E)||[];l>f;f++)if(r=this[f],i=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(ac," "):"")){o=0;while(s=t[o++])while(i.indexOf(" "+s+" ")>=0)i=i.replace(" "+s+" "," ");u=e?n.trim(i):"",r.className!==u&&(r.className=u)}return this},toggleClass:function(e,t){var r=typeof e;return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):this.each(n.isFunction(e)?function(r){n(this).toggleClass(e.call(this,r,this.className,t),t)}:function(){if("string"===r){var t,i=0,s=n(this),o=e.match(E)||[];while(t=o[i++])s.hasClass(t)?s.removeClass(t):s.addClass(t)}else(r===U||"boolean"===r)&&(this.className&&L.set(this,"__className__",this.className),this.className=this.className||e===!1?"":L.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,r=this.length;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(ac," ").indexOf(t)>=0)return!0;return!1}});var bc=/\r/g;n.fn.extend({val:function(e){var t,r,i,s=this[0];if(arguments.length)return i=n.isFunction(e),this.each(function(r){var s;1===this.nodeType&&(s=i?e.call(this,r,n(this).val()):e,null==s?s="":"number"==typeof s?s+="":n.isArray(s)&&(s=n.map(s,function(e){return null==e?"":e+""})),t=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],t&&"set"in t&&void 0!==t.set(this,s,"value")||(this.value=s))});if(s)return t=n.valHooks[s.type]||n.valHooks[s.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(r=t.get(s,"value"))?r:(r=s.value,"string"==typeof r?r.replace(bc,""):null==r?"":r)}}),n.extend({valHooks:{option:{get:function(e){var t=n.find.attr(e,"value");return null!=t?t:n.trim(n.text(e))}},select:{get:function(e){for(var t,r,i=e.options,s=e.selectedIndex,o="select-one"===e.type||0>s,u=o?null:[],a=o?s+1:i.length,f=0>s?a:o?s:0;a>f;f++)if(r=i[f],!(!r.selected&&f!==s||(k.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&n.nodeName(r.parentNode,"optgroup"))){if(t=n(r).val(),o)return t;u.push(t)}return u},set:function(e,t){var r,i,s=e.options,o=n.makeArray(t),u=s.length;while(u--)i=s[u],(i.selected=n.inArray(i.value,o)>=0)&&(r=!0);return r||(e.selectedIndex=-1),o}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(e,t){return n.isArray(t)?e.checked=n.inArray(n(e).val(),t)>=0:void 0}},k.checkOn||(n.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){n.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),n.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var cc=n.now(),dc=/\?/;n.parseJSON=function(e){return JSON.parse(e+"")},n.parseXML=function(e){var t,r;if(!e||"string"!=typeof e)return null;try{r=new DOMParser,t=r.parseFromString(e,"text/xml")}catch(i){t=void 0}return(!t||t.getElementsByTagName("parsererror").length)&&n.error("Invalid XML: "+e),t};var ec=/#.*$/,fc=/([?&])_=[^&]*/,gc=/^(.*?):[ \t]*([^\r\n]*)$/gm,hc=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ic=/^(?:GET|HEAD)$/,jc=/^\/\//,kc=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,lc={},mc={},nc="*/".concat("*"),oc=a.location.href,pc=kc.exec(oc.toLowerCase())||[];n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:oc,type:"GET",isLocal:hc.test(pc[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":nc,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?sc(sc(e,n.ajaxSettings),t):sc(n.ajaxSettings,e)},ajaxPrefilter:qc(lc),ajaxTransport:qc(mc),ajax:function(e,t){function T(e,t,o,a){var l,g,y,w,E,x=t;2!==b&&(b=2,u&&clearTimeout(u),r=void 0,s=a||"",S.readyState=e>0?4:0,l=e>=200&&300>e||304===e,o&&(w=tc(c,S,o)),w=uc(c,w,S,l),l?(c.ifModified&&(E=S.getResponseHeader("Last-Modified"),E&&(n.lastModified[i]=E),E=S.getResponseHeader("etag"),E&&(n.etag[i]=E)),204===e||"HEAD"===c.type?x="nocontent":304===e?x="notmodified":(x=w.state,g=w.data,y=w.error,l=!y)):(y=x,(e||!x)&&(x="error",0>e&&(e=0))),S.status=e,S.statusText=(t||x)+"",l?d.resolveWith(h,[g,x,S]):d.rejectWith(h,[S,x,y]),S.statusCode(m),m=void 0,f&&p.trigger(l?"ajaxSuccess":"ajaxError",[S,c,l?g:y]),v.fireWith(h,[S,x]),f&&(p.trigger("ajaxComplete",[S,c]),--n.active||n.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var r,i,s,o,u,a,f,l,c=n.ajaxSetup({},t),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?n(h):n.event,d=n.Deferred(),v=n.Callbacks("once memory"),m=c.statusCode||{},g={},y={},b=0,w="canceled",S={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!o){o={};while(t=gc.exec(s))o[t[1].toLowerCase()]=t[2]}t=o[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else S.always(e[S.status]);return this},abort:function(e){var t=e||w;return r&&r.abort(t),T(0,t),this}};if(d.promise(S).complete=v.add,S.success=S.done,S.error=S.fail,c.url=((e||c.url||oc)+"").replace(ec,"").replace(jc,pc[1]+"//"),c.type=t.method||t.type||c.method||c.type,c.dataTypes=n.trim(c.dataType||"*").toLowerCase().match(E)||[""],null==c.crossDomain&&(a=kc.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===pc[1]&&a[2]===pc[2]&&(a[3]||("http:"===a[1]?"80":"443"))===(pc[3]||("http:"===pc[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=n.param(c.data,c.traditional)),rc(lc,c,t,S),2===b)return S;f=n.event&&c.global,f&&0===n.active++&&n.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!ic.test(c.type),i=c.url,c.hasContent||(c.data&&(i=c.url+=(dc.test(i)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=fc.test(i)?i.replace(fc,"$1_="+cc++):i+(dc.test(i)?"&":"?")+"_="+cc++)),c.ifModified&&(n.lastModified[i]&&S.setRequestHeader("If-Modified-Since",n.lastModified[i]),n.etag[i]&&S.setRequestHeader("If-None-Match",n.etag[i])),(c.data&&c.hasContent&&c.contentType!==!1||t.contentType)&&S.setRequestHeader("Content-Type",c.contentType),S.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+nc+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)S.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,S,c)!==!1&&2!==b){w="abort";for(l in{success:1,error:1,complete:1})S[l](c[l]);if(r=rc(mc,c,t,S)){S.readyState=1,f&&p.trigger("ajaxSend",[S,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){S.abort("timeout")},c.timeout));try{b=1,r.send(g,T)}catch(x){if(!(2>b))throw x;T(-1,x)}}else T(-1,"No Transport");return S}return S.abort()},getJSON:function(e,t,r){return n.get(e,t,r,"json")},getScript:function(e,t){return n.get(e,void 0,t,"script")}}),n.each(["get","post"],function(e,t){n[t]=function(e,r,i,s){return n.isFunction(r)&&(s=s||i,i=r,r=void 0),n.ajax({url:e,type:t,dataType:s,data:r,success:i})}}),n._evalUrl=function(e){return n.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(e){var t;return n.isFunction(e)?this.each(function(t){n(this).wrapAll(e.call(this,t))}):(this[0]&&(t=n(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return this.each(n.isFunction(e)?function(t){n(this).wrapInner(e.call(this,t))}:function(){var t=n(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=n.isFunction(e);return this.each(function(r){n(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}}),n.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},n.expr.filters.visible=function(e){return!n.expr.filters.hidden(e)};var vc=/%20/g,wc=/\[\]$/,xc=/\r?\n/g,yc=/^(?:submit|button|image|reset|file)$/i,zc=/^(?:input|select|textarea|keygen)/i;n.param=function(e,t){var r,i=[],s=function(e,t){t=n.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(e)||e.jquery&&!n.isPlainObject(e))n.each(e,function(){s(this.name,this.value)});else for(r in e)Ac(r,e[r],t,s);return i.join("&").replace(vc,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=n.prop(this,"elements");return e?n.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!n(this).is(":disabled")&&zc.test(this.nodeName)&&!yc.test(e)&&(this.checked||!T.test(e))}).map(function(e,t){var r=n(this).val();return null==r?null:n.isArray(r)?n.map(r,function(e){return{name:t.name,value:e.replace(xc,"\r\n")}}):{name:t.name,value:r.replace(xc,"\r\n")}}).get()}}),n.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Bc=0,Cc={},Dc={0:200,1223:204},Ec=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var e in Cc)Cc[e]()}),k.cors=!!Ec&&"withCredentials"in Ec,k.ajax=Ec=!!Ec,n.ajaxTransport(function(e){var t;return k.cors||Ec&&!e.crossDomain?{send:function(n,r){var i,s=e.xhr(),o=++Bc;if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)s[i]=e.xhrFields[i];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)s.setRequestHeader(i,n[i]);t=function(e){return function(){t&&(delete Cc[o],t=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status,s.statusText):r(Dc[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:void 0,s.getAllResponseHeaders()))}},s.onload=t(),s.onerror=t("error"),t=Cc[o]=t("abort");try{s.send(e.hasContent&&e.data||null)}catch(u){if(t)throw u}},abort:function(){t&&t()}}:void 0}),n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return n.globalEval(e),e}}}),n.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),n.ajaxTransport("script",function(e){if(e.crossDomain){var t,r;return{send:function(i,s){t=n("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",r=function(e){t.remove(),r=null,e&&s("error"===e.type?404:200,e.type)}),l.head.appendChild(t[0])},abort:function(){r&&r()}}}});var Fc=[],Gc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Fc.pop()||n.expando+"_"+cc++;return this[e]=!0,e}}),n.ajaxPrefilter("json jsonp",function(e,t,r){var i,s,o,u=e.jsonp!==!1&&(Gc.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Gc.test(e.data)&&"data");return u||"jsonp"===e.dataTypes[0]?(i=e.jsonpCallback=n.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,u?e[u]=e[u].replace(Gc,"$1"+i):e.jsonp!==!1&&(e.url+=(dc.test(e.url)?"&":"?")+e.jsonp+"="+i),e.converters["script json"]=function(){return o||n.error(i+" was not called"),o[0]},e.dataTypes[0]="json",s=a[i],a[i]=function(){o=arguments},r.always(function(){a[i]=s,e[i]&&(e.jsonpCallback=t.jsonpCallback,Fc.push(i)),o&&n.isFunction(s)&&s(o[0]),o=s=void 0}),"script"):void 0}),n.parseHTML=function(e,t,r){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(r=t,t=!1),t=t||l;var i=v.exec(e),s=!r&&[];return i?[t.createElement(i[1])]:(i=n.buildFragment([e],t,s),s&&s.length&&n(s).remove(),n.merge([],i.childNodes))};var Hc=n.fn.load;n.fn.load=function(e,t,r){if("string"!=typeof e&&Hc)return Hc.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=n.trim(e.slice(a)),e=e.slice(0,a)),n.isFunction(t)?(r=t,t=void 0):t&&"object"==typeof t&&(s="POST"),u.length>0&&n.ajax({url:e,type:s,dataType:"html",data:t}).done(function(e){o=arguments,u.html(i?n("<div>").append(n.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,o||[e.responseText,t,e])}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){n.fn[t]=function(e){return this.on(t,e)}}),n.expr.filters.animated=function(e){return n.grep(n.timers,function(t){return e===t.elem}).length};var Ic=a.document.documentElement;n.offset={setOffset:function(e,t,r){var i,s,o,u,a,f,l,c=n.css(e,"position"),h=n(e),p={};"static"===c&&(e.style.position="relative"),a=h.offset(),o=n.css(e,"top"),f=n.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(o+f).indexOf("auto")>-1,l?(i=h.position(),u=i.top,s=i.left):(u=parseFloat(o)||0,s=parseFloat(f)||0),n.isFunction(t)&&(t=t.call(e,r,a)),null!=t.top&&(p.top=t.top-a.top+u),null!=t.left&&(p.left=t.left-a.left+s),"using"in t?t.using.call(e,p):h.css(p)}},n.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){n.offset.setOffset(this,e,t)});var t,r,i=this[0],s={top:0,left:0},o=i&&i.ownerDocument;if(o)return t=o.documentElement,n.contains(t,i)?(typeof i.getBoundingClientRect!==U&&(s=i.getBoundingClientRect()),r=Jc(o),{top:s.top+r.pageYOffset-t.clientTop,left:s.left+r.pageXOffset-t.clientLeft}):s},position:function(){if(this[0]){var e,t,r=this[0],i={top:0,left:0};return"fixed"===n.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),n.nodeName(e[0],"html")||(i=e.offset()),i.top+=n.css(e[0],"borderTopWidth",!0),i.left+=n.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-n.css(r,"marginTop",!0),left:t.left-i.left-n.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||Ic;while(e&&!n.nodeName(e,"html")&&"static"===n.css(e,"position"))e=e.offsetParent;return e||Ic})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var r="pageYOffset"===t;n.fn[e]=function(n){return J(this,function(e,n,i){var s=Jc(e);return void 0===i?s?s[t]:e[n]:void (s?s.scrollTo(r?a.pageXOffset:i,r?i:a.pageYOffset):e[n]=i)},e,n,arguments.length,null)}}),n.each(["top","left"],function(e,t){n.cssHooks[t]=yb(k.pixelPosition,function(e,r){return r?(r=xb(e,t),vb.test(r)?n(e).position()[t]+"px":r):void 0})}),n.each({Height:"height",Width:"width"},function(e,t){n.each({padding:"inner"+e,content:t,"":"outer"+e},function(r,i){n.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return J(this,function(t,r,i){var s;return n.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(s=t.documentElement,Math.max(t.body["scroll"+e],s["scroll"+e],t.body["offset"+e],s["offset"+e],s["client"+e])):void 0===i?n.css(t,r,u):n.style(t,r,i,u)},t,o?i:void 0,o,null)}})}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var Kc=a.jQuery,Lc=a.$;return n.noConflict=function(e){return a.$===n&&(a.$=Lc),e&&a.jQuery===n&&(a.jQuery=Kc),n},typeof b===U&&(a.jQuery=a.$=n),n}),define("can/util/can",[],function(){var e=window.can||{};if(typeof GLOBALCAN=="undefined"||GLOBALCAN!==!1)window.can=e;e.k=function(){},e.isDeferred=function(e){return e&&typeof e.then=="function"&&typeof e.pipe=="function"};var t=0;return e.cid=function(e,n){return e._cid||(t++,e._cid=(n||"")+t),e._cid},e.VERSION="2.1.4",e.simpleExtend=function(e,t){for(var n in t)e[n]=t[n];return e},e.frag=function(t){var n;return!t||typeof t=="string"?(n=e.buildFragment(t==null?"":""+t,document.body),n.childNodes.length||n.appendChild(document.createTextNode("")),n):t.nodeType===11?t:typeof t.nodeType=="number"?(n=document.createDocumentFragment(),n.appendChild(t),n):typeof t.length=="number"?(n=document.createDocumentFragment(),e.each(t,function(t){n.appendChild(e.frag(t))}),n):(n=e.buildFragment(""+t,document.body),n.childNodes.length||n.appendChild(document.createTextNode("")),n)},e.__reading=function(){},e}),define("can/util/attr",["can/util/can"],function(e){var t=window.setImmediate||function(e){return setTimeout(e,0)},n={MutationObserver:window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver,map:{"class":"className",value:"value",innerText:"innerText",textContent:"textContent",checked:!0,disabled:!0,readonly:!0,required:!0,src:function(e,t){return t==null||t===""?(e.removeAttribute("src"),null):(e.setAttribute("src",t),t)},style:function(e,t){return e.style.cssText=t||""}},defaultValue:["input","textarea"],set:function(t,r,i){var s;n.MutationObserver||(s=n.get(t,r));var o=t.nodeName.toString().toLowerCase(),u=n.map[r],a;typeof u=="function"?a=u(t,i):u===!0?(a=t[r]=!0,r==="checked"&&t.type==="radio"&&e.inArray(o,n.defaultValue)>=0&&(t.defaultChecked=!0)):u?(a=t[u]=i,u==="value"&&e.inArray(o,n.defaultValue)>=0&&(t.defaultValue=i)):(t.setAttribute(r,i),a=i),!n.MutationObserver&&a!==s&&n.trigger(t,r,s)},trigger:function(n,r,i){if(e.data(e.$(n),"canHasAttributesBindings"))return t(function(){e.trigger(n,{type:"attributes",attributeName:r,target:n,oldValue:i,bubbles:!1},[])})},get:function(e,t){var r=n.map[t];return typeof r=="string"&&e[r]?e[r]:e.getAttribute(t)},remove:function(e,t){var r;n.MutationObserver||(r=n.get(e,t));var i=n.map[t];typeof i=="function"&&i(e,undefined),i===!0?e[t]=!1:typeof i=="string"?e[i]="":e.removeAttribute(t),!n.MutationObserver&&r!=null&&n.trigger(e,t,r)},has:function(){var e=document.createElement("div");return e.hasAttribute?function(e,t){return e.hasAttribute(t)}:function(e,t){return e.getAttribute(t)!==null}}()};return n}),define("can/event",["can/util/can"],function(e){return e.addEvent=function(e,t){var n=this.__bindEvents||(this.__bindEvents={}),r=n[e]||(n[e]=[]);return r.push({handler:t,name:e}),this},e.listenTo=function(t,n,r){var i=this.__listenToEvents;i||(i=this.__listenToEvents={});var s=e.cid(t),o=i[s];o||(o=i[s]={obj:t,events:{}});var u=o.events[n];u||(u=o.events[n]=[]),u.push(r),e.bind.call(t,n,r)},e.stopListening=function(t,n,r){var i=this.__listenToEvents,s=i,o=0;if(!i)return this;if(t){var u=e.cid(t);(s={})[u]=i[u];if(!i[u])return this}for(var a in s){var f=s[a],l;t=i[a].obj,n?(l={})[n]=f.events[n]:l=f.events;for(var c in l){var h=l[c]||[];o=0;while(o<h.length)r&&r===h[o]||!r?(e.unbind.call(t,c,h[o]),h.splice(o,1)):o++;h.length||delete f.events[c]}e.isEmptyObject(f.events)&&delete i[a]}return this},e.removeEvent=function(e,t,n){if(!this.__bindEvents)return this;var r=this.__bindEvents[e]||[],i=0,s,o=typeof t=="function";while(i<r.length)s=r[i],(n?n(s,e,t):o&&s.handler===t||!o&&(s.cid===t||!t))?r.splice(i,1):i++;return this},e.dispatch=function(e,t){var n=this.__bindEvents;if(!n)return;typeof e=="string"&&(e={type:e});var r=e.type,i=(n[r]||[]).slice(0),s=[e];t&&s.push.apply(s,t);for(var o=0,u=i.length;o<u;o++)i[o].handler.apply(this,s);return e},e.one=function(t,n){var r=function(){return e.unbind.call(this,t,r),n.apply(this,arguments)};return e.bind.call(this,t,r),this},e.event={on:function(){return arguments.length===0&&e.Control&&this instanceof e.Control?e.Control.prototype.on.call(this):e.addEvent.apply(this,arguments)},off:function(){return arguments.length===0&&e.Control&&this instanceof e.Control?e.Control.prototype.off.call(this):e.removeEvent.apply(this,arguments)},bind:e.addEvent,unbind:e.removeEvent,delegate:function(t,n,r){return e.addEvent.call(this,n,r)},undelegate:function(t,n,r){return e.removeEvent.call(this,n,r)},trigger:e.dispatch,one:e.one,addEvent:e.addEvent,removeEvent:e.removeEvent,listenTo:e.listenTo,stopListening:e.stopListening,dispatch:e.dispatch},e.event}),define("can/util/array/each",["can/util/can"],function(e){var t=function(e){var t=e.length;return typeof arr!="function"&&(t===0||typeof t=="number"&&t>0&&t-1 in e)};return e.each=function(n,r,i){var s=0,o,u,a;if(n)if(t(n))if(e.List&&n instanceof e.List)for(u=n.attr("length");s<u;s++){a=n.attr(s);if(r.call(i||a,a,s,n)===!1)break}else for(u=n.length;s<u;s++){a=n[s];if(r.call(i||a,a,s,n)===!1)break}else if(typeof n=="object")if(e.Map&&n instanceof e.Map||n===e.route){var f=e.Map.keys(n);for(s=0,u=f.length;s<u;s++){o=f[s],a=n.attr(o);if(r.call(i||a,a,o,n)===!1)break}}else for(o in n)if(n.hasOwnProperty(o)&&r.call(i||n[o],n[o],o,n)===!1)break;return n},e}),define("can/util/inserted",["can/util/can"],function(e){e.inserted=function(t){t=e.makeArray(t);var n=!1,r=e.$(document.contains?document:document.body),i;for(var s=0,o;(o=t[s])!==undefined;s++){if(!n){if(!o.getElementsByTagName)continue;if(!e.has(r,o).length)return;n=!0}if(n&&o.getElementsByTagName){i=e.makeArray(o.getElementsByTagName("*")),e.trigger(o,"inserted",[],!1);for(var u=0,a;(a=i[u])!==undefined;u++)e.trigger(a,"inserted",[],!1)}}},e.appendChild=function(t,n){var r;n.nodeType===11?r=e.makeArray(n.childNodes):r=[n],t.appendChild(n),e.inserted(r)},e.insertBefore=function(t,n,r){var i;n.nodeType===11?i=e.makeArray(n.childNodes):i=[n],t.insertBefore(n,r),e.inserted(i)}}),define("can/util/jquery",["jquery","can/util/can","can/util/attr","can/event","can/util/array/each","can/util/inserted"],function(e,t,n,r){var i=function(e){return e.nodeName&&(e.nodeType===1||e.nodeType===9)||e==window};e.extend(t,e,{trigger:function(n,r,s,o){i(n)?e.event.trigger(r,s,n,!o):n.trigger?n.trigger(r,s):(typeof r=="string"&&(r={type:r}),r.target=r.target||n,s&&(s.length&&typeof s=="string"?s=[s]:s.length||(s=[s])),s||(s=[]),t.dispatch.call(n,r,s))},event:t.event,addEvent:t.addEvent,removeEvent:t.removeEvent,buildFragment:function(t,n){var r;return t=[t],n=n||document,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,r=e.buildFragment(t,n),r.cacheable?e.clone(r.fragment):r.fragment||r},$:e,each:t.each,bind:function(n,r){return this.bind&&this.bind!==t.bind?this.bind(n,r):i(this)?e.event.add(this,n,r):t.addEvent.call(this,n,r),this},unbind:function(n,r){return this.unbind&&this.unbind!==t.unbind?this.unbind(n,r):i(this)?e.event.remove(this,n,r):t.removeEvent.call(this,n,r),this},delegate:function(n,r,s){return this.delegate?this.delegate(n,r,s):i(this)?e(this).delegate(n,r,s):t.bind.call(this,r,s),this},undelegate:function(n,r,s){return this.undelegate?this.undelegate(n,r,s):i(this)?e(this).undelegate(n,r,s):t.unbind.call(this,r,s),this},proxy:function(e,t){return function(){return e.apply(t,arguments)}},attr:n}),t.on=t.bind,t.off=t.unbind,e.each(["append","filter","addClass","remove","data","get","has"],function(e,n){t[n]=function(e){return e[n].apply(e,t.makeArray(arguments).slice(1))}});var s=e.cleanData;e.cleanData=function(n){e.each(n,function(e,n){n&&t.trigger(n,"removed",[],!1)}),s(n)};var o=e.fn.domManip,u;e.fn.domManip=function(e,t,n){for(var r=1;r<arguments.length;r++)if(typeof arguments[r]=="function"){u=r;break}return o.apply(this,arguments)},e(document.createElement("div")).append(document.createElement("div")),e.fn.domManip=u===2?function(e,n,r){return o.call(this,e,n,function(e){var n;e.nodeType===11&&(n=t.makeArray(e.childNodes));var i=r.apply(this,arguments);return t.inserted(n?n:[e]),i})}:function(e,n){return o.call(this,e,function(e){var r;e.nodeType===11&&(r=t.makeArray(e.childNodes));var i=n.apply(this,arguments);return t.inserted(r?r:[e]),i})};if(!t.attr.MutationObserver){var a=e.attr;e.attr=function(e,n){var r,i;arguments.length>=3&&(r=a.call(this,e,n));var s=a.apply(this,arguments);return arguments.length>=3&&(i=a.call(this,e,n)),i!==r&&t.attr.trigger(e,n,r),s};var f=e.removeAttr;e.removeAttr=function(e,n){var r=a.call(this,e,n),i=f.apply(this,arguments);return r!=null&&t.attr.trigger(e,n,r),i},e.event.special.attributes={setup:function(){t.data(t.$(this),"canHasAttributesBindings",!0)},teardown:function(){e.removeData(this,"canHasAttributesBindings")}}}else e.event.special.attributes={setup:function(){var e=this,n=new t.attr.MutationObserver(function(n){n.forEach(function(n){var r=t.simpleExtend({},n);t.trigger(e,r,[])})});n.observe(this,{attributes:!0,attributeOldValue:!0}),t.data(t.$(this),"canAttributesObserver",n)},teardown:function(){t.data(t.$(this),"canAttributesObserver").disconnect(),e.removeData(this,"canAttributesObserver")}};return function(){var e="<-\n>",n=t.buildFragment(e,document);if(e!==n.childNodes[0].nodeValue){var r=t.buildFragment;t.buildFragment=function(e,t){var n=r(e,t);return n.childNodes.length===1&&n.childNodes[0].nodeType===3&&(n.childNodes[0].nodeValue=e),n}}}(),e.event.special.inserted={},e.event.special.removed={},t}),define("can/util/library",["can/util/jquery"],function(e){return e}),define("can/util/bind",["can/util/library"],function(e){return e.bindAndSetup=function(){return e.addEvent.apply(this,arguments),this._init||(this._bindings?this._bindings++:(this._bindings=1,this._bindsetup&&this._bindsetup())),this},e.unbindAndTeardown=function(t,n){return e.removeEvent.apply(this,arguments),this._bindings===null?this._bindings=0:this._bindings--,!this._bindings&&this._bindteardown&&this._bindteardown(),this},e}),define("can/map/bubble",["can/util/library"],function(e){var t=e.bubble={event:function(e,t){return e.constructor._bubbleRule(t,e)},childrenOf:function(e,n){e._each(function(r,i){r&&r.bind&&t.toParent(r,e,i,n)})},teardownChildrenFrom:function(e,n){e._each(function(r){t.teardownFromParent(e,r,n)})},toParent:function(t,n,r,i){e.listenTo.call(n,t,i,function(){var i=e.makeArray(arguments),s=i.shift();i[0]=(e.List&&n instanceof e.List?n.indexOf(t):r)+(i[0]?"."+i[0]:""),s.triggeredNS=s.triggeredNS||{};if(s.triggeredNS[n._cid])return;s.triggeredNS[n._cid]=!0,e.trigger(n,s,i)})},teardownFromParent:function(t,n,r){n&&n.unbind&&e.stopListening.call(t,n,r)},isBubbling:function(e,t){return e._bubbleBindings&&e._bubbleBindings[t]},bind:function(e,n){if(!e._init){var r=t.event(e,n);r&&(e._bubbleBindings||(e._bubbleBindings={}),e._bubbleBindings[r]?e._bubbleBindings[r]++:(e._bubbleBindings[r]=1,t.childrenOf(e,r)))}},unbind:function(n,r){var i=t.event(n,r);i&&(n._bubbleBindings&&n._bubbleBindings[i]--,n._bubbleBindings&&!n._bubbleBindings[i]&&(delete n._bubbleBindings[i],t.teardownChildrenFrom(n,i),e.isEmptyObject(n._bubbleBindings)&&delete n._bubbleBindings))},add:function(n,r,i){if(r instanceof e.Map&&n._bubbleBindings)for(var s in n._bubbleBindings)n._bubbleBindings[s]&&(t.teardownFromParent(n,r,s),t.toParent(r,n,i,s))},removeMany:function(e,n){for(var r=0,i=n.length;r<i;r++)t.remove(e,n[r])},remove:function(n,r){if(r instanceof e.Map&&n._bubbleBindings)for(var i in n._bubbleBindings)n._bubbleBindings[i]&&t.teardownFromParent(n,r,i)},set:function(n,r,i,s){return e.Map.helpers.isObservable(i)&&t.add(n,i,r),e.Map.helpers.isObservable(s)&&t.remove(n,s),i}};return t}),define("can/util/string",["can/util/library"],function(e){var t=/_|-/,n=/\=\=/,r=/([A-Z]+)([A-Z][a-z])/g,i=/([a-z\d])([A-Z])/g,s=/([a-z\d])([A-Z])/g,o=/\{([^\}]+)\}/g,u=/"/g,a=/'/g,f=/-+(.)?/g,l=/[a-z][A-Z]/g,c=function(e,t,n){var r=e[t];return r===undefined&&n===!0&&(r=e[t]={}),r},h=function(e){return/^f|^o/.test(typeof e)},p=function(e){var t=e===null||e===undefined||isNaN(e)&&""+e=="NaN";return""+(t?"":e)};return e.extend(e,{esc:function(e){return p(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(u,"&#34;").replace(a,"&#39;")},getObject:function(t,n,r){var i=t?t.split("."):[],s=i.length,o,u=0,a,f,l;n=e.isArray(n)?n:[n||window],l=n.length;if(!s)return n[0];for(u;u<l;u++){o=n[u],f=undefined;for(a=0;a<s&&h(o);a++)f=o,o=c(f,i[a]);if(f!==undefined&&o!==undefined)break}r===!1&&o!==undefined&&delete f[i[a-1]];if(r===!0&&o===undefined){o=n[0];for(a=0;a<s&&h(o);a++)o=c(o,i[a],!0)}return o},capitalize:function(e,t){return e.charAt(0).toUpperCase()+e.slice(1)},camelize:function(e){return p(e).replace(f,function(e,t){return t?t.toUpperCase():""})},hyphenate:function(e){return p(e).replace(l,function(e,t){return e.charAt(0)+"-"+e.charAt(1).toLowerCase()})},underscore:function(e){return e.replace(n,"/").replace(r,"$1_$2").replace(i,"$1_$2").replace(s,"_").toLowerCase()},sub:function(t,n,r){var i=[];return t=t||"",i.push(t.replace(o,function(t,s){var o=e.getObject(s,n,r===!0?!1:undefined);return o===undefined||o===null?(i=null,""):h(o)&&i?(i.push(o),""):""+o})),i===null?i:i.length<=1?i[0]:i},replacer:o,undHash:t}),e}),define("can/construct",["can/util/string"],function(e){var t=0,n=function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return n&&(n.get||n.set)?n:null},r=function(t,r,i){i=i||t;var s;for(var o in t)(s=n(t,o))?this._defineProperty(i,r,o,s):e.Construct._overwrite(i,r,o,t[o])},i=function(t,n,r){r=r||t;for(var i in t)e.Construct._overwrite(r,n,i,t[i])};return e.Construct=function(){if(arguments.length)return e.Construct.extend.apply(e.Construct,arguments)},e.extend(e.Construct,{constructorExtends:!0,newInstance:function(){var e=this.instance(),t;return e.setup&&(t=e.setup.apply(e,arguments)),e.init&&e.init.apply(e,t||arguments),e},_inherit:Object.getOwnPropertyDescriptor?r:i,_defineProperty:function(e,t,n,r){Object.defineProperty(e,n,r)},_overwrite:function(e,t,n,r){e[n]=r},setup:function(t,n){this.defaults=e.extend(!0,{},t.defaults,this.defaults)},instance:function(){t=1;var e=new this;return t=0,e},extend:function(n,r,i){function y(){if(!t)return this.constructor!==y&&arguments.length&&y.constructorExtends?y.extend.apply(y,arguments):y.newInstance.apply(y,arguments)}var s=n,o=r,u=i;typeof s!="string"&&(u=o,o=s,s=null),u||(u=o,o=null),u=u||{};var a=this,f=this.prototype,l,c,h,p,d,v,m,g;g=this.instance(),e.Construct._inherit(u,f,g);for(d in a)a.hasOwnProperty(d)&&(y[d]=a[d]);e.Construct._inherit(o,a,y),s&&(l=s.split("."),v=l.pop(),c=e.getObject(l.join("."),window,!0),m=c,h=e.underscore(s.replace(/\./g,"_")),p=e.underscore(v),c[v]=y),e.extend(y,{constructor:y,prototype:g,namespace:m,_shortName:p,fullName:s,_fullName:h}),v!==undefined&&(y.shortName=v),y.prototype.constructor=y;var b=[a].concat(e.makeArray(arguments)),w=y.setup.apply(y,b);return y.init&&y.init.apply(y,w||b),y}}),e.Construct.prototype.setup=function(){},e.Construct.prototype.init=function(){},e.Construct}),define("can/util/batch",["can/util/can"],function(e){var t=1,n=0,r=[],i=[];e.batch={start:function(e){n++,e&&i.push(e)},stop:function(s,o){s?n=0:n--;if(n===0){var u=r.slice(0),a=i.slice(0),f,l;r=[],i=[],t++,o&&e.batch.start();for(f=0,l=u.length;f<l;f++)e.dispatch.apply(u[f][0],u[f][1]);for(f=0,l=a.length;f<a.length;f++)a[f]()}},trigger:function(i,s,o){if(!i._init){if(n===0)return e.dispatch.call(i,s,o);s=typeof s=="string"?{type:s}:s,s.batchNum=t,r.push([i,[s,o]])}}}}),define("can/map",["can/util/library","can/util/bind","can/map/bubble","can/construct","can/util/batch"],function(e,t,n){var r=null,i=function(){for(var e in r)r[e].added&&delete r[e].obj._cid;r=null},s=function(e){return r&&r[e._cid]&&r[e._cid].instance},o=null,u=e.Map=e.Construct.extend({setup:function(){e.Construct.setup.apply(this,arguments);if(e.Map){this.defaults||(this.defaults={}),this._computes=[];for(var t in this.prototype)t!=="define"&&t!=="constructor"&&(typeof this.prototype[t]!="function"||this.prototype[t].prototype instanceof e.Construct)?this.defaults[t]=this.prototype[t]:this.prototype[t].isComputed&&this._computes.push(t);this.helpers.define&&this.helpers.define(this)}e.List&&!(this.prototype instanceof e.List)&&(this.List=u.List.extend({Map:this},{}))},_bubble:n,_bubbleRule:function(e){return(e==="change"||e.indexOf(".")>=0)&&"change"},_computes:[],bind:e.bindAndSetup,on:e.bindAndSetup,unbind:e.unbindAndTeardown,off:e.unbindAndTeardown,id:"id",helpers:{define:null,attrParts:function(e,t){return t?[e]:typeof e=="object"?e:(""+e).split(".")},addToMap:function(t,n){var s;r||(s=i,r={});var o=t._cid,u=e.cid(t);return r[u]||(r[u]={obj:t,instance:n,added:!o}),s},isObservable:function(t){return t instanceof e.Map||t&&t===e.route},canMakeObserve:function(t){return t&&!e.isDeferred(t)&&(e.isArray(t)||e.isPlainObject(t))},serialize:function(t,n,r){var i=e.cid(t),s=!1;return o||(s=!0,o={attr:{},serialize:{}}),o[n][i]=r,t.each(function(i,s){var a,f=u.helpers.isObservable(i),l=f&&o[n][e.cid(i)];l?a=l:n==="serialize"?a=u.helpers._serialize(t,s,i):a=u.helpers._getValue(t,s,i,n),a!==undefined&&(r[s]=a)}),e.__reading(t,"__keys"),s&&(o=null),r},_serialize:function(e,t,n){return u.helpers._getValue(e,t,n,"serialize")},_getValue:function(e,t,n,r){return u.helpers.isObservable(n)?n[r]():n}},keys:function(t){var n=[];e.__reading(t,"__keys");for(var r in t._data)n.push(r);return n}},{setup:function(t){t instanceof e.Map&&(t=t.serialize()),this._data={},e.cid(this,".map"),this._init=1,this._computedBindings={};var n=this._setupDefaults(t);this._setupComputes(n);var r=t&&e.Map.helpers.addToMap(t,this),i=e.extend(e.extend(!0,{},n),t);this.attr(i),r&&r(),this.bind("change",e.proxy(this._changes,this)),delete this._init},_setupComputes:function(){var e=this.constructor._computes;for(var t=0,n=e.length,r;t<n;t++)r=e[t],this[r]=this[r].clone(this),this._computedBindings[r]={count:0}},_setupDefaults:function(){return this.constructor.defaults||{}},_bindsetup:function(){},_bindteardown:function(){},_changes:function(t,n,r,i,s){e.batch.trigger(this,{type:n,batchNum:t.batchNum,target:t.target},[i,s])},_triggerChange:function(t,r,i,s){n.isBubbling(this,"change")?e.batch.trigger(this,{type:"change",target:this},[t,r,i,s]):e.batch.trigger(this,t,[i,s]),(r==="remove"||r==="add")&&e.batch.trigger(this,{type:"__keys",target:this})},_each:function(e){var t=this.__get();for(var n in t)t.hasOwnProperty(n)&&e(t[n],n)},attr:function(t,n){var r=typeof t;return r!=="string"&&r!=="number"?this._attrs(t,n):arguments.length===1?(e.__reading(this,t),this._get(t)):(this._set(t,n),this)},each:function(){return e.each.apply(undefined,[this].concat(e.makeArray(arguments)))},removeAttr:function(t){var n=e.List&&this instanceof e.List,r=e.Map.helpers.attrParts(t),i=r.shift(),s=n?this[i]:this._data[i];return r.length&&s?s.removeAttr(r):(typeof t=="string"&&!!~t.indexOf(".")&&(i=t),this._remove(i,s),s)},_remove:function(e,t){e in this._data&&(delete this._data[e],e in this.constructor.prototype||delete this[e],this._triggerChange(e,"remove",undefined,t))},_get:function(e){e=""+e;var t=e.indexOf(".");if(t>=0){var n=this.__get(e);if(n!==undefined)return n;var r=e.substr(0,t),i=e.substr(t+1),s=this.__get(r);return s&&s._get?s._get(i):undefined}return this.__get(e)},__get:function(e){return e?this._computedBindings[e]?this[e]():this._data[e]:this._data},__type:function(t,n){if(!(t instanceof e.Map)&&e.Map.helpers.canMakeObserve(t)){var r=s(t);if(r)return r;if(e.isArray(t)){var i=e.List;return new i(t)}var o=this.constructor.Map||e.Map;return new o(t)}return t},_set:function(e,t,n){e=""+e;var r=e.indexOf("."),i;if(!n&&r>=0){var s=e.substr(0,r),o=e.substr(r+1);i=this._init?undefined:this.__get(s);if(!u.helpers.isObservable(i))throw"can.Map: Object does not exist";i._set(o,t)}else this.__convert&&(t=this.__convert(e,t)),i=this._init?undefined:this.__get(e),this.__set(e,this.__type(t,e),i)},__set:function(e,t,n){if(t!==n){var r=n!==undefined||this.__get().hasOwnProperty(e)?"set":"add";this.___set(e,this.constructor._bubble.set(this,e,t,n)),this._triggerChange(e,r,t,n),n&&this.constructor._bubble.teardownFromParent(this,n)}},___set:function(e,t){this._computedBindings[e]?this[e](t):this._data[e]=t,typeof this.constructor.prototype[e]!="function"&&!this._computedBindings[e]&&(this[e]=t)},bind:function(t,n){var r=this._computedBindings&&this._computedBindings[t];if(r)if(!r.count){r.count=1;var i=this;r.handler=function(n,r,s){e.batch.trigger(i,{type:t,batchNum:n.batchNum,target:i},[r,s])},this[t].bind("change",r.handler)}else r.count++;return this.constructor._bubble.bind(this,t),e.bindAndSetup.apply(this,arguments)},unbind:function(t,n){var r=this._computedBindings&&this._computedBindings[t];return r&&(r.count===1?(r.count=0,this[t].unbind("change",r.handler),delete r.handler):r.count--),this.constructor._bubble.unbind(this,t),e.unbindAndTeardown.apply(this,arguments)},serialize:function(){return e.Map.helpers.serialize(this,"serialize",{})},_attrs:function(t,n){if(t===undefined)return u.helpers.serialize(this,"attr",{});t=e.simpleExtend({},t);var r,i=this,s;e.batch.start(),this.each(function(e,r){if(r==="_cid")return;s=t[r];if(s===undefined){n&&i.removeAttr(r);return}i.__convert&&(s=i.__convert(r,s)),u.helpers.isObservable(s)?i.__set(r,i.__type(s,r),e):u.helpers.isObservable(e)&&u.helpers.canMakeObserve(s)?e.attr(s,n):e!==s&&i.__set(r,i.__type(s,r),e),delete t[r]});for(r in t)r!=="_cid"&&(s=t[r],this._set(r,s,!0));return e.batch.stop(),this},compute:function(t){if(e.isFunction(this.constructor.prototype[t]))return e.compute(this[t],this);var n=t.split("."),r=n.length-1,i={args:[]};return e.compute(function(t){if(!arguments.length)return e.compute.read(this,n,i).value;e.compute.read(this,n.slice(0,r)).value.attr(n[r],t)},this)}});return u.prototype.on=u.prototype.bind,u.prototype.off=u.prototype.unbind,u}),define("can/list",["can/util/library","can/map","can/map/bubble"],function(e,t,n){var r=[].splice,i=function(){var e={0:"a",length:1};return r.call(e,0,1),!e[0]}(),s=t.extend({Map:t},{setup:function(t,n){this.length=0,e.cid(this,".map"),this._init=1,this._computedBindings={},this._setupComputes(),t=t||[];var r;e.isDeferred(t)?this.replace(t):(r=t.length&&e.Map.helpers.addToMap(t,this),this.push.apply(this,e.makeArray(t||[]))),r&&r(),this.bind("change",e.proxy(this._changes,this)),e.simpleExtend(this,n),delete this._init},_triggerChange:function(n,r,i,s){t.prototype._triggerChange.apply(this,arguments);var o=+n;!~n.indexOf(".")&&!isNaN(o)&&(r==="add"?(e.batch.trigger(this,r,[i,o]),e.batch.trigger(this,"length",[this.length])):r==="remove"?(e.batch.trigger(this,r,[s,o]),e.batch.trigger(this,"length",[this.length])):e.batch.trigger(this,r,[i,o]))},__get:function(t){return t?this[t]&&this[t].isComputed&&e.isFunction(this.constructor.prototype[t])?this[t]():this[t]:this},___set:function(e,t){this[e]=t,+e>=this.length&&(this.length=+e+1)},_remove:function(e,t){isNaN(+e)?(delete this[e],this._triggerChange(e,"remove",undefined,t)):this.splice(e,1)},_each:function(e){var t=this.__get();for(var n=0;n<t.length;n++)e(t[n],n)},serialize:function(){return t.helpers.serialize(this,"serialize",[])},splice:function(t,s){var o=e.makeArray(arguments),u=[],a,f;for(a=2,f=o.length;a<f;a++)o[a]=this.__type(o[a],a),u.push(o[a]);s===undefined&&(s=o[1]=this.length-t);var l=r.apply(this,o);if(!i)for(a=this.length;a<l.length+this.length;a++)delete this[a];e.batch.start(),s>0&&(n.removeMany(this,l),this._triggerChange(""+t,"remove",undefined,l));if(o.length>2){for(a=0,f=u.length;a<f;a++)n.set(this,a,u[a]);this._triggerChange(""+t,"add",u,l)}return e.batch.stop(),l},_attrs:function(n,r){if(n===undefined)return t.helpers.serialize(this,"attr",[]);n=e.makeArray(n),e.batch.start(),this._updateAttrs(n,r),e.batch.stop()},_updateAttrs:function(e,n){var r=Math.min(e.length,this.length);for(var i=0;i<r;i++){var s=this[i],o=e[i];t.helpers.isObservable(s)&&t.helpers.canMakeObserve(o)?s.attr(o,n):s!==o&&this._set(i,o)}e.length>this.length?this.push.apply(this,e.slice(this.length)):e.length<this.length&&n&&this.splice(e.length)}}),o=function(t){return t[0]&&e.isArray(t[0])?t[0]:e.makeArray(t)};return e.each({push:"length",unshift:0},function(e,t){var r=[][t];s.prototype[t]=function(){var t=[],i=e?this.length:0,s=arguments.length,o,u;while(s--)u=arguments[s],t[s]=n.set(this,s,this.__type(u,s));return o=r.apply(this,t),(!this.comparator||t.length)&&this._triggerChange(""+i,"add",t,undefined),o}}),e.each({pop:"length",shift:0},function(e,t){s.prototype[t]=function(){var r=o(arguments),i=e&&this.length?this.length-1:0,s=[][t].apply(this,r);return this._triggerChange(""+i,"remove",undefined,[s]),s&&s.unbind&&n.remove(this,s),s}}),e.extend(s.prototype,{indexOf:function(t,n){return this.attr("length"),e.inArray(t,this,n)},join:function(){return[].join.apply(this.attr(),arguments)},reverse:function(){var t=e.makeArray([].reverse.call(this));this.replace(t)},slice:function(){var e=Array.prototype.slice.apply(this,arguments);return new this.constructor(e)},concat:function(){var t=[];return e.each(e.makeArray(arguments),function(n,r){t[r]=n instanceof e.List?n.serialize():n}),new this.constructor(Array.prototype.concat.apply(this.serialize(),t))},forEach:function(t,n){return e.each(this,t,n||this)},replace:function(t){return e.isDeferred(t)?t.then(e.proxy(this.replace,this)):this.splice.apply(this,[0,this.length].concat(e.makeArray(t||[]))),this},filter:function(t,n){var r=new e.List,i=this,s;return this.each(function(e,o,u){s=t.call(n|i,e,o,i),s&&r.push(e)}),r}}),e.List=t.List=s,e.List}),define("can/util/string/deparam",["can/util/library","can/util/string"],function(e){var t=/^\d+$/,n=/([^\[\]]+)|(\[\])/g,r=/([^?#]*)(#.*)?$/,i=function(e){return decodeURIComponent(e.replace(/\+/g," "))};return e.extend(e,{deparam:function(s){var o={},u,a;return s&&r.test(s)&&(u=s.split("&"),e.each(u,function(e){var r=e.split("="),s=i(r.shift()),u=i(r.join("=")),f=o;if(s){r=s.match(n);for(var l=0,c=r.length-1;l<c;l++)f[r[l]]||(f[r[l]]=t.test(r[l+1])||r[l+1]==="[]"?[]:{}),f=f[r[l]];a=r.pop(),a==="[]"?f.push(u):f[a]=u}})),o}}),e}),define("can/route",["can/util/library","can/map","can/list","can/util/string/deparam"],function(e){var t=/\:([\w\.]+)/g,n=/^(?:&[^=]+=[^&]*)+/,r=function(t){var n=[];return e.each(t,function(t,r){n.push((r==="className"?"class":r)+'="'+(r==="href"?t:e.esc(t))+'"')}),n.join(" ")},i=function(e,t){var n=0,r=0,i={};for(var s in e.defaults)e.defaults[s]===t[s]&&(i[s]=1,n++);for(;r<e.names.length;r++){if(!t.hasOwnProperty(e.names[r]))return-1;i[e.names[r]]||n++}return n},s=window.location,o=function(e){return(e+"").replace(/([.?*+\^$\[\]\\(){}|\-])/g,"\\$1")},u=e.each,a=e.extend,f=function(t){return t&&typeof t=="object"?(t instanceof e.Map?t=t.attr():t=e.isFunction(t.slice)?t.slice():e.extend({},t),e.each(t,function(e,n){t[n]=f(e)})):t!==undefined&&t!==null&&e.isFunction(t.toString)&&(t=t.toString()),t},l=function(e){return e.replace(/\\/g,"")},c,h,p,d,v=function(t,n,r,i){d=1,clearTimeout(c),c=setTimeout(function(){d=0;var t=e.route.data.serialize(),n=e.route.param(t,!0);e.route._call("setURL",n),e.batch.trigger(m,"__url",[n,p]),p=n},10)},m=e.extend({},e.event);e.route=function(n,r){var i=e.route._call("root");i.lastIndexOf("/")===i.length-1&&n.indexOf("/")===0&&(n=n.substr(1)),r=r||{};var s=[],u,a="",f=t.lastIndex=0,c,h=e.route._call("querySeparator"),p=e.route._call("matchSlashes");while(u=t.exec(n))s.push(u[1]),a+=l(n.substring(f,t.lastIndex-u[0].length)),c="\\"+(l(n.substr(t.lastIndex,1))||h+(p?"":"|/")),a+="([^"+c+"]"+(r[u[1]]?"*":"+")+")",f=t.lastIndex;return a+=n.substr(f).replace("\\",""),e.route.routes[n]={test:new RegExp("^"+a+"($|"+o(h)+")"),route:n,names:s,defaults:r,length:n.split("/").length},e.route},a(e.route,{param:function(n,r){var s,o=0,f,l=n.route,c=0;delete n.route,u(n,function(){c++}),u(e.route.routes,function(e,t){f=i(e,n),f>o&&(s=e,o=f);if(f>=c)return!1}),e.route.routes[l]&&i(e.route.routes[l],n)===o&&(s=e.route.routes[l]);if(s){var h=a({},n),p=s.route.replace(t,function(e,t){return delete h[t],n[t]===s.defaults[t]?"":encodeURIComponent(n[t])}).replace("\\",""),d;return u(s.defaults,function(e,t){h[t]===e&&delete h[t]}),d=e.param(h),r&&e.route.attr("route",s.route),p+(d?e.route._call("querySeparator")+d:"")}return e.isEmptyObject(n)?"":e.route._call("querySeparator")+e.param(n)},deparam:function(t){var n=e.route._call("root");n.lastIndexOf("/")===n.length-1&&t.indexOf("/")===0&&(t=t.substr(1));var r={length:-1},i=e.route._call("querySeparator"),s=e.route._call("paramsMatcher");u(e.route.routes,function(e,n){e.test.test(t)&&e.length>r.length&&(r=e)});if(r.length>-1){var o=t.match(r.test),f=o.shift(),l=t.substr(f.length-(o[o.length-1]===i?1:0)),c=l&&s.test(l)?e.deparam(l.slice(1)):{};return c=a(!0,{},r.defaults,c),u(o,function(e,t){e&&e!==i&&(c[r.names[t]]=decodeURIComponent(e))}),c.route=r.route,c}return t.charAt(0)!==i&&(t=i+t),s.test(t)?e.deparam(t.slice(1)):{}},data:new e.Map({}),map:function(t){var n;t.prototype instanceof e.Map?n=new t:n=t,e.route.data=n},routes:{},ready:function(t){return t!==!0&&(e.route._setup(),e.route.setState()),e.route},url:function(t,n){return n&&(t=e.extend({},e.route.deparam(e.route._call("matchingPartOfURL")),t)),e.route._call("root")+e.route.param(t)},link:function(t,n,i,s){return"<a "+r(a({href:e.route.url(n,s)},i))+">"+t+"</a>"},current:function(t){return e.__reading(m,"__url"),this._call("matchingPartOfURL")===e.route.param(t)},bindings:{hashchange:{paramsMatcher:n,querySeparator:"&",matchSlashes:!1,bind:function(){e.bind.call(window,"hashchange",g)},unbind:function(){e.unbind.call(window,"hashchange",g)},matchingPartOfURL:function(){return s.href.split(/#!?/)[1]||""},setURL:function(e){return s.hash="#!"+e,e},root:"#!"}},defaultBinding:"hashchange",currentBinding:null,_setup:function(){e.route.currentBinding||(e.route._call("bind"),e.route.bind("change",v),e.route.currentBinding=e.route.defaultBinding)},_teardown:function(){e.route.currentBinding&&(e.route._call("unbind"),e.route.unbind("change",v),e.route.currentBinding=null),clearTimeout(c),d=0},_call:function(){var t=e.makeArray(arguments),n=t.shift(),r=e.route.bindings[e.route.currentBinding||e.route.defaultBinding],i=r[n];return i.apply?i.apply(r,t):i}}),u(["bind","unbind","on","off","delegate","undelegate","removeAttr","compute","_get","__get","each"],function(t){e.route[t]=function(){if(!e.route.data[t])return;return e.route.data[t].apply(e.route.data,arguments)}}),e.route.attr=function(t,n){var r=typeof t,i;return n===undefined?i=arguments:r!=="string"&&r!=="number"?i=[f(t),n]:i=[t,f(n)],e.route.data.attr.apply(e.route.data,i)};var g=e.route.setState=function(){var t=e.route._call("matchingPartOfURL"),n=h;h=e.route.deparam(t);if(!d||t!==p){e.batch.start();for(var r in n)h[r]||e.route.removeAttr(r);e.route.attr(h),e.batch.trigger(m,"__url",[t,p]),e.batch.stop()}};return e.route}),define("can/control",["can/util/library","can/construct"],function(e){var t=function(t,n,r){return e.bind.call(t,n,r),function(){e.unbind.call(t,n,r)}},n=e.isFunction,r=e.extend,i=e.each,s=[].slice,o=/\{([^\}]+)\}/g,u=e.getObject("$.event.special",[e])||{},a=function(t,n,r,i){return e.delegate.call(t,n,r,i),function(){e.undelegate.call(t,n,r,i)}},f=function(n,r,i,s){return s?a(n,e.trim(s),r,i):t(n,r,i)},l,c=e.Control=e.Construct({setup:function(){e.Construct.setup.apply(this,arguments);if(e.Control){var t=this,n;t.actions={};for(n in t.prototype)t._isAction(n)&&(t.actions[n]=t._action(n))}},_shifter:function(t,r){var i=typeof r=="string"?t[r]:r;return n(i)||(i=t[i]),function(){return t.called=r,i.apply(t,[this.nodeName?e.$(this):this].concat(s.call(arguments,0)))}},_isAction:function(e){var t=this.prototype[e],r=typeof t;return e!=="constructor"&&(r==="function"||r==="string"&&n(this.prototype[t]))&&!!(u[e]||h[e]||/[^\w]/.test(e))},_action:function(t,n){o.lastIndex=0;if(n||!o.test(t)){var r=n?e.sub(t,this._lookup(n)):t;if(!r)return null;var i=e.isArray(r),s=i?r[1]:r,u=s.split(/\s+/g),a=u.pop();return{processor:h[a]||l,parts:[s,u.join(" "),a],delegate:i?r[0]:undefined}}},_lookup:function(e){return[e,window]},processors:{},defaults:{}},{setup:function(t,n){var i=this.constructor,s=i.pluginName||i._fullName,o;return this.element=e.$(t),s&&s!=="can_control"&&this.element.addClass(s),o=e.data(this.element,"controls"),o||(o=[],e.data(this.element,"controls",o)),o.push(this),this.options=r({},i.defaults,n),this.on(),[this.element,this.options]},on:function(t,n,r,i){if(!t){this.off();var s=this.constructor,o=this._bindings,u=s.actions,a=this.element,l=e.Control._shifter(this,"destroy"),c,h;for(c in u)u.hasOwnProperty(c)&&(h=u[c]||s._action(c,this.options,this),h&&(o.control[c]=h.processor(h.delegate||a,h.parts[2],h.parts[1],c,this)));return e.bind.call(a,"removed",l),o.user.push(function(t){e.unbind.call(t,"removed",l)}),o.user.length}return typeof t=="string"&&(i=r,r=n,n=t,t=this.element),i===undefined&&(i=r,r=n,n=null),typeof i=="string"&&(i=e.Control._shifter(this,i)),this._bindings.user.push(f(t,r,i,n)),this._bindings.user.length},off:function(){var e=this.element[0],t=this._bindings;t&&(i(t.user||[],function(t){t(e)}),i(t.control||{},function(t){t(e)})),this._bindings={user:[],control:{}}},destroy:function(){if(this.element===null)return;var t=this.constructor,n=t.pluginName||t._fullName,r;this.off(),n&&n!=="can_control"&&this.element.removeClass(n),r=e.data(this.element,"controls"),r.splice(e.inArray(this,r),1),e.trigger(this,"destroyed"),this.element=null}}),h=e.Control.processors;return l=function(t,n,r,i,s){return f(t,n,e.Control._shifter(s,i),r)},i(["change","click","contextmenu","dblclick","keydown","keyup","keypress","mousedown","mousemove","mouseout","mouseover","mouseup","reset","resize","scroll","select","submit","focusin","focusout","mouseenter","mouseleave","touchstart","touchmove","touchcancel","touchend","touchleave","inserted","removed"],function(e){h[e]=l}),c}),define("can/control/route",["can/util/library","can/route","can/control"],function(e){return e.Control.processors.route=function(t,n,r,i,s){r=r||"",e.route.routes[r]||(r[0]==="/"&&(r=r.substring(1)),e.route(r));var o,u=function(t,n,u){if(e.route.attr("route")===r&&(t.batchNum===undefined||t.batchNum!==o)){o=t.batchNum;var a=e.route.attr();delete a.route,e.isFunction(s[i])?s[i](a):s[s[i]](a)}};return e.route.bind("change",u),function(){e.route.unbind("change",u)}},e}),define("can/model",["can/util/library","can/map","can/list"],function(e){var t=function(t,n,r){var i=new e.Deferred;return t.then(function(){var t=e.makeArray(arguments),s=!0;try{t[0]=r.apply(n,t)}catch(o){s=!1,i.rejectWith(i,[o].concat(t))}s&&i.resolveWith(i,t)},function(){i.rejectWith(this,arguments)}),typeof t.abort=="function"&&(i.abort=function(){return t.abort()}),i},n=0,r=function(t){return e.__reading(t,t.constructor.id),t.__get(t.constructor.id)},i=function(t,n,r,i,s,o){var u={};if(typeof t=="string"){var a=t.split(/\s+/);u.url=a.pop(),a.length&&(u.type=a.pop())}else e.extend(u,t);return u.data=typeof n=="object"&&!e.isArray(n)?e.extend(u.data||{},n):n,u.url=e.sub(u.url,u.data,!0),e.ajax(e.extend({type:r||"post",dataType:i||"json",success:s,error:o},u))},s=function(n,i,s,o,u){var a;e.isArray(n)?(a=n[1],n=n[0]):a=n.serialize(),a=[a];var f,l=n.constructor,c;return(i==="update"||i==="destroy")&&a.unshift(r(n)),c=l[i].apply(l,a),f=t(c,n,function(e){return n[u||i+"d"](e,c),n}),c.abort&&(f.abort=function(){c.abort()}),f.then(s,o),f},o={models:function(t,n,r){e.Model._reqs++;if(!t)return;if(t instanceof this.List)return t;var i=this,s=[],o=i.List||d,u=n instanceof e.List?n:new o,a=t instanceof d,f=a?t.serialize():t;f=i.parseModels(f,r),f.data&&(t=f,f=f.data);if(typeof f=="undefined")throw new Error("Could not get any raw data while converting using .models");return u.length&&u.splice(0),e.each(f,function(e){s.push(i.model(e,r))}),u.push.apply(u,s),e.isArray(t)||e.each(t,function(e,t){t!=="data"&&u.attr(t,e)}),setTimeout(e.proxy(this._clean,this),1),u},model:function(t,n,r){if(!t)return;typeof t.serialize=="function"?t=t.serialize():t=this.parseModel(t,r);var i=t[this.id];(i||i===0)&&this.store[i]&&(n=this.store[i]);var s=n&&e.isFunction(n.attr)?n.attr(t,this.removeAttr||!1):new this(t);return s}},u={parseModel:function(t){return function(n){return t?e.getObject(t,n):n}},parseModels:function(t){return function(n){if(e.isArray(n))return n;t=t||"data";var r=e.getObject(t,n);if(!e.isArray(r))throw new Error("Could not get any raw data while converting using .models");return r}}},a={create:{url:"_shortName",type:"post"},update:{data:function(t,n){n=n||{};var r=this.id;return n[r]&&n[r]!==t&&(n["new"+e.capitalize(t)]=n[r],delete n[r]),n[r]=t,n},type:"put"},destroy:{type:"delete",data:function(e,t){return t=t||{},t.id=t[this.id]=e,t}},findAll:{url:"_shortName"},findOne:{}},f=function(e,t){return function(n){return n=e.data?e.data.apply(this,arguments):n,i(t||this[e.url||"_url"],n,e.type||"get")}},l=function(e,t){if(!e.resource)return;var n=e.resource.replace(/\/+$/,"");return t==="findAll"||t==="create"?n:n+"/{"+e.id+"}"};e.Model=e.Map.extend({fullName:"can.Model",_reqs:0,setup:function(t,r,i,s){typeof r!="string"&&(s=i,i=r),s||(s=i),this.store={},e.Map.setup.apply(this,arguments);if(!e.Model)return;i&&i.List?(this.List=i.List,this.List.Map=this):this.List=t.List.extend({Map:this},{});var c=this,h=e.proxy(this._clean,c);e.each(a,function(n,r){i&&i[r]&&(typeof i[r]=="string"||typeof i[r]=="object")?c[r]=f(n,i[r]):i&&i.resource&&!e.isFunction(i[r])&&(c[r]=f(n,l(c,r)));if(c["make"+e.capitalize(r)]){var s=c["make"+e.capitalize(r)](c[r]);e.Construct._overwrite(c,t,r,function(){e.Model._reqs++;var t=s.apply(this,arguments),n=t.then(h,h);return n.abort=t.abort,n})}});var p={};e.each(o,function(n,r){var s="parse"+e.capitalize(r),o=i&&i[r]||c[r];typeof o=="string"?(c[s]=o,e.Construct._overwrite(c,t,r,n)):i&&i[r]&&(p[s]=!0)}),e.each(u,function(n,r){var s=i&&i[r]||c[r];if(typeof s=="string")e.Construct._overwrite(c,t,r,n(s));else if((!i||!e.isFunction(i[r]))&&!c[r]){var o=n();o.useModelConverter=p[r],e.Construct._overwrite(c,t,r,o)}});if(c.fullName==="can.Model"||!c.fullName)c.fullName="Model"+ ++n;e.Model._reqs=0,this._url=this._shortName+"/{"+this.id+"}"},_ajax:f,_makeRequest:s,_clean:function(){e.Model._reqs--;if(!e.Model._reqs)for(var t in this.store)this.store[t]._bindings||delete this.store[t];return arguments[0]},models:o.models,model:o.model},{setup:function(t){var n=t&&t[this.constructor.id];e.Model._reqs&&n!=null&&(this.constructor.store[n]=this),e.Map.prototype.setup.apply(this,arguments)},isNew:function(){var e=r(this);return!e&&e!==0},save:function(e,t){return s(this,this.isNew()?"create":"update",e,t)},destroy:function(t,n){if(this.isNew()){var r=this,i=e.Deferred();return i.then(t,n),i.done(function(e){r.destroyed(e)}).resolve(r)}return s(this,"destroy",t,n,"destroyed")},_bindsetup:function(){return this.constructor.store[this.__get(this.constructor.id)]=this,e.Map.prototype._bindsetup.apply(this,arguments)},_bindteardown:function(){return delete this.constructor.store[r(this)],e.Map.prototype._bindteardown.apply(this,arguments)},___set:function(t,n){e.Map.prototype.___set.call(this,t,n),t===this.constructor.id&&this._bindings&&(this.constructor.store[r(this)]=this)}});var c=function(e){return function(t,n,r){return this[e](t,null,r)}},h=function(e){return this.parseModel.useModelConverter?this.model(e):this.parseModel(e)},p={makeFindAll:c("models"),makeFindOne:c("model"),makeCreate:h,makeUpdate:h};e.each(p,function(n,r){e.Model[r]=function(r){return function(){var i=e.makeArray(arguments),s=e.isFunction(i[1])?i.splice(0,1):i.splice(0,2),o=t(r.apply(this,s),this,n);return o.then(i[0],i[1]),o}}}),e.each(["created","updated","destroyed"],function(t){e.Model.prototype[t]=function(n){var r=this,i=r.constructor;n&&typeof n=="object"&&this.attr(e.isFunction(n.attr)?n.attr():n),e.dispatch.call(this,{type:"change",target:this},[t]),e.dispatch.call(i,t,[this])}});var d=e.Model.List=e.List.extend({_bubbleRule:function(t,n){return e.List._bubbleRule(t,n)||"destroyed"}},{setup:function(t){e.isPlainObject(t)&&!e.isArray(t)?(e.List.prototype.setup.apply(this),this.replace(e.isDeferred(t)?t:this.constructor.Map.findAll(t))):e.List.prototype.setup.apply(this,arguments),this._init=1,this.bind("destroyed",e.proxy(this._destroyed,this)),delete this._init},_destroyed:function(e,t){if(/\w+/.test(t)){var n;while((n=this.indexOf(e.target))>-1)this.splice(n,1)}}});return e.Model}),define("can/view",["can/util/library"],function(e){var t=e.isFunction,n=e.makeArray,r=1,i=function(e){var t=function(){return f.frag(e.apply(this,arguments))};return t.render=function(){return e.apply(e,arguments)},t},s=function(e,t){if(!e.length)throw"can.view: No template or empty template:"+t},o=function(n,r){if(t(n)){var i=e.Deferred();return i.resolve(n)}var o=typeof n=="string"?n:n.url,u=n.engine&&"."+n.engine||o.match(/\.[\w\d]+$/),a,l,c;o.match(/^#/)&&(o=o.substr(1));if(l=document.getElementById(o))u="."+l.type.match(/\/(x\-)?(.+)/)[2];!u&&!f.cached[o]&&(o+=u=f.ext),e.isArray(u)&&(u=u[0]),c=f.toId(o),o.match(/^\/\//)&&(o=o.substr(2),o=window.steal?steal.config().root.mapJoin(""+steal.id(o)):o),window.require&&require.toUrl&&(o=require.toUrl(o)),a=f.types[u];if(f.cached[c])return f.cached[c];if(l)return f.registerView(c,l.innerHTML,a);var h=new e.Deferred;return e.ajax({async:r,url:o,dataType:"text",error:function(e){s("",o),h.reject(e)},success:function(e){s(e,o),f.registerView(c,e,a,h)}}),h},u=function(t){var n=[];if(e.isDeferred(t))return[t];for(var r in t)e.isDeferred(t[r])&&n.push(t[r]);return n},a=function(t){return e.isArray(t)&&t[1]==="success"?t[0]:t},f=e.view=e.template=function(e,n,r,i){return t(r)&&(i=r,r=undefined),f.renderAs("fragment",e,n,r,i)};return e.extend(f,{frag:function(e,t){return f.hookup(f.fragment(e),t)},fragment:function(t){if(typeof t!="string"&&t.nodeType===11)return t;var n=e.buildFragment(t,document.body);return n.childNodes.length||n.appendChild(document.createTextNode("")),n},toId:function(t){return e.map(t.toString().split(/\/|\./g),function(e){if(e)return e}).join("_")},toStr:function(e){return e==null?"":""+e},hookup:function(t,n){var r=[],i,s;return e.each(t.childNodes?e.makeArray(t.childNodes):t,function(t){t.nodeType===1&&(r.push(t),r.push.apply(r,e.makeArray(t.getElementsByTagName("*"))))}),e.each(r,function(e){e.getAttribute&&(i=e.getAttribute("data-view-id"))&&(s=f.hookups[i])&&(s(e,n,i),delete f.hookups[i],e.removeAttribute("data-view-id"))}),t},hookups:{},hook:function(e){return f.hookups[++r]=e," data-view-id='"+r+"'"},cached:{},cachedRenderers:{},cache:!0,register:function(t){this.types["."+t.suffix]=t,e[t.suffix]=f[t.suffix]=function(e,n){var r,s;if(!n)return s=function(){return r||(t.fragRenderer?r=t.fragRenderer(null,e):r=i(t.renderer(null,e))),r.apply(this,arguments)},s.render=function(){var n=t.renderer(null,e);return n.apply(n,arguments)},s;var o=function(){return r||(t.fragRenderer?r=t.fragRenderer(e,n):r=t.renderer(e,n)),r.apply(this,arguments)};return t.fragRenderer?f.preload(e,o):f.preloadStringRenderer(e,o)}},types:{},ext:".ejs",registerScript:function(e,t,n){return"can.view.preloadStringRenderer('"+t+"',"+f.types["."+e].script(t,n)+");"},preload:function(t,n){var r=f.cached[t]=(new e.Deferred).resolve(function(e,t){return n.call(e,e,t)});return r.__view_id=t,f.cachedRenderers[t]=n,n},preloadStringRenderer:function(e,t){return this.preload(e,i(t))},render:function(t,n,r,i){return e.view.renderAs("string",t,n,r,i)},renderTo:function(e,t,n,r){return(e==="string"&&t.render?t.render:t)(n,r)},renderAs:function(r,i,s,l,c){t(l)&&(c=l,l=undefined);var h=u(s),p,d,v,m,g;if(h.length)return d=new e.Deferred,v=e.extend({},s),h.push(o(i,!0)),e.when.apply(e,h).then(function(t){var i=n(arguments),o=i.pop(),u;if(e.isDeferred(s))v=a(t);else for(var f in s)e.isDeferred(s[f])&&(v[f]=a(i.shift()));u=e.view.renderTo(r,o,v,l),d.resolve(u,v),c&&c(u,v)},function(){d.reject.apply(d,arguments)}),d;p=e.__clearReading(),m=t(c),d=o(i,m),p&&e.__setReading(p);if(m)g=d,d.then(function(t){c(s?e.view.renderTo(r,t,s,l):t)});else{if(d.state()==="resolved"&&d.__view_id){var y=f.cachedRenderers[d.__view_id];return s?e.view.renderTo(r,y,s,l):y}d.then(function(t){g=s?e.view.renderTo(r,t,s,l):t})}return g},registerView:function(t,n,r,s){var o=typeof r=="object"?r:f.types[r||f.ext],u;return o.fragRenderer?u=o.fragRenderer(t,n):u=i(o.renderer(t,n)),s=s||new e.Deferred,f.cache&&(f.cached[t]=s,s.__view_id=t,f.cachedRenderers[t]=u),s.resolve(u)}}),e}),define("can/compute",["can/util/library","can/util/bind","can/util/batch"],function(e,t){var n=[];e.__read=function(e,t){n.push({});var r=e.call(t);return{value:r,observed:n.pop()}},e.__reading=function(e,t){n.length&&(n[n.length-1][e._cid+"|"+t]={obj:e,event:t+""})},e.__clearReading=function(){if(n.length){var e=n[n.length-1];return n[n.length-1]={},e}},e.__setReading=function(e){n.length&&(n[n.length-1]=e)},e.__addReading=function(t){n.length&&e.simpleExtend(n[n.length-1],t)};var r=function(t,n,r,s){var u=e.__read(t,n),a=u.observed;return i(r,a,s),o(r,s),u},i=function(e,t,n){for(var r in t)s(e,t,r,n)},s=function(e,t,n,r){if(e[n])delete e[n];else{var i=t[n];i.obj.bind(i.event,r)}},o=function(e,t){for(var n in e){var r=e[n];r.obj.unbind(r.event,t)}},u=function(t,n,r,i){n!==r&&e.batch.trigger(t,i?{type:"change",batchNum:i}:"change",[n,r])},a=function(t,n,i,s){var o,u,a;return{on:function(f){u||(u=function(e){if(t.bound&&(e.batchNum===undefined||e.batchNum!==a)){var s=o.value;o=r(n,i,o.observed,u),f(o.value,s,e.batchNum),a=a=e.batchNum}}),o=r(n,i,{},u),s(o.value),t.hasDependencies=!e.isEmptyObject(o.observed)},off:function(e){for(var t in o.observed){var n=o.observed[t];n.obj.unbind(n.event,u)}}}},f=function(t,n,i,s){var o,u,a,f;return{on:function(l){a||(a=function(r){if(t.bound&&(r.batchNum===undefined||r.batchNum!==f)){var s=e.__clearReading(),o=n.call(i);e.__setReading(s),l(o,u,r.batchNum),u=o,f=f=r.batchNum}}),o=r(n,i,{},a),u=o.value,s(o.value),t.hasDependencies=!e.isEmptyObject(o.observed)},off:function(e){for(var t in o.observed){var n=o.observed[t];n.obj.unbind(n.event,a)}}}},l=function(t){return t instanceof e.Map||t&&t.__get},c=function(){};e.compute=function(t,r,i,s){if(t&&t.isComputed)return t;var o,l=c,h=c,p,d=function(){return p},v=function(e){p=e},m=v,g=[],y=function(e,t,n){m(e),u(o,e,t,n)},b;for(var w=0,E=arguments.length;w<E;w++)g[w]=arguments[w];o=function(t){if(arguments.length){var i=p,s=v.call(r,t,i);return o.hasDependencies?d.call(r):(s===undefined?p=d.call(r):p=s,u(o,p,i),p)}return n.length&&o.canReadForChangeEvent!==!1&&(e.__reading(o,"change"),o.bound||e.compute.temporarilyBind(o)),o.bound?p:d.call(r)};if(typeof t=="function"){v=t,d=t,o.canReadForChangeEvent=i===!1?!1:!0;var S=s?f(o,t,r||this,m):a(o,t,r||this,m);l=S.on,h=S.off}else if(r)if(typeof r=="string"){var x=r,T=t instanceof e.Map;if(T){o.hasDependencies=!0;var N;d=function(){return t.attr(x)},v=function(e){t.attr(x,e)},l=function(n){N=function(e,t,r){n(t,r,e.batchNum)},t.bind(i||x,N),p=e.__read(d).value},h=function(e){t.unbind(i||x,N)}}else d=function(){return t[x]},v=function(e){t[x]=e},l=function(n){N=function(){n(d(),p)},e.bind.call(t,i||x,N),p=e.__read(d).value},h=function(n){e.unbind.call(t,i||x,N)}}else if(typeof r=="function")p=t,v=r,r=i,b="setter";else{p=t;var C=r,L=y;r=C.context||C,d=C.get||d,v=C.set||function(){return p};if(C.fn){var A=C.fn,O;d=function(){return A.call(r,p)},A.length===0?O=a(o,A,r,m):A.length===1?O=a(o,function(){return A.call(r,p)},r,m):(y=function(e){e!==undefined&&L(e,p)},O=a(o,function(){var e=A.call(r,p,function(e){L(e,p)});return e!==undefined?e:p},r,m)),l=O.on,h=O.off}else y=function(){var e=d.call(r);L(e,p)};l=C.on||l,h=C.off||h}else p=t;return e.cid(o,"compute"),e.simpleExtend(o,{isComputed:!0,_bindsetup:function(){this.bound=!0;var t=e.__clearReading();l.call(this,y),e.__setReading(t)},_bindteardown:function(){h.call(this,y),this.bound=!1},bind:e.bindAndSetup,unbind:e.unbindAndTeardown,clone:function(t){return t&&(b==="setter"?g[2]=t:g[1]=t),e.compute.apply(e,g)}})};var h,p=function(){for(var e=0,t=h.length;e<t;e++)h[e].unbind("change",c);h=null};return e.compute.temporarilyBind=function(e){e.bind("change",c),h||(h=[],setTimeout(p,10)),h.push(e)},e.compute.truthy=function(t){return e.compute(function(){var e=t();return typeof e=="function"&&(e=e()),!!e})},e.compute.async=function(t,n,r){return e.compute(t,{fn:n,context:r})},e.compute.read=function(t,n,r){r=r||{};var i=t,s,o,u;for(var a=0,f=n.length;a<f;a++){o=i,o&&o.isComputed&&(r.foundObservable&&r.foundObservable(o,a),o=i=o()),l(o)?(!u&&r.foundObservable&&r.foundObservable(o,a),u=1,typeof o[n[a]]=="function"&&o.constructor.prototype[n[a]]===o[n[a]]?r.returnObserveMethods?i=i[n[a]]:n[a]==="constructor"&&o instanceof e.Construct||o[n[a]].prototype instanceof e.Construct?i=o[n[a]]:i=o[n[a]].apply(o,r.args||[]):i=i.attr(n[a])):i==null?i=undefined:i=o[n[a]],s=typeof i,i&&i.isComputed&&!r.isArgument&&a<f-1?(!u&&r.foundObservable&&r.foundObservable(o,a+1),i=i()):a<n.length-1&&s==="function"&&r.executeAnonymousFunctions&&!(e.Construct&&i.prototype instanceof e.Construct)&&(i=i());if(a<n.length-1&&(i===null||s!=="function"&&s!=="object"))return r.earlyExit&&r.earlyExit(o,a,i),{value:undefined,parent:o}}return typeof i=="function"&&!(e.Construct&&i.prototype instanceof e.Construct)&&(!e.route||i!==e.route)&&(r.isArgument?!i.isComputed&&r.proxyMethods!==!1&&(i=e.proxy(i,o)):(i.isComputed&&!u&&r.foundObservable&&r.foundObservable(i,a),i=i.call(o))),i===undefined&&r.earlyExit&&r.earlyExit(o,a-1),{value:i,parent:o}},e.compute.set=function(e,t,n){if(l(e))return e.attr(t,n);if(e[t]&&e[t].isComputed)return e[t](n);typeof e=="object"&&(e[t]=n)},e.compute}),define("can/view/scope",["can/util/library","can/construct","can/map","can/list","can/view","can/compute"],function(e){var t=/(\\)?\./g,n=/\\\./g,r=function(e){var r=[],i=0;return e.replace(t,function(t,s,o){s||(r.push(e.slice(i,o).replace(n,".")),i=o+t.length)}),r.push(e.slice(i).replace(n,".")),r},i=e.Construct.extend({read:e.compute.read},{init:function(e,t){this._context=e,this._parent=t,this.__cache={}},attr:function(t,n){var r=e.__clearReading(),i=this.read(t,{isArgument:!0,returnObserveMethods:!0,proxyMethods:!1});if(arguments.length===2){var s=t.lastIndexOf("."),o=s!==-1?t.substring(0,s):".",u=this.read(o,{isArgument:!0,returnObserveMethods:!0,proxyMethods:!1}).value;s!==-1&&(t=t.substring(s+1,t.length)),e.compute.set(u,t,n)}return e.__setReading(r),i.value},add:function(e){return e!==this._context?new this.constructor(e,this):this},computeData:function(t,n){n=n||{args:[]};var r=this,i,s,o={compute:e.compute(function(u){if(!arguments.length){if(i)return e.compute.read(i,s,n).value;var l=r.read(t,n);return i=l.rootObserve,s=l.reads,o.scope=l.scope,o.initialValue=l.value,o.reads=l.reads,o.root=i,l.value}if(i.isComputed)i(u);else if(s.length){var a=s.length-1,f=s.length?e.compute.read(i,s.slice(0,a)).value:i;e.compute.set(f,s[a],u)}})};return o},compute:function(e,t){return this.computeData(e,t).compute},read:function(t,n){var i;if(t.substr(0,2)==="./")i=!0,t=t.substr(2);else{if(t.substr(0,3)==="../")return this._parent.read(t.substr(3),n);if(t==="..")return{value:this._parent._context};if(t==="."||t==="this")return{value:this._context}}var s=t.indexOf("\\.")===-1?t.split("."):r(t),o,u=this,a,f=[],l=-1,c,h,p,d;while(u){o=u._context;if(o!==null){var v=e.compute.read(o,s,e.simpleExtend({foundObservable:function(e,t){p=e,d=s.slice(t)},earlyExit:function(t,n){n>l&&(a=p,f=d,l=n,h=u,c=e.__clearReading())},executeAnonymousFunctions:!0},n));if(v.value!==undefined)return{scope:u,rootObserve:p,value:v.value,reads:d}}e.__clearReading(),i?u=null:u=u._parent}return a?(e.__setReading(c),{scope:h,rootObserve:a,reads:f,value:undefined}):{names:s,value:undefined}}});return e.view.Scope=i,i}),define("can/view/elements",["can/util/library","can/view"],function(e){var t=function(){return e.$(document.createComment("~")).length===1}(),n={tagToContentPropMap:{option:"textContent"in document.createElement("option")?"textContent":"innerText",textarea:"value"},attrMap:e.attr.map,attrReg:/([^\s=]+)[\s]*=[\s]*/,defaultValue:e.attr.defaultValue,tagMap:{"":"span",colgroup:"col",table:"tbody",tr:"td",ol:"li",ul:"li",tbody:"tr",thead:"tr",tfoot:"tr",select:"option",optgroup:"option"},reverseTagMap:{col:"colgroup",tr:"tbody",option:"select",td:"tr",th:"tr",li:"ul"},getParentNode:function(e,t){return t&&e.parentNode.nodeType===11?t:e.parentNode},setAttr:e.attr.set,getAttr:e.attr.get,removeAttr:e.attr.remove,contentText:function(e){return typeof e=="string"?e:!e&&e!==0?"":""+e},after:function(t,n){var r=t[t.length-1];r.nextSibling?e.insertBefore(r.parentNode,n,r.nextSibling):e.appendChild(r.parentNode,n)},replace:function(r,i){n.after(r,i),e.remove(e.$(r)).length<r.length&&!t&&e.each(r,function(e){e.nodeType===8&&e.parentNode.removeChild(e)})}};return e.view.elements=n,n}),define("can/view/callbacks",["can/util/library","can/view"],function(e){var t=e.view.attr=function(e,t){if(!t){var i=n[e];if(!i)for(var s=0,o=r.length;s<o;s++){var u=r[s];if(u.match.test(e)){i=u.handler;break}}return i}typeof e=="string"?n[e]=t:r.push({match:e,handler:t})},n={},r=[],i=/[-\:]/,s=e.view.tag=function(e,t){if(!t){var n=o[e.toLowerCase()];return!n&&i.test(e)&&(n=function(){}),n}window.html5&&(window.html5.elements+=" "+e,window.html5.shivDocument()),o[e.toLowerCase()]=t},o={};return e.view.callbacks={_tags:o,_attributes:n,_regExpAttributes:r,tag:s,attr:t,tagHandler:function(t,n,r){var i=r.options.attr("tags."+n),s=i||o[n],u=r.scope,a;if(s){var f=e.__clearReading();a=s(t,r),e.__setReading(f)}else a=u;if(a&&r.subtemplate){u!==a&&(u=u.add(a));var l=r.subtemplate(u,r.options),c=typeof l=="string"?e.view.frag(l):l;e.appendChild(t,c)}}},e.view.callbacks}),define("can/view/scanner",["can/view","can/view/elements","can/view/callbacks"],function(can,elements,viewCallbacks){var newLine=/(\r|\n)+/g,notEndTag=/\//,clean=function(e){return e.split("\\").join("\\\\").split("\n").join("\\n").split('"').join('\\"').split("	").join("\\t")},getTag=function(e,t,n){if(e)return e;while(n<t.length){if(t[n]==="<"&&!notEndTag.test(t[n+1]))return elements.reverseTagMap[t[n+1]]||"span";n++}return""},bracketNum=function(e){return--e.split("{").length- --e.split("}").length},myEval=function(script){eval(script)},attrReg=/([^\s]+)[\s]*=[\s]*$/,startTxt="var ___v1ew = [];",finishTxt="return ___v1ew.join('')",put_cmd="___v1ew.push(\n",insert_cmd=put_cmd,htmlTag=null,quote=null,beforeQuote=null,rescan=null,getAttrName=function(){var e=beforeQuote.match(attrReg);return e&&e[1]},status=function(){return quote?"'"+getAttrName()+"'":htmlTag?1:0},top=function(e){return e[e.length-1]},Scanner;return can.view.Scanner=Scanner=function(e){can.extend(this,{text:{},tokens:[]},e),this.text.options=this.text.options||"",this.tokenReg=[],this.tokenSimple={"<":"<",">":">",'"':'"',"'":"'"},this.tokenComplex=[],this.tokenMap={};for(var t=0,n;n=this.tokens[t];t++)n[2]?(this.tokenReg.push(n[2]),this.tokenComplex.push({abbr:n[1],re:new RegExp(n[2]),rescan:n[3]})):(this.tokenReg.push(n[1]),this.tokenSimple[n[1]]=n[0]),this.tokenMap[n[0]]=n[1];this.tokenReg=new RegExp("("+this.tokenReg.slice(0).concat(["<",">",'"',"'"]).join("|")+")","g")},Scanner.prototype={helpers:[],scan:function(e,t){var n=[],r=0,i=this.tokenSimple,s=this.tokenComplex;e=e.replace(newLine,"\n"),this.transform&&(e=this.transform(e)),e.replace(this.tokenReg,function(t,o){var u=arguments[arguments.length-2];u>r&&n.push(e.substring(r,u));if(i[t])n.push(t);else for(var a=0,f;f=s[a];a++)if(f.re.test(t)){n.push(f.abbr),f.rescan&&n.push(f.rescan(o));break}r=u+o.length}),r<e.length&&n.push(e.substr(r));var o="",u=[startTxt+(this.text.start||"")],a=function(e,t){u.push(put_cmd,'"',clean(e),'"'+(t||"")+");")},f=[],l,c=null,h=!1,p={attributeHookups:[],tagHookups:[],lastTagHookup:""},d=function(){p.lastTagHookup=p.tagHookups.pop()+p.tagHookups.length},v="",m=[],g=!1,y,b=!1,w=0,E,S=this.tokenMap,x;htmlTag=quote=beforeQuote=null;for(;(E=n[w++])!==undefined;){if(c===null)switch(E){case S.left:case S.escapeLeft:case S.returnLeft:h=htmlTag&&1;case S.commentLeft:c=E,o.length&&a(o),o="";break;case S.escapeFull:h=htmlTag&&1,rescan=1,c=S.escapeLeft,o.length&&a(o),rescan=n[w++],o=rescan.content||rescan,rescan.before&&a(rescan.before),n.splice(w,0,S.right);break;case S.commentFull:break;case S.templateLeft:o+=S.left;break;case"<":n[w].indexOf("!--")!==0&&(htmlTag=1,h=0),o+=E;break;case">":htmlTag=0;var T=o.substr(o.length-1)==="/"||o.substr(o.length-2)==="--",N="";p.attributeHookups.length&&(N="attrs: ['"+p.attributeHookups.join("','")+"'], ",p.attributeHookups=[]);if(v+p.tagHookups.length!==p.lastTagHookup&&v===top(p.tagHookups))T&&(o=o.substr(0,o.length-1)),u.push(put_cmd,'"',clean(o),'"',",can.view.pending({tagName:'"+v+"',"+N+"scope: "+(this.text.scope||"this")+this.text.options),T?(u.push("}));"),o="/>",d()):n[w]==="<"&&n[w+1]==="/"+v?(u.push("}));"),o=E,d()):(u.push(",subtemplate: function("+this.text.argNames+"){\n"+startTxt+(this.text.start||"")),o="");else if(h||!g&&elements.tagToContentPropMap[m[m.length-1]]||N){var C=",can.view.pending({"+N+"scope: "+(this.text.scope||"this")+this.text.options+'}),"';T?a(o.substr(0,o.length-1),C+'/>"'):a(o,C+'>"'),o="",h=0}else o+=E;if(T||g)m.pop(),v=m[m.length-1],g=!1;p.attributeHookups=[];break;case"'":case'"':if(htmlTag)if(quote&&quote===E){quote=null;var k=getAttrName();viewCallbacks.attr(k)&&p.attributeHookups.push(k);if(b){o+=E,a(o),u.push(finishTxt,"}));\n"),o="",b=!1;break}}else if(quote===null){quote=E,beforeQuote=l,x=getAttrName();if(v==="img"&&x==="src"||x==="style"){a(o.replace(attrReg,"")),o="",b=!0,u.push(insert_cmd,"can.view.txt(2,'"+getTag(v,n,w)+"',"+status()+",this,function(){",startTxt),a(x+"="+E);break}};default:if(l==="<"){v=E.substr(0,3)==="!--"?"!--":E.split(/\s/)[0];var L=!1,A;v.indexOf("/")===0&&(L=!0,A=v.substr(1)),L?(top(m)===A&&(v=A,g=!0),top(p.tagHookups)===A&&(a(o.substr(0,o.length-1)),u.push(finishTxt+"}}) );"),o="><",d())):(v.lastIndexOf("/")===v.length-1&&(v=v.substr(0,v.length-1)),v!=="!--"&&viewCallbacks.tag(v)&&(v==="content"&&elements.tagMap[top(m)]&&(E=E.replace("content",elements.tagMap[top(m)])),p.tagHookups.push(v)),m.push(v))}o+=E}else switch(E){case S.right:case S.returnRight:switch(c){case S.left:y=bracketNum(o),y===1?(u.push(insert_cmd,"can.view.txt(0,'"+getTag(v,n,w)+"',"+status()+",this,function(){",startTxt,o),f.push({before:"",after:finishTxt+"}));\n"})):(r=f.length&&y===-1?f.pop():{after:";"},r.before&&u.push(r.before),u.push(o,";",r.after));break;case S.escapeLeft:case S.returnLeft:y=bracketNum(o),y&&f.push({before:finishTxt,after:"}));\n"});var O=c===S.escapeLeft?1:0,M={insert:insert_cmd,tagName:getTag(v,n,w),status:status(),specialAttribute:b};for(var _=0;_<this.helpers.length;_++){var D=this.helpers[_];if(D.name.test(o)){o=D.fn(o,M),D.name.source===/^>[\s]*\w*/.source&&(O=0);break}}typeof o=="object"?o.startTxt&&o.end&&b?u.push(insert_cmd,"can.view.toStr( ",o.content,"() ) );"):(o.startTxt?u.push(insert_cmd,"can.view.txt(\n"+(typeof status()=="string"||(o.escaped!=null?o.escaped:O))+",\n'"+v+"',\n"+status()+",\nthis,\n"):o.startOnlyTxt&&u.push(insert_cmd,"can.view.onlytxt(this,\n"),u.push(o.content),o.end&&u.push("));")):b?u.push(insert_cmd,o,");"):u.push(insert_cmd,"can.view.txt(\n"+(typeof status()=="string"||O)+",\n'"+v+"',\n"+status()+",\nthis,\nfunction(){ "+(this.text.escape||"")+"return ",o,y?startTxt:"}));\n"),rescan&&rescan.after&&rescan.after.length&&(a(rescan.after.length),rescan=null)}c=null,o="";break;case S.templateLeft:o+=S.left;break;default:o+=E}l=E}o.length&&a(o),u.push(";");var P=u.join(""),H={out:(this.text.outStart||"")+P+" "+finishTxt+(this.text.outEnd||"")};return myEval.call(H,"this.fn = (function("+this.text.argNames+"){"+H.out+"});\r\n//# sourceURL="+t+".js"),H}},can.view.pending=function(e){var t=can.view.getHooks();return can.view.hook(function(n){can.each(t,function(e){e(n)}),e.templateType="legacy",e.tagName&&viewCallbacks.tagHandler(n,e.tagName,e),can.each(e&&e.attrs||[],function(t){e.attributeName=t;var r=viewCallbacks.attr(t);r&&r(n,e)})})},can.view.tag("content",function(e,t){return t.scope}),can.view.Scanner=Scanner,Scanner}),define("can/view/node_lists",["can/util/library","can/view/elements"],function(e){var t=!0;try{document.createTextNode("")._=0}catch(n){t=!1}var r={},i={},s="ejs_"+Math.random(),o=0,u=function(e,n){var r=n||i,u=a(e,r);return u?u:t||e.nodeType!==3?(++o,e[s]=(e.nodeName?"element_":"obj_")+o):(++o,r["text_"+o]=e,"text_"+o)},a=function(e,n){if(t||e.nodeType!==3)return e[s];for(var r in n)if(n[r]===e)return r},f=[].splice,l=[].push,c=function(e){var t=0;for(var n=0,r=e.length;n<r;n++){var i=e[n];i.nodeType?t++:t+=c(i)}return t},h=function(e,t){var n={};for(var r=0,i=e.length;r<i;r++){var s=p.first(e[r]);n[u(s,t)]=e[r]}return n},p={id:u,update:function(t,n){var r=p.unregisterChildren(t);n=e.makeArray(n);var i=t.length;return f.apply(t,[0,i].concat(n)),t.replacements?p.nestReplacements(t):p.nestList(t),r},nestReplacements:function(e){var t=0,n={},r=h(e.replacements,n),i=e.replacements.length;while(t<e.length&&i){var s=e[t],o=r[a(s,n)];o&&(e.splice(t,c(o),o),i--),t++}e.replacements=[]},nestList:function(e){var t=0;while(t<e.length){var n=e[t],i=r[u(n)];i?i!==e&&e.splice(t,c(i),i):r[u(n)]=e,t++}},last:function(e){var t=e[e.length-1];return t.nodeType?t:p.last(t)},first:function(e){var t=e[0];return t.nodeType?t:p.first(t)},register:function(e,t,n){return e.unregistered=t,e.parentList=n,n===!0?e.replacements=[]:n?(n.replacements.push(e),e.replacements=[]):p.nestList(e),e},unregisterChildren:function(t){var n=[];return e.each(t,function(e){e.nodeType?(t.replacements||delete r[u(e)],n.push(e)):l.apply(n,p.unregister(e))}),n},unregister:function(e){var t=p.unregisterChildren(e);if(e.unregistered){var n=e.unregistered;delete e.unregistered,delete e.replacements,n()}return t},nodeMap:r};return e.view.nodeLists=p,p}),define("can/view/parser",["can/view"],function(e){function t(e){var t={},n=e.split(",");for(var r=0;r<n.length;r++)t[n[r]]=!0;return t}var n="-:A-Za-z0-9_",r="[a-zA-Z_:]["+n+":.]*",i="\\s*=\\s*",s='"((?:\\\\.|[^"])*)"',o="'((?:\\\\.|[^'])*)'",u="(?:"+i+"(?:"+"(?:\"[^\"]*\")|(?:'[^']*')|[^>\\s]+))?",a="\\{\\{[^\\}]*\\}\\}\\}?",f="\\{\\{([^\\}]*)\\}\\}\\}?",l=new RegExp("^<(["+n+"]+)"+"("+"(?:\\s*"+"(?:(?:"+"(?:"+r+")?"+u+")|"+"(?:"+a+")+)"+")*"+")\\s*(\\/?)>"),c=new RegExp("^<\\/(["+n+"]+)[^>]*>"),h=new RegExp("(?:(?:("+r+")|"+f+")"+"(?:"+i+"(?:"+"(?:"+s+")|(?:"+o+")|([^>\\s]+)"+")"+")?)","g"),p=new RegExp(f,"g"),d=/<|\{\{/,v=t("area,base,basefont,br,col,frame,hr,img,input,isindex,link,meta,param,embed"),m=t("address,article,applet,aside,audio,blockquote,button,canvas,center,dd,del,dir,div,dl,dt,fieldset,figcaption,figure,footer,form,frameset,h1,h2,h3,h4,h5,h6,header,hgroup,hr,iframe,ins,isindex,li,map,menu,noframes,noscript,object,ol,output,p,pre,section,script,table,tbody,td,tfoot,th,thead,tr,ul,video"),g=t("a,abbr,acronym,applet,b,basefont,bdo,big,br,button,cite,code,del,dfn,em,font,i,iframe,img,input,ins,kbd,label,map,object,q,s,samp,script,select,small,span,strike,strong,sub,sup,textarea,tt,u,var"),y=t("colgroup,dd,dt,li,options,p,td,tfoot,th,thead,tr"),b=t("checked,compact,declare,defer,disabled,ismap,multiple,nohref,noresize,noshade,nowrap,readonly,selected"),w=t("script,style"),E=function(e,t){function n(e,n,i,s){n=n.toLowerCase();if(m[n])while(a.last()&&g[a.last()])r("",a.last());y[n]&&a.last()===n&&r("",n),s=v[n]||!!s,t.start(n,s),s||a.push(n),E.parseAttrs(i,t),t.end(n,s)}function r(e,n){var r;if(!n)r=0;else for(r=a.length-1;r>=0;r--)if(a[r]===n)break;if(r>=0){for(var i=a.length-1;i>=r;i--)t.close&&t.close(a[i]);a.length=r}}function i(e,n){t.special&&t.special(n)}var s,o,u,a=[],f=e;a.last=function(){return this[this.length-1]};while(e){o=!0;if(!a.last()||!w[a.last()]){e.indexOf("<!--")===0?(s=e.indexOf("-->"),s>=0&&(t.comment&&t.comment(e.substring(4,s)),e=e.substring(s+3),o=!1)):e.indexOf("</")===0?(u=e.match(c),u&&(e=e.substring(u[0].length),u[0].replace(c,r),o=!1)):e.indexOf("<")===0?(u=e.match(l),u&&(e=e.substring(u[0].length),u[0].replace(l,n),o=!1)):e.indexOf("{{")===0&&(u=e.match(p),u&&(e=e.substring(u[0].length),u[0].replace(p,i)));if(o){s=e.search(d);var h=s<0?e:e.substring(0,s);e=s<0?"":e.substring(s),t.chars&&h&&t.chars(h)}}else e=e.replace(new RegExp("([\\s\\S]*?)</"+a.last()+"[^>]*>"),function(e,n){return n=n.replace(/<!--([\s\S]*?)-->|<!\[CDATA\[([\s\S]*?)]]>/g,"$1$2"),t.chars&&t.chars(n),""}),r("",a.last());if(e===f)throw"Parse Error: "+e;f=e}r(),t.done()};return E.parseAttrs=function(e,t){(e!=null?e:"").replace(h,function(e,n,r,i,s,o){r&&t.special(r);if(n||i||s||o){var u=arguments[3]?arguments[3]:arguments[4]?arguments[4]:arguments[5]?arguments[5]:b[n.toLowerCase()]?n:"";t.attrStart(n||"");var a=p.lastIndex=0,f=p.exec(u),l;while(f)l=u.substring(a,p.lastIndex-f[0].length),l.length&&t.attrValue(l),t.special(f[1]),a=p.lastIndex,f=p.exec(u);l=u.substr(a,u.length),l&&t.attrValue(l),t.attrEnd(n||"")}})},e.view.parser=E,E}),define("can/view/live",["can/util/library","can/view/elements","can/view","can/view/node_lists","can/view/parser"],function(e,t,n,r,i){t=t||e.view.elements,r=r||e.view.NodeLists,i=i||e.view.parser;var s=function(t,n,r){var i=!1,s=function(){return i||(i=!0,r(o),e.unbind.call(t,"removed",s)),!0},o={teardownCheck:function(e){return e?!1:s()}};return e.bind.call(t,"removed",s),n(o),o},o=function(e,t,n){return s(e,function(){t.bind("change",n)},function(e){t.unbind("change",n),e.nodeList&&r.unregister(e.nodeList)})},u=function(e){var t={},n;return i.parseAttrs(e,{attrStart:function(e){t[e]="",n=e},attrValue:function(e){t[n]+=e},attrEnd:function(){}}),t},a=[].splice,f=function(e){return e&&e.nodeType},l=function(e){e.childNodes.length||e.appendChild(document.createTextNode(""))},c={list:function(n,i,o,u,f,l){var h=l||[n],p=[],d=function(n,i,s){var f=document.createDocumentFragment(),c=[],d=[];e.each(i,function(t,n){var i=[];l&&r.register(i,null,!0);var a=e.compute(n+s),h=o.call(u,t,a,i),p=typeof h=="string",v=e.frag(h);v=p?e.view.hookup(v):v;var m=e.makeArray(v.childNodes);l?(r.update(i,m),c.push(i)):c.push(r.register(m)),f.appendChild(v),d.push(a)});var v=s+1;if(!h[v])t.after(v===1?[m]:[r.last(h[v-1])],f);else{var g=r.first(h[v]);e.insertBefore(g.parentNode,f,g)}a.apply(h,[v,0].concat(c)),a.apply(p,[s,0].concat(d));for(var y=s+d.length,b=p.length;y<b;y++)p[y](y)},v=function(t,n,i,s,o){if(!s&&w.teardownCheck(m.parentNode))return;i<0&&(i=p.length+i);var u=h.splice(i+1,n.length),a=[];e.each(u,function(e){var t=r.unregister(e);[].push.apply(a,t)}),p.splice(i,n.length);for(var f=i,l=p.length;f<l;f++)p[f](f);o||e.remove(e.$(a))},m=document.createTextNode(""),g,y=function(e){g&&g.unbind&&g.unbind("add",d).unbind("remove",v),v({},{length:h.length-1},0,!0,e)},b=function(e,t,n){y(),g=t||[],g.bind&&g.bind("add",d).bind("remove",v),d({},g,0)};f=t.getParentNode(n,f);var w=s(f,function(){e.isFunction(i)&&i.bind("change",b)},function(){e.isFunction(i)&&i.unbind("change",b),y(!0)});l?(t.replace(h,m),r.update(h,[m]),l.unregistered=w.teardownCheck):c.replace(h,m,w.teardownCheck),b({},e.isFunction(i)?i():i)},html:function(n,i,s,u){var a;s=t.getParentNode(n,s),a=o(s,i,function(e,t,n){var i=r.first(c).parentNode;i&&h(t),a.teardownCheck(r.first(c).parentNode)});var c=u||[n],h=function(n){var i=!f(n),o=e.frag(n),u=e.makeArray(c);l(o),i&&(o=e.view.hookup(o,s)),u=r.update(c,o.childNodes),t.replace(u,o)};a.nodeList=c,u?u.unregistered=a.teardownCheck:r.register(c,a.teardownCheck),h(i())},replace:function(n,i,s){var o=n.slice(0),u=e.frag(i);return r.register(n,s),typeof i=="string"&&(u=e.view.hookup(u,n[0].parentNode)),r.update(n,u.childNodes),t.replace(o,u),n},text:function(n,i,s,u){var a=t.getParentNode(n,s),f=o(a,i,function(t,n,r){typeof l.nodeValue!="unknown"&&(l.nodeValue=e.view.toStr(n)),f.teardownCheck(l.parentNode)}),l=document.createTextNode(e.view.toStr(i()));u?(u.unregistered=f.teardownCheck,f.nodeList=u,r.update(u,[l]),t.replace([n],l)):f.nodeList=c.replace([n],l,f.teardownCheck)},setAttributes:function(t,n){var r=u(n);for(var i in r)e.attr.set(t,i,r[i])},attributes:function(n,r,i){var s={},a=function(r){var i=u(r),o;for(o in i){var a=i[o],f=s[o];a!==f&&e.attr.set(n,o,a),delete s[o]}for(o in s)t.removeAttr(n,o);s=i};o(n,r,function(e,t){a(t)}),arguments.length>=3?s=u(i):a(r())},attributePlaceholder:"__!!__",attributeReplace:/__!!__/g,attribute:function(n,r,i){o(n,i,function(e,i){t.setAttr(n,r,h.render())});var s=e.$(n),u;u=e.data(s,"hooks"),u||e.data(s,"hooks",u={});var a=t.getAttr(n,r),f=a.split(c.attributePlaceholder),l=[],h;l.push(f.shift(),f.join(c.attributePlaceholder)),u[r]?u[r].computes.push(i):u[r]={render:function(){var e=0,n=a?a.replace(c.attributeReplace,function(){return t.contentText(h.computes[e++]())}):t.contentText(h.computes[e++]());return n},computes:[i],batchNum:undefined},h=u[r],l.splice(1,0,i()),t.setAttr(n,r,l.join(""))},specialAttribute:function(e,n,r){o(e,r,function(r,i){t.setAttr(e,n,p(i))}),t.setAttr(e,n,p(r()))},simpleAttribute:function(e,n,r){o(e,r,function(r,i){t.setAttr(e,n,i)}),t.setAttr(e,n,r())}};c.attr=c.simpleAttribute,c.attrs=c.attributes;var h=/(\r|\n)+/g,p=function(e){var n=/^["'].*["']$/;return e=e.replace(t.attrReg,"").replace(h,""),n.test(e)?e.substr(1,e.length-2):e};return e.view.live=c,c}),define("can/view/render",["can/view","can/view/elements","can/view/live","can/util/string"],function(e,t,n){var r=[],i=function(e){var n=t.tagMap[e]||"span";return n==="span"?"@@!!@@":"<"+n+">"+i(n)+"</"+n+">"},s=function(t,n){if(typeof t=="string")return t;if(!t&&t!==0)return"";var i=t.hookup&&function(e,n){t.hookup.call(t,e,n)}||typeof t=="function"&&t;if(i)return n?"<"+n+" "+e.view.hook(i)+"></"+n+">":(r.push(i),"");return""+t},o=function(t,n){return typeof t=="string"||typeof t=="number"?e.esc(t):s(t,n)},u=!1,a=function(){},f;return e.extend(e.view,{live:n,setupLists:function(){var t=e.view.lists,n;return e.view.lists=function(e,t){return n={list:e,renderer:t},Math.random()},function(){return e.view.lists=t,n}},getHooks:function(){var e=r.slice(0);return f=e,r=[],e},onlytxt:function(e,t){return o(t.call(e))},txt:function(l,c,h,p,d){var v=t.tagMap[c]||"span",m=!1,g,y,b,w=a,E;if(u)g=d.call(p);else{if(typeof h=="string"||h===1)u=!0;var S=e.view.setupLists();w=function(){b.unbind("change",a)},b=e.compute(d,p,!1),b.bind("change",a),y=S(),g=b(),u=!1,m=b.hasDependencies}if(y)return w(),"<"+v+e.view.hook(function(e,t){n.list(e,y.list,y.renderer,p,t)})+"></"+v+">";if(!m||typeof g=="function")return w(),(u||l===2||!l?s:o)(g,h===0&&v);var x=t.tagToContentPropMap[c];return h===0&&!x?"<"+v+e.view.hook(l&&typeof g!="object"?function(e,t){n.text(e,b,t),w()}:function(e,t){n.html(e,b,t),w()})+">"+i(v)+"</"+v+">":h===1?(r.push(function(e){n.attributes(e,b,b()),w()}),b()):l===2?(E=h,r.push(function(e){n.specialAttribute(e,E,b),w()}),b()):(E=h===0?x:h,(h===0?f:r).push(function(e){n.attribute(e,E,b),w()}),n.attributePlaceholder)}}),e}),define("can/view/mustache",["can/util/library","can/view/scope","can/view","can/view/scanner","can/compute","can/view/render"],function(e){e.view.ext=".mustache";var t="scope",n="___h4sh",r="{scope:"+t+",options:options}",i="{scope:"+t+",options:options, special: true}",s=t+",options",o=/((([^'"\s]+?=)?('.*?'|".*?"))|.*?)\s/g,u=/^(('.*?'|".*?"|[0-9]+\.?[0-9]*|true|false|null|undefined)|((.+?)=(('.*?'|".*?"|[0-9]+\.?[0-9]*|true|false)|(.+))))$/,a=function(e){return'{get:"'+e.replace(/"/g,'\\"')+'"}'},f=function(e){return e&&typeof e.get=="string"},l=function(t){return t instanceof e.Map||t&&!!t._get},c=function(e){return e&&e.splice&&typeof e.length=="number"},h=function(t,n,r){var i=function(e,r){return t(e||n,r)};return function(t,s){return t!==undefined&&!(t instanceof e.view.Scope)&&(t=n.add(t)),s!==undefined&&!(s instanceof e.view.Options)&&(s=r.add(s)),i(t,s||r)}},p=function(t,n){if(this.constructor!==p){var r=new p(t);return function(e,t){return r.render(e,t)}}if(typeof t=="function"){this.template={fn:t};return}e.extend(this,t),this.template=this.scanner.scan(this.text,this.name)};e.Mustache=window.Mustache=p,p.prototype.render=function(t,n){return t instanceof e.view.Scope||(t=new e.view.Scope(t||{})),n instanceof e.view.Options||(n=new e.view.Options(n||{})),n=n||{},this.template.fn.call(t,t,n)},e.extend(p.prototype,{scanner:new e.view.Scanner({text:{start:"",scope:t,options:",options: options",argNames:s},tokens:[["returnLeft","{{{","{{[{&]"],["commentFull","{{!}}","^[\\s\\t]*{{!.+?}}\\n"],["commentLeft","{{!","(\\n[\\s\\t]*{{!|{{!)"],["escapeFull","{{}}","(^[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}\\n|\\n[\\s\\t]*{{[#/^][^}]+?}}$)",function(e){return{before:/^\n.+?\n$/.test(e)?"\n":"",content:e.match(/\{\{(.+?)\}\}/)[1]||""}}],["escapeLeft","{{"],["returnRight","}}}"],["right","}}"]],helpers:[{name:/^>[\s]*\w*/,fn:function(t,n){var r=e.trim(t.replace(/^>\s?/,"")).replace(/["|']/g,"");return"can.Mustache.renderPartial('"+r+"',"+s+")"}},{name:/^\s*data\s/,fn:function(e,n){var r=e.match(/["|'](.*)["|']/)[1];return"can.proxy(function(__){can.data(can.$(__),'"+r+"', this.attr('.')); }, "+t+")"}},{name:/\s*\(([\$\w]+)\)\s*->([^\n]*)/,fn:function(e){var n=/\s*\(([\$\w]+)\)\s*->([^\n]*)/,r=e.match(n);return"can.proxy(function(__){var "+r[1]+"=can.$(__);with("+t+".attr('.')){"+r[2]+"}}, this);"}},{name:/^.*$/,fn:function(t,f){var l=!1,c={content:"",startTxt:!1,startOnlyTxt:!1,end:!1};t=e.trim(t);if(t.length&&(l=t.match(/^([#^/]|else$)/))){l=l[0];switch(l){case"#":case"^":f.specialAttribute?c.startOnlyTxt=!0:(c.startTxt=!0,c.escaped=0);break;case"/":return c.end=!0,c.content+='return ___v1ew.join("");}}])',c}t=t.substring(1)}if(l!=="else"){var h=[],p=[],d=0,v;c.content+="can.Mustache.txt(\n"+(f.specialAttribute?i:r)+",\n"+(l?'"'+l+'"':"null")+",",(e.trim(t)+" ").replace(o,function(e,t){d&&(v=t.match(u))?v[2]?h.push(v[0]):p.push(v[4]+":"+(v[6]?v[6]:a(v[5]))):h.push(a(t)),d++}),c.content+=h.join(","),p.length&&(c.content+=",{"+n+":{"+p.join(",")+"}}")}l&&l!=="else"&&(c.content+=",[\n\n");switch(l){case"^":case"#":c.content+="{fn:function("+s+"){var ___v1ew = [];";break;case"else":c.content+='return ___v1ew.join("");}},\n{inverse:function('+s+"){\nvar ___v1ew = [];";break;default:c.content+=")"}return l||(c.startTxt=!0,c.end=!0),c}}]})});var d=e.view.Scanner.prototype.helpers;for(var v=0;v<d.length;v++)p.prototype.scanner.helpers.unshift(d[v]);return p.txt=function(t,r,i){var s=t.scope,o=t.options,u=[],a={fn:function(){},inverse:function(){}},d,v=s.attr("."),m=!0,g;for(var y=3;y<arguments.length;y++){var b=arguments[y];if(r&&e.isArray(b))a=e.extend.apply(e,[a].concat(b));else if(b&&b[n]){d=b[n];for(var w in d)f(d[w])&&(d[w]=p.get(d[w].get,t,!1,!0))}else b&&f(b)?u.push(p.get(b.get,t,!1,!0,!0)):u.push(b)}if(f(i)){var E=i.get;i=p.get(i.get,t,u.length,!1),m=E===i}a.fn=h(a.fn,s,o),a.inverse=h(a.inverse,s,o);if(r==="^"){var S=a.fn;a.fn=a.inverse,a.inverse=S}return(g=m&&typeof i=="string"&&p.getHelper(i,o)||e.isFunction(i)&&!i.isComputed&&{fn:i})?(e.extend(a,{context:v,scope:s,contexts:s,hash:d}),u.push(a),function(){return g.fn.apply(v,u)||""}):function(){var t;e.isFunction(i)&&i.isComputed?t=i():t=i;var n=u.length?u:[t],s=!0,o=[],f,h,p;if(r)for(f=0;f<n.length;f++)p=n[f],h=typeof p!="undefined"&&l(p),c(p)?r==="#"?s=s&&(h?!!p.attr("length"):!!p.length):r==="^"&&(s=s&&(h?!p.attr("length"):!p.length)):s=r==="#"?s&&!!p:r==="^"?s&&!p:s;if(s){if(r==="#"){if(c(t)){var d=l(t);for(f=0;f<t.length;f++)o.push(a.fn(d?t.attr(""+f):t[f]));return o.join("")}return a.fn(t||{})||""}return r==="^"?a.inverse(t||{})||"":""+(t!=null?t:"")}return""}},p.get=function(t,n,r,i,s){var o=n.scope.attr("."),u=n.options||{};if(r){if(p.getHelper(t,u))return t;if(n.scope&&e.isFunction(o[t]))return o[t]}var a=n.scope.computeData(t,{isArgument:i,args:[o,n.scope]}),f=a.compute;e.compute.temporarilyBind(f);var l=a.initialValue,c=p.getHelper(t,u);return!s&&(l===undefined||a.scope!==n.scope)&&p.getHelper(t,u)?t:f.hasDependencies?f:l},p.resolve=function(t){return l(t)&&c(t)&&t.attr("length")?t:e.isFunction(t)?t():t},e.view.Options=e.view.Scope.extend({init:function(t,n){!t.helpers&&!t.partials&&!t.tags&&(t={helpers:t}),e.view.Scope.prototype.init.apply(this,arguments)}}),p._helpers={},p.registerHelper=function(e,t){this._helpers[e]={name:e,fn:t}},p.getHelper=function(e,t){var n;return t&&(n=t.attr("helpers."+e)),n?{fn:n}:this._helpers[e]},p.render=function(t,n,r){if(!e.view.cached[t]){var i=e.__clearReading();n.attr("partial")&&(t=n.attr("partial")),e.__setReading(i)}return e.view.render(t,n,r)},p.safeString=function(e){return{toString:function(){return e}}},p.renderPartial=function(t,n,r){var i=r.attr("partials."+t);return i?i.render?i.render(n,r):i(n,r):e.Mustache.render(t,n,r)},e.each({"if":function(t,n){var r;return e.isFunction(t)?r=e.compute.truthy(t)():r=!!p.resolve(t),r?n.fn(n.contexts||this):n.inverse(n.contexts||this)},unless:function(t,n){return p._helpers["if"].fn.apply(this,[e.isFunction(t)?e.compute(function(){return!t()}):!t,n])},each:function(t,n){var r=p.resolve(t),i=[],s,o,u;if(e.view.lists&&(r instanceof e.List||t&&t.isComputed&&r===undefined))return e.view.lists(t,function(e,t){return n.fn(n.scope.add({"@index":t}).add(e))});t=r;if(!!t&&c(t)){for(u=0;u<t.length;u++)i.push(n.fn(n.scope.add({"@index":u}).add(t[u])));return i.join("")}if(l(t)){s=e.Map.keys(t);for(u=0;u<s.length;u++)o=s[u],i.push(n.fn(n.scope.add({"@key":o}).add(t[o])));return i.join("")}if(t instanceof Object){for(o in t)i.push(n.fn(n.scope.add({"@key":o}).add(t[o])));return i.join("")}},"with":function(e,t){var n=e;e=p.resolve(e);if(!!e)return t.fn(n)},log:function(e,t){typeof console!="undefined"&&console.log&&(t?console.log(e,t.context):console.log(e.context))},"@index":function(t,n){n||(n=t,t=0);var r=n.scope.attr("@index");return""+((e.isFunction(r)?r():r)+t)}},function(e,t){p.registerHelper(t,e)}),e.view.register({suffix:"mustache",contentType:"x-mustache-template",script:function(e,t){return"can.Mustache(function("+s+") { "+(new p({text:t,name:e})).template.out+" })"},renderer:function(e,t){return p({text:t,name:e})}}),e.mustache.registerHelper=e.proxy(e.Mustache.registerHelper,e.Mustache),e.mustache.safeString=e.Mustache.safeString,e}),define("can/observe",["can/util/library","can/map","can/list","can/compute"],function(e){return e.Observe=e.Map,e.Observe.startBatch=e.batch.start,e.Observe.stopBatch=e.batch.stop,e.Observe.triggerBatch=e.batch.trigger,e}),define("can/view/bindings",["can/util/library","can/view/mustache","can/control"],function(e){var t=function(){var e={"":!0,"true":!0,"false":!1},t=function(t){if(!t||!t.getAttribute)return;var n=t.getAttribute("contenteditable");return e[n]};return function(e){var n=t(e);return typeof n=="boolean"?n:!!t(e.parentNode)}}(),n=function(e){return e[0]==="{"&&e[e.length-1]==="}"?e.substr(1,e.length-2):e};e.view.attr("can-value",function(r,a){var f=n(r.getAttribute("can-value")),l=a.scope.computeData(f,{args:[]}).compute,c,h;if(r.nodeName.toLowerCase()==="input"){r.type==="checkbox"&&(e.attr.has(r,"can-true-value")?c=r.getAttribute("can-true-value"):c=!0,e.attr.has(r,"can-false-value")?h=r.getAttribute("can-false-value"):h=!1);if(r.type==="checkbox"||r.type==="radio"){new s(r,{value:l,trueValue:c,falseValue:h});return}}if(r.nodeName.toLowerCase()==="select"&&r.multiple){new o(r,{value:l});return}if(t(r)){new u(r,{value:l});return}new i(r,{value:l})});var r={enter:function(e,t,n){return{event:"keyup",handler:function(e){if(e.keyCode===13)return n.call(this,e)}}}};e.view.attr(/can-[\w\.]+/,function(t,i){var s=i.attributeName,o=s.substr("can-".length),u=function(r){var o=n(t.getAttribute(s)),u=i.scope.read(o,{returnObserveMethods:!0,isArgument:!0});return u.value.call(u.parent,i.scope._context,e.$(this),r)};if(r[o]){var a=r[o](i,t,u);u=a.handler,o=a.event}e.bind.call(t,o,u)});var i=e.Control.extend({init:function(){this.element[0].nodeName.toUpperCase()==="SELECT"?setTimeout(e.proxy(this.set,this),1):this.set()},"{value} change":"set",set:function(){if(!this.element)return;var e=this.options.value();this.element[0].value=e==null?"":e},change:function(){if(!this.element)return;this.options.value(this.element[0].value)}}),s=e.Control.extend({init:function(){this.isCheckbox=this.element[0].type.toLowerCase()==="checkbox",this.check()},"{value} change":"check",check:function(){if(this.isCheckbox){var t=this.options.value(),n=this.options.trueValue||!0;this.element[0].checked=t===n}else{var r=this.options.value()==this.element[0].value?"set":"remove";e.attr[r](this.element[0],"checked",!0)}},change:function(){this.isCheckbox?this.options.value(this.element[0].checked?this.options.trueValue:this.options.falseValue):this.element[0].checked&&this.options.value(this.element[0].value)}}),o=i.extend({init:function(){this.delimiter=";",this.set()},set:function(){var t=this.options.value();typeof t=="string"?(t=t.split(this.delimiter),this.isString=!0):t&&(t=e.makeArray(t));var n={};e.each(t,function(e){n[e]=!0}),e.each(this.element[0].childNodes,function(e){e.value&&(e.selected=!!n[e.value])})},get:function(){var t=[],n=this.element[0].childNodes;return e.each(n,function(e){e.selected&&e.value&&t.push(e.value)}),t},change:function(){var t=this.get(),n=this.options.value();this.isString||typeof n=="string"?(this.isString=!0,this.options.value(t.join(this.delimiter))):n instanceof e.List?n.attr(t,!0):this.options.value(t)}}),u=e.Control.extend({init:function(){this.set(),this.on("blur","setValue")},"{value} change":"set",set:function(){var e=this.options.value();this.element[0].innerHTML=typeof e=="undefined"?"":e},setValue:function(){this.options.value(this.element[0].innerHTML)}})}),define("can/component",["can/util/library","can/view/callbacks","can/control","can/observe","can/view/mustache","can/view/bindings"],function(e,t){var n=/^(dataViewId|class|id)$/i,r=/\{([^\}]+)\}/g,i=e.Component=e.Construct.extend({setup:function(){e.Construct.setup.apply(this,arguments);if(e.Component){var t=this,n=this.prototype.scope;this.Control=s.extend(this.prototype.events),!n||typeof n=="object"&&!(n instanceof e.Map)?this.Map=e.Map.extend(n||{}):n.prototype instanceof e.Map&&(this.Map=n),this.attributeScopeMappings={},e.each(this.Map?this.Map.defaults:{},function(e,n){e==="@"&&(t.attributeScopeMappings[n]=n)});if(this.prototype.template)if(typeof this.prototype.template=="function"){var r=this.prototype.template;this.renderer=function(){return e.view.frag(r.apply(null,arguments))}}else this.renderer=e.view.mustache(this.prototype.template);e.view.tag(this.prototype.tag,function(e,n){new t(e,n)})}}},{setup:function(r,i){var s={},o=this,u={},a,f,l;e.each(this.constructor.attributeScopeMappings,function(t,n){s[n]=r.getAttribute(e.hyphenate(t))}),e.each(e.makeArray(r.attributes),function(l,c){var h=e.camelize(l.nodeName.toLowerCase()),p=l.value;if(o.constructor.attributeScopeMappings[h]||n.test(h)||t.attr(l.nodeName))return;if(p[0]==="{"&&p[p.length-1]==="}")p=p.substr(1,p.length-2);else if(i.templateType!=="legacy"){s[h]=p;return}var d=i.scope.computeData(p,{args:[]}),v=d.compute,m=function(e,t){a=h,f.attr(h,t),a=null};v.bind("change",m),s[h]=v(),v.hasDependencies?(e.bind.call(r,"removed",function(){v.unbind("change",m)}),u[h]=d):v.unbind("change",m)});if(this.constructor.Map)f=new this.constructor.Map(s);else if(this.scope instanceof e.Map)f=this.scope;else if(e.isFunction(this.scope)){var c=this.scope(s,i.scope,r);c instanceof e.Map?f=c:c.prototype instanceof e.Map?f=new c(s):f=new(e.Map.extend(c))(s)}var h={};e.each(u,function(e,t){h[t]=function(n,r){a!==t&&e.compute(r)},f.bind(t,h[t])}),e.bind.call(r,"removed",function(){e.each(h,function(e,t){f.unbind(t,h[t])})}),(!e.isEmptyObject(this.constructor.attributeScopeMappings)||i.templateType!=="legacy")&&e.bind.call(r,"attributes",function(t){var i=e.camelize(t.attributeName);!u[i]&&!n.test(i)&&f.attr(i,r.getAttribute(t.attributeName))}),this.scope=f,e.data(e.$(r),"scope",this.scope);var p=i.scope.add(this.scope),d={helpers:{}};e.each(this.helpers||{},function(t,n){e.isFunction(t)&&(d.helpers[n]=function(){return t.apply(f,arguments)})}),this._control=new this.constructor.Control(r,{scope:this.scope}),this.constructor.renderer?(d.tags||(d.tags={}),d.tags.content=function v(t,n){var r=i.subtemplate||n.subtemplate;r&&(delete d.tags.content,e.view.live.replace([t],r(n.scope,n.options)),d.tags.content=v)},l=this.constructor.renderer(p,i.options.add(d))):i.templateType==="legacy"?l=e.view.frag(i.subtemplate?i.subtemplate(p,i.options.add(d)):""):l=i.subtemplate?i.subtemplate(p,i.options.add(d)):document.createDocumentFragment(),e.appendChild(r,l)}}),s=e.Control.extend({_lookup:function(e){return[e.scope,e,window]},_action:function(t,n,i){var s,o;r.lastIndex=0,s=r.test(t);if(!i&&s)return;if(!s)return e.Control._action.apply(this,arguments);o=e.compute(function(){var i,s=t.replace(r,function(t,r){var s;return r==="scope"?(i=n.scope,""):(r=r.replace(/^scope\./,""),s=e.compute.read(n.scope,r.split("."),{isArgument:!0}).value,s===undefined&&(s=e.getObject(r)),typeof s=="string"?s:(i=s,""))}),o=s.split(/\s+/g),u=o.pop();return{processor:this.processors[u]||this.processors.click,parts:[s,o.join(" "),u],delegate:i||undefined}},this);var u=function(e,n){i._bindings.control[t](i.element),i._bindings.control[t]=n.processor(n.delegate||i.element,n.parts[2],n.parts[1],t,i)};return o.bind("change",u),i._bindings.readyComputes[t]={compute:o,handler:u},o()}},{setup:function(t,n){return this.scope=n.scope,e.Control.prototype.setup.call(this,t,n)},off:function(){this._bindings&&e.each(this._bindings.readyComputes||{},function(e){e.compute.unbind("change",e.handler)}),e.Control.prototype.off.apply(this,arguments),this._bindings.readyComputes={}}});return window.jQuery&&jQuery.fn&&(jQuery.fn.scope=function(e){return e?this.data("scope").attr(e):this.data("scope")}),e.scope=function(t,n){return t=e.$(t),n?e.data(t,"scope").attr(n):e.data(t,"scope")},i}),define("can",["can/util/library","can/control/route","can/model","can/view/mustache","can/component"],function(e){return e}),define("common_scripts",["jquery"],function(e){return function(){e("#nav-accordion").dcAccordion({eventType:"click",autoClose:!0,saveState:!0,disableLink:!0,speed:"slow",showCount:!1,autoExpand:!0,classExpand:"dcjq-current-parent"}),e.slidebars(),jQuery("#sidebar .sub-menu > a").click(function(){var t=e(this).offset();diff=250-t.top,diff>0?e("#sidebar").scrollTo("-="+Math.abs(diff),500):e("#sidebar").scrollTo("+="+Math.abs(diff),500)}),e(function(){function t(){var t=e(window).width();t<=768&&(e("#container").addClass("sidebar-close"),e("#sidebar > ul").hide()),t>768&&(e("#container").removeClass("sidebar-close"),e("#sidebar > ul").show())}e(window).on("load",t),e(window).on("resize",t)}),e(".fa-bars").click(function(){e("#sidebar > ul").is(":visible")===!0?(e(".main-content.active").css({"margin-left":"0px"}),e("#sidebar").css({"margin-left":"-210px"}),e("#sidebar > ul").hide(),e("#container").addClass("sidebar-closed")):(e(".main-content.active").css({"margin-left":"210px"}),e("#sidebar > ul").show(),e("#sidebar").css({"margin-left":"0"}),e("#container").removeClass("sidebar-closed"))}),e("#sidebar").niceScroll({styler:"fb",cursorcolor:"#e8403f",cursorwidth:"3",cursorborderradius:"10px",background:"#404040",spacebarenabled:!1,cursorborder:""}),e("html").niceScroll({styler:"fb",cursorcolor:"#e8403f",cursorwidth:"6",cursorborderradius:"10px",background:"#404040",spacebarenabled:!1,cursorborder:"",zindex:"1000"}),jQuery(".panel .tools .fa-chevron-down").click(function(){var e=jQuery(this).parents(".panel").children(".panel-body");jQuery(this).hasClass("fa-chevron-down")?(jQuery(this).removeClass("fa-chevron-down").addClass("fa-chevron-up"),e.slideUp(200)):(jQuery(this).removeClass("fa-chevron-up").addClass("fa-chevron-down"),e.slideDown(200))}),jQuery(".panel .tools .fa-times").click(function(){jQuery(this).parents(".panel").parent().remove()}),e(".tooltips").tooltip(),e(".popovers").popover(),e(".custom-bar-chart")&&e(".bar").each(function(){var t=e(this).find(".value").html();e(this).find(".value").html(""),e(this).find(".value").animate({height:t},2e3)})}}),define("can/route/pushstate",["can/util/library","can/route"],function(e){if(window.history&&history.pushState){e.route.bindings.pushstate={root:"/",matchSlashes:!1,paramsMatcher:/^\?(?:[^=]+=[^&]*&)*[^=]+=[^&]*/,querySeparator:"?",bind:function(){e.delegate.call(e.$(document.documentElement),"a","click",t),e.each(r,function(t){i[t]=window.history[t],window.history[t]=function(n,r,s){var o=s.indexOf("http")===0,u=window.location.search+window.location.hash;if(!o&&s!==window.location.pathname+u||o&&s!==window.location.href+u)i[t].apply(window.history,arguments),e.route.setState()}}),e.bind.call(window,"popstate",e.route.setState)},unbind:function(){e.undelegate.call(e.$(document.documentElement),"click","a",t),e.each(r,function(e){window.history[e]=i[e]}),e.unbind.call(window,"popstate",e.route.setState)},matchingPartOfURL:function(){var e=n(),t=location.pathname+location.search,r=t.indexOf(e);return t.substr(r+e.length)},setURL:function(t){s&&t.indexOf("#")===-1&&window.location.hash&&(t+=window.location.hash),window.history.pushState(null,null,e.route._call("root")+t)}};var t=function(t){if(t.isDefaultPrevented?!t.isDefaultPrevented():t.defaultPrevented!==!0){var r=this._node||this,i=r.host||window.location.host;if(window.location.host===i){var o=n();if(r.pathname.indexOf(o)===0){var u=(r.pathname+r.search).substr(o.length),a=e.route.deparam(u);a.hasOwnProperty("route")&&(s=!0,window.history.pushState(null,null,r.href),t.preventDefault&&t.preventDefault())}}}},n=function(){var t=location.protocol+"//"+location.host,n=e.route._call("root"),r=n.indexOf(t);return r===0?n.substr(t.length):n},r=["pushState","replaceState"],i={},s=!1;e.route.defaultBinding="pushstate"}return e});if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){var t=e.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),+function(e){function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,r=this;e(this).one("bsTransitionEnd",function(){n=!0});var i=function(){n||e(r).trigger(e.support.transition.end)};return setTimeout(i,t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){return e(t.target).is(this)?t.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),+function(e){function t(t){return this.each(function(){var n=e(this),i=n.data("bs.alert");i||n.data("bs.alert",i=new r(this)),"string"==typeof t&&i[t].call(n)})}var n='[data-dismiss="alert"]',r=function(t){e(t).on("click",n,this.close)};r.VERSION="3.3.2",r.TRANSITION_DURATION=150,r.prototype.close=function(t){function n(){o.detach().trigger("closed.bs.alert").remove()}var i=e(this),s=i.attr("data-target");s||(s=i.attr("href"),s=s&&s.replace(/.*(?=#[^\s]*$)/,""));var o=e(s);t&&t.preventDefault(),o.length||(o=i.closest(".alert")),o.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(o.removeClass("in"),e.support.transition&&o.hasClass("fade")?o.one("bsTransitionEnd",n).emulateTransitionEnd(r.TRANSITION_DURATION):n())};var i=e.fn.alert;e.fn.alert=t,e.fn.alert.Constructor=r,e.fn.alert.noConflict=function(){return e.fn.alert=i,this},e(document).on("click.bs.alert.data-api",n,r.prototype.close)}(jQuery),+function(e){function t(t){return this.each(function(){var r=e(this),i=r.data("bs.button"),s="object"==typeof t&&t;i||r.data("bs.button",i=new n(this,s)),"toggle"==t?i.toggle():t&&i.setState(t)})}var n=function(t,r){this.$element=e(t),this.options=e.extend({},n.DEFAULTS,r),this.isLoading=!1};n.VERSION="3.3.2",n.DEFAULTS={loadingText:"loading..."},n.prototype.setState=function(t){var n="disabled",r=this.$element,i=r.is("input")?"val":"html",s=r.data();t+="Text",null==s.resetText&&r.data("resetText",r[i]()),setTimeout(e.proxy(function(){r[i](null==s[t]?this.options[t]:s[t]),"loadingText"==t?(this.isLoading=!0,r.addClass(n).attr(n,n)):this.isLoading&&(this.isLoading=!1,r.removeClass(n).removeAttr(n))},this),0)},n.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var n=this.$element.find("input");"radio"==n.prop("type")&&(n.prop("checked")&&this.$element.hasClass("active")?e=!1:t.find(".active").removeClass("active")),e&&n.prop("checked",!this.$element.hasClass("active")).trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active"));e&&this.$element.toggleClass("active")};var r=e.fn.button;e.fn.button=t,e.fn.button.Constructor=n,e.fn.button.noConflict=function(){return e.fn.button=r,this},e(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(n){var r=e(n.target);r.hasClass("btn")||(r=r.closest(".btn")),t.call(r,"toggle"),n.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){e(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}(jQuery),+function(e){function t(t){return this.each(function(){var r=e(this),i=r.data("bs.carousel"),s=e.extend({},n.DEFAULTS,r.data(),"object"==typeof t&&t),o="string"==typeof t?t:s.slide;i||r.data("bs.carousel",i=new n(this,s)),"number"==typeof t?i.to(t):o?i[o]():s.interval&&i.pause().cycle()})}var n=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=this.sliding=this.interval=this.$active=this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",e.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",e.proxy(this.pause,this)).on("mouseleave.bs.carousel",e.proxy(this.cycle,this))};n.VERSION="3.3.2",n.TRANSITION_DURATION=600,n.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},n.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},n.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},n.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},n.prototype.getItemForDirection=function(e,t){var n=this.getItemIndex(t),r="prev"==e&&0===n||"next"==e&&n==this.$items.length-1;if(r&&!this.options.wrap)return t;var i="prev"==e?-1:1,s=(n+i)%this.$items.length;return this.$items.eq(s)},n.prototype.to=function(e){var t=this,n=this.getItemIndex(this.$active=this.$element.find(".item.active"));return e>this.$items.length-1||0>e?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){t.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",this.$items.eq(e))},n.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},n.prototype.next=function(){return this.sliding?void 0:this.slide("next")},n.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},n.prototype.slide=function(t,r){var i=this.$element.find(".item.active"),s=r||this.getItemForDirection(t,i),o=this.interval,u="next"==t?"left":"right",f=this;if(s.hasClass("active"))return this.sliding=!1;var l=s[0],h=e.Event("slide.bs.carousel",{relatedTarget:l,direction:u});if(this.$element.trigger(h),!h.isDefaultPrevented()){if(this.sliding=!0,o&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var p=e(this.$indicators.children()[this.getItemIndex(s)]);p&&p.addClass("active")}var d=e.Event("slid.bs.carousel",{relatedTarget:l,direction:u});return e.support.transition&&this.$element.hasClass("slide")?(s.addClass(t),s[0].offsetWidth,i.addClass(u),s.addClass(u),i.one("bsTransitionEnd",function(){s.removeClass([t,u].join(" ")).addClass("active"),i.removeClass(["active",u].join(" ")),f.sliding=!1,setTimeout(function(){f.$element.trigger(d)},0)}).emulateTransitionEnd(n.TRANSITION_DURATION)):(i.removeClass("active"),s.addClass("active"),this.sliding=!1,this.$element.trigger(d)),o&&this.cycle(),this}};var r=e.fn.carousel;e.fn.carousel=t,e.fn.carousel.Constructor=n,e.fn.carousel.noConflict=function(){return e.fn.carousel=r,this};var i=function(n){var r,i=e(this),s=e(i.attr("data-target")||(r=i.attr("href"))&&r.replace(/.*(?=#[^\s]+$)/,""));if(s.hasClass("carousel")){var o=e.extend({},s.data(),i.data()),u=i.attr("data-slide-to");u&&(o.interval=!1),t.call(s,o),u&&s.data("bs.carousel").to(u),n.preventDefault()}};e(document).on("click.bs.carousel.data-api","[data-slide]",i).on("click.bs.carousel.data-api","[data-slide-to]",i),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var n=e(this);t.call(n,n.data())})})}(jQuery),+function(e){function t(t){var n,r=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(r)}function n(t){return this.each(function(){var n=e(this),i=n.data("bs.collapse"),s=e.extend({},r.DEFAULTS,n.data(),"object"==typeof t&&t);!i&&s.toggle&&"show"==t&&(s.toggle=!1),i||n.data("bs.collapse",i=new r(this,s)),"string"==typeof t&&i[t]()})}var r=function(t,n){this.$element=e(t),this.options=e.extend({},r.DEFAULTS,n),this.$trigger=e(this.options.trigger).filter('[href="#'+t.id+'"], [data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};r.VERSION="3.3.2",r.TRANSITION_DURATION=350,r.DEFAULTS={toggle:!0,trigger:'[data-toggle="collapse"]'},r.prototype.dimension=function(){var e=this.$element.hasClass("width");return e?"width":"height"},r.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,i=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(i&&i.length&&(t=i.data("bs.collapse"),t&&t.transitioning))){var s=e.Event("show.bs.collapse");if(this.$element.trigger(s),!s.isDefaultPrevented()){i&&i.length&&(n.call(i,"hide"),t||i.data("bs.collapse",null));var o=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[o](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var u=function(){this.$element.removeClass("collapsing").addClass("collapse in")[o](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return u.call(this);var f=e.camelCase(["scroll",o].join("-"));this.$element.one("bsTransitionEnd",e.proxy(u,this)).emulateTransitionEnd(r.TRANSITION_DURATION)[o](this.$element[0][f])}}}},r.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var i=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return e.support.transition?void this.$element[n](0).one("bsTransitionEnd",e.proxy(i,this)).emulateTransitionEnd(r.TRANSITION_DURATION):i.call(this)}}},r.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},r.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,r){var i=e(r);this.addAriaAndCollapsedClass(t(i),i)},this)).end()},r.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var i=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=r,e.fn.collapse.noConflict=function(){return e.fn.collapse=i,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(r){var i=e(this);i.attr("data-target")||r.preventDefault();var s=t(i),o=s.data("bs.collapse"),u=o?"toggle":e.extend({},i.data(),{trigger:this});n.call(s,u)})}(jQuery),+function(e){function t(t){t&&3===t.which||(e(i).remove(),e(s).each(function(){var r=e(this),i=n(r),s={relatedTarget:this};i.hasClass("open")&&(i.trigger(t=e.Event("hide.bs.dropdown",s)),t.isDefaultPrevented()||(r.attr("aria-expanded","false"),i.removeClass("open").trigger("hidden.bs.dropdown",s)))}))}function n(t){var n=t.attr("data-target");n||(n=t.attr("href"),n=n&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var r=n&&e(n);return r&&r.length?r:t.parent()}function r(t){return this.each(function(){var n=e(this),r=n.data("bs.dropdown");r||n.data("bs.dropdown",r=new o(this)),"string"==typeof t&&r[t].call(n)})}var i=".dropdown-backdrop",s='[data-toggle="dropdown"]',o=function(t){e(t).on("click.bs.dropdown",this.toggle)};o.VERSION="3.3.2",o.prototype.toggle=function(r){var i=e(this);if(!i.is(".disabled, :disabled")){var s=n(i),o=s.hasClass("open");if(t(),!o){"ontouchstart"in document.documentElement&&!s.closest(".navbar-nav").length&&e('<div class="dropdown-backdrop"/>').insertAfter(e(this)).on("click",t);var u={relatedTarget:this};if(s.trigger(r=e.Event("show.bs.dropdown",u)),r.isDefaultPrevented())return;i.trigger("focus").attr("aria-expanded","true"),s.toggleClass("open").trigger("shown.bs.dropdown",u)}return!1}},o.prototype.keydown=function(t){if(/(38|40|27|32)/.test(t.which)&&!/input|textarea/i.test(t.target.tagName)){var r=e(this);if(t.preventDefault(),t.stopPropagation(),!r.is(".disabled, :disabled")){var i=n(r),o=i.hasClass("open");if(!o&&27!=t.which||o&&27==t.which)return 27==t.which&&i.find(s).trigger("focus"),r.trigger("click");var u=" li:not(.divider):visible a",l=i.find('[role="menu"]'+u+', [role="listbox"]'+u);if(l.length){var h=l.index(t.target);38==t.which&&h>0&&h--,40==t.which&&h<l.length-1&&h++,~h||(h=0),l.eq(h).trigger("focus")}}}};var u=e.fn.dropdown;e.fn.dropdown=r,e.fn.dropdown.Constructor=o,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=u,this},e(document).on("click.bs.dropdown.data-api",t).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",s,o.prototype.toggle).on("keydown.bs.dropdown.data-api",s,o.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="menu"]',o.prototype.keydown).on("keydown.bs.dropdown.data-api",'[role="listbox"]',o.prototype.keydown)}(jQuery),+function(e){function t(t,r){return this.each(function(){var i=e(this),s=i.data("bs.modal"),o=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t);s||i.data("bs.modal",s=new n(this,o)),"string"==typeof t?s[t](r):o.show&&s.show(r)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$backdrop=this.isShown=null,this.scrollbarWidth=0,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.2",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var r=this,i=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(i),this.isShown||i.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.backdrop(function(){var i=e.support.transition&&r.$element.hasClass("fade");r.$element.parent().length||r.$element.appendTo(r.$body),r.$element.show().scrollTop(0),r.options.backdrop&&r.adjustBackdrop(),r.adjustDialog(),i&&r.$element[0].offsetWidth,r.$element.addClass("in").attr("aria-hidden",!1),r.enforceFocus();var s=e.Event("shown.bs.modal",{relatedTarget:t});i?r.$element.find(".modal-dialog").one("bsTransitionEnd",function(){r.$element.trigger("focus").trigger(s)}).emulateTransitionEnd(n.TRANSITION_DURATION):r.$element.trigger("focus").trigger(s)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").attr("aria-hidden",!0).off("click.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var r=this,i=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var s=e.support.transition&&i;if(this.$backdrop=e('<div class="modal-backdrop '+i+'" />').prependTo(this.$element).on("click.dismiss.bs.modal",e.proxy(function(e){e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus.call(this.$element[0]):this.hide.call(this))},this)),s&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;s?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var o=function(){r.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",o).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):o()}else t&&t()},n.prototype.handleUpdate=function(){this.options.backdrop&&this.adjustBackdrop(),this.adjustDialog()},n.prototype.adjustBackdrop=function(){this.$backdrop.css("height",0).css("height",this.$element[0].scrollHeight)},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){this.bodyIsOverflowing=document.body.scrollHeight>document.documentElement.clientHeight,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right","")},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var r=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=r,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var r=e(this),i=r.attr("href"),s=e(r.attr("data-target")||i&&i.replace(/.*(?=#[^\s]+$)/,"")),o=s.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(i)&&i},s.data(),r.data());r.is("a")&&n.preventDefault(),s.one("show.bs.modal",function(e){e.isDefaultPrevented()||s.one("hidden.bs.modal",function(){r.is(":visible")&&r.trigger("focus")})}),t.call(s,o,this)})}(jQuery),+function(e){function t(t){return this.each(function(){var r=e(this),i=r.data("bs.tooltip"),s="object"==typeof t&&t;(i||"destroy"!=t)&&(i||r.data("bs.tooltip",i=new n(this,s)),"string"==typeof t&&i[t]())})}var n=function(e,t){this.type=this.options=this.enabled=this.timeout=this.hoverState=this.$element=null,this.init("tooltip",e,t)};n.VERSION="3.3.2",n.TRANSITION_DURATION=150,n.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},n.prototype.init=function(t,n,r){this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(r),this.$viewport=this.options.viewport&&e(this.options.viewport.selector||this.options.viewport);for(var i=this.options.trigger.split(" "),s=i.length;s--;){var o=i[s];if("click"==o)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=o){var u="hover"==o?"mouseenter":"focusin",f="hover"==o?"mouseleave":"focusout";this.$element.on(u+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(f+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.getOptions=function(t){return t=e.extend({},this.getDefaults(),this.$element.data(),t),t.delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},n.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,r){n[e]!=r&&(t[e]=r)}),t},n.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n&&n.$tip&&n.$tip.is(":visible")?void (n.hoverState="in"):(n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),clearTimeout(n.timeout),n.hoverState="in",n.options.delay&&n.options.delay.show?void (n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)):n.show())},n.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);return n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),clearTimeout(n.timeout),n.hoverState="out",n.options.delay&&n.options.delay.hide?void (n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)):n.hide()},n.prototype.show=function(){var t=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(t);var r=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(t.isDefaultPrevented()||!r)return;var i=this,s=this.tip(),o=this.getUID(this.type);this.setContent(),s.attr("id",o),this.$element.attr("aria-describedby",o),this.options.animation&&s.addClass("fade");var u="function"==typeof this.options.placement?this.options.placement.call(this,s[0],this.$element[0]):this.options.placement,f=/\s?auto?\s?/i,l=f.test(u);l&&(u=u.replace(f,"")||"top"),s.detach().css({top:0,left:0,display:"block"}).addClass(u).data("bs."+this.type,this),this.options.container?s.appendTo(this.options.container):s.insertAfter(this.$element);var h=this.getPosition(),p=s[0].offsetWidth,d=s[0].offsetHeight;if(l){var v=u,m=this.options.container?e(this.options.container):this.$element.parent(),g=this.getPosition(m);u="bottom"==u&&h.bottom+d>g.bottom?"top":"top"==u&&h.top-d<g.top?"bottom":"right"==u&&h.right+p>g.width?"left":"left"==u&&h.left-p<g.left?"right":u,s.removeClass(v).addClass(u)}var y=this.getCalculatedOffset(u,h,p,d);this.applyPlacement(y,u);var b=function(){var e=i.hoverState;i.$element.trigger("shown.bs."+i.type),i.hoverState=null,"out"==e&&i.leave(i)};e.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",b).emulateTransitionEnd(n.TRANSITION_DURATION):b()}},n.prototype.applyPlacement=function(t,n){var r=this.tip(),i=r[0].offsetWidth,s=r[0].offsetHeight,o=parseInt(r.css("margin-top"),10),u=parseInt(r.css("margin-left"),10);isNaN(o)&&(o=0),isNaN(u)&&(u=0),t.top=t.top+o,t.left=t.left+u,e.offset.setOffset(r[0],e.extend({using:function(e){r.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),r.addClass("in");var f=r[0].offsetWidth,l=r[0].offsetHeight;"top"==n&&l!=s&&(t.top=t.top+s-l);var c=this.getViewportAdjustedDelta(n,t,f,l);c.left?t.left+=c.left:t.top+=c.top;var h=/top|bottom/.test(n),p=h?2*c.left-i+f:2*c.top-s+l,d=h?"offsetWidth":"offsetHeight";r.offset(t),this.replaceArrow(p,r[0][d],h)},n.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},n.prototype.hide=function(t){function r(){"in"!=i.hoverState&&s.detach(),i.$element.removeAttr("aria-describedby").trigger("hidden.bs."+i.type),t&&t()}var i=this,s=this.tip(),o=e.Event("hide.bs."+this.type);return this.$element.trigger(o),o.isDefaultPrevented()?void 0:(s.removeClass("in"),e.support.transition&&this.$tip.hasClass("fade")?s.one("bsTransitionEnd",r).emulateTransitionEnd(n.TRANSITION_DURATION):r(),this.hoverState=null,this)},n.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},n.prototype.hasContent=function(){return this.getTitle()},n.prototype.getPosition=function(t){t=t||this.$element;var n=t[0],r="BODY"==n.tagName,i=n.getBoundingClientRect();null==i.width&&(i=e.extend({},i,{width:i.right-i.left,height:i.bottom-i.top}));var s=r?{top:0,left:0}:t.offset(),o={scroll:r?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},u=r?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},i,o,u,s)},n.prototype.getCalculatedOffset=function(e,t,n,r){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-r,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-r/2,left:t.left-n}:{top:t.top+t.height/2-r/2,left:t.left+t.width}},n.prototype.getViewportAdjustedDelta=function(e,t,n,r){var i={top:0,left:0};if(!this.$viewport)return i;var s=this.options.viewport&&this.options.viewport.padding||0,o=this.getPosition(this.$viewport);if(/right|left/.test(e)){var u=t.top-s-o.scroll,a=t.top+s-o.scroll+r;u<o.top?i.top=o.top-u:a>o.top+o.height&&(i.top=o.top+o.height-a)}else{var f=t.left-s,l=t.left+s+n;f<o.left?i.left=o.left-f:l>o.width&&(i.left=o.left+o.width-l)}return i},n.prototype.getTitle=function(){var e,t=this.$element,n=this.options;return e=t.attr("data-original-title")||("function"==typeof n.title?n.title.call(t[0]):n.title)},n.prototype.getUID=function(e){do e+=~~(1e6*Math.random());while(document.getElementById(e));return e},n.prototype.tip=function(){return this.$tip=this.$tip||e(this.options.template)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},n.prototype.enable=function(){this.enabled=!0},n.prototype.disable=function(){this.enabled=!1},n.prototype.toggleEnabled=function(){this.enabled=!this.enabled},n.prototype.toggle=function(t){var n=this;t&&(n=e(t.currentTarget).data("bs."+this.type),n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),n.tip().hasClass("in")?n.leave(n):n.enter(n)},n.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type)})};var r=e.fn.tooltip;e.fn.tooltip=t,e.fn.tooltip.Constructor=n,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=r,this}}(jQuery),+function(e){function t(t){return this.each(function(){var r=e(this),i=r.data("bs.popover"),s="object"==typeof t&&t;(i||"destroy"!=t)&&(i||r.data("bs.popover",i=new n(this,s)),"string"==typeof t&&i[t]())})}var n=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");n.VERSION="3.3.2",n.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),n.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),n.prototype.constructor=n,n.prototype.getDefaults=function(){return n.DEFAULTS},n.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},n.prototype.hasContent=function(){return this.getTitle()||this.getContent()},n.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},n.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")},n.prototype.tip=function(){return this.$tip||(this.$tip=e(this.options.template)),this.$tip};var r=e.fn.popover;e.fn.popover=t,e.fn.popover.Constructor=n,e.fn.popover.noConflict=function(){return e.fn.popover=r,this}}(jQuery),+function(e){function t(n,r){var i=e.proxy(this.process,this);this.$body=e("body"),this.$scrollElement=e(e(n).is("body")?window:n),this.options=e.extend({},t.DEFAULTS,r),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",i),this.refresh(),this.process()}function n(n){return this.each(function(){var r=e(this),i=r.data("bs.scrollspy"),s="object"==typeof n&&n;i||r.data("bs.scrollspy",i=new t(this,s)),"string"==typeof n&&i[n]()})}t.VERSION="3.3.2",t.DEFAULTS={offset:10},t.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},t.prototype.refresh=function(){var t="offset",n=0;e.isWindow(this.$scrollElement[0])||(t="position",n=this.$scrollElement.scrollTop()),this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight();var r=this;this.$body.find(this.selector).map(function(){var r=e(this),i=r.data("target")||r.attr("href"),s=/^#./.test(i)&&e(i);return s&&s.length&&s.is(":visible")&&[[s[t]().top+n,i]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){r.offsets.push(this[0]),r.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.getScrollHeight(),r=this.options.offset+n-this.$scrollElement.height(),i=this.offsets,s=this.targets,o=this.activeTarget;if(this.scrollHeight!=n&&this.refresh(),t>=r)return o!=(e=s[s.length-1])&&this.activate(e);if(o&&t<i[0])return this.activeTarget=null,this.clear();for(e=i.length;e--;)o!=s[e]&&t>=i[e]&&(!i[e+1]||t<=i[e+1])&&this.activate(s[e])},t.prototype.activate=function(t){this.activeTarget=t,this.clear();var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',r=e(n).parents("li").addClass("active");r.parent(".dropdown-menu").length&&(r=r.closest("li.dropdown").addClass("active")),r.trigger("activate.bs.scrollspy")},t.prototype.clear=function(){e(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var r=e.fn.scrollspy;e.fn.scrollspy=n,e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=r,this},e(window).on("load.bs.scrollspy.data-api",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);n.call(t,t.data())})})}(jQuery),+function(e){function t(t){return this.each(function(){var r=e(this),i=r.data("bs.tab");i||r.data("bs.tab",i=new n(this)),"string"==typeof t&&i[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.2",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),r=t.data("target");if(r||(r=t.attr("href"),r=r&&r.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var i=n.find(".active:last a"),s=e.Event("hide.bs.tab",{relatedTarget:t[0]}),o=e.Event("show.bs.tab",{relatedTarget:i[0]});if(i.trigger(s),t.trigger(o),!o.isDefaultPrevented()&&!s.isDefaultPrevented()){var u=e(r);this.activate(t.closest("li"),n),this.activate(u,u.parent(),function(){i.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:i[0]})})}}},n.prototype.activate=function(t,r,i){function s(){o.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),u?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu")&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),i&&i()}var o=r.find("> .active"),u=i&&e.support.transition&&(o.length&&o.hasClass("fade")||!!r.find("> .fade").length);o.length&&u?o.one("bsTransitionEnd",s).emulateTransitionEnd(n.TRANSITION_DURATION):s(),o.removeClass("in")};var r=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=r,this};var i=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',i).on("click.bs.tab.data-api",'[data-toggle="pill"]',i)}(jQuery),+function(e){function t(t){return this.each(function(){var r=e(this),i=r.data("bs.affix"),s="object"==typeof t&&t;i||r.data("bs.affix",i=new n(this,s)),"string"==typeof t&&i[t]()})}var n=function(t,r){this.options=e.extend({},n.DEFAULTS,r),this.$target=e(this.options.target).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(t),this.affixed=this.unpin=this.pinnedOffset=null,this.checkPosition()};n.VERSION="3.3.2",n.RESET="affix affix-top affix-bottom",n.DEFAULTS={offset:0,target:window},n.prototype.getState=function(e,t,n,r){var i=this.$target.scrollTop(),s=this.$element.offset(),o=this.$target.height();if(null!=n&&"top"==this.affixed)return n>i?"top":!1;if("bottom"==this.affixed)return null!=n?i+this.unpin<=s.top?!1:"bottom":e-r>=i+o?!1:"bottom";var u=null==this.affixed,a=u?i:s.top,f=u?o:t;return null!=n&&n>=i?"top":null!=r&&a+f>=e-r?"bottom":!1},n.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(n.RESET).addClass("affix");var e=this.$target.scrollTop(),t=this.$element.offset();return this.pinnedOffset=t.top-e},n.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},n.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=this.$element.height(),r=this.options.offset,i=r.top,s=r.bottom,o=e("body").height();"object"!=typeof r&&(s=i=r),"function"==typeof i&&(i=r.top(this.$element)),"function"==typeof s&&(s=r.bottom(this.$element));var u=this.getState(o,t,i,s);if(this.affixed!=u){null!=this.unpin&&this.$element.css("top","");var f="affix"+(u?"-"+u:""),l=e.Event(f+".bs.affix");if(this.$element.trigger(l),l.isDefaultPrevented())return;this.affixed=u,this.unpin="bottom"==u?this.getPinnedOffset():null,this.$element.removeClass(n.RESET).addClass(f).trigger(f.replace("affix","affixed")+".bs.affix")}"bottom"==u&&this.$element.offset({top:o-t-s})}};var r=e.fn.affix;e.fn.affix=t,e.fn.affix.Constructor=n,e.fn.affix.noConflict=function(){return e.fn.affix=r,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var n=e(this),r=n.data();r.offset=r.offset||{},null!=r.offsetBottom&&(r.offset.bottom=r.offsetBottom),null!=r.offsetTop&&(r.offset.top=r.offsetTop),t.call(n,r)})})}(jQuery),define("bootstrap",["jquery"],function(){}),function(e){e.fn.dcAccordion=function(t){var n={classParent:"dcjq-parent",classActive:"active",classArrow:"dcjq-icon",classCount:"dcjq-count",classExpand:"dcjq-current-parent",eventType:"click",hoverDelay:300,menuClose:!0,autoClose:!0,autoExpand:!1,speed:"slow",saveState:!0,disableLink:!0,showCount:!1},t=e.extend(n,t);this.each(function(t){function o(){$arrow='<span class="'+n.classArrow+'"></span>';var t=n.classParent+"-li";e("> ul",r).show(),e("li",r).each(function(){e("> ul",this).length>0&&(e(this).addClass(t),e("> a",this).addClass(n.classParent).append($arrow))}),e("> ul",r).hide(),n.showCount==1&&e("li."+t,r).each(function(){if(n.disableLink==1)var t=parseInt(e("ul a:not(."+n.classParent+")",this).length);else var t=parseInt(e("ul a",this).length);e("> a",this).append(' <span class="'+n.classCount+'">'+t+"</span>")})}function u(){$activeLi=e(this).parent("li"),$parentsLi=$activeLi.parents("li"),$parentsUl=$activeLi.parents("ul"),n.autoClose==1&&c($parentsLi,$parentsUl),e("> ul",$activeLi).is(":visible")?(e("ul",$activeLi).slideUp(n.speed),e("a",$activeLi).removeClass(n.classActive)):(e(this).siblings("ul").slideToggle(n.speed),e("> a",$activeLi).addClass(n.classActive)),n.saveState==1&&createCookie(n.cookie,r)}function a(){}function f(){}function l(){n.menuClose==1&&(e("ul",r).slideUp(n.speed),e("a",r).removeClass(n.classActive),createCookie(n.cookie,r))}function c(t,i){e("ul",r).not(i).slideUp(n.speed),e("a",r).removeClass(n.classActive),e("> a",t).addClass(n.classActive)}function h(){e("ul",r).hide(),$allActiveLi=e("a."+n.classActive,r),$allActiveLi.siblings("ul").show()}var r=this;o(),n.autoExpand==1&&e("li."+n.classExpand+" > a").addClass(n.classActive),h();if(n.eventType=="hover"){var i={sensitivity:2,interval:n.hoverDelay,over:u,timeout:n.hoverDelay,out:a};e("li a",r).hoverIntent(i);var s={sensitivity:2,interval:1e3,over:f,timeout:1e3,out:l};e(r).hoverIntent(s),n.disableLink==1&&e("li a",r).click(function(t){e(this).siblings("ul").length>0&&t.preventDefault()})}else e("li a",r).click(function(t){$activeLi=e(this).parent("li"),$parentsLi=$activeLi.parents("li"),$parentsUl=$activeLi.parents("ul"),n.disableLink==1&&e(this).siblings("ul").length>0&&t.preventDefault(),n.autoClose==1&&c($parentsLi,$parentsUl),e("> ul",$activeLi).is(":visible")?(e("ul",$activeLi).slideUp(n.speed),e("a",$activeLi).removeClass(n.classActive)):(e(this).siblings("ul").slideToggle(n.speed),e("> a",$activeLi).addClass(n.classActive))})})}}(jQuery),define("dcjqaccordion",["jquery"],function(){}),function(e){function n(e){return typeof e=="object"?e:{top:e,left:e}}var t=e.scrollTo=function(t,n,r){e(window).scrollTo(t,n,r)};t.defaults={axis:"xy",duration:parseFloat(e.fn.jquery)>=1.3?0:1,limit:!0},t.window=function(t){return e(window)._scrollable()},e.fn._scrollable=function(){return this.map(function(){var t=this,n=!t.nodeName||e.inArray(t.nodeName.toLowerCase(),["iframe","#document","html","body"])!=-1;if(!n)return t;var r=(t.contentWindow||t).document||t.ownerDocument||t;return/webkit/i.test(navigator.userAgent)||r.compatMode=="BackCompat"?r.body:r.documentElement})},e.fn.scrollTo=function(r,i,s){return typeof i=="object"&&(s=i,i=0),typeof s=="function"&&(s={onAfter:s}),r=="max"&&(r=9e9),s=e.extend({},t.defaults,s),i=i||s.duration,s.queue=s.queue&&s.axis.length>1,s.queue&&(i/=2),s.offset=n(s.offset),s.over=n(s.over),this._scrollable().each(function(){function d(e){u.animate(c,i,s.easing,e&&function(){e.call(this,a,s)})}if(r==null)return;var o=this,u=e(o),a=r,l,c={},p=u.is("html,body");switch(typeof a){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(a)){a=n(a);break}a=e(a,this);if(!a.length)return;case"object":if(a.is||a.style)l=(a=e(a)).offset()}e.each(s.axis.split(""),function(e,n){var r=n=="x"?"Left":"Top",i=r.toLowerCase(),f="scroll"+r,v=o[f],m=t.max(o,n);if(l)c[f]=l[i]+(p?0:v-u.offset()[i]),s.margin&&(c[f]-=parseInt(a.css("margin"+r))||0,c[f]-=parseInt(a.css("border"+r+"Width"))||0),c[f]+=s.offset[i]||0,s.over[i]&&(c[f]+=a[n=="x"?"width":"height"]()*s.over[i]);else{var y=a[i];c[f]=y.slice&&y.slice(-1)=="%"?parseFloat(y)/100*m:y}s.limit&&/^\d+$/.test(c[f])&&(c[f]=c[f]<=0?0:Math.min(c[f],m)),!e&&s.queue&&(v!=c[f]&&d(s.onAfterFirst),delete c[f])}),d(s.onAfter)}).end()},t.max=function(t,n){var r=n=="x"?"Width":"Height",i="scroll"+r;if(!e(t).is("html,body"))return t[i]-e(t)[r.toLowerCase()]();var s="client"+r,o=t.ownerDocument.documentElement,u=t.ownerDocument.body;return Math.max(o[i],u[i])-Math.min(o[s],u[s])}}(jQuery),define("scrollTo",["jquery"],function(){}),$(document).ready(function(){$.slidebars=function(e){function g(){!t.disableOver||typeof t.disableOver=="number"&&t.disableOver>=d?(p=!0,$("html").addClass("sb-init"),t.hideControlClasses&&v.removeClass("sb-hide"),y()):typeof t.disableOver=="number"&&t.disableOver<d&&(p=!1,$("html").removeClass("sb-init"),t.hideControlClasses&&v.addClass("sb-hide"),(l||h)&&S())}function y(){a.css("minHeight",""),a.css("minHeight",$("body").height()+"px"),f&&(f.hasClass("sb-style-push")||f.hasClass("sb-style-overlay"))&&f.css("marginLeft","-"+f.css("width")),c&&(c.hasClass("sb-style-push")||c.hasClass("sb-style-overlay"))&&c.css("marginRight","-"+c.css("width")),f&&f.hasClass("sb-width-custom")&&f.css("width",f.attr("data-sb-width")),c&&c.hasClass("sb-width-custom")&&c.css("width",c.attr("data-sb-width")),t.siteLock&&$("html").addClass("sb-lock")}function w(e,t,n){var r;e.hasClass("sb-style-push")?r=a.add(e).add(m):e.hasClass("sb-style-overlay")?r=e:r=a.add(m);if(b==="translate")r.css("transform","translate("+t+")");else if(b==="side")t[0]==="-"&&(t=t.substr(1)),r.css(n,t),setTimeout(function(){t==="0px"&&(r.removeAttr("style"),y())},400);else if(b==="jQuery"){t[0]==="-"&&(t=t.substr(1));var i={};i[n]=t,r.stop().animate(i,400),setTimeout(function(){t==="0px"&&(r.removeAttr("style"),y())},400)}}function E(e){function t(){p&&e==="left"&&f?($("html").addClass("sb-active sb-active-left"),f.addClass("sb-active"),w(f,f.css("width"),"left"),setTimeout(function(){l=!0},400)):p&&e==="right"&&c&&($("html").addClass("sb-active sb-active-right"),c.addClass("sb-active"),w(c,"-"+c.css("width"),"right"),setTimeout(function(){h=!0},400))}e==="left"&&f&&h||e==="right"&&c&&l?(S(),setTimeout(t,400)):t()}function S(e){if(l||h)l&&(w(f,"0px","left"),l=!1),h&&(w(c,"0px","right"),h=!1),setTimeout(function(){$("html").removeClass("sb-active sb-active-left sb-active-right"),f&&f.removeClass("sb-active"),c&&c.removeClass("sb-active"),e&&(window.location=e)},400)}function x(e){e==="left"&&f&&(l?S():E("left")),e==="right"&&c&&(h?S():E("right"))}function T(e,t){e.stopPropagation(),e.preventDefault(),e.type==="touchend"&&t.off("click")}var t=$.extend({siteClose:!0,siteLock:!1,disableOver:!1,hideControlClasses:!1},e),n=document.createElement("div").style,r=!1,i=!1;if(n.MozTransition===""||n.WebkitTransition===""||n.OTransition===""||n.transition==="")r=!0;if(n.MozTransform===""||n.WebkitTransform===""||n.OTransform===""||n.transform==="")i=!0;var s=navigator.userAgent,o=!1,u=!1;/Android/.test(s)?o=s.substr(s.indexOf("Android")+8,3):/(iPhone|iPod|iPad)/.test(s)&&(u=s.substr(s.indexOf("OS ")+3,3).replace("_",".")),(o&&o<3||u&&u<5)&&$("html").addClass("sb-static");var a=$("#sb-site, .sb-site");if($(".sb-left").length)var f=$(".sb-left"),l=!1;if($(".sb-right").length)var c=$(".sb-right"),h=!1;var p=!1,d=$(window).width(),v=$(".sb-toggle-left, .sb-toggle-right, .sb-open-left, .sb-open-right, .sb-close"),m=$(".sb-slide");g(),$(window).resize(function(){var e=$(window).width();p&&d!==e&&(d=e,g(),y(),l&&E("left"),h&&E("right"))});var b;r&&i?(b="translate",o&&o<4.4&&(b="side")):b="jQuery",this.open=E,this.close=S,this.toggle=x,this.init=function(){return p},this.active=function(e){if(e==="left"&&f)return l;if(e==="right"&&c)return h},$(".sb-toggle-left").on("touchend click",function(e){T(e,$(this)),x("left")}),$(".sb-toggle-right").on("touchend click",function(e){T(e,$(this)),x("right")}),$(".sb-open-left").on("touchend click",function(e){T(e,$(this)),E("left")}),$(".sb-open-right").on("touchend click",function(e){T(e,$(this)),E("right")}),$(".sb-close").on("touchend click",function(e){T(e,$(this)),S()}),$(".sb-slidebar a").not(".sb-disable-close").on("click",function(e){T(e,$(this)),S($(this).attr("href"))}),a.on("touchend click",function(e){t.siteClose&&(l||h)&&(T(e,$(this)),S())})}}),define("slidebars",["jquery"],function(){}),function(e){var t=!1,n=!1,r=5e3,i=2e3,s=0,o=function(){var e=document.getElementsByTagName("script"),e=e[e.length-1].src.split("?")[0];return 0<e.split("/").length?e.split("/").slice(0,-1).join("/")+"/":""}(),u=["ms","moz","webkit","o"],f=window.requestAnimationFrame||!1,l=window.cancelAnimationFrame||!1;if(!f)for(var c in u){var h=u[c];f||(f=window[h+"RequestAnimationFrame"]),l||(l=window[h+"CancelAnimationFrame"]||window[h+"CancelRequestAnimationFrame"])}var p=window.MutationObserver||window.WebKitMutationObserver||!1,d={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"5px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:!1,cursordragontouch:!1,oneaxismousemode:"auto"},v=!1,m=function(){if(v)return v;var e=document.createElement("DIV"),t={haspointerlock:"pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document};t.isopera="opera"in window,t.isopera12=t.isopera&&"getUserMedia"in navigator,t.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),t.isie="all"in document&&"attachEvent"in e&&!t.isopera,t.isieold=t.isie&&!("msInterpolationMode"in e.style),t.isie7=t.isie&&!t.isieold&&(!("documentMode"in document)||7==document.documentMode),t.isie8=t.isie&&"documentMode"in document&&8==document.documentMode,t.isie9=t.isie&&"performance"in window&&9<=document.documentMode,t.isie10=t.isie&&"performance"in window&&10<=document.documentMode,t.isie9mobile=/iemobile.9/i.test(navigator.userAgent),t.isie9mobile&&(t.isie9=!1),t.isie7mobile=!t.isie9mobile&&t.isie7&&/iemobile/i.test(navigator.userAgent),t.ismozilla="MozAppearance"in e.style,t.iswebkit="WebkitAppearance"in e.style,t.ischrome="chrome"in window,t.ischrome22=t.ischrome&&t.haspointerlock,t.ischrome26=t.ischrome&&"transition"in e.style,t.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,t.hasmstouch=window.navigator.msPointerEnabled||!1,t.ismac=/^mac$/i.test(navigator.platform),t.isios=t.cantouch&&/iphone|ipad|ipod/i.test(navigator.platform),t.isios4=t.isios&&!("seal"in Object),t.isandroid=/android/i.test(navigator.userAgent),t.trstyle=!1,t.hastransform=!1,t.hastranslate3d=!1,t.transitionstyle=!1,t.hastransition=!1,t.transitionend=!1;for(var n=["transform","msTransform","webkitTransform","MozTransform","OTransform"],r=0;r<n.length;r++)if("undefined"!=typeof e.style[n[r]]){t.trstyle=n[r];break}t.hastransform=0!=t.trstyle,t.hastransform&&(e.style[t.trstyle]="translate3d(1px,2px,3px)",t.hastranslate3d=/translate3d/.test(e.style[t.trstyle])),t.transitionstyle=!1,t.prefixstyle="",t.transitionend=!1;for(var n="transition webkitTransition MozTransition OTransition OTransition msTransition KhtmlTransition".split(" "),i=" -webkit- -moz- -o- -o -ms- -khtml-".split(" "),s="transitionend webkitTransitionEnd transitionend otransitionend oTransitionEnd msTransitionEnd KhtmlTransitionEnd".split(" "),r=0;r<n.length;r++)if(n[r]in e.style){t.transitionstyle=n[r],t.prefixstyle=i[r],t.transitionend=s[r];break}t.ischrome26&&(t.prefixstyle=i[1]),t.hastransition=t.transitionstyle;e:{n=["-moz-grab","-webkit-grab","grab"];if(t.ischrome&&!t.ischrome22||t.isie)n=[];for(r=0;r<n.length;r++)if(i=n[r],e.style.cursor=i,e.style.cursor==i){n=i;break e}n="url(http://www.google.com/intl/en_ALL/mapfiles/openhand.cur),n-resize"}return t.cursorgrabvalue=n,t.hasmousecapture="setCapture"in e,t.hasMutationObserver=!1!==p,v=t},g=function(u,a){function c(){var e=b.win;if("zIndex"in e)return e.zIndex();for(;0<e.length&&9!=e[0].nodeType;){var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function h(e,t,n){return t=e.css(t),e=parseFloat(t),isNaN(e)?(e=x[t]||0,n=3==e?n?b.win.outerHeight()-b.win.innerHeight():b.win.outerWidth()-b.win.innerWidth():1,b.isie8&&e&&(e+=1),n?e:0):e}function v(e,t,n,r){b._bind(e,t,function(r){r=r?r:window.event;var i={original:r,target:r.target||r.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==r.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return r.preventDefault?r.preventDefault():r.returnValue=!1,!1},stopImmediatePropagation:function(){r.stopImmediatePropagation?r.stopImmediatePropagation():r.cancelBubble=!0}};return"mousewheel"==t?(i.deltaY=-0.025*r.wheelDelta,r.wheelDeltaX&&(i.deltaX=-0.025*r.wheelDeltaX)):i.deltaY=r.detail,n.call(e,i)},r)}function g(e,t,n){var r,i;0==e.deltaMode?(r=-Math.floor(e.deltaX*(b.opt.mousescrollstep/54)),i=-Math.floor(e.deltaY*(b.opt.mousescrollstep/54))):1==e.deltaMode&&(r=-Math.floor(e.deltaX*b.opt.mousescrollstep),i=-Math.floor(e.deltaY*b.opt.mousescrollstep)),t&&b.opt.oneaxismousemode&&0==r&&i&&(r=i,i=0),r&&(b.scrollmom&&b.scrollmom.stop(),b.lastdeltax+=r,b.debounced("mousewheelx",function(){var e=b.lastdeltax;b.lastdeltax=0,b.rail.drag||b.doScrollLeftBy(e)},120));if(i){if(b.opt.nativeparentscrolling&&n&&!b.ispage&&!b.zoomactive)if(0>i){if(b.getScrollTop()>=b.page.maxh)return!0}else if(0>=b.getScrollTop())return!0;b.scrollmom&&b.scrollmom.stop(),b.lastdeltay+=i,b.debounced("mousewheely",function(){var e=b.lastdeltay;b.lastdeltay=0,b.rail.drag||b.doScrollBy(e)},120)}return e.stopImmediatePropagation(),e.preventDefault()}var b=this;this.version="3.5.0",this.name="nicescroll",this.me=a,this.opt={doc:e("body"),win:!1},e.extend(this.opt,d),this.opt.snapbackspeed=80;if(u)for(var w in b.opt)"undefined"!=typeof u[w]&&(b.opt[w]=u[w]);this.iddoc=(this.doc=b.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/BODY|HTML/.test(b.opt.win?b.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==b.opt.win,this.win=b.opt.win||(this.ispage?e(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win,this.body=e("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=b.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,this.observerremover=this.observer=this.scrollmom=this.scrollrunning=this.checkrtlmode=!1;do this.id="ascrail"+i++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=!1,this.cursoractive=!0,this.overflowx=b.opt.overflowx,this.overflowy=b.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=m();var E=e.extend({},this.detected);this.ishwscroll=(this.canhwscroll=E.hastransform&&b.opt.hwacceleration)&&b.haswrapper,this.istouchcapable=!1,E.cantouch&&E.ischrome&&!E.isios&&!E.isandroid&&(this.istouchcapable=!0,E.cantouch=!1),E.cantouch&&E.ismozilla&&!E.isios&&!E.isandroid&&(this.istouchcapable=!0,E.cantouch=!1),b.opt.enablemouselockapi||(E.hasmousecapture=!1,E.haspointerlock=!1),this.delayed=function(e,t,n,r){var i=b.delaylist[e],s=(new Date).getTime();if(!r&&i&&i.tt)return!1;i&&i.tt&&clearTimeout(i.tt);if(i&&i.last+n>s&&!i.tt)b.delaylist[e]={last:s+n,tt:setTimeout(function(){b.delaylist[e].tt=0,t.call()},n)};else if(!i||!i.tt)b.delaylist[e]={last:s,tt:0},setTimeout(function(){t.call()},0)},this.debounced=function(e,t,n){var r=b.delaylist[e];(new Date).getTime(),b.delaylist[e]=t,r||setTimeout(function(){var t=b.delaylist[e];b.delaylist[e]=!1,t.call()},n)},this.synched=function(e,t){return b.synclist[e]=t,function(){b.onsync||(f(function(){b.onsync=!1;for(e in b.synclist){var t=b.synclist[e];t&&t.call(b),b.synclist[e]=!1}}),b.onsync=!0)}(),e},this.unsynched=function(e){b.synclist[e]&&(b.synclist[e]=!1)},this.css=function(e,t){for(var n in t)b.saved.css.push([e,n,e.css(n)]),e.css(n,t[n])},this.scrollTop=function(e){return"undefined"==typeof e?b.getScrollTop():b.setScrollTop(e)},this.scrollLeft=function(e){return"undefined"==typeof e?b.getScrollLeft():b.setScrollLeft(e)},BezierClass=function(e,t,n,r,i,s,o){this.st=e,this.ed=t,this.spd=n,this.p1=r||0,this.p2=i||1,this.p3=s||0,this.p4=o||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st},BezierClass.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*t)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}};if(this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},E.hastranslate3d&&E.isios&&this.doc.css("-webkit-backface-visibility","hidden");var S=function(){var e=b.doc.css(E.trstyle);return e&&"matrix"==e.substr(0,6)?e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1};this.getScrollTop=function(e){if(!e){if(e=S())return 16==e.length?-e[13]:-e[5];if(b.timerscroll&&b.timerscroll.bz)return b.timerscroll.bz.getNow()}return b.doc.translate.y},this.getScrollLeft=function(e){if(!e){if(e=S())return 16==e.length?-e[12]:-e[4];if(b.timerscroll&&b.timerscroll.bh)return b.timerscroll.bh.getNow()}return b.doc.translate.x},this.notifyScrollEvent=document.createEvent?function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),e.dispatchEvent(t)}:document.fireEvent?function(e){var t=document.createEventObject();e.fireEvent("onscroll"),t.cancelBubble=!0}:function(e,t){},E.hastranslate3d&&b.opt.enabletranslate3d?(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=-1*e+"px",b.doc.css(E.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=-1*e+"px",b.doc.css(E.trstyle,"translate3d("+b.doc.translate.tx+","+b.doc.translate.ty+",0px)"),t||b.notifyScrollEvent(b.win[0])}):(this.setScrollTop=function(e,t){b.doc.translate.y=e,b.doc.translate.ty=-1*e+"px",b.doc.css(E.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])},this.setScrollLeft=function(e,t){b.doc.translate.x=e,b.doc.translate.tx=-1*e+"px",b.doc.css(E.trstyle,"translate("+b.doc.translate.tx+","+b.doc.translate.ty+")"),t||b.notifyScrollEvent(b.win[0])})}else this.getScrollTop=function(){return b.docscroll.scrollTop()},this.setScrollTop=function(e){return b.docscroll.scrollTop(e)},this.getScrollLeft=function(){return b.docscroll.scrollLeft()},this.setScrollLeft=function(e){return b.docscroll.scrollLeft(e)};this.getTarget=function(e){return e?e.target?e.target:e.srcElement?e.srcElement:!1:!1},this.hasParent=function(e,t){if(!e)return!1;for(var n=e.target||e.srcElement||e||!1;n&&n.id!=t;)n=n.parentNode||!1;return!1!==n};var x={thin:1,medium:3,thick:5};this.getOffset=function(){if(b.isfixed)return{top:parseFloat(b.win.css("top")),left:parseFloat(b.win.css("left"))};if(!b.viewport)return b.win.offset();var e=b.win.offset(),t=b.viewport.offset();return{top:e.top-t.top+b.viewport.scrollTop(),left:e.left-t.left+b.viewport.scrollLeft()}},this.updateScrollBar=function(e){if(b.ishwscroll)b.rail.css({height:b.win.innerHeight()}),b.railh&&b.railh.css({width:b.win.innerWidth()});else{var t=b.getOffset(),n=t.top,r=t.left,n=n+h(b.win,"border-top-width",!0);b.win.outerWidth(),b.win.innerWidth();var r=r+(b.rail.align?b.win.outerWidth()-h(b.win,"border-right-width")-b.rail.width:h(b.win,"border-left-width")),i=b.opt.railoffset;i&&(i.top&&(n+=i.top),b.rail.align&&i.left&&(r+=i.left)),b.locked||b.rail.css({top:n,left:r,height:e?e.h:b.win.innerHeight()}),b.zoom&&b.zoom.css({top:n+1,left:1==b.rail.align?r-20:r+b.rail.width+4}),b.railh&&!b.locked&&(n=t.top,r=t.left,e=b.railh.align?n+h(b.win,"border-top-width",!0)+b.win.innerHeight()-b.railh.height:n+h(b.win,"border-top-width",!0),r+=h(b.win,"border-left-width"),b.railh.css({top:e,left:r,width:b.railh.width}))}},this.doRailClick=function(e,t,n){var r;b.locked||(b.cancelEvent(e),t?(t=n?b.doScrollLeft:b.doScrollTop,r=n?(e.pageX-b.railh.offset().left-b.cursorwidth/2)*b.scrollratio.x:(e.pageY-b.rail.offset().top-b.cursorheight/2)*b.scrollratio.y,t(r)):(t=n?b.doScrollLeftBy:b.doScrollBy,r=n?b.scroll.x:b.scroll.y,e=n?e.pageX-b.railh.offset().left:e.pageY-b.rail.offset().top,n=n?b.view.w:b.view.h,r>=e?t(n):t(-n)))},b.hasanimationframe=f,b.hascancelanimationframe=l,b.hasanimationframe?b.hascancelanimationframe||(l=function(){b.cancelAnimationFrame=!0}):(f=function(e){return setTimeout(e,15-Math.floor(+(new Date)/1e3)%16)},l=clearInterval),this.init=function(){b.saved.css=[];if(E.isie7mobile||E.isoperamini)return!0;E.hasmstouch&&b.css(b.ispage?e("html"):b.win,{"-ms-touch-action":"none"}),b.zindex="auto",b.zindex=!b.ispage&&"auto"==b.opt.zindex?c()||"auto":b.opt.zindex,!b.ispage&&"auto"!=b.zindex&&b.zindex>s&&(s=b.zindex),b.isie&&0==b.zindex&&"auto"==b.opt.zindex&&(b.zindex="auto");if(!b.ispage||!E.cantouch&&!E.isieold&&!E.isie9mobile){var i=b.docscroll;b.ispage&&(i=b.haswrapper?b.win:b.doc),E.isie9mobile||b.css(i,{"overflow-y":"hidden"}),b.ispage&&E.isie7&&("BODY"==b.doc[0].nodeName?b.css(e("html"),{"overflow-y":"hidden"}):"HTML"==b.doc[0].nodeName&&b.css(e("body"),{"overflow-y":"hidden"})),E.isios&&!b.ispage&&!b.haswrapper&&b.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var u=e(document.createElement("div"));u.css({position:"relative",top:0,"float":"right",width:b.opt.cursorwidth,height:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),u.hborder=parseFloat(u.outerHeight()-u.innerHeight()),b.cursor=u;var a=e(document.createElement("div"));a.attr("id",b.id),a.addClass("nicescroll-rails");var f,l,h=["left","right"],d;for(d in h)l=h[d],(f=b.opt.railpadding[l])?a.css("padding-"+l,f+"px"):b.opt.railpadding[l]=0;a.append(u),a.width=Math.max(parseFloat(b.opt.cursorwidth),u.outerWidth())+b.opt.railpadding.left+b.opt.railpadding.right,a.css({width:a.width+"px",zIndex:b.zindex,background:b.opt.background,cursor:"default"}),a.visibility=!0,a.scrollable=!0,a.align="left"==b.opt.railalign?0:1,b.rail=a,u=b.rail.drag=!1,b.opt.boxzoom&&!b.ispage&&!E.isieold&&(u=document.createElement("div"),b.bind(u,"click",b.doZoom),b.zoom=e(u),b.zoom.css({cursor:"pointer","z-index":b.zindex,backgroundImage:"url("+o+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),b.opt.dblclickzoom&&b.bind(b.win,"dblclick",b.doZoom),E.cantouch&&b.opt.gesturezoom&&(b.ongesturezoom=function(e){return 1.5<e.scale&&b.doZoomIn(e),.8>e.scale&&b.doZoomOut(e),b.cancelEvent(e)},b.bind(b.win,"gestureend",b.ongesturezoom))),b.railh=!1;if(b.opt.horizrailenabled){b.css(i,{"overflow-x":"hidden"}),u=e(document.createElement("div")),u.css({position:"relative",top:0,height:b.opt.cursorwidth,width:"0px","background-color":b.opt.cursorcolor,border:b.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":b.opt.cursorborderradius,"-moz-border-radius":b.opt.cursorborderradius,"border-radius":b.opt.cursorborderradius}),u.wborder=parseFloat(u.outerWidth()-u.innerWidth()),b.cursorh=u;var v=e(document.createElement("div"));v.attr("id",b.id+"-hr"),v.addClass("nicescroll-rails"),v.height=Math.max(parseFloat(b.opt.cursorwidth),u.outerHeight()),v.css({height:v.height+"px",zIndex:b.zindex,background:b.opt.background}),v.append(u),v.visibility=!0,v.scrollable=!0,v.align="top"==b.opt.railvalign?0:1,b.railh=v,b.railh.drag=!1}b.ispage?(a.css({position:"fixed",top:"0px",height:"100%"}),a.align?a.css({right:"0px"}):a.css({left:"0px"}),b.body.append(a),b.railh&&(v.css({position:"fixed",left:"0px",width:"100%"}),v.align?v.css({bottom:"0px"}):v.css({top:"0px"}),b.body.append(v))):(b.ishwscroll?("static"==b.win.css("position")&&b.css(b.win,{position:"relative"}),i="HTML"==b.win[0].nodeName?b.body:b.win,b.zoom&&(b.zoom.css({position:"absolute",top:1,right:0,"margin-right":a.width+4}),i.append(b.zoom)),a.css({position:"absolute",top:0}),a.align?a.css({right:0}):a.css({left:0}),i.append(a),v&&(v.css({position:"absolute",left:0,bottom:0}),v.align?v.css({bottom:0}):v.css({top:0}),i.append(v))):(b.isfixed="fixed"==b.win.css("position"),i=b.isfixed?"fixed":"absolute",b.isfixed||(b.viewport=b.getViewport(b.win[0])),b.viewport&&(b.body=b.viewport,0==/fixed|relative|absolute/.test(b.viewport.css("position"))&&b.css(b.viewport,{position:"relative"})),a.css({position:i}),b.zoom&&b.zoom.css({position:i}),b.updateScrollBar(),b.body.append(a),b.zoom&&b.body.append(b.zoom),b.railh&&(v.css({position:i}),b.body.append(v))),E.isios&&b.css(b.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),E.isie&&b.opt.disableoutline&&b.win.attr("hideFocus","true"),E.iswebkit&&b.opt.disableoutline&&b.win.css({outline:"none"})),!1===b.opt.autohidemode?(b.autohidedom=!1,b.rail.css({opacity:b.opt.cursoropacitymax}),b.railh&&b.railh.css({opacity:b.opt.cursoropacitymax})):!0===b.opt.autohidemode||"leave"===b.opt.autohidemode?(b.autohidedom=e().add(b.rail),E.isie8&&(b.autohidedom=b.autohidedom.add(b.cursor)),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh)),b.railh&&E.isie8&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"scroll"==b.opt.autohidemode?(b.autohidedom=e().add(b.rail),b.railh&&(b.autohidedom=b.autohidedom.add(b.railh))):"cursor"==b.opt.autohidemode?(b.autohidedom=e().add(b.cursor),b.railh&&(b.autohidedom=b.autohidedom.add(b.cursorh))):"hidden"==b.opt.autohidemode&&(b.autohidedom=!1,b.hide(),b.locked=!1);if(E.isie9mobile)b.scrollmom=new y(b),b.onmangotouch=function(e){e=b.getScrollTop();var t=b.getScrollLeft();if(e==b.scrollmom.lastscrolly&&t==b.scrollmom.lastscrollx)return!0;var n=e-b.mangotouch.sy,r=t-b.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(r,2)+Math.pow(n,2)))){var i=0>n?-1:1,s=0>r?-1:1,o=+(new Date);b.mangotouch.lazy&&clearTimeout(b.mangotouch.lazy),80<o-b.mangotouch.tm||b.mangotouch.dry!=i||b.mangotouch.drx!=s?(b.scrollmom.stop(),b.scrollmom.reset(t,e),b.mangotouch.sy=e,b.mangotouch.ly=e,b.mangotouch.sx=t,b.mangotouch.lx=t,b.mangotouch.dry=i,b.mangotouch.drx=s,b.mangotouch.tm=o):(b.scrollmom.stop(),b.scrollmom.update(b.mangotouch.sx-r,b.mangotouch.sy-n),b.mangotouch.tm=o,n=Math.max(Math.abs(b.mangotouch.ly-e),Math.abs(b.mangotouch.lx-t)),b.mangotouch.ly=e,b.mangotouch.lx=t,2<n&&(b.mangotouch.lazy=setTimeout(function(){b.mangotouch.lazy=!1,b.mangotouch.dry=0,b.mangotouch.drx=0,b.mangotouch.tm=0,b.scrollmom.doMomentum(30)},100)))}},a=b.getScrollTop(),v=b.getScrollLeft(),b.mangotouch={sy:a,ly:a,dry:0,sx:v,lx:v,drx:0,lazy:!1,tm:0},b.bind(b.docscroll,"scroll",b.onmangotouch);else{if(E.cantouch||b.istouchcapable||b.opt.touchbehavior||E.hasmstouch){b.scrollmom=new y(b),b.ontouchstart=function(t){if(t.pointerType&&2!=t.pointerType)return!1;if(!b.locked){if(E.hasmstouch)for(var n=t.target?t.target:!1;n;){var r=e(n).getNiceScroll();if(0<r.length&&r[0].me==b.me)break;if(0<r.length)return!1;if("DIV"==n.nodeName&&n.id==b.id)break;n=n.parentNode?n.parentNode:!1}b.cancelScroll();if((n=b.getTarget(t))&&/INPUT/i.test(n.nodeName)&&/range/i.test(n.type))return b.stopPropagation(t);!("clientX"in t)&&"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),b.forcescreen&&(r=t,t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY),b.rail.drag={x:t.clientX,y:t.clientY,sx:b.scroll.x,sy:b.scroll.y,st:b.getScrollTop(),sl:b.getScrollLeft(),pt:2,dl:!1};if(b.ispage||!b.opt.directionlockdeadzone)b.rail.drag.dl="f";else{var r=e(window).width(),i=e(window).height(),s=Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),o=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight),i=Math.max(0,o-i),r=Math.max(0,s-r);b.rail.drag.ck=!b.rail.scrollable&&b.railh.scrollable?0<i?"v":!1:b.rail.scrollable&&!b.railh.scrollable?0<r?"h":!1:!1,b.rail.drag.ck||(b.rail.drag.dl="f")}b.opt.touchbehavior&&b.isiframe&&E.isie&&(r=b.win.position(),b.rail.drag.x+=r.left,b.rail.drag.y+=r.top),b.hasmoving=!1,b.lastmouseup=!1,b.scrollmom.reset(t.clientX,t.clientY);if(!E.cantouch&&!this.istouchcapable&&!E.hasmstouch){if(!n||!/INPUT|SELECT|TEXTAREA/i.test(n.nodeName))return!b.ispage&&E.hasmousecapture&&n.setCapture(),b.opt.touchbehavior?b.cancelEvent(t):b.stopPropagation(t);/SUBMIT|CANCEL|BUTTON/i.test(e(n).attr("type"))&&(pc={tg:n,click:!1},b.preventclick=pc)}}},b.ontouchend=function(e){if(e.pointerType&&2!=e.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt&&(b.scrollmom.doMomentum(),b.rail.drag=!1,b.hasmoving&&(b.hasmoving=!1,b.lastmouseup=!0,b.hideCursor(),E.hasmousecapture&&document.releaseCapture(),!E.cantouch)))return b.cancelEvent(e)};var m=b.opt.touchbehavior&&b.isiframe&&!E.hasmousecapture;b.ontouchmove=function(t,n){if(t.pointerType&&2!=t.pointerType)return!1;if(b.rail.drag&&2==b.rail.drag.pt){if(E.cantouch&&"undefined"==typeof t.original)return!0;b.hasmoving=!0,b.preventclick&&!b.preventclick.click&&(b.preventclick.click=b.preventclick.tg.onclick||!1,b.preventclick.tg.onclick=b.onpreventclick),t=e.extend({original:t},t),"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY);if(b.forcescreen){var r=t;t={original:t.original?t.original:t},t.clientX=r.screenX,t.clientY=r.screenY}r=ofy=0;if(m&&!n){var i=b.win.position(),r=-i.left;ofy=-i.top}var s=t.clientY+ofy,i=s-b.rail.drag.y,o=t.clientX+r,u=o-b.rail.drag.x,a=b.rail.drag.st-i;b.ishwscroll&&b.opt.bouncescroll?0>a?a=Math.round(a/2):a>b.page.maxh&&(a=b.page.maxh+Math.round((a-b.page.maxh)/2)):(0>a&&(s=a=0),a>b.page.maxh&&(a=b.page.maxh,s=0));if(b.railh&&b.railh.scrollable){var f=b.rail.drag.sl-u;b.ishwscroll&&b.opt.bouncescroll?0>f?f=Math.round(f/2):f>b.page.maxw&&(f=b.page.maxw+Math.round((f-b.page.maxw)/2)):(0>f&&(o=f=0),f>b.page.maxw&&(f=b.page.maxw,o=0))}r=!1;if(b.rail.drag.dl)r=!0,"v"==b.rail.drag.dl?f=b.rail.drag.sl:"h"==b.rail.drag.dl&&(a=b.rail.drag.st);else{var i=Math.abs(i),u=Math.abs(u),l=b.opt.directionlockdeadzone;if("v"==b.rail.drag.ck){if(i>l&&u<=.3*i)return b.rail.drag=!1,!0;u>l&&(b.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==b.rail.drag.ck){if(u>l&&i<=.3*u)return b.rail.drag=!1,!0;i>l&&(b.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}b.synched("touchmove",function(){b.rail.drag&&2==b.rail.drag.pt&&(b.prepareTransition&&b.prepareTransition(0),b.rail.scrollable&&b.setScrollTop(a),b.scrollmom.update(o,s),b.railh&&b.railh.scrollable?(b.setScrollLeft(f),b.showCursor(a,f)):b.showCursor(a),E.isie10&&document.selection.clear())}),E.ischrome&&b.istouchcapable&&(r=!1);if(r)return b.cancelEvent(t)}}}b.onmousedown=function(e,t){if(!b.rail.drag||1==b.rail.drag.pt){if(b.locked)return b.cancelEvent(e);b.cancelScroll(),b.rail.drag={x:e.clientX,y:e.clientY,sx:b.scroll.x,sy:b.scroll.y,pt:1,hr:!!t};var n=b.getTarget(e);return!b.ispage&&E.hasmousecapture&&n.setCapture(),b.isiframe&&!E.hasmousecapture&&(b.saved.csspointerevents=b.doc.css("pointer-events"),b.css(b.doc,{"pointer-events":"none"})),b.cancelEvent(e)}},b.onmouseup=function(e){if(b.rail.drag&&(E.hasmousecapture&&document.releaseCapture(),b.isiframe&&!E.hasmousecapture&&b.doc.css("pointer-events",b.saved.csspointerevents),1==b.rail.drag.pt))return b.rail.drag=!1,b.cancelEvent(e)},b.onmousemove=function(e){if(b.rail.drag&&1==b.rail.drag.pt){if(E.ischrome&&0==e.which)return b.onmouseup(e);b.cursorfreezed=!0;if(b.rail.drag.hr){b.scroll.x=b.rail.drag.sx+(e.clientX-b.rail.drag.x),0>b.scroll.x&&(b.scroll.x=0);var t=b.scrollvaluemaxw;b.scroll.x>t&&(b.scroll.x=t)}else b.scroll.y=b.rail.drag.sy+(e.clientY-b.rail.drag.y),0>b.scroll.y&&(b.scroll.y=0),t=b.scrollvaluemax,b.scroll.y>t&&(b.scroll.y=t);return b.synched("mousemove",function(){b.rail.drag&&1==b.rail.drag.pt&&(b.showCursor(),b.rail.drag.hr?b.doScrollLeft(Math.round(b.scroll.x*b.scrollratio.x),b.opt.cursordragspeed):b.doScrollTop(Math.round(b.scroll.y*b.scrollratio.y),b.opt.cursordragspeed))}),b.cancelEvent(e)}};if(E.cantouch||b.opt.touchbehavior)b.onpreventclick=function(e){if(b.preventclick)return b.preventclick.tg.onclick=b.preventclick.click,b.preventclick=!1,b.cancelEvent(e)},b.bind(b.win,"mousedown",b.ontouchstart),b.onclick=E.isios?!1:function(e){return b.lastmouseup?(b.lastmouseup=!1,b.cancelEvent(e)):!0},b.opt.grabcursorenabled&&E.cursorgrabvalue&&(b.css(b.ispage?b.doc:b.win,{cursor:E.cursorgrabvalue}),b.css(b.rail,{cursor:E.cursorgrabvalue}));else{var g=function(e){if(b.selectiondrag){if(e){var t=b.win.outerHeight();e=e.pageY-b.selectiondrag.top,0<e&&e<t&&(e=0),e>=t&&(e-=t),b.selectiondrag.df=e}0!=b.selectiondrag.df&&(b.doScrollBy(2*-Math.floor(b.selectiondrag.df/6)),b.debounced("doselectionscroll",function(){g()},50))}};b.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},b.onselectionstart=function(e){b.ispage||(b.selectiondrag=b.win.offset())},b.onselectionend=function(e){b.selectiondrag=!1},b.onselectiondrag=function(e){b.selectiondrag&&b.hasTextSelected()&&b.debounced("selectionscroll",function(){g(e)},250)}}E.hasmstouch&&(b.css(b.rail,{"-ms-touch-action":"none"}),b.css(b.cursor,{"-ms-touch-action":"none"}),b.bind(b.win,"MSPointerDown",b.ontouchstart),b.bind(document,"MSPointerUp",b.ontouchend),b.bind(document,"MSPointerMove",b.ontouchmove),b.bind(b.cursor,"MSGestureHold",function(e){e.preventDefault()}),b.bind(b.cursor,"contextmenu",function(e){e.preventDefault()})),this.istouchcapable&&(b.bind(b.win,"touchstart",b.ontouchstart),b.bind(document,"touchend",b.ontouchend),b.bind(document,"touchcancel",b.ontouchend),b.bind(document,"touchmove",b.ontouchmove)),b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mouseup",b.onmouseup),b.railh&&(b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.bind(b.cursorh,"mouseup",function(e){if(!b.rail.drag||2!=b.rail.drag.pt)return b.rail.drag=!1,b.hasmoving=!1,b.hideCursor(),E.hasmousecapture&&document.releaseCapture(),b.cancelEvent(e)}));if(b.opt.cursordragontouch||!E.cantouch&&!b.opt.touchbehavior)b.rail.css({cursor:"default"}),b.railh&&b.railh.css({cursor:"default"}),b.jqbind(b.rail,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.rail,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.rail,"click",function(e){b.doRailClick(e,!1,!1)}),b.bind(b.rail,"dblclick",function(e){b.doRailClick(e,!0,!1)}),b.bind(b.cursor,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursor,"dblclick",function(e){b.cancelEvent(e)})),b.railh&&(b.jqbind(b.railh,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.railh,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}),b.opt.sensitiverail&&(b.bind(b.railh,"click",function(e){b.doRailClick(e,!1,!0)}),b.bind(b.railh,"dblclick",function(e){b.doRailClick(e,!0,!0)}),b.bind(b.cursorh,"click",function(e){b.cancelEvent(e)}),b.bind(b.cursorh,"dblclick",function(e){b.cancelEvent(e)})));!E.cantouch&&!b.opt.touchbehavior?(b.bind(E.hasmousecapture?b.win:document,"mouseup",b.onmouseup),b.bind(document,"mousemove",b.onmousemove),b.onclick&&b.bind(document,"click",b.onclick),!b.ispage&&b.opt.enablescrollonselection&&(b.bind(b.win[0],"mousedown",b.onselectionstart),b.bind(document,"mouseup",b.onselectionend),b.bind(b.cursor,"mouseup",b.onselectionend),b.cursorh&&b.bind(b.cursorh,"mouseup",b.onselectionend),b.bind(document,"mousemove",b.onselectiondrag)),b.zoom&&(b.jqbind(b.zoom,"mouseenter",function(){b.canshowonmouseevent&&b.showCursor(),b.rail.active=!0}),b.jqbind(b.zoom,"mouseleave",function(){b.rail.active=!1,b.rail.drag||b.hideCursor()}))):(b.bind(E.hasmousecapture?b.win:document,"mouseup",b.ontouchend),b.bind(document,"mousemove",b.ontouchmove),b.onclick&&b.bind(document,"click",b.onclick),b.opt.cursordragontouch&&(b.bind(b.cursor,"mousedown",b.onmousedown),b.bind(b.cursor,"mousemove",b.onmousemove),b.cursorh&&b.bind(b.cursorh,"mousedown",function(e){b.onmousedown(e,!0)}),b.cursorh&&b.bind(b.cursorh,"mousemove",b.onmousemove))),b.opt.enablemousewheel&&(b.isiframe||b.bind(E.isie&&b.ispage?document:b.win,"mousewheel",b.onmousewheel),b.bind(b.rail,"mousewheel",b.onmousewheel),b.railh&&b.bind(b.railh,"mousewheel",b.onmousewheelhr)),!b.ispage&&!E.cantouch&&!/HTML|BODY/.test(b.win[0].nodeName)&&(b.win.attr("tabindex")||b.win.attr({tabindex:r++}),b.jqbind(b.win,"focus",function(e){t=b.getTarget(e).id||!0,b.hasfocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"blur",function(e){t=!1,b.hasfocus=!1}),b.jqbind(b.win,"mouseenter",function(e){n=b.getTarget(e).id||!0,b.hasmousefocus=!0,b.canshowonmouseevent&&b.noticeCursor()}),b.jqbind(b.win,"mouseleave",function(){n=!1,b.hasmousefocus=!1,b.rail.drag||b.hideCursor()}))}b.onkeypress=function(e){if(b.locked&&0==b.page.maxh)return!0;e=e?e:window.e;var r=b.getTarget(e);if(r&&/INPUT|TEXTAREA|SELECT|OPTION/.test(r.nodeName)&&(!r.getAttribute("type")&&!r.type||!/submit|button|cancel/i.tp))return!0;if(b.hasfocus||b.hasmousefocus&&!t||b.ispage&&!t&&!n){r=e.keyCode;if(b.locked&&27!=r)return b.cancelEvent(e);var i=e.ctrlKey||!1,s=e.shiftKey||!1,o=!1;switch(r){case 38:case 63233:b.doScrollBy(72),o=!0;break;case 40:case 63235:b.doScrollBy(-72),o=!0;break;case 37:case 63232:b.railh&&(i?b.doScrollLeft(0):b.doScrollLeftBy(72),o=!0);break;case 39:case 63234:b.railh&&(i?b.doScrollLeft(b.page.maxw):b.doScrollLeftBy(-72),o=!0);break;case 33:case 63276:b.doScrollBy(b.view.h),o=!0;break;case 34:case 63277:b.doScrollBy(-b.view.h),o=!0;break;case 36:case 63273:b.railh&&i?b.doScrollPos(0,0):b.doScrollTo(0),o=!0;break;case 35:case 63275:b.railh&&i?b.doScrollPos(b.page.maxw,b.page.maxh):b.doScrollTo(b.page.maxh),o=!0;break;case 32:b.opt.spacebarenabled&&(s?b.doScrollBy(b.view.h):b.doScrollBy(-b.view.h),o=!0);break;case 27:b.zoomactive&&(b.doZoom(),o=!0)}if(o)return b.cancelEvent(e)}},b.opt.enablekeyboard&&b.bind(document,E.isopera&&!E.isopera12?"keypress":"keydown",b.onkeypress),b.bind(window,"resize",b.lazyResize),b.bind(window,"orientationchange",b.lazyResize),b.bind(window,"load",b.lazyResize);if(E.ischrome&&!b.ispage&&!b.haswrapper){var w=b.win.attr("style"),a=parseFloat(b.win.css("width"))+1;b.win.css("width",a),b.synched("chromefix",function(){b.win.attr("style",w)})}b.onAttributeChange=function(e){b.lazyResize(250)},!b.ispage&&!b.haswrapper&&(!1!==p?(b.observer=new p(function(e){e.forEach(b.onAttributeChange)}),b.observer.observe(b.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),b.observerremover=new p(function(e){e.forEach(function(e){if(0<e.removedNodes.length)for(var t in e.removedNodes)if(e.removedNodes[t]==b.win[0])return b.remove()})}),b.observerremover.observe(b.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(b.bind(b.win,E.isie&&!E.isie9?"propertychange":"DOMAttrModified",b.onAttributeChange),E.isie9&&b.win[0].attachEvent("onpropertychange",b.onAttributeChange),b.bind(b.win,"DOMNodeRemoved",function(e){e.target==b.win[0]&&b.remove()}))),!b.ispage&&b.opt.boxzoom&&b.bind(window,"resize",b.resizeZoom),b.istextarea&&b.bind(b.win,"mouseup",b.lazyResize),b.checkrtlmode=!0,b.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var S=function(t){b.iframexd=!1;try{var n="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(r){b.iframexd=!0,n=!1}if(b.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;b.forcescreen=!0,b.isiframe&&(b.iframe={doc:e(n),html:b.doc.contents().find("html")[0],body:b.doc.contents().find("body")[0]},b.getContentSize=function(){return{w:Math.max(b.iframe.html.scrollWidth,b.iframe.body.scrollWidth),h:Math.max(b.iframe.html.scrollHeight,b.iframe.body.scrollHeight)}},b.docscroll=e(b.iframe.body)),!E.isios&&b.opt.iframeautoresize&&!b.isiframe&&(b.win.scrollTop(0),b.doc.height(""),t=Math.max(n.getElementsByTagName("html")[0].scrollHeight,n.body.scrollHeight),b.doc.height(t)),b.lazyResize(30),E.isie7&&b.css(e(b.iframe.html),{"overflow-y":"hidden"}),b.css(e(b.iframe.body),{"overflow-y":"hidden"}),E.isios&&b.haswrapper&&b.css(e(n.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?b.bind(this.contentWindow,"scroll",b.onscroll):b.bind(n,"scroll",b.onscroll),b.opt.enablemousewheel&&b.bind(n,"mousewheel",b.onmousewheel),b.opt.enablekeyboard&&b.bind(n,E.isopera?"keypress":"keydown",b.onkeypress);if(E.cantouch||b.opt.touchbehavior)b.bind(n,"mousedown",b.ontouchstart),b.bind(n,"mousemove",function(e){b.ontouchmove(e,!0)}),b.opt.grabcursorenabled&&E.cursorgrabvalue&&b.css(e(n.body),{cursor:E.cursorgrabvalue});b.bind(n,"mouseup",b.ontouchend),b.zoom&&(b.opt.dblclickzoom&&b.bind(n,"dblclick",b.doZoom),b.ongesturezoom&&b.bind(n,"gestureend",b.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){S.call(b.doc[0],!1)},500),b.bind(this.doc,"load",S)}},this.showCursor=function(e,t){b.cursortimeout&&(clearTimeout(b.cursortimeout),b.cursortimeout=0);if(b.rail){b.autohidedom&&(b.autohidedom.stop().css({opacity:b.opt.cursoropacitymax}),b.cursoractive=!0);if(!b.rail.drag||1!=b.rail.drag.pt)"undefined"!=typeof e&&!1!==e&&(b.scroll.y=Math.round(1*e/b.scrollratio.y)),"undefined"!=typeof t&&(b.scroll.x=Math.round(1*t/b.scrollratio.x));b.cursor.css({height:b.cursorheight,top:b.scroll.y}),b.cursorh&&(!b.rail.align&&b.rail.visibility?b.cursorh.css({width:b.cursorwidth,left:b.scroll.x+b.rail.width}):b.cursorh.css({width:b.cursorwidth,left:b.scroll.x}),b.cursoractive=!0),b.zoom&&b.zoom.stop().css({opacity:b.opt.cursoropacitymax})}},this.hideCursor=function(e){!b.cursortimeout&&b.rail&&b.autohidedom&&(!b.hasmousefocus||"leave"!=b.opt.autohidemode)&&(b.cursortimeout=setTimeout(function(){if(!b.rail.active||!b.showonmouseevent)b.autohidedom.stop().animate({opacity:b.opt.cursoropacitymin}),b.zoom&&b.zoom.stop().animate({opacity:b.opt.cursoropacitymin}),b.cursoractive=!1;b.cursortimeout=0},e||b.opt.hidecursordelay))},this.noticeCursor=function(e,t,n){b.showCursor(t,n),b.rail.active||b.hideCursor(e)},this.getContentSize=b.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:b.haswrapper?function(){return{w:b.doc.outerWidth()+parseInt(b.win.css("paddingLeft"))+parseInt(b.win.css("paddingRight")),h:b.doc.outerHeight()+parseInt(b.win.css("paddingTop"))+parseInt(b.win.css("paddingBottom"))}}:function(){return{w:b.docscroll[0].scrollWidth,h:b.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!b.win)return!1;if(!b.haswrapper&&!b.ispage){if("none"==b.win.css("display"))return b.visibility&&b.hideRail().hideRailHr(),!1;!b.hidden&&!b.visibility&&b.showRail().showRailHr()}var n=b.page.maxh,r=b.page.maxw,i=b.view.w;b.view={w:b.ispage?b.win.width():parseInt(b.win[0].clientWidth),h:b.ispage?b.win.height():parseInt(b.win[0].clientHeight)},b.page=t?t:b.getContentSize(),b.page.maxh=Math.max(0,b.page.h-b.view.h),b.page.maxw=Math.max(0,b.page.w-b.view.w);if(b.page.maxh==n&&b.page.maxw==r&&b.view.w==i){if(b.ispage)return b;n=b.win.offset();if(b.lastposition&&(r=b.lastposition,r.top==n.top&&r.left==n.left))return b;b.lastposition=n}return 0==b.page.maxh?(b.hideRail(),b.scrollvaluemax=0,b.scroll.y=0,b.scrollratio.y=0,b.cursorheight=0,b.setScrollTop(0),b.rail.scrollable=!1):b.rail.scrollable=!0,0==b.page.maxw?(b.hideRailHr(),b.scrollvaluemaxw=0,b.scroll.x=0,b.scrollratio.x=0,b.cursorwidth=0,b.setScrollLeft(0),b.railh.scrollable=!1):b.railh.scrollable=!0,b.locked=0==b.page.maxh&&0==b.page.maxw,b.locked?(b.ispage||b.updateScrollBar(b.view),!1):(!b.hidden&&!b.visibility?b.showRail().showRailHr():!b.hidden&&!b.railh.visibility&&b.showRailHr(),b.istextarea&&b.win.css("resize")&&"none"!=b.win.css("resize")&&(b.view.h-=20),b.cursorheight=Math.min(b.view.h,Math.round(b.view.h*(b.view.h/b.page.h))),b.cursorheight=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorheight),b.cursorwidth=Math.min(b.view.w,Math.round(b.view.w*(b.view.w/b.page.w))),b.cursorwidth=b.opt.cursorfixedheight?b.opt.cursorfixedheight:Math.max(b.opt.cursorminheight,b.cursorwidth),b.scrollvaluemax=b.view.h-b.cursorheight-b.cursor.hborder,b.railh&&(b.railh.width=0<b.page.maxh?b.view.w-b.rail.width:b.view.w,b.scrollvaluemaxw=b.railh.width-b.cursorwidth-b.cursorh.wborder),b.checkrtlmode&&b.railh&&(b.checkrtlmode=!1,b.opt.rtlmode&&0==b.scroll.x&&b.setScrollLeft(b.page.maxw)),b.ispage||b.updateScrollBar(b.view),b.scrollratio={x:b.page.maxw/b.scrollvaluemaxw,y:b.page.maxh/b.scrollvaluemax},b.getScrollTop()>b.page.maxh?b.doScrollTop(b.page.maxh):(b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x)),b.cursoractive&&b.noticeCursor()),b.scroll.y&&0==b.getScrollTop()&&b.doScrollTo(Math.floor(b.scroll.y*b.scrollratio.y)),b)},this.resize=b.onResize,this.lazyResize=function(e){return e=isNaN(e)?30:e,b.delayed("resize",b.resize,e),b},this._bind=function(e,t,n,r){b.events.push({e:e,n:t,f:n,b:r,q:!1}),e.addEventListener?e.addEventListener(t,n,r||!1):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},this.jqbind=function(t,n,r){b.events.push({e:t,n:n,f:r,q:!0}),e(t).bind(n,r)},this.bind=function(e,t,n,r){var i="jquery"in e?e[0]:e;"mousewheel"==t?"onwheel"in b.win?b._bind(i,"wheel",n,r||!1):(e="undefined"!=typeof document.onmousewheel?"mousewheel":"DOMMouseScroll",v(i,e,n,r||!1),"DOMMouseScroll"==e&&v(i,"MozMousePixelScroll",n,r||!1)):i.addEventListener?(E.cantouch&&/mouseup|mousedown|mousemove/.test(t)&&b._bind(i,"mousedown"==t?"touchstart":"mouseup"==t?"touchend":"touchmove",function(e){if(e.touches){if(2>e.touches.length){var t=e.touches.length?e.touches[0]:e;t.original=e,n.call(this,t)}}else e.changedTouches&&(t=e.changedTouches[0],t.original=e,n.call(this,t))},r||!1),b._bind(i,t,n,r||!1),E.cantouch&&"mouseup"==t&&b._bind(i,"touchcancel",n,r||!1)):b._bind(i,t,function(e){return(e=e||window.event||!1)&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),!1===n.call(i,e)||!1===r?b.cancelEvent(e):!0})},this._unbind=function(e,t,n,r){e.removeEventListener?e.removeEventListener(t,n,r):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=!1},this.unbindAll=function(){for(var e=0;e<b.events.length;e++){var t=b.events[e];t.q?t.e.unbind(t.n,t.f):b._unbind(t.e,t.n,t.f,t.b)}},this.cancelEvent=function(e){return e=e.original?e.original:e?e:window.event||!1,e?(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1):!1},this.stopPropagation=function(e){return e=e.original?e.original:e?e:window.event||!1,e?e.stopPropagation?e.stopPropagation():(e.cancelBubble&&(e.cancelBubble=!0),!1):!1},this.showRail=function(){return 0!=b.page.maxh&&(b.ispage||"none"!=b.win.css("display"))&&(b.visibility=!0,b.rail.visibility=!0,b.rail.css("display","block")),b},this.showRailHr=function(){return b.railh?(0!=b.page.maxw&&(b.ispage||"none"!=b.win.css("display"))&&(b.railh.visibility=!0,b.railh.css("display","block")),b):b},this.hideRail=function(){return b.visibility=!1,b.rail.visibility=!1,b.rail.css("display","none"),b},this.hideRailHr=function(){return b.railh?(b.railh.visibility=!1,b.railh.css("display","none"),b):b},this.show=function(){return b.hidden=!1,b.locked=!1,b.showRail().showRailHr()},this.hide=function(){return b.hidden=!0,b.locked=!0,b.hideRail().hideRailHr()},this.toggle=function(){return b.hidden?b.show():b.hide()},this.remove=function(){b.stop(),b.cursortimeout&&clearTimeout(b.cursortimeout),b.doZoomOut(),b.unbindAll(),E.isie9&&b.win[0].detachEvent("onpropertychange",b.onAttributeChange),!1!==b.observer&&b.observer.disconnect(),!1!==b.observerremover&&b.observerremover.disconnect(),b.events=null,b.cursor&&b.cursor.remove(),b.cursorh&&b.cursorh.remove(),b.rail&&b.rail.remove(),b.railh&&b.railh.remove(),b.zoom&&b.zoom.remove();for(var t=0;t<b.saved.css.length;t++){var n=b.saved.css[t];n[0].css(n[1],"undefined"==typeof n[2]?"":n[2])}b.saved=!1,b.me.data("__nicescroll","");var r=e.nicescroll;r.each(function(e){if(this&&this.id===b.id){delete r[e];for(var t=++e;t<r.length;t++,e++)r[e]=r[t];r.length--,r.length&&delete r[r.length]}});for(var i in b)b[i]=null,delete b[i];b=null},this.scrollstart=function(e){return this.onscrollstart=e,b},this.scrollend=function(e){return this.onscrollend=e,b},this.scrollcancel=function(e){return this.onscrollcancel=e,b},this.zoomin=function(e){return this.onzoomin=e,b},this.zoomout=function(e){return this.onzoomout=e,b},this.isScrollable=function(t){t=t.target?t.target:t;if("OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=e(t),n=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(n))return t.clientHeight!=t.scrollHeight;t=t.parentNode?t.parentNode:!1}return!1},this.getViewport=function(t){for(t=t&&t.parentNode?t.parentNode:!1;t&&1==t.nodeType&&!/BODY|HTML/.test(t.nodeName);){var n=e(t);if(/fixed|absolute/.test(n.css("position")))return n;var r=n.css("overflowY")||n.css("overflowX")||n.css("overflow")||"";if(/scroll|auto/.test(r)&&t.clientHeight!=t.scrollHeight||0<n.getNiceScroll().length)return n;t=t.parentNode?t.parentNode:!1}return!1},this.onmousewheel=function(e){if(b.locked)return b.debounced("checkunlock",b.resize,250),!0;if(b.rail.drag)return b.cancelEvent(e);"auto"==b.opt.oneaxismousemode&&0!=e.deltaX&&(b.opt.oneaxismousemode=!1);if(b.opt.oneaxismousemode&&0==e.deltaX&&!b.rail.scrollable)return b.railh&&b.railh.scrollable?b.onmousewheelhr(e):!0;var t=+(new Date),n=!1;b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t;if(b.nativescrollingarea)return!0;if(e=g(e,!1,n))b.checkarea=0;return e},this.onmousewheelhr=function(e){if(b.locked||!b.railh.scrollable)return!0;if(b.rail.drag)return b.cancelEvent(e);var t=+(new Date),n=!1;return b.opt.preservenativescrolling&&b.checkarea+600<t&&(b.nativescrollingarea=b.isScrollable(e),n=!0),b.checkarea=t,b.nativescrollingarea?!0:b.locked?b.cancelEvent(e):g(e,!0,n)},this.stop=function(){return b.cancelScroll(),b.scrollmon&&b.scrollmon.stop(),b.cursorfreezed=!1,b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.noticeCursor(),b},this.getTransitionSpeed=function(e){var t=Math.round(10*b.opt.scrollspeed);return e=Math.min(t,Math.round(e/20*b.opt.scrollspeed)),20<e?e:0},b.opt.smoothscroll?b.ishwscroll&&E.hastransition&&b.opt.usetransition?(this.prepareTransition=function(e,t){var n=t?20<e?e:0:b.getTransitionSpeed(e),r=n?E.prefixstyle+"transform "+n+"ms ease-out":"";if(!b.lasttransitionstyle||b.lasttransitionstyle!=r)b.lasttransitionstyle=r,b.doc.css(E.transitionstyle,r);return n},this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var r=b.getScrollTop(),i=b.getScrollLeft();(0>(b.newscrolly-r)*(t-r)||0>(b.newscrollx-i)*(e-i))&&b.cancelScroll(),0==b.opt.bouncescroll&&(0>t?t=0:t>b.page.maxh&&(t=b.page.maxh),0>e?e=0:e>b.page.maxw&&(e=b.page.maxw));if(b.scrollrunning&&e==b.newscrollx&&t==b.newscrolly)return!1;b.newscrolly=t,b.newscrollx=e,b.newscrollspeed=n||!1;if(b.timer)return!1;b.timer=setTimeout(function(){var n=b.getScrollTop(),r=b.getScrollLeft(),i,s;i=e-r,s=t-n,i=Math.round(Math.sqrt(Math.pow(i,2)+Math.pow(s,2))),i=b.newscrollspeed&&1<b.newscrollspeed?b.newscrollspeed:b.getTransitionSpeed(i),b.newscrollspeed&&1>=b.newscrollspeed&&(i*=b.newscrollspeed),b.prepareTransition(i,!0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),0<i&&(!b.scrollrunning&&b.onscrollstart&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:r,y:n},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:i}),E.transitionend?b.scrollendtrapped||(b.scrollendtrapped=!0,b.bind(b.doc,E.transitionend,b.onScrollEnd,!1)):(b.scrollendtrapped&&clearTimeout(b.scrollendtrapped),b.scrollendtrapped=setTimeout(b.onScrollEnd,i)),b.timerscroll={bz:new BezierClass(n,b.newscrolly,i,0,0,.58,1),bh:new BezierClass(r,b.newscrollx,i,0,0,.58,1)},b.cursorfreezed||(b.timerscroll.tm=setInterval(function(){b.showCursor(b.getScrollTop(),b.getScrollLeft())},60))),b.synched("doScroll-set",function(){b.timer=0,b.scrollendtrapped&&(b.scrollrunning=!0),b.setScrollTop(b.newscrolly),b.setScrollLeft(b.newscrollx),b.scrollendtrapped||b.onScrollEnd()})},50)},this.cancelScroll=function(){if(!b.scrollendtrapped)return!0;var e=b.getScrollTop(),t=b.getScrollLeft();return b.scrollrunning=!1,E.transitionend||clearTimeout(E.transitionend),b.scrollendtrapped=!1,b._unbind(b.doc,E.transitionend,b.onScrollEnd),b.prepareTransition(0),b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1,b.cursorfreezed=!1,b.showCursor(e,t),b},this.onScrollEnd=function(){b.scrollendtrapped&&b._unbind(b.doc,E.transitionend,b.onScrollEnd),b.scrollendtrapped=!1,b.prepareTransition(0),b.timerscroll&&b.timerscroll.tm&&clearInterval(b.timerscroll.tm),b.timerscroll=!1;var e=b.getScrollTop(),t=b.getScrollLeft();b.setScrollTop(e),b.railh&&b.setScrollLeft(t),b.noticeCursor(!1,e,t),b.cursorfreezed=!1,0>e?e=0:e>b.page.maxh&&(e=b.page.maxh),0>t?t=0:t>b.page.maxw&&(t=b.page.maxw);if(e!=b.newscrolly||t!=b.newscrollx)return b.doScrollPos(t,e,b.opt.snapbackspeed);b.onscrollend&&b.scrollrunning&&b.onscrollend.call(b,{type:"scrollend",current:{x:t,y:e},end:{x:b.newscrollx,y:b.newscrolly}}),b.scrollrunning=!1}):(this.doScrollLeft=function(e,t){var n=b.scrollrunning?b.newscrolly:b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.scrollrunning?b.newscrollx:b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){function r(){if(b.cancelAnimationFrame)return!0;b.scrollrunning=!0;if(c=1-c)return b.timer=f(r)||1;var e=0,t=sy=b.getScrollTop();if(b.dst.ay){var t=b.bzscroll?b.dst.py+b.bzscroll.getNow()*b.dst.ay:b.newscrolly,n=t-sy;if(0>n&&t<b.newscrolly||0<n&&t>b.newscrolly)t=b.newscrolly;b.setScrollTop(t),t==b.newscrolly&&(e=1)}else e=1;var i=sx=b.getScrollLeft();if(b.dst.ax){i=b.bzscroll?b.dst.px+b.bzscroll.getNow()*b.dst.ax:b.newscrollx,n=i-sx;if(0>n&&i<b.newscrollx||0<n&&i>b.newscrollx)i=b.newscrollx;b.setScrollLeft(i),i==b.newscrollx&&(e+=1)}else e+=1;2==e?(b.timer=0,b.cursorfreezed=!1,b.bzscroll=!1,b.scrollrunning=!1,0>t?t=0:t>b.page.maxh&&(t=b.page.maxh),0>i?i=0:i>b.page.maxw&&(i=b.page.maxw),i!=b.newscrollx||t!=b.newscrolly?b.doScrollPos(i,t):b.onscrollend&&b.onscrollend.call(b,{type:"scrollend",current:{x:sx,y:sy},end:{x:b.newscrollx,y:b.newscrolly}})):b.timer=f(r)||1}t="undefined"==typeof t||!1===t?b.getScrollTop(!0):t;if(b.timer&&b.newscrolly==t&&b.newscrollx==e)return!0;b.timer&&l(b.timer),b.timer=0;var i=b.getScrollTop(),s=b.getScrollLeft();(0>(b.newscrolly-i)*(t-i)||0>(b.newscrollx-s)*(e-s))&&b.cancelScroll(),b.newscrolly=t,b.newscrollx=e;if(!b.bouncescroll||!b.rail.visibility)0>b.newscrolly?b.newscrolly=0:b.newscrolly>b.page.maxh&&(b.newscrolly=b.page.maxh);if(!b.bouncescroll||!b.railh.visibility)0>b.newscrollx?b.newscrollx=0:b.newscrollx>b.page.maxw&&(b.newscrollx=b.page.maxw);b.dst={},b.dst.x=e-s,b.dst.y=t-i,b.dst.px=s,b.dst.py=i;var o=Math.round(Math.sqrt(Math.pow(b.dst.x,2)+Math.pow(b.dst.y,2)));b.dst.ax=b.dst.x/o,b.dst.ay=b.dst.y/o;var u=0,a=o;0==b.dst.x?(u=i,a=t,b.dst.ay=1,b.dst.py=0):0==b.dst.y&&(u=s,a=e,b.dst.ax=1,b.dst.px=0),o=b.getTransitionSpeed(o),n&&1>=n&&(o*=n),b.bzscroll=0<o?b.bzscroll?b.bzscroll.update(a,o):new BezierClass(u,a,o,0,1,0,1):!1;if(!b.timer){(i==b.page.maxh&&t>=b.page.maxh||s==b.page.maxw&&e>=b.page.maxw)&&b.checkContentSize();var c=1;b.cancelAnimationFrame=!1,b.timer=1,b.onscrollstart&&!b.scrollrunning&&b.onscrollstart.call(b,{type:"scrollstart",current:{x:s,y:i},request:{x:e,y:t},end:{x:b.newscrollx,y:b.newscrolly},speed:o}),r(),(i==b.page.maxh&&t>=i||s==b.page.maxw&&e>=s)&&b.checkContentSize(),b.noticeCursor()}},this.cancelScroll=function(){return b.timer&&l(b.timer),b.timer=0,b.bzscroll=!1,b.scrollrunning=!1,b}):(this.doScrollLeft=function(e,t){var n=b.getScrollTop();b.doScrollPos(e,n,t)},this.doScrollTop=function(e,t){var n=b.getScrollLeft();b.doScrollPos(n,e,t)},this.doScrollPos=function(e,t,n){var r=e>b.page.maxw?b.page.maxw:e;0>r&&(r=0);var i=t>b.page.maxh?b.page.maxh:t;0>i&&(i=0),b.synched("scroll",function(){b.setScrollTop(i),b.setScrollLeft(r)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var n=0,n=t?Math.floor((b.scroll.y-e)*b.scrollratio.y):(b.timer?b.newscrolly:b.getScrollTop(!0))-e;if(b.bouncescroll){var r=Math.round(b.view.h/2);n<-r?n=-r:n>b.page.maxh+r&&(n=b.page.maxh+r)}b.cursorfreezed=!1,py=b.getScrollTop(!0);if(0>n&&0>=py)return b.noticeCursor();if(n>b.page.maxh&&py>=b.page.maxh)return b.checkContentSize(),b.noticeCursor();b.doScrollTop(n)},this.doScrollLeftBy=function(e,t){var n=0,n=t?Math.floor((b.scroll.x-e)*b.scrollratio.x):(b.timer?b.newscrollx:b.getScrollLeft(!0))-e;if(b.bouncescroll){var r=Math.round(b.view.w/2);n<-r?n=-r:n>b.page.maxw+r&&(n=b.page.maxw+r)}b.cursorfreezed=!1,px=b.getScrollLeft(!0);if(0>n&&0>=px||n>b.page.maxw&&px>=b.page.maxw)return b.noticeCursor();b.doScrollLeft(n)},this.doScrollTo=function(e,t){t&&Math.round(e*b.scrollratio.y),b.cursorfreezed=!1,b.doScrollTop(e)},this.checkContentSize=function(){var e=b.getContentSize();(e.h!=b.page.h||e.w!=b.page.w)&&b.resize(!1,e)},b.onscroll=function(e){b.rail.drag||b.cursorfreezed||b.synched("scroll",function(){b.scroll.y=Math.round(b.getScrollTop()*(1/b.scrollratio.y)),b.railh&&(b.scroll.x=Math.round(b.getScrollLeft()*(1/b.scrollratio.x))),b.noticeCursor()})},b.bind(b.docscroll,"scroll",b.onscroll),this.doZoomIn=function(t){if(!b.zoomactive){b.zoomactive=!0,b.zoomrestore={style:{}};var n="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),r=b.win[0].style,i;for(i in n){var o=n[i];b.zoomrestore.style[o]="undefined"!=typeof r[o]?r[o]:""}return b.zoomrestore.style.width=b.win.css("width"),b.zoomrestore.style.height=b.win.css("height"),b.zoomrestore.padding={w:b.win.outerWidth()-b.win.width(),h:b.win.outerHeight()-b.win.height()},E.isios4&&(b.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0)),b.win.css({position:E.isios4?"absolute":"fixed",top:0,left:0,"z-index":s+100,margin:"0px"}),n=b.win.css("backgroundColor"),(""==n||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(n))&&b.win.css("backgroundColor","#fff"),b.rail.css({"z-index":s+101}),b.zoom.css({"z-index":s+102}),b.zoom.css("backgroundPosition","0px -18px"),b.resizeZoom(),b.onzoomin&&b.onzoomin.call(b),b.cancelEvent(t)}},this.doZoomOut=function(t){if(b.zoomactive)return b.zoomactive=!1,b.win.css("margin",""),b.win.css(b.zoomrestore.style),E.isios4&&e(window).scrollTop(b.zoomrestore.scrollTop),b.rail.css({"z-index":b.zindex}),b.zoom.css({"z-index":b.zindex}),b.zoomrestore=!1,b.zoom.css("backgroundPosition","0px 0px"),b.onResize(),b.onzoomout&&b.onzoomout.call(b),b.cancelEvent(t)},this.doZoom=function(e){return b.zoomactive?b.doZoomOut(e):b.doZoomIn(e)},this.resizeZoom=function(){if(b.zoomactive){var t=b.getScrollTop();b.win.css({width:e(window).width()-b.zoomrestore.padding.w+"px",height:e(window).height()-b.zoomrestore.padding.h+"px"}),b.onResize(),b.setScrollTop(Math.min(b.page.maxh,t))}},this.init(),e.nicescroll.push(this)},y=function(e){var t=this;this.nc=e,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+(new Date)},this.reset=function(e,n){t.stop();var r=t.time();t.steptime=0,t.lasttime=r,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=n,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,n){var r=t.time();t.steptime=r-t.lasttime,t.lasttime=r;var r=n-t.lasty,i=e-t.lastx,s=t.nc.getScrollTop(),o=t.nc.getScrollLeft(),s=s+r,o=o+i;t.snapx=0>o||o>t.nc.page.maxw,t.snapy=0>s||s>t.nc.page.maxh,t.speedx=i,t.speedy=r,t.lastx=e,t.lasty=n},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,n){var r=!1;0>n?(n=0,r=!0):n>t.nc.page.maxh&&(n=t.nc.page.maxh,r=!0),0>e?(e=0,r=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,r=!0),r&&t.nc.doScrollPos(e,n,t.nc.opt.snapbackspeed)},this.doMomentum=function(e){var n=t.time(),r=e?n+e:t.lasttime;e=t.nc.getScrollLeft();var i=t.nc.getScrollTop(),s=t.nc.page.maxh,o=t.nc.page.maxw;t.speedx=0<o?Math.min(60,t.speedx):0,t.speedy=0<s?Math.min(60,t.speedy):0,r=r&&60>=n-r;if(0>i||i>s||0>e||e>o)r=!1;e=t.speedx&&r?t.speedx:!1;if(t.speedy&&r&&t.speedy||e){var u=Math.max(16,t.steptime);50<u&&(e=u/50,t.speedx*=e,t.speedy*=e,u=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var a=t.lastscrollx,f=t.lastscrolly,l=function(){var e=600<t.time()-n?.04:.02;t.speedx&&(a=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=a,0>a||a>o)&&(e=.1),t.speedy&&(f=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=f,0>f||f>s)&&(e=.1),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft()!=t.chkx&&t.stop(),t.chkx=a,t.nc.setScrollLeft(a)),t.speedy&&(t.nc.getScrollTop()!=t.chky&&t.stop(),t.chky=f,t.nc.setScrollTop(f)),t.timer||(t.nc.hideCursor(),t.doSnapy(a,f))}),1>t.demulxy?t.timer=setTimeout(l,u):(t.stop(),t.nc.hideCursor(),t.doSnapy(a,f))};l()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},b=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(t,n,r){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollTop():b.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollTop(parseInt(n)):b.call(t,n),this}},e.fn.scrollTop=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollTop():b.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollTop(parseInt(t)):b.call(e(this),t)})};var w=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(t,n,r){return(n=e.data(t,"__nicescroll")||!1)&&n.ishwscroll?n.getScrollLeft():w.call(t)},set:function(t,n){var r=e.data(t,"__nicescroll")||!1;return r&&r.ishwscroll?r.setScrollLeft(parseInt(n)):w.call(t,n),this}},e.fn.scrollLeft=function(t){if("undefined"==typeof t){var n=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return n&&n.ishwscroll?n.getScrollLeft():w.call(this)}return this.each(function(){var n=e.data(this,"__nicescroll")||!1;n&&n.ishwscroll?n.setScrollLeft(parseInt(t)):w.call(e(this),t)})};var E=function(t){var n=this;this.length=0,this.name="nicescrollarray",this.each=function(e){for(var t=0,r=0;t<n.length;t++)e.call(n[t],r++);return n},this.push=function(e){n[n.length]=e,n.length++},this.eq=function(e){return n[e]};if(t)for(a=0;a<t.length;a++){var r=e.data(t[a],"__nicescroll")||!1;r&&(this[this.length]=r,this.length++)}return this};(function(e,t,n){for(var r=0;r<t.length;r++)n(e,t[r])})(E.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(t){return"undefined"==typeof t?new E(this):this[t]&&e.data(this[t],"__nicescroll")||!1},e.extend(e.expr[":"],{nicescroll:function(t){return e.data(t,"__nicescroll")?!0:!1}}),e.fn.niceScroll=function(t,n){"undefined"==typeof n&&"object"==typeof t&&!("jquery"in t)&&(n=t,t=!1);var r=new E;"undefined"==typeof n&&(n={}),t&&(n.doc=e(t),n.win=e(this));var i=!("doc"in n);return!i&&!("win"in n)&&(n.win=e(this)),this.each(function(){var t=e(this).data("__nicescroll")||!1;t||(n.doc=i?e(this):n.doc,t=new g(n,e(this)),e(this).data("__nicescroll",t)),r.push(t)}),1==r.length?r[0]:r},window.NiceScroll={getjQuery:function(){return e}},e.nicescroll||(e.nicescroll=new E,e.nicescroll.options=d)}(jQuery),define("nicescroll",["jquery"],function(){}),window.matchMedia=window.matchMedia||function(e){var t,n=e.documentElement,r=n.firstElementChild||n.firstChild,i=e.createElement("body"),s=e.createElement("div");return s.id="mq-test-1",s.style.cssText="position:absolute;top:-100em",i.style.background="none",i.appendChild(s),function(e){return s.innerHTML='&shy;<style media="'+e+'"> #mq-test-1 { width: 42px; }</style>',n.insertBefore(i,r),t=42===s.offsetWidth,n.removeChild(i),{matches:t,media:e}}}(document),function(e){function t(){E(!0)}var n={};if(e.respond=n,n.update=function(){},n.mediaQueriesSupported=e.matchMedia&&e.matchMedia("only all").matches,!n.mediaQueriesSupported){var r,i,s,o=e.document,u=o.documentElement,a=[],f=[],l=[],c={},h=30,p=o.getElementsByTagName("head")[0]||u,d=o.getElementsByTagName("base")[0],v=p.getElementsByTagName("link"),m=[],g=function(){for(var t=0;v.length>t;t++){var n=v[t],r=n.href,i=n.media,s=n.rel&&"stylesheet"===n.rel.toLowerCase();r&&s&&!c[r]&&(n.styleSheet&&n.styleSheet.rawCssText?(b(n.styleSheet.rawCssText,r,i),c[r]=!0):(!/^([a-zA-Z:]*\/\/)/.test(r)&&!d||r.replace(RegExp.$1,"").split("/")[0]===e.location.host)&&m.push({href:r,media:i}))}y()},y=function(){if(m.length){var t=m.shift();S(t.href,function(n){b(n,t.href,t.media),c[t.href]=!0,e.setTimeout(function(){y()},0)})}},b=function(e,t,n){var r=e.match(/@media[^\{]+\{([^\{\}]*\{[^\}\{]*\})+/gi),i=r&&r.length||0;t=t.substring(0,t.lastIndexOf("/"));var s=function(e){return e.replace(/(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g,"$1"+t+"$2$3")},o=!i&&n;t.length&&(t+="/"),o&&(i=1);for(var u=0;i>u;u++){var l,c,h,p;o?(l=n,f.push(s(e))):(l=r[u].match(/@media *([^\{]+)\{([\S\s]+?)$/)&&RegExp.$1,f.push(RegExp.$2&&s(RegExp.$2))),h=l.split(","),p=h.length;for(var d=0;p>d;d++)c=h[d],a.push({media:c.split("(")[0].match(/(only\s+)?([a-zA-Z]+)\s?/)&&RegExp.$2||"all",rules:f.length-1,hasquery:c.indexOf("(")>-1,minw:c.match(/\(\s*min\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||""),maxw:c.match(/\(\s*max\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/)&&parseFloat(RegExp.$1)+(RegExp.$2||"")})}E()},w=function(){var e,t=o.createElement("div"),n=o.body,r=!1;return t.style.cssText="position:absolute;font-size:1em;width:1em",n||(n=r=o.createElement("body"),n.style.background="none"),n.appendChild(t),u.insertBefore(n,u.firstChild),e=t.offsetWidth,r?u.removeChild(n):n.removeChild(t),e=s=parseFloat(e)},E=function(t){var n="clientWidth",c=u[n],d="CSS1Compat"===o.compatMode&&c||o.body[n]||c,m={},g=v[v.length-1],y=(new Date).getTime();if(t&&r&&h>y-r)return e.clearTimeout(i),i=e.setTimeout(E,h),void 0;r=y;for(var b in a)if(a.hasOwnProperty(b)){var S=a[b],x=S.minw,T=S.maxw,N=null===x,C=null===T,k="em";x&&(x=parseFloat(x)*(x.indexOf(k)>-1?s||w():1)),T&&(T=parseFloat(T)*(T.indexOf(k)>-1?s||w():1)),S.hasquery&&(N&&C||!(N||d>=x)||!(C||T>=d))||(m[S.media]||(m[S.media]=[]),m[S.media].push(f[S.rules]))}for(var L in l)l.hasOwnProperty(L)&&l[L]&&l[L].parentNode===p&&p.removeChild(l[L]);for(var A in m)if(m.hasOwnProperty(A)){var O=o.createElement("style"),M=m[A].join("\n");O.type="text/css",O.media=A,p.insertBefore(O,g.nextSibling),O.styleSheet?O.styleSheet.cssText=M:O.appendChild(o.createTextNode(M)),l.push(O)}},S=function(e,t){var n=x();n&&(n.open("GET",e,!0),n.onreadystatechange=function(){4!==n.readyState||200!==n.status&&304!==n.status||t(n.responseText)},4!==n.readyState&&n.send(null))},x=function(){var t=!1;try{t=new e.XMLHttpRequest}catch(n){t=new e.ActiveXObject("Microsoft.XMLHTTP")}return function(){return t}}();g(),n.update=g,e.addEventListener?e.addEventListener("resize",t,!1):e.attachEvent&&e.attachEvent("onresize",t)}}(this),define("respondjs",function(e){return function(){var t,n;return t||e.respondjs}}(this)),function(e){function t(e,t){return function(n){return a(e.call(this,n),t)}}function n(e){return function(t){return this.lang().ordinal(e.call(this,t))}}function r(){}function i(e){o(this,e)}function s(e){var t=this._data={},n=e.years||e.year||e.y||0,r=e.months||e.month||e.M||0,i=e.weeks||e.week||e.w||0,s=e.days||e.day||e.d||0,o=e.hours||e.hour||e.h||0,a=e.minutes||e.minute||e.m||0,f=e.seconds||e.second||e.s||0,l=e.milliseconds||e.millisecond||e.ms||0;this._milliseconds=l+f*1e3+a*6e4+o*36e5,this._days=s+i*7,this._months=r+n*12,t.milliseconds=l%1e3,f+=u(l/1e3),t.seconds=f%60,a+=u(f/60),t.minutes=a%60,o+=u(a/60),t.hours=o%24,s+=u(o/24),s+=i*7,t.days=s%30,r+=u(s/30),t.months=r%12,n+=u(r/12),t.years=n}function o(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function u(e){return e<0?Math.ceil(e):Math.floor(e)}function a(e,t){var n=e+"";while(n.length<t)n="0"+n;return n}function f(e,t,n){var r=t._milliseconds,i=t._days,s=t._months,o;r&&e._d.setTime(+e+r*n),i&&e.date(e.date()+i*n),s&&(o=e.date(),e.date(1).month(e.month()+s*n).date(Math.min(o,e.daysInMonth())))}function l(e){return Object.prototype.toString.call(e)==="[object Array]"}function c(e,t){var n=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),i=0,s;for(s=0;s<n;s++)~~e[s]!==~~t[s]&&i++;return i+r}function h(e,t){return t.abbr=e,H[e]||(H[e]=new r),H[e].set(t),H[e]}function p(e){return e?(!H[e]&&B&&require("./lang/"+e),H[e]):M.fn._lang}function d(e){return e.match(/\[.*\]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function v(e){var t=e.match(F),n,r;for(n=0,r=t.length;n<r;n++)st[t[n]]?t[n]=st[t[n]]:t[n]=d(t[n]);return function(i){var s="";for(n=0;n<r;n++)s+=typeof t[n].call=="function"?t[n].call(i,e):t[n];return s}}function m(e,t){function n(t){return e.lang().longDateFormat(t)||t}var r=5;while(r--&&I.test(t))t=t.replace(I,n);return nt[t]||(nt[t]=v(t)),nt[t](e)}function g(e){switch(e){case"DDDD":return z;case"YYYY":return W;case"YYYYY":return X;case"S":case"SS":case"SSS":case"DDD":return U;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":case"a":case"A":return V;case"X":return K;case"Z":case"ZZ":return $;case"T":return J;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return R;default:return new RegExp(e.replace("\\",""))}}function y(e,t,n){var r,i,s=n._a;switch(e){case"M":case"MM":s[1]=t==null?0:~~t-1;break;case"MMM":case"MMMM":r=p(n._l).monthsParse(t),r!=null?s[1]=r:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":t!=null&&(s[2]=~~t);break;case"YY":s[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":s[0]=~~t;break;case"a":case"A":n._isPm=(t+"").toLowerCase()==="pm";break;case"H":case"HH":case"h":case"hh":s[3]=~~t;break;case"m":case"mm":s[4]=~~t;break;case"s":case"ss":s[5]=~~t;break;case"S":case"SS":case"SSS":s[6]=~~(("0."+t)*1e3);break;case"X":n._d=new Date(parseFloat(t)*1e3);break;case"Z":case"ZZ":n._useUTC=!0,r=(t+"").match(Z),r&&r[1]&&(n._tzh=~~r[1]),r&&r[2]&&(n._tzm=~~r[2]),r&&r[0]==="+"&&(n._tzh=-n._tzh,n._tzm=-n._tzm)}t==null&&(n._isValid=!1)}function b(e){var t,n,r=[];if(e._d)return;for(t=0;t<7;t++)e._a[t]=r[t]=e._a[t]==null?t===2?1:0:e._a[t];r[3]+=e._tzh||0,r[4]+=e._tzm||0,n=new Date(0),e._useUTC?(n.setUTCFullYear(r[0],r[1],r[2]),n.setUTCHours(r[3],r[4],r[5],r[6])):(n.setFullYear(r[0],r[1],r[2]),n.setHours(r[3],r[4],r[5],r[6])),e._d=n}function w(e){var t=e._f.match(F),n=e._i,r,i;e._a=[];for(r=0;r<t.length;r++)i=(g(t[r]).exec(n)||[])[0],i&&(n=n.slice(n.indexOf(i)+i.length)),st[t[r]]&&y(t[r],i,e);e._isPm&&e._a[3]<12&&(e._a[3]+=12),e._isPm===!1&&e._a[3]===12&&(e._a[3]=0),b(e)}function E(e){var t,n,r,s=99,u,a,f;while(e._f.length){t=o({},e),t._f=e._f.pop(),w(t),n=new i(t);if(n.isValid()){r=n;break}f=c(t._a,n.toArray()),f<s&&(s=f,r=n)}o(e,r)}function S(e){var t,n=e._i;if(Q.exec(n)){e._f="YYYY-MM-DDT";for(t=0;t<4;t++)if(Y[t][1].exec(n)){e._f+=Y[t][0];break}$.exec(n)&&(e._f+=" Z"),w(e)}else e._d=new Date(n)}function x(t){var n=t._i,r=j.exec(n);n===e?t._d=new Date:r?t._d=new Date(+r[1]):typeof n=="string"?S(t):l(n)?(t._a=n.slice(0),b(t)):t._d=n instanceof Date?new Date(+n):new Date(n)}function T(e,t,n,r,i){return i.relativeTime(t||1,!!n,e,r)}function N(e,t,n){var r=D(Math.abs(e)/1e3),i=D(r/60),s=D(i/60),o=D(s/24),u=D(o/365),a=r<45&&["s",r]||i===1&&["m"]||i<45&&["mm",i]||s===1&&["h"]||s<22&&["hh",s]||o===1&&["d"]||o<=25&&["dd",o]||o<=45&&["M"]||o<345&&["MM",D(o/30)]||u===1&&["y"]||["yy",u];return a[2]=t,a[3]=e>0,a[4]=n,T.apply({},a)}function C(e,t,n){var r=n-t,i=n-e.day();return i>r&&(i-=7),i<r-7&&(i+=7),Math.ceil(M(e).add("d",i).dayOfYear()/7)}function k(e){var t=e._i,n=e._f;return t===null||t===""?null:(typeof t=="string"&&(e._i=t=p().preparse(t)),M.isMoment(t)?(e=o({},t),e._d=new Date(+t._d)):n?l(n)?E(e):w(e):x(e),new i(e))}function L(e,t){M.fn[e]=M.fn[e+"s"]=function(e){var n=this._isUTC?"UTC":"";return e!=null?(this._d["set"+n+t](e),this):this._d["get"+n+t]()}}function A(e){M.duration.fn[e]=function(){return this._data[e]}}function O(e,t){M.duration.fn["as"+e]=function(){return+this/t}}var M,_="2.0.0",D=Math.round,P,H={},B=typeof module!="undefined"&&module.exports,j=/^\/?Date\((\-?\d+)/i,F=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,I=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,q=/([0-9a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)/gi,R=/\d\d?/,U=/\d{1,3}/,z=/\d{3}/,W=/\d{1,4}/,X=/[+\-]?\d{1,6}/,V=/[0-9]*[a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF]+\s*?[\u0600-\u06FF]+/i,$=/Z|[\+\-]\d\d:?\d\d/i,J=/T/i,K=/[\+\-]?\d+(\.\d{1,3})?/,Q=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,G="YYYY-MM-DDTHH:mm:ssZ",Y=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Z=/([\+\-]|\d\d)/gi,et="Month|Date|Hours|Minutes|Seconds|Milliseconds".split("|"),tt={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},nt={},rt="DDD w W M D d".split(" "),it="M D H h m s w W".split(" "),st={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return a(this.year()%100,2)},YYYY:function(){return a(this.year(),4)},YYYYY:function(){return a(this.year(),5)},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return a(~~(this.milliseconds()/10),2)},SSS:function(){return a(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+a(~~(e/60),2)+":"+a(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+a(~~(10*e/6),4)},X:function(){return this.unix()}};while(rt.length)P=rt.pop(),st[P+"o"]=n(st[P]);while(it.length)P=it.pop(),st[P+P]=t(st[P],2);st.DDDD=t(st.DDD,3),r.prototype={set:function(e){var t,n;for(n in e)t=e[n],typeof t=="function"?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var t,n,r,i;this._monthsParse||(this._monthsParse=[]);for(t=0;t<12;t++){this._monthsParse[t]||(n=M([2e3,t]),r="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[t]=new RegExp(r.replace(".",""),"i"));if(this._monthsParse[t].test(e))return t}},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return typeof n=="function"?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,r){var i=this._relativeTime[n];return typeof i=="function"?i(e,t,n,r):i.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return typeof n=="function"?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return C(e,this._week.dow,this._week.doy)},_week:{dow:0,doy:6}},M=function(e,t,n){return k({_i:e,_f:t,_l:n,_isUTC:!1})},M.utc=function(e,t,n){return k({_useUTC:!0,_isUTC:!0,_l:n,_i:e,_f:t})},M.unix=function(e){return M(e*1e3)},M.duration=function(e,t){var n=M.isDuration(e),r=typeof e=="number",i=n?e._data:r?{}:e,o;return r&&(t?i[t]=e:i.milliseconds=e),o=new s(i),n&&e.hasOwnProperty("_lang")&&(o._lang=e._lang),o},M.version=_,M.defaultFormat=G,M.lang=function(e,t){var n;if(!e)return M.fn._lang._abbr;t?h(e,t):H[e]||p(e),M.duration.fn._lang=M.fn._lang=p(e)},M.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),p(e)},M.isMoment=function(e){return e instanceof i},M.isDuration=function(e){return e instanceof s},M.fn=i.prototype={clone:function(){return M(this)},valueOf:function(){return+this._d},unix:function(){return Math.floor(+this._d/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._d},toJSON:function(){return M.utc(this).format("YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return this._isValid==null&&(this._a?this._isValid=!c(this._a,(this._isUTC?M.utc(this._a):M(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this._isUTC=!0,this},local:function(){return this._isUTC=!1,this},format:function(e){var t=m(this,e||M.defaultFormat);return this.lang().postformat(t)},add:function(e,t){var n;return typeof e=="string"?n=M.duration(+t,e):n=M.duration(e,t),f(this,n,1),this},subtract:function(e,t){var n;return typeof e=="string"?n=M.duration(+t,e):n=M.duration(e,t),f(this,n,-1),this},diff:function(e,t,n){var r=this._isUTC?M(e).utc():M(e).local(),i=(this.zone()-r.zone())*6e4,s,o;return t&&(t=t.replace(/s$/,"")),t==="year"||t==="month"?(s=(this.daysInMonth()+r.daysInMonth())*432e5,o=(this.year()-r.year())*12+(this.month()-r.month()),o+=(this-M(this).startOf("month")-(r-M(r).startOf("month")))/s,t==="year"&&(o/=12)):(s=this-r-i,o=t==="second"?s/1e3:t==="minute"?s/6e4:t==="hour"?s/36e5:t==="day"?s/864e5:t==="week"?s/6048e5:s),n?o:u(o)},from:function(e,t){return M.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!t)},fromNow:function(e){return this.from(M(),e)},calendar:function(){var e=this.diff(M().startOf("day"),"days",!0),t=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(t,this))},isLeapYear:function(){var e=this.year();return e%4===0&&e%100!==0||e%400===0},isDST:function(){return this.zone()<M([this.year()]).zone()||this.zone()<M([this.year(),5]).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return e==null?t:this.add({d:e-t})},startOf:function(e){e=e.replace(/s$/,"");switch(e){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return e==="week"&&this.day(0),this},endOf:function(e){return this.startOf(e).add(e.replace(/s?$/,"s"),1).subtract("ms",1)},isAfter:function(e,t){return t=typeof t!="undefined"?t:"millisecond",+this.clone().startOf(t)>+M(e).startOf(t)},isBefore:function(e,t){return t=typeof t!="undefined"?t:"millisecond",+this.clone().startOf(t)<+M(e).startOf(t)},isSame:function(e,t){return t=typeof t!="undefined"?t:"millisecond",+this.clone().startOf(t)===+M(e).startOf(t)},zone:function(){return this._isUTC?0:this._d.getTimezoneOffset()},daysInMonth:function(){return M.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var t=D((M(this).startOf("day")-M(this).startOf("year"))/864e5)+1;return e==null?t:this.add("d",e-t)},isoWeek:function(e){var t=C(this,1,4);return e==null?t:this.add("d",(e-t)*7)},week:function(e){var t=this.lang().week(this);return e==null?t:this.add("d",(e-t)*7)},lang:function(t){return t===e?this._lang:(this._lang=p(t),this)}};for(P=0;P<et.length;P++)L(et[P].toLowerCase().replace(/s$/,""),et[P]);L("year","FullYear"),M.fn.days=M.fn.day,M.fn.weeks=M.fn.week,M.fn.isoWeeks=M.fn.isoWeek,M.duration.fn=s.prototype={weeks:function(){return u(this.days()/7)},valueOf:function(){return this._milliseconds+this._days*864e5+this._months*2592e6},humanize:function(e){var t=+this,n=N(t,!e,this.lang());return e&&(n=this.lang().pastFuture(t,n)),this.lang().postformat(n)},lang:M.fn.lang};for(P in tt)tt.hasOwnProperty(P)&&(O(P,tt[P]),A(P.toLowerCase()));O("Weeks",6048e5),M.lang("en",{ordinal:function(e){var t=e%10,n=~~(e%100/10)===1?"th":t===1?"st":t===2?"nd":t===3?"rd":"th";return e+n}}),B&&(module.exports=M),typeof ender=="undefined"&&(this.moment=M),typeof define=="function"&&define.amd&&define("moment",[],function(){return M})}.call(this),define("momentjs",function(){}),define("lib/mywash/constructs/map.helpers",["jquery","can","momentjs"],function(e,t){var n={getFormattedDate:function(e,t){var n=e();if(!n)return"";var r=moment(n);return r.format("YYYY-MM-DD")},getFormattedDateTime:function(e,t){var n=e();if(!n)return"";var r=moment(n);return r.format("YYYY-MM-DD hh:mm A")},lower:function(e,t){return e().toLowerCase()},upper:function(e,t){return e().toUpperCase()},capitalize:function(e,t){var n=null;return typeof e=="function"?n=e():typeof e=="string"&&(n=e),n?n.charAt(0).toUpperCase()+n.slice(1):n},ifNot:function(e,t){var n=t.fn,r=t.inverse;return e()?r():n()},isNum:function(e,t){var n=e(),r=t.fn,i=t.inverse;return isNaN(n)?i():r()},isSet:function(e,t){var n=t.fn,r=t.inverse,i=typeof e()!="undefined"?n():r();return i},idFormat:function(e,t){var n=e().toLowerCase(),r=n.split(" ");return r.join("-")},isEmpty:function(e,t){var n=t.fn,r=t.inverse,i=e();if(typeof i=="undefined")return;var s=0,o=i.attr();return i.each(function(e,t){s++}),s==0?n():r()},isNotEmpty:function(t,n){var r=null;typeof t=="object"?r=t:r=t();var i=n.fn,s=n.inverse;if(typeof r=="undefined")return 0;var o=0;return e.each(r.attr(),function(e,t){o++}),o==0?s():i()},ifEqual:function(e,t,n){var r=n.fn,i=n.inverse;return typeof e=="function"&&(e=e()),typeof t=="function"&&(t=t()),e&&e.indexOf(" ")>=0&&(e=e.replace(/ /g,"")),t&&t.indexOf(" ")>=0&&(t=t.replace(/ /g,"")),e==t?r():i()},ifNotEqual:function(e,t,n){var r=n.fn,i=n.inverse;return typeof e=="function"&&(e=e()),typeof t=="function"&&(t=t()),e&&e.indexOf(" ")>=0&&(e=e.replace(/ /g,"")),t&&t.indexOf(" ")>=0&&(t=t.replace(/ /g,"")),e!=t?r():i()},lt:function(e,t,n){var r=n.fn,i=n.inverse;return e()<t?r():i()},gt:function(e,t,n){var r=n.fn,i=n.inverse;return e()>t?r():i()},length:function(e,t){typeof e=="function"&&(e=e());var n=0;return e&&e.each(function(e,t){n++}),n},incr:function(e,t){var e=e();return++e},decr:function(e,t){var e=e();return--e},timeRangeFormat:function(e,t){var n=null,r=null,i=null,s=null,o=null,u=parseInt(e);return u%2==0?(s=u/2+1,o=u/2-1):(s=(u+1)/2,o=s-1),s>12?r=(s-12).toString()+"pm":s==12?r=s.toString()+"pm":r=s.toString()+"am",o>12?i=(o-12).toString()+"pm":o==12?i=o.toString()+"pm":i=o.toString()+"am",i+" - "+r},_timeRange:function(e,t){var n=null,r=null,i=null,s=null,o=null,u=parseInt(e);return u%2==0?(s=u/2+1,o=u/2-1):(s=(u+1)/2,o=s-1),{ceil:s,floor:o}},timeslotBackColor:function(e,t,n){var r=moment(),t=moment(t());return r.format("YYYY-MM-DD")!=t.format("YYYY-MM-DD")?"#FFF5A3":this._timeRange(e).ceil<r.hours()?"#ff6c60":this._timeRange(e).ceil-r.hours()<2?"#FF8134":"#FFF5A3"},currentDate:function(e){var t=moment();return t.format("DD-MM-YYYY hh:mma")},joinList:function(e,t,n){typeof e=="function"&&(e=e());if(e)return e.attr().join(t||",")},jsonify:function(e,t){typeof e=="function"&&(e=e());if(e)return JSON.stringify(e.attr())},getStatusDetails:function(t){var n=null,r=null;t==1?n="order_placed":t==2?n="pickup_complete":t==3?n="delivery_ready":t==4?n="clothes_delivered":t==5?n="order_cancelled":t==6?n="order_rejected":n=t;for(;;){var i=e.map(this.order_status.attr(),function(e,t){return t}).length;if(i)break}return this.order_status.each(function(e,t){e.status.each(function(t,i){t.name_id==n&&(t.color=e.color,r=t)})}),r},startsWith:function(e,t,n){var r=n.fn,i=n.inverse;return typeof e=="function"&&(e=e()),typeof t=="function"&&(t=t()),e.startsWith(t)?r():i()}};return n}),define("app/components/leftSidebar",["jquery","can","../../lib/mywash/constructs/map.helpers"],function(e,t,n){return t.Component.extend({},{tag:"left-sidebar",template:"",scope:{init:function(){t.route.bind(this.bindRoute,this.tabchangeevent)},bindRoute:"sidebarmenu",sidebarMenuItems:[{iconClass:"fa-dashboard",name:"dashboard"},{iconClass:"fa-laptop",name:"orders",submenu:[{name:"all",pane_href:"all-orders"},{name:"pickup"},{name:"tagging"},{name:"packaging/Invoicing",pane_href:"package"},{name:"delivery"},{name:"delivery progress (OFD)",pane_href:"ofd"},{name:"completed"},{name:"canceled/Rejected",pane_href:"cancelled"}]},{iconClass:"fa-cogs",name:"configuration"},{iconClass:"fa-user",name:"users"},{iconClass:"fa-user",name:"vendors"},{iconClass:"fa-plane",name:"logistics",submenu:[{name:"staffs",pane_href:"logistic-staffs"}]}],tabchangeevent:function(t,n){var r=e("#nav-accordion").find("a");r.each(function(){var t=e(this).attr("href").substr(1);t.substr(0,12)=="main-content"&&(t===n?(e(this).parent().addClass("active"),e("#"+t).show()):(e("#"+t).hide(),e(this).parent().removeClass("active")))});if(!e("#"+n+" .tab-buttons label.active").length){var i=e("#"+n+" .tab-buttons label")[0];e(i).trigger("click")}},tabchange:function(n,r,i){i.preventDefault(),t.route.attr(this.bindRoute,e(r).find("a").attr("href").substr(1))}},helpers:e.extend(n,{})})}),define("lib/mywash/components/tabs",["jquery","can"],function(e,t){var n=t.Component.extend({},{tag:"",template:"<content></content>",scope:r}),r=t.Map({tabchangeevent:function(e,t){},tabchange:function(t,n,r){r.preventDefault();var i=e(n).find("input").attr("href").substr(1),s=e('input[href="#'+i+'"]').parents(".btn-group").find("input");s.each(function(){var t=e(this).attr("href").substr(1);t===i?(e(this).parent().addClass("active"),e("#"+t).show()):(e("#"+t).hide(),e(this).parent().removeClass("active"))})},_validateEmail:function(e){var t=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;return t.test(e)},_validatePhone:function(e){var t=/^((\+?91)|(0))?\d{8,12}$/;return t.test(e)},getStatusDetails:function(t){var n=null,r=null;t==1?n="order_placed":t==2?n="pickup_complete":t==3?n="delivery_ready":t==4?n="clothes_delivered":t==5?n="order_cancelled":t==6?n="order_rejected":n=t;for(;;){var i=e.map(this.order_status.attr(),function(e,t){return t}).length;if(i)break}var s=null;if(n=="pickup_failed"||n=="delivery_failed")s="danger";return this.order_status.each(function(e,t){e.status.each(function(t,i){t.name_id==n&&(t.color=s||e.color,r=t)})}),r}});return[n,r]}),define("toastr",["jquery"],function(e){return function(){function t(e,t,n){return d({type:E.error,iconClass:v().iconClasses.error,message:e,optionsOverride:n,title:t})}function n(t,n){return t||(t=v()),g=e("#"+t.containerId),g.length?g:(n&&(g=c(t)),g)}function r(e,t,n){return d({type:E.info,iconClass:v().iconClasses.info,message:e,optionsOverride:n,title:t})}function i(e){y=e}function s(e,t,n){return d({type:E.success,iconClass:v().iconClasses.success,message:e,optionsOverride:n,title:t})}function o(e,t,n){return d({type:E.warning,iconClass:v().iconClasses.warning,message:e,optionsOverride:n,title:t})}function u(e){var t=v();g||n(t),l(e,t)||f(t)}function a(t){var r=v();return g||n(r),t&&0===e(":focus",t).length?void m(t):void (g.children().length&&g.remove())}function f(t){for(var n=g.children(),r=n.length-1;r>=0;r--)l(e(n[r]),t)}function l(t,n){return t&&0===e(":focus",t).length?(t[n.hideMethod]({duration:n.hideDuration,easing:n.hideEasing,complete:function(){m(t)}}),!0):!1}function c(t){return g=e("<div/>").attr("id",t.containerId).addClass(t.positionClass).attr("aria-live","polite").attr("role","alert"),g.appendTo(e(t.target)),g}function h(){return{tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1e3,hideEasing:"swing",onHidden:void 0,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",target:"body",closeHtml:'<button type="button">&times;</button>',newestOnTop:!0,preventDuplicates:!1,progressBar:!1}}function p(e){y&&y(e)}function d(t){function r(t){return!e(":focus",l).length||t?(clearTimeout(E.intervalId),l[u.hideMethod]({duration:u.hideDuration,easing:u.hideEasing,complete:function(){m(l),u.onHidden&&"hidden"!==S.state&&u.onHidden(),S.state="hidden",S.endTime=new Date,p(S)}})):void 0}function i(){(u.timeOut>0||u.extendedTimeOut>0)&&(f=setTimeout(r,u.extendedTimeOut),E.maxHideTime=parseFloat(u.extendedTimeOut),E.hideEta=(new Date).getTime()+E.maxHideTime)}function s(){clearTimeout(f),E.hideEta=0,l.stop(!0,!0)[u.showMethod]({duration:u.showDuration,easing:u.showEasing})}function o(){var e=(E.hideEta-(new Date).getTime())/E.maxHideTime*100;d.width(e+"%")}var u=v(),a=t.iconClass||u.iconClass;if("undefined"!=typeof t.optionsOverride&&(u=e.extend(u,t.optionsOverride),a=t.optionsOverride.iconClass||a),u.preventDuplicates){if(t.message===b)return;b=t.message}w++,g=n(u,!0);var f=null,l=e("<div/>"),c=e("<div/>"),h=e("<div/>"),d=e("<div/>"),y=e(u.closeHtml),E={intervalId:null,hideEta:null,maxHideTime:null},S={toastId:w,state:"visible",startTime:new Date,options:u,map:t};return t.iconClass&&l.addClass(u.toastClass).addClass(a),t.title&&(c.append(t.title).addClass(u.titleClass),l.append(c)),t.message&&(h.append(t.message).addClass(u.messageClass),l.append(h)),u.closeButton&&(y.addClass("toast-close-button").attr("role","button"),l.prepend(y)),u.progressBar&&(d.addClass("toast-progress"),l.prepend(d)),l.hide(),u.newestOnTop?g.prepend(l):g.append(l),l[u.showMethod]({duration:u.showDuration,easing:u.showEasing,complete:u.onShown}),u.timeOut>0&&(f=setTimeout(r,u.timeOut),E.maxHideTime=parseFloat(u.timeOut),E.hideEta=(new Date).getTime()+E.maxHideTime,u.progressBar&&(E.intervalId=setInterval(o,10))),l.hover(s,i),!u.onclick&&u.tapToDismiss&&l.click(r),u.closeButton&&y&&y.click(function(e){e.stopPropagation?e.stopPropagation():void 0!==e.cancelBubble&&e.cancelBubble!==!0&&(e.cancelBubble=!0),r(!0)}),u.onclick&&l.click(function(){u.onclick(),r()}),p(S),u.debug&&console&&console.log(S),l}function v(){return e.extend({},h(),S.options)}function m(e){g||(g=n()),e.is(":visible")||(e.remove(),e=null,0===g.children().length&&(g.remove(),b=void 0))}var g,y,b,w=0,E={error:"error",info:"info",success:"success",warning:"warning"},S={clear:u,remove:a,error:t,getContainer:n,info:r,options:{},subscribe:i,success:s,version:"2.1.0",warning:o};return S}()}),define("nanobar",[],function(){return function(){var e,t,n,r,i,s,o={width:"100%",height:"4px",zIndex:9999,top:"0"},u={width:0,height:"100%",clear:"both",transition:"height .3s"};return e=function(e,t){for(var n in t)e.style[n]=t[n];e.style["float"]="left"},r=function(){var e=this,t=this.width-this.here;.1>t&&-0.1<t?(i.call(this,this.here),this.moving=!1,100==this.width&&(this.el.style.height=0,setTimeout(function(){e.cont.el.removeChild(e.el)},300))):(i.call(this,this.width-t/4),setTimeout(function(){e.go()},16))},i=function(e){this.width=e,this.el.style.width=this.width+"%"},s=function(){var e=new t(this);this.bars.unshift(e)},t=function(t){this.el=document.createElement("div"),this.el.style.backgroundColor=t.opts.bg,this.here=this.width=0,this.moving=!1,this.cont=t,e(this.el,u),t.el.appendChild(this.el)},t.prototype.go=function(e){e?(this.here=e,this.moving||(this.moving=!0,r.call(this))):this.moving&&r.call(this)},n=function(t){t=this.opts=t||{};var n;t.bg=t.bg||"#000",this.bars=[],n=this.el=document.createElement("div"),e(this.el,o),t.id&&(n.id=t.id),n.style.position=t.target?"relative":"fixed",t.target?t.target.insertBefore(n,t.target.firstChild):document.getElementsByTagName("body")[0].appendChild(n),s.call(this)},n.prototype.go=function(e){this.bars[0].go(e),100==e&&s.call(this)},n}()}),function(e,t){function n(){return new Date(Date.UTC.apply(Date,arguments))}function r(){var e=new Date;return n(e.getFullYear(),e.getMonth(),e.getDate())}function i(e,t){return e.getUTCFullYear()===t.getUTCFullYear()&&e.getUTCMonth()===t.getUTCMonth()&&e.getUTCDate()===t.getUTCDate()}function s(e){return function(){return this[e].apply(this,arguments)}}function f(t,n){function u(e,t){return t.toLowerCase()}var r=e(t).data(),i={},s,o=new RegExp("^"+n.toLowerCase()+"([A-Z])");n=new RegExp("^"+n.toLowerCase());for(var a in r)n.test(a)&&(s=a.replace(o,u),i[s]=r[a]);return i}function l(t){var n={};if(!v[t]){t=t.split("-")[0];if(!v[t])return}var r=v[t];return e.each(d,function(e,t){t in r&&(n[t]=r[t])}),n}var o=function(){var t={get:function(e){return this.slice(e)[0]},contains:function(e){var t=e&&e.valueOf();for(var n=0,r=this.length;n<r;n++)if(this[n].valueOf()===t)return n;return-1},remove:function(e){this.splice(e,1)},replace:function(t){if(!t)return;e.isArray(t)||(t=[t]),this.clear(),this.push.apply(this,t)},clear:function(){this.length=0},copy:function(){var e=new o;return e.replace(this),e}};return function(){var n=[];return n.push.apply(n,arguments),e.extend(n,t),n}}(),u=function(t,n){this._process_options(n),this.dates=new o,this.viewDate=this.o.defaultViewDate,this.focusDate=null,this.element=e(t),this.isInline=!1,this.isInput=this.element.is("input"),this.component=this.element.hasClass("date")?this.element.find(".add-on, .input-group-addon, .btn"):!1,this.hasInput=this.component&&this.element.find("input").length,this.component&&this.component.length===0&&(this.component=!1),this.picker=e(m.template),this._buildEvents(),this._attachEvents(),this.isInline?this.picker.addClass("datepicker-inline").appendTo(this.element):this.picker.addClass("datepicker-dropdown dropdown-menu"),this.o.rtl&&this.picker.addClass("datepicker-rtl"),this.viewMode=this.o.startView,this.o.calendarWeeks&&this.picker.find("tfoot .today, tfoot .clear").attr("colspan",function(e,t){return parseInt(t)+1}),this._allow_update=!1,this.setStartDate(this._o.startDate),this.setEndDate(this._o.endDate),this.setDaysOfWeekDisabled(this.o.daysOfWeekDisabled),this.setDatesDisabled(this.o.datesDisabled),this.fillDow(),this.fillMonths(),this._allow_update=!0,this.update(),this.showMode(),this.isInline&&this.show()};u.prototype={constructor:u,_process_options:function(i){this._o=e.extend({},this._o,i);var s=this.o=e.extend({},this._o),o=s.language;v[o]||(o=o.split("-")[0],v[o]||(o=p.language)),s.language=o;switch(s.startView){case 2:case"decade":s.startView=2;break;case 1:case"year":s.startView=1;break;default:s.startView=0}switch(s.minViewMode){case 1:case"months":s.minViewMode=1;break;case 2:case"years":s.minViewMode=2;break;default:s.minViewMode=0}s.startView=Math.max(s.startView,s.minViewMode),s.multidate!==!0&&(s.multidate=Number(s.multidate)||!1,s.multidate!==!1&&(s.multidate=Math.max(0,s.multidate))),s.multidateSeparator=String(s.multidateSeparator),s.weekStart%=7,s.weekEnd=(s.weekStart+6)%7;var u=m.parseFormat(s.format);s.startDate!==-Infinity&&(s.startDate?s.startDate instanceof Date?s.startDate=this._local_to_utc(this._zero_time(s.startDate)):s.startDate=m.parseDate(s.startDate,u,s.language):s.startDate=-Infinity),s.endDate!==Infinity&&(s.endDate?s.endDate instanceof Date?s.endDate=this._local_to_utc(this._zero_time(s.endDate)):s.endDate=m.parseDate(s.endDate,u,s.language):s.endDate=Infinity),s.daysOfWeekDisabled=s.daysOfWeekDisabled||[],e.isArray(s.daysOfWeekDisabled)||(s.daysOfWeekDisabled=s.daysOfWeekDisabled.split(/[,\s]*/)),s.daysOfWeekDisabled=e.map(s.daysOfWeekDisabled,function(e){return parseInt(e,10)}),s.datesDisabled=s.datesDisabled||[];if(!e.isArray(s.datesDisabled)){var a=[];a.push(m.parseDate(s.datesDisabled,u,s.language)),s.datesDisabled=a}s.datesDisabled=e.map(s.datesDisabled,function(e){return m.parseDate(e,u,s.language)});var f=String(s.orientation).toLowerCase().split(/\s+/g),l=s.orientation.toLowerCase();f=e.grep(f,function(e){return/^auto|left|right|top|bottom$/.test(e)}),s.orientation={x:"auto",y:"auto"};if(!!l&&l!=="auto")if(f.length===1)switch(f[0]){case"top":case"bottom":s.orientation.y=f[0];break;case"left":case"right":s.orientation.x=f[0]}else l=e.grep(f,function(e){return/^left|right$/.test(e)}),s.orientation.x=l[0]||"auto",l=e.grep(f,function(e){return/^top|bottom$/.test(e)}),s.orientation.y=l[0]||"auto";if(s.defaultViewDate){var c=s.defaultViewDate.year||(new Date).getFullYear(),h=s.defaultViewDate.month||0,d=s.defaultViewDate.day||1;s.defaultViewDate=n(c,h,d)}else s.defaultViewDate=r();s.showOnFocus=s.showOnFocus!==t?s.showOnFocus:!0},_events:[],_secondaryEvents:[],_applyEvents:function(e){for(var n=0,r,i,s;n<e.length;n++)r=e[n][0],e[n].length===2?(i=t,s=e[n][1]):e[n].length===3&&(i=e[n][1],s=e[n][2]),r.on(s,i)},_unapplyEvents:function(e){for(var n=0,r,i,s;n<e.length;n++)r=e[n][0],e[n].length===2?(s=t,i=e[n][1]):e[n].length===3&&(s=e[n][1],i=e[n][2]),r.off(i,s)},_buildEvents:function(){var t={keyup:e.proxy(function(t){e.inArray(t.keyCode,[27,37,39,38,40,32,13,9])===-1&&this.update()},this),keydown:e.proxy(this.keydown,this)};this.o.showOnFocus===!0&&(t.focus=e.proxy(this.show,this)),this.isInput?this._events=[[this.element,t]]:this.component&&this.hasInput?this._events=[[this.element.find("input"),t],[this.component,{click:e.proxy(this.show,this)}]]:this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:e.proxy(this.show,this)}]],this._events.push([this.element,"*",{blur:e.proxy(function(e){this._focused_from=e.target},this)}],[this.element,{blur:e.proxy(function(e){this._focused_from=e.target},this)}]),this._secondaryEvents=[[this.picker,{click:e.proxy(this.click,this)}],[e(window),{resize:e.proxy(this.place,this)}],[e(document),{"mousedown touchstart":e.proxy(function(e){this.element.is(e.target)||this.element.find(e.target).length||this.picker.is(e.target)||this.picker.find(e.target).length||this.hide()},this)}]]},_attachEvents:function(){this._detachEvents(),this._applyEvents(this._events)},_detachEvents:function(){this._unapplyEvents(this._events)},_attachSecondaryEvents:function(){this._detachSecondaryEvents(),this._applyEvents(this._secondaryEvents)},_detachSecondaryEvents:function(){this._unapplyEvents(this._secondaryEvents)},_trigger:function(t,n){var r=n||this.dates.get(-1),i=this._utc_to_local(r);this.element.trigger({type:t,date:i,dates:e.map(this.dates,this._utc_to_local),format:e.proxy(function(e,t){arguments.length===0?(e=this.dates.length-1,t=this.o.format):typeof e=="string"&&(t=e,e=this.dates.length-1),t=t||this.o.format;var n=this.dates.get(e);return m.formatDate(n,t,this.o.language)},this)})},show:function(){if(this.element.attr("readonly")&&this.o.enableOnReadonly===!1)return;return this.isInline||this.picker.appendTo(this.o.container),this.place(),this.picker.show(),this._attachSecondaryEvents(),this._trigger("show"),(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&this.o.disableTouchKeyboard&&e(this.element).blur(),this},hide:function(){return this.isInline?this:this.picker.is(":visible")?(this.focusDate=null,this.picker.hide().detach(),this._detachSecondaryEvents(),this.viewMode=this.o.startView,this.showMode(),this.o.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this._trigger("hide"),this):this},remove:function(){return this.hide(),this._detachEvents(),this._detachSecondaryEvents(),this.picker.remove(),delete this.element.data().datepicker,this.isInput||delete this.element.data().date,this},_utc_to_local:function(e){return e&&new Date(e.getTime()+e.getTimezoneOffset()*6e4)},_local_to_utc:function(e){return e&&new Date(e.getTime()-e.getTimezoneOffset()*6e4)},_zero_time:function(e){return e&&new Date(e.getFullYear(),e.getMonth(),e.getDate())},_zero_utc_time:function(e){return e&&new Date(Date.UTC(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()))},getDates:function(){return e.map(this.dates,this._utc_to_local)},getUTCDates:function(){return e.map(this.dates,function(e){return new Date(e)})},getDate:function(){return this._utc_to_local(this.getUTCDate())},getUTCDate:function(){var e=this.dates.get(-1);return typeof e!="undefined"?new Date(e):null},clearDates:function(){var e;this.isInput?e=this.element:this.component&&(e=this.element.find("input")),e&&e.val("").change(),this.update(),this._trigger("changeDate"),this.o.autoclose&&this.hide()},setDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,t),this._trigger("changeDate"),this.setValue(),this},setUTCDates:function(){var t=e.isArray(arguments[0])?arguments[0]:arguments;return this.update.apply(this,e.map(t,this._utc_to_local)),this._trigger("changeDate"),this.setValue(),this},setDate:s("setDates"),setUTCDate:s("setUTCDates"),setValue:function(){var e=this.getFormattedDate();return this.isInput?this.element.val(e).change():this.component&&this.element.find("input").val(e).change(),this},getFormattedDate:function(n){n===t&&(n=this.o.format);var r=this.o.language;return e.map(this.dates,function(e){return m.formatDate(e,n,r)}).join(this.o.multidateSeparator)},setStartDate:function(e){return this._process_options({startDate:e}),this.update(),this.updateNavArrows(),this},setEndDate:function(e){return this._process_options({endDate:e}),this.update(),this.updateNavArrows(),this},setDaysOfWeekDisabled:function(e){return this._process_options({daysOfWeekDisabled:e}),this.update(),this.updateNavArrows(),this},setDatesDisabled:function(e){this._process_options({datesDisabled:e}),this.update(),this.updateNavArrows()},place:function(){if(this.isInline)return this;var t=this.picker.outerWidth(),n=this.picker.outerHeight(),r=10,i=e(this.o.container).width(),s=e(this.o.container).height(),o=e(this.o.container).scrollTop(),u=e(this.o.container).offset(),a=[];this.element.parents().each(function(){var t=e(this).css("z-index");t!=="auto"&&t!==0&&a.push(parseInt(t))});var f=Math.max.apply(Math,a)+10,l=this.component?this.component.parent().offset():this.element.offset(),c=this.component?this.component.outerHeight(!0):this.element.outerHeight(!1),h=this.component?this.component.outerWidth(!0):this.element.outerWidth(!1),p=l.left-u.left,d=l.top-u.top;this.picker.removeClass("datepicker-orient-top datepicker-orient-bottom datepicker-orient-right datepicker-orient-left"),this.o.orientation.x!=="auto"?(this.picker.addClass("datepicker-orient-"+this.o.orientation.x),this.o.orientation.x==="right"&&(p-=t-h)):l.left<0?(this.picker.addClass("datepicker-orient-left"),p-=l.left-r):p+t>i?(this.picker.addClass("datepicker-orient-right"),p=l.left+h-t):this.picker.addClass("datepicker-orient-left");var v=this.o.orientation.y,m,g;v==="auto"&&(m=-o+d-n,g=o+s-(d+c+n),Math.max(m,g)===g?v="top":v="bottom"),this.picker.addClass("datepicker-orient-"+v),v==="top"?d+=c:d-=n+parseInt(this.picker.css("padding-top"));if(this.o.rtl){var y=i-(p+h);this.picker.css({top:d,right:y,zIndex:f})}else this.picker.css({top:d,left:p,zIndex:f});return this},_allow_update:!0,update:function(){if(!this._allow_update)return this;var t=this.dates.copy(),n=[],r=!1;return arguments.length?(e.each(arguments,e.proxy(function(e,t){t instanceof Date&&(t=this._local_to_utc(t)),n.push(t)},this)),r=!0):(n=this.isInput?this.element.val():this.element.data("date")||this.element.find("input").val(),n&&this.o.multidate?n=n.split(this.o.multidateSeparator):n=[n],delete this.element.data().date),n=e.map(n,e.proxy(function(e){return m.parseDate(e,this.o.format,this.o.language)},this)),n=e.grep(n,e.proxy(function(e){return e<this.o.startDate||e>this.o.endDate||!e},this),!0),this.dates.replace(n),this.dates.length?this.viewDate=new Date(this.dates.get(-1)):this.viewDate<this.o.startDate?this.viewDate=new Date(this.o.startDate):this.viewDate>this.o.endDate&&(this.viewDate=new Date(this.o.endDate)),r?this.setValue():n.length&&String(t)!==String(this.dates)&&this._trigger("changeDate"),!this.dates.length&&t.length&&this._trigger("clearDate"),this.fill(),this},fillDow:function(){var e=this.o.weekStart,t="<tr>";if(this.o.calendarWeeks){this.picker.find(".datepicker-days thead tr:first-child .datepicker-switch").attr("colspan",function(e,t){return parseInt(t)+1});var n='<th class="cw">&#160;</th>';t+=n}while(e<this.o.weekStart+7)t+='<th class="dow">'+v[this.o.language].daysMin[e++%7]+"</th>";t+="</tr>",this.picker.find(".datepicker-days thead").append(t)},fillMonths:function(){var e="",t=0;while(t<12)e+='<span class="month">'+v[this.o.language].monthsShort[t++]+"</span>";this.picker.find(".datepicker-months td").html(e)},setRange:function(t){!t||!t.length?delete this.range:this.range=e.map(t,function(e){return e.valueOf()}),this.fill()},getClassNames:function(t){var n=[],r=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),o=new Date;return t.getUTCFullYear()<r||t.getUTCFullYear()===r&&t.getUTCMonth()<s?n.push("old"):(t.getUTCFullYear()>r||t.getUTCFullYear()===r&&t.getUTCMonth()>s)&&n.push("new"),this.focusDate&&t.valueOf()===this.focusDate.valueOf()&&n.push("focused"),this.o.todayHighlight&&t.getUTCFullYear()===o.getFullYear()&&t.getUTCMonth()===o.getMonth()&&t.getUTCDate()===o.getDate()&&n.push("today"),this.dates.contains(t)!==-1&&n.push("active"),(t.valueOf()<this.o.startDate||t.valueOf()>this.o.endDate||e.inArray(t.getUTCDay(),this.o.daysOfWeekDisabled)!==-1)&&n.push("disabled"),this.o.datesDisabled.length>0&&e.grep(this.o.datesDisabled,function(e){return i(t,e)}).length>0&&n.push("disabled","disabled-date"),this.range&&(t>this.range[0]&&t<this.range[this.range.length-1]&&n.push("range"),e.inArray(t.valueOf(),this.range)!==-1&&n.push("selected")),n},fill:function(){var r=new Date(this.viewDate),i=r.getUTCFullYear(),s=r.getUTCMonth(),o=this.o.startDate!==-Infinity?this.o.startDate.getUTCFullYear():-Infinity,u=this.o.startDate!==-Infinity?this.o.startDate.getUTCMonth():-Infinity,a=this.o.endDate!==Infinity?this.o.endDate.getUTCFullYear():Infinity,f=this.o.endDate!==Infinity?this.o.endDate.getUTCMonth():Infinity,l=v[this.o.language].today||v.en.today||"",c=v[this.o.language].clear||v.en.clear||"",h;if(isNaN(i)||isNaN(s))return;this.picker.find(".datepicker-days thead .datepicker-switch").text(v[this.o.language].months[s]+" "+i),this.picker.find("tfoot .today").text(l).toggle(this.o.todayBtn!==!1),this.picker.find("tfoot .clear").text(c).toggle(this.o.clearBtn!==!1),this.updateNavArrows(),this.fillMonths();var p=n(i,s-1,28),d=m.getDaysInMonth(p.getUTCFullYear(),p.getUTCMonth());p.setUTCDate(d),p.setUTCDate(d-(p.getUTCDay()-this.o.weekStart+7)%7);var g=new Date(p);g.setUTCDate(g.getUTCDate()+42),g=g.valueOf();var y=[],b;while(p.valueOf()<g){if(p.getUTCDay()===this.o.weekStart){y.push("<tr>");if(this.o.calendarWeeks){var w=new Date(+p+(this.o.weekStart-p.getUTCDay()-7)%7*864e5),E=new Date(Number(w)+(11-w.getUTCDay())%7*864e5),S=new Date(Number(S=n(E.getUTCFullYear(),0,1))+(11-S.getUTCDay())%7*864e5),x=(E-S)/864e5/7+1;y.push('<td class="cw">'+x+"</td>")}}b=this.getClassNames(p),b.push("day");if(this.o.beforeShowDay!==e.noop){var T=this.o.beforeShowDay(this._utc_to_local(p));T===t?T={}:typeof T=="boolean"?T={enabled:T}:typeof T=="string"&&(T={classes:T}),T.enabled===!1&&b.push("disabled"),T.classes&&(b=b.concat(T.classes.split(/\s+/))),T.tooltip&&(h=T.tooltip)}b=e.unique(b),y.push('<td class="'+b.join(" ")+'"'+(h?' title="'+h+'"':"")+">"+p.getUTCDate()+"</td>"),h=null,p.getUTCDay()===this.o.weekEnd&&y.push("</tr>"),p.setUTCDate(p.getUTCDate()+1)}this.picker.find(".datepicker-days tbody").empty().append(y.join(""));var N=this.picker.find(".datepicker-months").find("th:eq(1)").text(i).end().find("span").removeClass("active");e.each(this.dates,function(e,t){t.getUTCFullYear()===i&&N.eq(t.getUTCMonth()).addClass("active")}),(i<o||i>a)&&N.addClass("disabled"),i===o&&N.slice(0,u).addClass("disabled"),i===a&&N.slice(f+1).addClass("disabled");if(this.o.beforeShowMonth!==e.noop){var C=this;e.each(N,function(t,n){if(!e(n).hasClass("disabled")){var r=new Date(i,t,1),s=C.o.beforeShowMonth(r);s===!1&&e(n).addClass("disabled")}})}y="",i=parseInt(i/10,10)*10;var k=this.picker.find(".datepicker-years").find("th:eq(1)").text(i+"-"+(i+9)).end().find("td");i-=1;var L=e.map(this.dates,function(e){return e.getUTCFullYear()}),A;for(var O=-1;O<11;O++)A=["year"],O===-1?A.push("old"):O===10&&A.push("new"),e.inArray(i,L)!==-1&&A.push("active"),(i<o||i>a)&&A.push("disabled"),y+='<span class="'+A.join(" ")+'">'+i+"</span>",i+=1;k.html(y)},updateNavArrows:function(){if(!this._allow_update)return;var e=new Date(this.viewDate),t=e.getUTCFullYear(),n=e.getUTCMonth();switch(this.viewMode){case 0:this.o.startDate!==-Infinity&&t<=this.o.startDate.getUTCFullYear()&&n<=this.o.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==Infinity&&t>=this.o.endDate.getUTCFullYear()&&n>=this.o.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:case 2:this.o.startDate!==-Infinity&&t<=this.o.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.o.endDate!==Infinity&&t>=this.o.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},click:function(t){t.preventDefault();var r=e(t.target).closest("span, td, th"),i,s,o;if(r.length===1)switch(r[0].nodeName.toLowerCase()){case"th":switch(r[0].className){case"datepicker-switch":this.showMode(1);break;case"prev":case"next":var u=m.modes[this.viewMode].navStep*(r[0].className==="prev"?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveMonth(this.viewDate,u),this._trigger("changeMonth",this.viewDate);break;case 1:case 2:this.viewDate=this.moveYear(this.viewDate,u),this.viewMode===1&&this._trigger("changeYear",this.viewDate)}this.fill();break;case"today":var a=new Date;a=n(a.getFullYear(),a.getMonth(),a.getDate(),0,0,0),this.showMode(-2);var f=this.o.todayBtn==="linked"?null:"view";this._setDate(a,f);break;case"clear":this.clearDates()}break;case"span":r.hasClass("disabled")||(this.viewDate.setUTCDate(1),r.hasClass("month")?(o=1,s=r.parent().find("span").index(r),i=this.viewDate.getUTCFullYear(),this.viewDate.setUTCMonth(s),this._trigger("changeMonth",this.viewDate),this.o.minViewMode===1&&this._setDate(n(i,s,o))):(o=1,s=0,i=parseInt(r.text(),10)||0,this.viewDate.setUTCFullYear(i),this._trigger("changeYear",this.viewDate),this.o.minViewMode===2&&this._setDate(n(i,s,o))),this.showMode(-1),this.fill());break;case"td":r.hasClass("day")&&!r.hasClass("disabled")&&(o=parseInt(r.text(),10)||1,i=this.viewDate.getUTCFullYear(),s=this.viewDate.getUTCMonth(),r.hasClass("old")?s===0?(s=11,i-=1):s-=1:r.hasClass("new")&&(s===11?(s=0,i+=1):s+=1),this._setDate(n(i,s,o)))}this.picker.is(":visible")&&this._focused_from&&e(this._focused_from).focus(),delete this._focused_from},_toggle_multidate:function(e){var t=this.dates.contains(e);e||this.dates.clear(),t!==-1?(this.o.multidate===!0||this.o.multidate>1||this.o.toggleActive)&&this.dates.remove(t):this.o.multidate===!1?(this.dates.clear(),this.dates.push(e)):this.dates.push(e);if(typeof this.o.multidate=="number")while(this.dates.length>this.o.multidate)this.dates.remove(0)},_setDate:function(e,t){(!t||t==="date")&&this._toggle_multidate(e&&new Date(e));if(!t||t==="view")this.viewDate=e&&new Date(e);this.fill(),this.setValue(),(!t||t!=="view")&&this._trigger("changeDate");var n;this.isInput?n=this.element:this.component&&(n=this.element.find("input")),n&&n.change(),this.o.autoclose&&(!t||t==="date")&&this.hide()},moveMonth:function(e,n){if(!e)return t;if(!n)return e;var r=new Date(e.valueOf()),i=r.getUTCDate(),s=r.getUTCMonth(),o=Math.abs(n),u,a;n=n>0?1:-1;if(o===1){a=n===-1?function(){return r.getUTCMonth()===s}:function(){return r.getUTCMonth()!==u},u=s+n,r.setUTCMonth(u);if(u<0||u>11)u=(u+12)%12}else{for(var f=0;f<o;f++)r=this.moveMonth(r,n);u=r.getUTCMonth(),r.setUTCDate(i),a=function(){return u!==r.getUTCMonth()}}while(a())r.setUTCDate(--i),r.setUTCMonth(u);return r},moveYear:function(e,t){return this.moveMonth(e,t*12)},dateWithinRange:function(e){return e>=this.o.startDate&&e<=this.o.endDate},keydown:function(e){if(!this.picker.is(":visible")){e.keyCode===27&&this.show();return}var t=!1,n,i,s,o=this.focusDate||this.viewDate;switch(e.keyCode){case 27:this.focusDate?(this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill()):this.hide(),e.preventDefault();break;case 37:case 39:if(!this.o.keyboardNavigation)break;n=e.keyCode===37?-1:1,e.ctrlKey?(i=this.moveYear(this.dates.get(-1)||r(),n),s=this.moveYear(o,n),this._trigger("changeYear",this.viewDate)):e.shiftKey?(i=this.moveMonth(this.dates.get(-1)||r(),n),s=this.moveMonth(o,n),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||r()),i.setUTCDate(i.getUTCDate()+n),s=new Date(o),s.setUTCDate(o.getUTCDate()+n)),this.dateWithinRange(s)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),e.preventDefault());break;case 38:case 40:if(!this.o.keyboardNavigation)break;n=e.keyCode===38?-1:1,e.ctrlKey?(i=this.moveYear(this.dates.get(-1)||r(),n),s=this.moveYear(o,n),this._trigger("changeYear",this.viewDate)):e.shiftKey?(i=this.moveMonth(this.dates.get(-1)||r(),n),s=this.moveMonth(o,n),this._trigger("changeMonth",this.viewDate)):(i=new Date(this.dates.get(-1)||r()),i.setUTCDate(i.getUTCDate()+n*7),s=new Date(o),s.setUTCDate(o.getUTCDate()+n*7)),this.dateWithinRange(s)&&(this.focusDate=this.viewDate=s,this.setValue(),this.fill(),e.preventDefault());break;case 32:break;case 13:o=this.focusDate||this.dates.get(-1)||this.viewDate,this.o.keyboardNavigation&&(this._toggle_multidate(o),t=!0),this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.setValue(),this.fill(),this.picker.is(":visible")&&(e.preventDefault(),typeof e.stopPropagation=="function"?e.stopPropagation():e.cancelBubble=!0,this.o.autoclose&&this.hide());break;case 9:this.focusDate=null,this.viewDate=this.dates.get(-1)||this.viewDate,this.fill(),this.hide()}if(t){this.dates.length?this._trigger("changeDate"):this._trigger("clearDate");var u;this.isInput?u=this.element:this.component&&(u=this.element.find("input")),u&&u.change()}},showMode:function(e){e&&(this.viewMode=Math.max(this.o.minViewMode,Math.min(2,this.viewMode+e))),this.picker.children("div").hide().filter(".datepicker-"+m.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()}};var a=function(t,n){this.element=e(t),this.inputs=e.map(n.inputs,function(e){return e.jquery?e[0]:e}),delete n.inputs,h.call(e(this.inputs),n).bind("changeDate",e.proxy(this.dateUpdated,this)),this.pickers=e.map(this.inputs,function(t){return e(t).data("datepicker")}),this.updateDates()};a.prototype={updateDates:function(){this.dates=e.map(this.pickers,function(e){return e.getUTCDate()}),this.updateRanges()},updateRanges:function(){var t=e.map(this.dates,function(e){return e.valueOf()});e.each(this.pickers,function(e,n){n.setRange(t)})},dateUpdated:function(t){if(this.updating)return;this.updating=!0;var n=e(t.target).data("datepicker"),r=n.getUTCDate(),i=e.inArray(t.target,this.inputs),s=i-1,o=i+1,u=this.inputs.length;if(i===-1)return;e.each(this.pickers,function(e,t){t.getUTCDate()||t.setUTCDate(r)});if(r<this.dates[s])while(s>=0&&r<this.dates[s])this.pickers[s--].setUTCDate(r);else if(r>this.dates[o])while(o<u&&r>this.dates[o])this.pickers[o++].setUTCDate(r);this.updateDates(),delete this.updating},remove:function(){e.map(this.pickers,function(e){e.remove()}),delete this.element.data().datepicker}};var c=e.fn.datepicker,h=function(n){var r=Array.apply(null,arguments);r.shift();var i;return this.each(function(){var s=e(this),o=s.data("datepicker"),c=typeof n=="object"&&n;if(!o){var h=f(this,"date"),d=e.extend({},p,h,c),v=l(d.language),m=e.extend({},p,v,h,c);if(s.hasClass("input-daterange")||m.inputs){var g={inputs:m.inputs||s.find("input").toArray()};s.data("datepicker",o=new a(this,e.extend(m,g)))}else s.data("datepicker",o=new u(this,m))}if(typeof n=="string"&&typeof o[n]=="function"){i=o[n].apply(o,r);if(i!==t)return!1}}),i!==t?i:this};e.fn.datepicker=h;var p=e.fn.datepicker.defaults={autoclose:!1,beforeShowDay:e.noop,beforeShowMonth:e.noop,calendarWeeks:!1,clearBtn:!1,toggleActive:!1,daysOfWeekDisabled:[],datesDisabled:[],endDate:Infinity,forceParse:!0,format:"mm/dd/yyyy",keyboardNavigation:!0,language:"en",minViewMode:0,multidate:!1,multidateSeparator:",",orientation:"auto",rtl:!1,startDate:-Infinity,startView:0,todayBtn:!1,todayHighlight:!1,weekStart:0,disableTouchKeyboard:!1,enableOnReadonly:!0,container:"body"},d=e.fn.datepicker.locale_opts=["format","rtl","weekStart"];e.fn.datepicker.Constructor=u;var v=e.fn.datepicker.dates={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa","Su"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear"}},m={modes:[{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(e){return e%4===0&&e%100!==0||e%400===0},getDaysInMonth:function(e,t){return[31,m.isLeapYear(e)?29:28,31,30,31,30,31,31,30,31,30,31][t]},validParts:/dd?|DD?|mm?|MM?|yy(?:yy)?/g,nonpunctuation:/[^ -\/:-@\[\u3400-\u9fff-`{-~\t\n\r]+/g,parseFormat:function(e){var t=e.replace(this.validParts,"\0").split("\0"),n=e.match(this.validParts);if(!t||!t.length||!n||n.length===0)throw new Error("Invalid date format.");return{separators:t,parts:n}},parseDate:function(r,i,s){function w(){var e=this.slice(0,a[c].length),t=a[c].slice(0,e.length);return e.toLowerCase()===t.toLowerCase()}if(!r)return t;if(r instanceof Date)return r;typeof i=="string"&&(i=m.parseFormat(i));var o=/([\-+]\d+)([dmwy])/,a=r.match(/([\-+]\d+)([dmwy])/g),f,l,c;if(/^[\-+]\d+[dmwy]([\s,]+[\-+]\d+[dmwy])*$/.test(r)){r=new Date;for(c=0;c<a.length;c++){f=o.exec(a[c]),l=parseInt(f[1]);switch(f[2]){case"d":r.setUTCDate(r.getUTCDate()+l);break;case"m":r=u.prototype.moveMonth.call(u.prototype,r,l);break;case"w":r.setUTCDate(r.getUTCDate()+l*7);break;case"y":r=u.prototype.moveYear.call(u.prototype,r,l)}}return n(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),0,0,0)}a=r&&r.match(this.nonpunctuation)||[],r=new Date;var h={},p=["yyyy","yy","M","MM","m","mm","d","dd"],d={yyyy:function(e,t){return e.setUTCFullYear(t)},yy:function(e,t){return e.setUTCFullYear(2e3+t)},m:function(e,t){if(isNaN(e))return e;t-=1;while(t<0)t+=12;t%=12,e.setUTCMonth(t);while(e.getUTCMonth()!==t)e.setUTCDate(e.getUTCDate()-1);return e},d:function(e,t){return e.setUTCDate(t)}},g,y;d.M=d.MM=d.mm=d.m,d.dd=d.d,r=n(r.getFullYear(),r.getMonth(),r.getDate(),0,0,0);var b=i.parts.slice();a.length!==b.length&&(b=e(b).filter(function(t,n){return e.inArray(n,p)!==-1}).toArray());if(a.length===b.length){var E;for(c=0,E=b.length;c<E;c++){g=parseInt(a[c],10),f=b[c];if(isNaN(g))switch(f){case"MM":y=e(v[s].months).filter(w),g=e.inArray(y[0],v[s].months)+1;break;case"M":y=e(v[s].monthsShort).filter(w),g=e.inArray(y[0],v[s].monthsShort)+1}h[f]=g}var S,x;for(c=0;c<p.length;c++)x=p[c],x in h&&!isNaN(h[x])&&(S=new Date(r),d[x](S,h[x]),isNaN(S)||(r=S))}return r},formatDate:function(t,n,r){if(!t)return"";typeof n=="string"&&(n=m.parseFormat(n));var i={d:t.getUTCDate(),D:v[r].daysShort[t.getUTCDay()],DD:v[r].days[t.getUTCDay()],m:t.getUTCMonth()+1,M:v[r].monthsShort[t.getUTCMonth()],MM:v[r].months[t.getUTCMonth()],yy:t.getUTCFullYear().toString().substring(2),yyyy:t.getUTCFullYear()};i.dd=(i.d<10?"0":"")+i.d,i.mm=(i.m<10?"0":"")+i.m,t=[];var s=e.extend([],n.separators);for(var o=0,u=n.parts.length;o<=u;o++)s.length&&t.push(s.shift()),t.push(i[n.parts[o]]);return t.join("")},headTemplate:'<thead><tr><th class="prev">&#171;</th><th colspan="5" class="datepicker-switch"></th><th class="next">&#187;</th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr><tr><th colspan="7" class="clear"></th></tr></tfoot>'};m.template='<div class="datepicker"><div class="datepicker-days"><table class=" table-condensed">'+m.headTemplate+"<tbody></tbody>"+m.footTemplate+"</table>"+"</div>"+'<div class="datepicker-months">'+'<table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+"</table>"+"</div>"+'<div class="datepicker-years">'+'<table class="table-condensed">'+m.headTemplate+m.contTemplate+m.footTemplate+"</table>"+"</div>"+"</div>",e.fn.datepicker.DPGlobal=m,e.fn.datepicker.noConflict=function(){return e.fn.datepicker=c,this},e.fn.datepicker.version="1.4.0",e(document).on("focus.datepicker.data-api click.datepicker.data-api",'[data-provide="datepicker"]',function(t){var n=e(this);if(n.data("datepicker"))return;t.preventDefault(),h.call(n,"show")}),e(function(){h.call(e('[data-provide="datepicker-inline"]'))})}(window.jQuery),define("datepicker",["jquery"],function(){}),!function(e){"function"==typeof define&&define.amd?define("summernote",["jquery"],e):e(window.jQuery)}(function(e){"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(e,t){var n,r,i=this.length>>>0,s=!1;for(1<arguments.length&&(r=t,s=!0),n=0;i>n;++n)this.hasOwnProperty(n)&&(s?r=e(r,this[n],n,this):(r=this[n],s=!0));if(!s)throw new TypeError("Reduce of empty array with no initial value");return r}),"function"!=typeof Array.prototype.filter&&(Array.prototype.filter=function(e){if(void 0===this||null===this)throw new TypeError;var t=Object(this),n=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var r=[],i=arguments.length>=2?arguments[1]:void 0,s=0;n>s;s++)if(s in t){var o=t[s];e.call(i,o,s,t)&&r.push(o)}return r});var t,n="function"==typeof define&&define.amd,r=function(t){var n="Comic Sans MS"===t?"Courier New":"Comic Sans MS",r=e("<div>").css({position:"absolute",left:"-9999px",top:"-9999px",fontSize:"200px"}).text("mmmmmmmmmwwwwwww").appendTo(document.body),i=r.css("fontFamily",n).width(),s=r.css("fontFamily",t+","+n).width();return r.remove(),i!==s},i={isMac:navigator.appVersion.indexOf("Mac")>-1,isMSIE:navigator.userAgent.indexOf("MSIE")>-1||navigator.userAgent.indexOf("Trident")>-1,isFF:navigator.userAgent.indexOf("Firefox")>-1,jqueryVersion:parseFloat(e.fn.jquery),isSupportAmd:n,hasCodeMirror:n?require.specified("CodeMirror"):!!window.CodeMirror,isFontInstalled:r,isW3CRangeSupport:!!document.createRange},s=function(){var t=function(e){return function(t){return e===t}},n=function(e,t){return e===t},r=function(e){return function(t,n){return t[e]===n[e]}},i=function(){return!0},s=function(){return!1},o=function(e){return function(){return!e.apply(e,arguments)}},u=function(e,t){return function(n){return e(n)&&t(n)}},a=function(e){return e},f=0,l=function(e){var t=++f+"";return e?e+t:t},c=function(t){var n=e(document);return{top:t.top+n.scrollTop(),left:t.left+n.scrollLeft(),width:t.right-t.left,height:t.bottom-t.top}},h=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t};return{eq:t,eq2:n,peq2:r,ok:i,fail:s,self:a,not:o,and:u,uniqueId:l,rect2bnd:c,invertObject:h}}(),o=function(){var t=function(e){return e[0]},n=function(e){return e[e.length-1]},r=function(e){return e.slice(0,e.length-1)},i=function(e){return e.slice(1)},o=function(e,t){for(var n=0,r=e.length;r>n;n++){var i=e[n];if(t(i))return i}},u=function(e,t){for(var n=0,r=e.length;r>n;n++)if(!t(e[n]))return!1;return!0},a=function(t,n){return-1!==e.inArray(n,t)},f=function(e,t){return t=t||s.self,e.reduce(function(e,n){return e+t(n)},0)},l=function(e){for(var t=[],n=-1,r=e.length;++n<r;)t[n]=e[n];return t},c=function(e,r){if(!e.length)return[];var s=i(e);return s.reduce(function(e,t){var i=n(e);return r(n(i),t)?i[i.length]=t:e[e.length]=[t],e},[[t(e)]])},h=function(e){for(var t=[],n=0,r=e.length;r>n;n++)e[n]&&t.push(e[n]);return t},p=function(e){for(var t=[],n=0,r=e.length;r>n;n++)a(t,e[n])||t.push(e[n]);return t},d=function(e,t){var n=e.indexOf(t);return-1===n?null:e[n+1]},v=function(e,t){var n=e.indexOf(t);return-1===n?null:e[n-1]};return{head:t,last:n,initial:r,tail:i,prev:v,next:d,find:o,contains:a,all:u,sum:f,from:l,clusterBy:c,compact:h,unique:p}}(),u=String.fromCharCode(160),a="﻿",f=function(){var t=function(t){return t&&e(t).hasClass("note-editable")},n=function(t){return t&&e(t).hasClass("note-control-sizing")},r=function(t){var n;if(t.hasClass("note-air-editor")){var r=o.last(t.attr("id").split("-"));return n=function(t){return function(){return e(t+r)}},{editor:function(){return t},editable:function(){return t},popover:n("#note-popover-"),handle:n("#note-handle-"),dialog:n("#note-dialog-")}}return n=function(e){return function(){return t.find(e)}},{editor:function(){return t},dropzone:n(".note-dropzone"),toolbar:n(".note-toolbar"),editable:n(".note-editable"),codable:n(".note-codable"),statusbar:n(".note-statusbar"),popover:n(".note-popover"),handle:n(".note-handle"),dialog:n(".note-dialog")}},l=function(e){return e=e.toUpperCase(),function(t){return t&&t.nodeName.toUpperCase()===e}},c=function(e){return e&&3===e.nodeType},h=function(e){return e&&/^BR|^IMG|^HR/.test(e.nodeName.toUpperCase())},p=function(e){return t(e)?!1:e&&/^DIV|^P|^LI|^H[1-7]/.test(e.nodeName.toUpperCase())},d=l("LI"),v=function(e){return p(e)&&!d(e)},m=function(e){return!w(e)&&!g(e)&&!p(e)},g=function(e){return e&&/^UL|^OL/.test(e.nodeName.toUpperCase())},y=function(e){return e&&/^TD|^TH/.test(e.nodeName.toUpperCase())},b=l("BLOCKQUOTE"),w=function(e){return y(e)||b(e)||t(e)},E=l("A"),S=function(e){return m(e)&&!!A(e,p)},x=function(e){return m(e)&&!A(e,p)},T=l("BODY"),N=i.isMSIE?"&nbsp;":"<br>",C=function(e){return c(e)?e.nodeValue.length:e.childNodes.length},k=function(e){var t=C(e);return 0===t?!0:f.isText(e)||1!==t||e.innerHTML!==N?!1:!0},L=function(e){h(e)||C(e)||(e.innerHTML=N)},A=function(e,n){for(;e;){if(n(e))return e;if(t(e))break;e=e.parentNode}return null},O=function(e,n){n=n||s.fail;var r=[];return A(e,function(e){return t(e)||r.push(e),n(e)}),r},M=function(e,t){var n=O(e);return o.last(n.filter(t))},_=function(t,n){for(var r=O(t),i=n;i;i=i.parentNode)if(e.inArray(i,r)>-1)return i;return null},D=function(e,t){t=t||s.fail;for(var n=[];e&&!t(e);)n.push(e),e=e.previousSibling;return n},P=function(e,t){t=t||s.fail;for(var n=[];e&&!t(e);)n.push(e),e=e.nextSibling;return n},H=function(e,t){var n=[];return t=t||s.ok,function r(i){e!==i&&t(i)&&n.push(i);for(var s=0,o=i.childNodes.length;o>s;s++)r(i.childNodes[s])}(e),n},B=function(t,n){var r=t.parentNode,i=e("<"+n+">")[0];return r.insertBefore(i,t),i.appendChild(t),i},F=function(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e},I=function(t,n){return e.each(n,function(e,n){t.appendChild(n)}),t},q=function(e){return 0===e.offset},R=function(e){return e.offset===C(e.node)},U=function(e){return q(e)||R(e)},z=function(e,t){for(;e&&e!==t;){if(0!==X(e))return!1;e=e.parentNode}return!0},W=function(e,t){for(;e&&e!==t;){if(X(e)!==C(e.parentNode)-1)return!1;e=e.parentNode}return!0},X=function(e){for(var t=0;e=e.previousSibling;)t+=1;return t},V=function(e){return!!(e&&e.childNodes&&e.childNodes.length)},$=function(e,n){var r,i;if(0===e.offset){if(t(e.node))return null;r=e.node.parentNode,i=X(e.node)}else V(e.node)?(r=e.node.childNodes[e.offset-1],i=C(r)):(r=e.node,i=n?0:e.offset-1);return{node:r,offset:i}},J=function(e,n){var r,i;if(C(e.node)===e.offset){if(t(e.node))return null;r=e.node.parentNode,i=X(e.node)+1}else V(e.node)?(r=e.node.childNodes[e.offset],i=0):(r=e.node,i=n?C(e.node):e.offset+1);return{node:r,offset:i}},K=function(e,t){return e.node===t.node&&e.offset===t.offset},Q=function(e){if(c(e.node)||!V(e.node)||k(e.node))return!0;var t=e.node.childNodes[e.offset-1],n=e.node.childNodes[e.offset];return t&&!h(t)||n&&!h(n)?!1:!0},G=function(e,t){for(;e;){if(t(e))return e;e=$(e)}return null},Y=function(e,t){for(;e;){if(t(e))return e;e=J(e)}return null},Z=function(e,t,n,r){for(var i=e;i&&(n(i),!K(i,t));){var s=r&&e.node!==i.node&&t.node!==i.node;i=J(i,s)}},et=function(t,n){var r=O(n,s.eq(t));return e.map(r,X).reverse()},tt=function(e,t){for(var n=e,r=0,i=t.length;i>r;r++)n=n.childNodes.length<=t[r]?n.childNodes[n.childNodes.length-1]:n.childNodes[t[r]];return n},nt=function(e,t){if(c(e.node))return q(e)?e.node:R(e)?e.node.nextSibling:e.node.splitText(e.offset);var n=e.node.childNodes[e.offset],r=F(e.node.cloneNode(!1),e.node);return I(r,P(n)),t||(L(e.node),L(r)),r},rt=function(e,t,n){var r=O(t.node,s.eq(e));return r.length?1===r.length?nt(t,n):r.reduce(function(e,r){var i=F(r.cloneNode(!1),r);return e===t.node&&(e=nt(t,n)),I(i,P(e)),n||(L(r),L(i)),i}):null},it=function(e){return document.createElement(e)},st=function(e){return document.createTextNode(e)},ot=function(e,t){if(e&&e.parentNode){if(e.removeNode)return e.removeNode(t);var n=e.parentNode;if(!t){var r,i,s=[];for(r=0,i=e.childNodes.length;i>r;r++)s.push(e.childNodes[r]);for(r=0,i=s.length;i>r;r++)n.insertBefore(s[r],e)}n.removeChild(e)}},ut=function(e,n){for(;e&&!t(e)&&n(e);){var r=e.parentNode;ot(e),e=r}},at=function(e,t){if(e.nodeName.toUpperCase()===t.toUpperCase())return e;var n=it(t);return e.style.cssText&&(n.style.cssText=e.style.cssText),I(n,o.from(e.childNodes)),F(n,e),ot(e),n},ft=l("TEXTAREA"),lt=function(t,n){var r=ft(t[0])?t.val():t.html();if(n){var i=/<(\/?)(\b(?!!)[^>\s]*)(.*?)(\s*\/?>)/g;r=r.replace(i,function(e,t,n){n=n.toUpperCase();var r=/^DIV|^TD|^TH|^P|^LI|^H[1-7]/.test(n)&&!!t,i=/^BLOCKQUOTE|^TABLE|^TBODY|^TR|^HR|^UL|^OL/.test(n);return e+(r||i?"\n":"")}),r=e.trim(r)}return r},ct=function(e){var t=e.val();return t.replace(/[\n\r]/g,"")};return{NBSP_CHAR:u,ZERO_WIDTH_NBSP_CHAR:a,blank:N,emptyPara:"<p>"+N+"</p>",isEditable:t,isControlSizing:n,buildLayoutInfo:r,isText:c,isPara:p,isPurePara:v,isInline:m,isBodyInline:x,isBody:T,isParaInline:S,isList:g,isTable:l("TABLE"),isCell:y,isBlockquote:b,isBodyContainer:w,isAnchor:E,isDiv:l("DIV"),isLi:d,isSpan:l("SPAN"),isB:l("B"),isU:l("U"),isS:l("S"),isI:l("I"),isImg:l("IMG"),isTextarea:ft,isEmpty:k,isEmptyAnchor:s.and(E,k),nodeLength:C,isLeftEdgePoint:q,isRightEdgePoint:R,isEdgePoint:U,isLeftEdgeOf:z,isRightEdgeOf:W,prevPoint:$,nextPoint:J,isSamePoint:K,isVisiblePoint:Q,prevPointUntil:G,nextPointUntil:Y,walkPoint:Z,ancestor:A,listAncestor:O,lastAncestor:M,listNext:P,listPrev:D,listDescendant:H,commonAncestor:_,wrap:B,insertAfter:F,appendChildNodes:I,position:X,hasChildren:V,makeOffsetPath:et,fromOffsetPath:tt,splitTree:rt,create:it,createText:st,remove:ot,removeWhile:ut,replace:at,html:lt,value:ct}}(),l=function(){var t=function(e,t){var n,r,i=e.parentElement(),s=document.body.createTextRange(),u=o.from(i.childNodes);for(n=0;n<u.length;n++)if(!f.isText(u[n])){if(s.moveToElementText(u[n]),s.compareEndPoints("StartToStart",e)>=0)break;r=u[n]}if(0!==n&&f.isText(u[n-1])){var a=document.body.createTextRange(),l=null;a.moveToElementText(r||i),a.collapse(!r),l=r?r.nextSibling:i.firstChild;var c=e.duplicate();c.setEndPoint("StartToStart",a);for(var h=c.text.replace(/[\r\n]/g,"").length;h>l.nodeValue.length&&l.nextSibling;)h-=l.nodeValue.length,l=l.nextSibling;l.nodeValue,t&&l.nextSibling&&f.isText(l.nextSibling)&&h===l.nodeValue.length&&(h-=l.nodeValue.length,l=l.nextSibling),i=l,n=h}return{cont:i,offset:n}},n=function(e){var t=function(e,n){var r,i;if(f.isText(e)){var u=f.listPrev(e,s.not(f.isText)),a=o.last(u).previousSibling;r=a||e.parentNode,n+=o.sum(o.tail(u),f.nodeLength),i=!a}else{if(r=e.childNodes[n]||e,f.isText(r))return t(r,0);n=0,i=!1}return{node:r,collapseToStart:i,offset:n}},n=document.body.createTextRange(),r=t(e.node,e.offset);return n.moveToElementText(r.node),n.collapse(r.collapseToStart),n.moveStart("character",r.offset),n},r=function(t,u,a,l){this.sc=t,this.so=u,this.ec=a,this.eo=l;var c=function(){if(i.isW3CRangeSupport){var e=document.createRange();return e.setStart(t,u),e.setEnd(a,l),e}var r=n({node:t,offset:u});return r.setEndPoint("EndToEnd",n({node:a,offset:l})),r};this.getPoints=function(){return{sc:t,so:u,ec:a,eo:l}},this.getStartPoint=function(){return{node:t,offset:u}},this.getEndPoint=function(){return{node:a,offset:l}},this.select=function(){var e=c();if(i.isW3CRangeSupport){var t=document.getSelection();t.rangeCount>0&&t.removeAllRanges(),t.addRange(e)}else e.select()},this.normalize=function(){var e=function(e){return f.isVisiblePoint(e)||(f.isLeftEdgePoint(e)?e=f.nextPointUntil(e,f.isVisiblePoint):f.isRightEdgePoint(e)&&(e=f.prevPointUntil(e,f.isVisiblePoint))),e},t=e(this.getStartPoint()),n=e(this.getStartPoint());return new r(t.node,t.offset,n.node,n.offset)},this.nodes=function(e,t){e=e||s.ok;var n=t&&t.includeAncestor,r=t&&t.fullyContains,i=this.getStartPoint(),u=this.getEndPoint(),a=[],l=[];return f.walkPoint(i,u,function(t){if(!f.isEditable(t.node)){var i;r?(f.isLeftEdgePoint(t)&&l.push(t.node),f.isRightEdgePoint(t)&&o.contains(l,t.node)&&(i=t.node)):i=n?f.ancestor(t.node,e):t.node,i&&e(i)&&a.push(i)}},!0),o.unique(a)},this.commonAncestor=function(){return f.commonAncestor(t,a)},this.expand=function(e){var n=f.ancestor(t,e),i=f.ancestor(a,e);if(!n&&!i)return new r(t,u,a,l);var s=this.getPoints();return n&&(s.sc=n,s.so=0),i&&(s.ec=i,s.eo=f.nodeLength(i)),new r(s.sc,s.so,s.ec,s.eo)},this.collapse=function(e){return e?new r(t,u,t,u):new r(a,l,a,l)},this.splitText=function(){var e=t===a,n=this.getPoints();return f.isText(a)&&!f.isEdgePoint(this.getEndPoint())&&a.splitText(l),f.isText(t)&&!f.isEdgePoint(this.getStartPoint())&&(n.sc=t.splitText(u),n.so=0,e&&(n.ec=n.sc,n.eo=l-u)),new r(n.sc,n.so,n.ec,n.eo)},this.deleteContents=function(){if(this.isCollapsed())return this;var t=this.splitText(),n=t.nodes(null,{fullyContains:!0}),i=f.prevPointUntil(t.getStartPoint(),function(e){return!o.contains(n,e.node)}),s=[];return e.each(n,function(e,t){var n=t.parentNode;i.node!==n&&1===f.nodeLength(n)&&s.push(n),f.remove(t,!1)}),e.each(s,function(e,t){f.remove(t,!1)}),new r(i.node,i.offset,i.node,i.offset)};var h=function(e){return function(){var n=f.ancestor(t,e);return!!n&&n===f.ancestor(a,e)}};this.isOnEditable=h(f.isEditable),this.isOnList=h(f.isList),this.isOnAnchor=h(f.isAnchor),this.isOnCell=h(f.isCell),this.isLeftEdgeOf=function(e){if(!f.isLeftEdgePoint(this.getStartPoint()))return!1;var t=f.ancestor(this.sc,e);return t&&f.isLeftEdgeOf(this.sc,t)},this.isCollapsed=function(){return t===a&&u===l},this.wrapBodyInlineWithPara=function(){if(f.isBodyContainer(t)&&f.isEmpty(t))return t.innerHTML=f.emptyPara,new r(t.firstChild,0);if(f.isParaInline(t)||f.isPara(t))return this.normalize();var e;if(f.isInline(t)){var n=f.listAncestor(t,s.not(f.isInline));e=o.last(n),f.isInline(e)||(e=n[n.length-2]||t.childNodes[u])}else e=t.childNodes[u-1];var i=f.listPrev(e,f.isParaInline).reverse();if(i=i.concat(f.listNext(e.nextSibling,f.isParaInline)),i.length){var a=f.wrap(o.head(i),"p");f.appendChildNodes(a,o.tail(i))}return this.normalize()},this.insertNode=function(e,t){var n,r,i,s=this.wrapBodyInlineWithPara(),u=s.getStartPoint();if(t)r=f.isPara(u.node)?u.node:u.node.parentNode,i=f.isPara(u.node)?u.node.childNodes[u.offset]:f.splitTree(u.node,u);else{var a=f.listAncestor(u.node,f.isBodyContainer),l=o.last(a)||u.node;f.isBodyContainer(l)?(n=a[a.length-2],r=l):(n=l,r=n.parentNode),i=n&&f.splitTree(n,u)}return i?i.parentNode.insertBefore(e,i):r.appendChild(e),e},this.toString=function(){var e=c();return i.isW3CRangeSupport?e.toString():e.text},this.bookmark=function(e){return{s:{path:f.makeOffsetPath(e,t),offset:u},e:{path:f.makeOffsetPath(e,a),offset:l}}},this.getClientRects=function(){var e=c();return e.getClientRects()}};return{create:function(e,n,s,o){if(arguments.length)2===arguments.length&&(s=e,o=n);else if(i.isW3CRangeSupport){var u=document.getSelection();if(0===u.rangeCount)return null;if(f.isBody(u.anchorNode))return null;var a=u.getRangeAt(0);e=a.startContainer,n=a.startOffset,s=a.endContainer,o=a.endOffset}else{var l=document.selection.createRange(),c=l.duplicate();c.collapse(!1);var h=l;h.collapse(!0);var p=t(h,!0),d=t(c,!1);f.isText(p.node)&&f.isLeftEdgePoint(p)&&f.isTextNode(d.node)&&f.isRightEdgePoint(d)&&d.node.nextSibling===p.node&&(p=d),e=p.cont,n=p.offset,s=d.cont,o=d.offset}return new r(e,n,s,o)},createFromNode:function(e){return this.create(e,0,e,1)},createFromBookmark:function(e,t){var n=f.fromOffsetPath(e,t.s.path),i=t.s.offset,s=f.fromOffsetPath(e,t.e.path),o=t.e.offset;return new r(n,i,s,o)}}}(),c={version:"0.6.0",options:{width:null,height:null,minHeight:null,maxHeight:null,focus:!1,tabsize:4,styleWithSpan:!0,disableLinkTarget:!1,disableDragAndDrop:!1,disableResizeEditor:!1,shortcuts:!0,placeholder:!1,codemirror:{mode:"text/html",htmlMode:!0,lineNumbers:!0},lang:"en-US",direction:null,toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["fontname",["fontname"]],["color",["color"]],["para",["ul","ol","paragraph"]],["height",["height"]],["table",["table"]],["insert",["link","picture","hr"]],["view",["fullscreen","codeview"]],["help",["help"]]],airMode:!1,airPopover:[["color",["color"]],["font",["bold","underline","clear"]],["para",["ul","paragraph"]],["table",["table"]],["insert",["link","picture"]]],styleTags:["p","blockquote","pre","h1","h2","h3","h4","h5","h6"],defaultFontName:"Helvetica Neue",fontNames:["Arial","Arial Black","Comic Sans MS","Courier New","Helvetica Neue","Impact","Lucida Grande","Tahoma","Times New Roman","Verdana"],colors:[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],lineHeights:["1.0","1.2","1.4","1.5","1.6","1.8","2.0","3.0"],insertTableMaxSize:{col:10,row:10},maximumImageFileSize:null,oninit:null,onfocus:null,onblur:null,onenter:null,onkeyup:null,onkeydown:null,onImageUpload:null,onImageUploadError:null,onToolbarClick:null,onsubmit:null,onCreateLink:function(e){return-1!==e.indexOf("@")&&-1===e.indexOf(":")?e="mailto:"+e:-1===e.indexOf("://")&&(e="http://"+e),e},keyMap:{pc:{ENTER:"insertParagraph","CTRL+Z":"undo","CTRL+Y":"redo",TAB:"tab","SHIFT+TAB":"untab","CTRL+B":"bold","CTRL+I":"italic","CTRL+U":"underline","CTRL+SHIFT+S":"strikethrough","CTRL+BACKSLASH":"removeFormat","CTRL+SHIFT+L":"justifyLeft","CTRL+SHIFT+E":"justifyCenter","CTRL+SHIFT+R":"justifyRight","CTRL+SHIFT+J":"justifyFull","CTRL+SHIFT+NUM7":"insertUnorderedList","CTRL+SHIFT+NUM8":"insertOrderedList","CTRL+LEFTBRACKET":"outdent","CTRL+RIGHTBRACKET":"indent","CTRL+NUM0":"formatPara","CTRL+NUM1":"formatH1","CTRL+NUM2":"formatH2","CTRL+NUM3":"formatH3","CTRL+NUM4":"formatH4","CTRL+NUM5":"formatH5","CTRL+NUM6":"formatH6","CTRL+ENTER":"insertHorizontalRule","CTRL+K":"showLinkDialog"},mac:{ENTER:"insertParagraph","CMD+Z":"undo","CMD+SHIFT+Z":"redo",TAB:"tab","SHIFT+TAB":"untab","CMD+B":"bold","CMD+I":"italic","CMD+U":"underline","CMD+SHIFT+S":"strikethrough","CMD+BACKSLASH":"removeFormat","CMD+SHIFT+L":"justifyLeft","CMD+SHIFT+E":"justifyCenter","CMD+SHIFT+R":"justifyRight","CMD+SHIFT+J":"justifyFull","CMD+SHIFT+NUM7":"insertUnorderedList","CMD+SHIFT+NUM8":"insertOrderedList","CMD+LEFTBRACKET":"outdent","CMD+RIGHTBRACKET":"indent","CMD+NUM0":"formatPara","CMD+NUM1":"formatH1","CMD+NUM2":"formatH2","CMD+NUM3":"formatH3","CMD+NUM4":"formatH4","CMD+NUM5":"formatH5","CMD+NUM6":"formatH6","CMD+ENTER":"insertHorizontalRule","CMD+K":"showLinkDialog"}}},lang:{"en-US":{font:{bold:"Bold",italic:"Italic",underline:"Underline",clear:"Remove Font Style",height:"Line Height",name:"Font Family"},image:{image:"Picture",insert:"Insert Image",resizeFull:"Resize Full",resizeHalf:"Resize Half",resizeQuarter:"Resize Quarter",floatLeft:"Float Left",floatRight:"Float Right",floatNone:"Float None",shapeRounded:"Shape: Rounded",shapeCircle:"Shape: Circle",shapeThumbnail:"Shape: Thumbnail",shapeNone:"Shape: None",dragImageHere:"Drag image or text here",dropImage:"Drop image or Text",selectFromFiles:"Select from files",maximumFileSize:"Maximum file size",maximumFileSizeError:"Maximum file size exceeded.",url:"Image URL",remove:"Remove Image"},link:{link:"Link",insert:"Insert Link",unlink:"Unlink",edit:"Edit",textToDisplay:"Text to display",url:"To what URL should this link go?",openInNewWindow:"Open in new window"},table:{table:"Table"},hr:{insert:"Insert Horizontal Rule"},style:{style:"Style",normal:"Normal",blockquote:"Quote",pre:"Code",h1:"Header 1",h2:"Header 2",h3:"Header 3",h4:"Header 4",h5:"Header 5",h6:"Header 6"},lists:{unordered:"Unordered list",ordered:"Ordered list"},options:{help:"Help",fullscreen:"Full Screen",codeview:"Code View"},paragraph:{paragraph:"Paragraph",outdent:"Outdent",indent:"Indent",left:"Align left",center:"Align center",right:"Align right",justify:"Justify full"},color:{recent:"Recent Color",more:"More Color",background:"Background Color",foreground:"Foreground Color",transparent:"Transparent",setTransparent:"Set transparent",reset:"Reset",resetToDefault:"Reset to default"},shortcut:{shortcuts:"Keyboard shortcuts",close:"Close",textFormatting:"Text formatting",action:"Action",paragraphFormatting:"Paragraph formatting",documentStyle:"Document Style",extraKeys:"Extra keys"},history:{undo:"Undo",redo:"Redo"}}}},h=function(){var t=function(t){return e.Deferred(function(n){e.extend(new FileReader,{onload:function(e){var t=e.target.result;n.resolve(t)},onerror:function(){n.reject(this)}}).readAsDataURL(t)}).promise()},n=function(t,n){return e.Deferred(function(r){e("<img>").one("load",function(){r.resolve(e(this))}).one("error abort",function(){r.reject(e(this).detach())}).css({display:"none"}).appendTo(document.body).attr("src",t).attr("data-filename",n)}).promise()};return{readFileAsDataURL:t,createImage:n}}(),p={isEdit:function(e){return o.contains([8,9,13,32],e)},nameFromCode:{8:"BACKSPACE",9:"TAB",13:"ENTER",32:"SPACE",48:"NUM0",49:"NUM1",50:"NUM2",51:"NUM3",52:"NUM4",53:"NUM5",54:"NUM6",55:"NUM7",56:"NUM8",66:"B",69:"E",73:"I",74:"J",75:"K",76:"L",82:"R",83:"S",85:"U",89:"Y",90:"Z",191:"SLASH",219:"LEFTBRACKET",220:"BACKSLASH",221:"RIGHTBRACKET"}},d=function(){var t=function(t,n){if(i.jqueryVersion<1.9){var r={};return e.each(n,function(e,n){r[n]=t.css(n)}),r}return t.css.call(t,n)};this.stylePara=function(t,n){e.each(t.nodes(f.isPara,{includeAncestor:!0}),function(t,r){e(r).css(n)})},this.current=function(n,r){var i=e(f.isText(n.sc)?n.sc.parentNode:n.sc),s=["font-family","font-size","text-align","list-style-type","line-height"],o=t(i,s)||{};if(o["font-size"]=parseInt(o["font-size"],10),o["font-bold"]=document.queryCommandState("bold")?"bold":"normal",o["font-italic"]=document.queryCommandState("italic")?"italic":"normal",o["font-underline"]=document.queryCommandState("underline")?"underline":"normal",o["font-strikethrough"]=document.queryCommandState("strikeThrough")?"strikethrough":"normal",o["font-superscript"]=document.queryCommandState("superscript")?"superscript":"normal",o["font-subscript"]=document.queryCommandState("subscript")?"subscript":"normal",n.isOnList()){var u=["circle","disc","disc-leading-zero","square"],a=e.inArray(o["list-style-type"],u)>-1;o["list-style"]=a?"unordered":"ordered"}else o["list-style"]="none";var l=f.ancestor(n.sc,f.isPara);if(l&&l.style["line-height"])o["line-height"]=l.style.lineHeight;else{var c=parseInt(o["line-height"],10)/parseInt(o["font-size"],10);o["line-height"]=c.toFixed(1)}return o.image=f.isImg(r)&&r,o.anchor=n.isOnAnchor()&&f.ancestor(n.sc,f.isAnchor),o.ancestors=f.listAncestor(n.sc,f.isEditable),o.range=n,o}},v=function(){this.insertTab=function(e,t,n){var r=f.createText((new Array(n+1)).join(f.NBSP_CHAR));t=t.deleteContents(),t.insertNode(r,!0),t=l.create(r,n),t.select()},this.insertParagraph=function(){var t=l.create();t=t.deleteContents(),t=t.wrapBodyInlineWithPara();var n,r=f.ancestor(t.sc,f.isPara);if(r){n=f.splitTree(r,t.getStartPoint());var i=f.listDescendant(r,f.isEmptyAnchor);i=i.concat(f.listDescendant(n,f.isEmptyAnchor)),e.each(i,function(e,t){f.remove(t)})}else{var s=t.sc.childNodes[t.so];n=e(f.emptyPara)[0],s?t.sc.insertBefore(n,s):t.sc.appendChild(n)}l.create(n,0).normalize().select()}},m=function(){this.tab=function(e,t){var n=f.ancestor(e.commonAncestor(),f.isCell),r=f.ancestor(n,f.isTable),i=f.listDescendant(r,f.isCell),s=o[t?"prev":"next"](i,n);s&&l.create(s,0).select()},this.createTable=function(t,n){for(var r,i=[],s=0;t>s;s++)i.push("<td>"+f.blank+"</td>");r=i.join("");for(var o,u=[],a=0;n>a;a++)u.push("<tr>"+r+"</tr>");return o=u.join(""),e('<table class="table table-bordered">'+o+"</table>")[0]}},g=function(){this.insertOrderedList=function(){this.toggleList("OL")},this.insertUnorderedList=function(){this.toggleList("UL")},this.indent=function(){var t=this,n=l.create().wrapBodyInlineWithPara(),r=n.nodes(f.isPara,{includeAncestor:!0}),i=o.clusterBy(r,s.peq2("parentNode"));e.each(i,function(n,r){var i=o.head(r);f.isLi(i)?t.wrapList(r,i.parentNode.nodeName):e.each(r,function(t,n){e(n).css("marginLeft",function(e,t){return(parseInt(t,10)||0)+25})})}),n.select()},this.outdent=function(){var t=this,n=l.create().wrapBodyInlineWithPara(),r=n.nodes(f.isPara,{includeAncestor:!0}),i=o.clusterBy(r,s.peq2("parentNode"));e.each(i,function(n,r){var i=o.head(r);f.isLi(i)?t.releaseList([r]):e.each(r,function(t,n){e(n).css("marginLeft",function(e,t){return t=parseInt(t,10)||0,t>25?t-25:""})})}),n.select()},this.toggleList=function(t){var n=this,r=l.create().wrapBodyInlineWithPara(),i=r.nodes(f.isPara,{includeAncestor:!0}),u=o.clusterBy(i,s.peq2("parentNode"));if(o.find(i,f.isPurePara))e.each(u,function(e,r){n.wrapList(r,t)});else{var a=r.nodes(f.isList,{includeAncestor:!0}).filter(function(n){return!e.nodeName(n,t)});a.length?e.each(a,function(e,n){f.replace(n,t)}):this.releaseList(u,!0)}r.select()},this.wrapList=function(t,n){var r=o.head(t),i=o.last(t),s=f.isList(r.previousSibling)&&r.previousSibling,u=f.isList(i.nextSibling)&&i.nextSibling,a=s||f.insertAfter(f.create(n||"UL"),i);t=e.map(t,function(e){return f.isPurePara(e)?f.replace(e,"LI"):e}),f.appendChildNodes(a,t),u&&(f.appendChildNodes(a,o.from(u.childNodes)),f.remove(u))},this.releaseList=function(t,n){var r=[];return e.each(t,function(t,i){var s=o.head(i),u=o.last(i),a=n?f.lastAncestor(s,f.isList):s.parentNode,l=a.childNodes.length>1?f.splitTree(a,{node:u.parentNode,offset:f.position(u)+1},!0):null,c=f.splitTree(a,{node:s.parentNode,offset:f.position(s)},!0);i=n?f.listDescendant(c,f.isLi):o.from(c.childNodes).filter(f.isLi),(n||!f.isList(a.parentNode))&&(i=e.map(i,function(e){return f.replace(e,"P")})),e.each(o.from(i).reverse(),function(e,t){f.insertAfter(t,a)});var h=o.compact([a,c,l]);e.each(h,function(t,n){var r=[n].concat(f.listDescendant(n,f.isList));e.each(r.reverse(),function(e,t){f.nodeLength(t)||f.remove(t,!0)})}),r=r.concat(i)}),r}},y=function(){var t=new d,n=new m,r=new v,s=new g;this.createRange=function(e){return e.focus(),l.create()},this.saveRange=function(e,t){e.focus(),e.data("range",l.create()),t&&l.create().collapse().select()},this.saveNode=function(e){for(var t=[],n=0,r=e[0].childNodes.length;r>n;n++)t.push(e[0].childNodes[n]);e.data("childNodes",t)},this.restoreRange=function(e){var t=e.data("range");t&&(t.select(),e.focus())},this.restoreNode=function(e){e.html("");for(var t=e.data("childNodes"),n=0,r=t.length;r>n;n++)e[0].appendChild(t[n])},this.currentStyle=function(e){var n=l.create();return n?n.isOnEditable()&&t.current(n,e):!1};var u=this.triggerOnChange=function(e){var t=e.data("callbacks").onChange;t&&t(e.html(),e)};this.undo=function(e){e.data("NoteHistory").undo(),u(e)},this.redo=function(e){e.data("NoteHistory").redo(),u(e)};for(var a=this.afterCommand=function(e){e.data("NoteHistory").recordUndo(),u(e)},c=["bold","italic","underline","strikethrough","superscript","subscript","justifyLeft","justifyCenter","justifyRight","justifyFull","formatBlock","removeFormat","backColor","foreColor","insertHorizontalRule","fontName"],p=0,y=c.length;y>p;p++)this[c[p]]=function(e){return function(t,n){document.execCommand(e,!1,n),a(t)}}(c[p]);this.tab=function(e,t){var i=l.create();i.isCollapsed()&&i.isOnCell()?n.tab(i):(r.insertTab(e,i,t.tabsize),a(e))},this.untab=function(){var e=l.create();e.isCollapsed()&&e.isOnCell()&&n.tab(e,!0)},this.insertParagraph=function(e){r.insertParagraph(e),a(e)},this.insertOrderedList=function(e){s.insertOrderedList(e),a(e)},this.insertUnorderedList=function(e){s.insertUnorderedList(e),a(e)},this.indent=function(e){s.indent(e),a(e)},this.outdent=function(e){s.outdent(e),a(e)},this.insertImage=function(e,t,n){h.createImage(t,n).then(function(t){t.css({display:"",width:Math.min(e.width(),t.width())}),l.create().insertNode(t[0]),a(e)}).fail(function(){var t=e.data("callbacks");t.onImageUploadError&&t.onImageUploadError()})},this.insertNode=function(e,t,n){l.create().insertNode(t,n),a(e)},this.insertText=function(e,t){var n=this.createRange(e).insertNode(f.createText(t),!0);l.create(n,f.nodeLength(n)).select(),a(e)},this.formatBlock=function(e,t){t=i.isMSIE?"<"+t+">":t,document.execCommand("FormatBlock",!1,t),a(e)},this.formatPara=function(e){this.formatBlock(e,"P"),a(e)};for(var p=1;6>=p;p++)this["formatH"+p]=function(e){return function(t){this.formatBlock(t,"H"+e)}}(p);this.fontSize=function(e,t){document.execCommand("fontSize",!1,3),i.isFF?e.find("font[size=3]").removeAttr("size").css("font-size",t+"px"):e.find("span").filter(function(){return"medium"===this.style.fontSize}).css("font-size",t+"px"),a(e)},this.lineHeight=function(e,n){t.stylePara(l.create(),{lineHeight:n}),a(e)},this.unlink=function(e){var t=l.create();if(t.isOnAnchor()){var n=f.ancestor(t.sc,f.isAnchor);t=l.createFromNode(n),t.select(),document.execCommand("unlink"),a(e)}},this.createLink=function(t,n,r){var i=n.url,s=n.text,o=n.newWindow,u=n.range;r.onCreateLink&&(i=r.onCreateLink(i)),u=u.deleteContents();var f=u.insertNode(e("<A>"+s+"</A>")[0],!0);e(f).attr({href:i,target:o?"_blank":""}),l.createFromNode(f).select(),a(t)},this.getLinkInfo=function(t){t.focus();var n=l.create().expand(f.isAnchor),r=e(o.head(n.nodes(f.isAnchor)));return{range:n,text:n.toString(),isNewWindow:r.length?"_blank"===r.attr("target"):!0,url:r.length?r.attr("href"):""}},this.color=function(e,t){var n=JSON.parse(t),r=n.foreColor,i=n.backColor;r&&document.execCommand("foreColor",!1,r),i&&document.execCommand("backColor",!1,i),a(e)},this.insertTable=function(e,t){var r=t.split("x"),i=l.create();i=i.deleteContents(),i.insertNode(n.createTable(r[0],r[1])),a(e)},this.floatMe=function(e,t,n){n.css("float",t),a(e)},this.imageShape=function(e,t,n){n.removeClass("img-rounded img-circle img-thumbnail"),t&&n.addClass(t),a(e)},this.resize=function(e,t,n){n.css({width:100*t+"%",height:""}),a(e)},this.resizeTo=function(e,t,n){var r;if(n){var i=e.y/e.x,s=t.data("ratio");r={width:s>i?e.x:e.y/s,height:s>i?e.x*s:e.y}}else r={width:e.x,height:e.y};t.css(r)},this.removeMedia=function(e,t,n){n.detach(),a(e)}},b=function(e){var t=[],n=-1,r=e[0],i=function(){var t=l.create(),n={s:{path:[0],offset:0},e:{path:[0],offset:0}};return{contents:e.html(),bookmark:t?t.bookmark(r):n}},s=function(t){null!==t.contents&&e.html(t.contents),null!==t.bookmark&&l.createFromBookmark(r,t.bookmark).select()};this.undo=function(){n>0&&(n--,s(t[n]))},this.redo=function(){t.length-1>n&&(n++,s(t[n]))},this.recordUndo=function(){n++,t.length>n&&(t=t.slice(0,n)),t.push(i())},this.recordUndo()},w=function(){this.update=function(t,n){var r=function(t,n){t.find(".dropdown-menu li a").each(function(){var t=e(this).data("value")+""==n+"";this.className=t?"checked":""})},i=function(e,n){var r=t.find(e);r.toggleClass("active",n())},s=t.find(".note-fontname");if(s.length){var u=n["font-family"];u&&(u=o.head(u.split(",")),u=u.replace(/\'/g,""),s.find(".note-current-fontname").text(u),r(s,u))}var a=t.find(".note-fontsize");a.find(".note-current-fontsize").text(n["font-size"]),r(a,parseFloat(n["font-size"]));var f=t.find(".note-height");r(f,parseFloat(n["line-height"])),i('button[data-event="bold"]',function(){return"bold"===n["font-bold"]}),i('button[data-event="italic"]',function(){return"italic"===n["font-italic"]}),i('button[data-event="underline"]',function(){return"underline"===n["font-underline"]}),i('button[data-event="strikethrough"]',function(){return"strikethrough"===n["font-strikethrough"]}),i('button[data-event="superscript"]',function(){return"superscript"===n["font-superscript"]}),i('button[data-event="subscript"]',function(){return"subscript"===n["font-subscript"]}),i('button[data-event="justifyLeft"]',function(){return"left"===n["text-align"]||"start"===n["text-align"]}),i('button[data-event="justifyCenter"]',function(){return"center"===n["text-align"]}),i('button[data-event="justifyRight"]',function(){return"right"===n["text-align"]}),i('button[data-event="justifyFull"]',function(){return"justify"===n["text-align"]}),i('button[data-event="insertUnorderedList"]',function(){return"unordered"===n["list-style"]}),i('button[data-event="insertOrderedList"]',function(){return"ordered"===n["list-style"]})},this.updateRecentColor=function(t,n,r){var i=e(t).closest(".note-color"),s=i.find(".note-recent-color"),o=JSON.parse(s.attr("data-value"));o[n]=r,s.attr("data-value",JSON.stringify(o));var u="backColor"===n?"background-color":"color";s.find("i").css(u,r)}},E=function(){var e=new w;this.update=function(t,n){e.update(t,n)},this.updateRecentColor=function(t,n,r){e.updateRecentColor(t,n,r)},this.activate=function(e){e.find("button").not('button[data-event="codeview"]').removeClass("disabled")},this.deactivate=function(e){e.find("button").not('button[data-event="codeview"]').addClass("disabled")},this.updateFullscreen=function(e,t){var n=e.find('button[data-event="fullscreen"]');n.toggleClass("active",t)},this.updateCodeview=function(e,t){var n=e.find('button[data-event="codeview"]');n.toggleClass("active",t)}},S=function(){var t=new w,n=function(t,n){var r=e(t),i=n?r.offset():r.position(),s=r.outerHeight(!0);return{left:i.left,top:i.top+s}},r=function(e,t){e.css({display:"block",left:t.left,top:t.top})},i=20;this.update=function(u,a,f){t.update(u,a);var l=u.find(".note-link-popover");if(a.anchor){var c=l.find("a"),h=e(a.anchor).attr("href");c.attr("href",h).html(h),r(l,n(a.anchor,f))}else l.hide();var p=u.find(".note-image-popover");a.image?r(p,n(a.image,f)):p.hide();var d=u.find(".note-air-popover");if(f&&!a.range.isCollapsed()){var v=s.rect2bnd(o.last(a.range.getClientRects()));r(d,{left:Math.max(v.left+v.width/2-i,0),top:v.top+v.height})}else d.hide()},this.updateRecentColor=function(e,t,n){e.updateRecentColor(e,t,n)},this.hide=function(e){e.children().hide()}},x=function(){this.update=function(t,n,r){var i=t.find(".note-control-selection");if(n.image){var s=e(n.image),o=r?s.offset():s.position(),u={w:s.outerWidth(!0),h:s.outerHeight(!0)};i.css({display:"block",left:o.left,top:o.top,width:u.w,height:u.h}).data("target",n.image);var a=u.w+"x"+u.h;i.find(".note-control-selection-info").text(a)}else i.hide()},this.hide=function(e){e.children().hide()}},T=function(){var t=function(e,t){e.toggleClass("disabled",!t),e.attr("disabled",!t)};this.showImageDialog=function(n,r){return e.Deferred(function(e){var n=r.find(".note-image-dialog"),i=r.find(".note-image-input"),s=r.find(".note-image-url"),o=r.find(".note-image-btn");n.one("shown.bs.modal",function(){i.replaceWith(i.clone().on("change",function(){e.resolve(this.files||this.value),n.modal("hide")}).val("")),o.click(function(t){t.preventDefault(),e.resolve(s.val()),n.modal("hide")}),s.on("keyup paste",function(e){var n;n="paste"===e.type?e.originalEvent.clipboardData.getData("text"):s.val(),t(o,n)}).val("").trigger("focus")}).one("hidden.bs.modal",function(){i.off("change"),s.off("keyup paste"),o.off("click"),"pending"===e.state()&&e.reject()}).modal("show")})},this.showLinkDialog=function(n,r,i){return e.Deferred(function(e){var n=r.find(".note-link-dialog"),s=n.find(".note-link-text"),o=n.find(".note-link-url"),u=n.find(".note-link-btn"),a=n.find("input[type=checkbox]");n.one("shown.bs.modal",function(){s.val(i.text),s.on("input",function(){i.text=s.val()}),i.url||(i.url=i.text,t(u,i.text)),o.on("input",function(){t(u,o.val()),i.text||s.val(o.val())}).val(i.url).trigger("focus").trigger("select"),a.prop("checked",i.newWindow),u.one("click",function(t){t.preventDefault(),e.resolve({range:i.range,url:o.val(),text:s.val(),newWindow:a.is(":checked")}),n.modal("hide")})}).one("hidden.bs.modal",function(){s.off("input"),o.off("input"),u.off("click"),"pending"===e.state()&&e.reject()}).modal("show")}).promise()},this.showHelpDialog=function(t,n){return e.Deferred(function(e){var t=n.find(".note-help-dialog");t.one("hidden.bs.modal",function(){e.resolve()}).modal("show")}).promise()}};i.hasCodeMirror&&(i.isSupportAmd?require(["CodeMirror"],function(e){t=e}):t=window.CodeMirror);var N=function(){var n=e(window),r=e(document),s=e("html, body"),u=new y,a=new E,l=new S,c=new x,d=new T;this.getEditor=function(){return u};var v=function(t){var n=e(t).closest(".note-editor, .note-air-editor, .note-air-layout");if(!n.length)return null;var r;return r=n.is(".note-editor, .note-air-editor")?n:e("#note-editor-"+o.last(n.attr("id").split("-"))),f.buildLayoutInfo(r)},m=function(t,n){var r=t.editor(),i=t.editable(),s=i.data("callbacks"),o=r.data("options");s.onImageUpload?s.onImageUpload(n,u,i):e.each(n,function(e,t){var n=t.name;o.maximumImageFileSize&&o.maximumImageFileSize<t.size?s.onImageUploadError?s.onImageUploadError(o.langInfo.image.maximumFileSizeError):alert(o.langInfo.image.maximumFileSizeError):h.readFileAsDataURL(t).then(function(e){u.insertImage(i,e,n)}).fail(function(){s.onImageUploadError&&s.onImageUploadError()})})},g={showLinkDialog:function(e){var t=e.editor(),n=e.dialog(),r=e.editable(),i=u.getLinkInfo(r),s=t.data("options");u.saveRange(r),d.showLinkDialog(r,n,i).then(function(t){u.restoreRange(r),u.createLink(r,t,s),l.hide(e.popover())}).fail(function(){u.restoreRange(r)})},showImageDialog:function(e){var t=e.dialog(),n=e.editable();u.saveRange(n),d.showImageDialog(n,t).then(function(t){u.restoreRange(n),"string"==typeof t?u.insertImage(n,t):m(e,t)}).fail(function(){u.restoreRange(n)})},showHelpDialog:function(e){var t=e.dialog(),n=e.editable();u.saveRange(n,!0),d.showHelpDialog(n,t).then(function(){u.restoreRange(n)})},fullscreen:function(e){var t=e.editor(),r=e.toolbar(),i=e.editable(),o=e.codable(),u=function(e){i.css("height",e.h),o.css("height",e.h),o.data("cmeditor")&&o.data("cmeditor").setsize(null,e.h)};t.toggleClass("fullscreen");var f=t.hasClass("fullscreen");f?(i.data("orgheight",i.css("height")),n.on("resize",function(){u({h:n.height()-r.outerHeight()})}).trigger("resize"),s.css("overflow","hidden")):(n.off("resize"),u({h:i.data("orgheight")}),s.css("overflow","visible")),a.updateFullscreen(r,f)},codeview:function(e){var n,r,s=e.editor(),o=e.toolbar(),u=e.editable(),h=e.codable(),p=e.popover(),d=e.handle(),v=s.data("options");s.toggleClass("codeview");var m=s.hasClass("codeview");m?(h.val(f.html(u,!0)),h.height(u.height()),a.deactivate(o),l.hide(p),c.hide(d),h.focus(),i.hasCodeMirror&&(n=t.fromTextArea(h[0],v.codemirror),v.codemirror.tern&&(r=new t.TernServer(v.codemirror.tern),n.ternServer=r,n.on("cursorActivity",function(e){r.updateArgHints(e)})),n.setSize(null,u.outerHeight()),h.data("cmEditor",n))):(i.hasCodeMirror&&(n=h.data("cmEditor"),h.val(n.getValue()),n.toTextArea()),u.html(f.value(h)||f.emptyPara),u.height(v.height?h.height():"auto"),a.activate(o),u.focus()),a.updateCodeview(e.toolbar(),m)}},w=function(e){f.isImg(e.target)&&e.preventDefault()},N=function(e){setTimeout(function(){var t=v(e.currentTarget||e.target),n=u.currentStyle(e.target);if(n){var r=t.editor().data("options").airMode;r||a.update(t.toolbar(),n),l.update(t.popover(),n,r),c.update(t.handle(),n,r)}},0)},C=function(e){var t=v(e.currentTarget||e.target);l.hide(t.popover()),c.hide(t.handle())},k=function(e){var t=e.originalEvent.clipboardData,n=v(e.currentTarget||e.target),r=n.editable();if(!t||!t.items||!t.items.length){var i=r.data("callbacks");if(!i.onImageUpload)return;return u.saveNode(r),u.saveRange(r),r.html(""),void setTimeout(function(){for(var e=r.find("img"),t=e[0].src,i=atob(t.split(",")[1]),s=new Uint8Array(i.length),o=0;o<i.length;o++)s[o]=i.charCodeAt(o);var a=new Blob([s],{type:"image/png"});a.name="clipboard.png",u.restoreNode(r),u.restoreRange(r),m(n,[a]),u.afterCommand(r)},0)}var s=o.head(t.items),a="file"===s.kind&&-1!==s.type.indexOf("image/");a&&m(n,[s.getAsFile()]),u.afterCommand(r)},L=function(t){if(f.isControlSizing(t.target)){t.preventDefault(),t.stopPropagation();var n=v(t.target),i=n.handle(),s=n.popover(),o=n.editable(),a=n.editor(),h=i.find(".note-control-selection").data("target"),p=e(h),d=p.offset(),m=r.scrollTop(),g=a.data("options").airMode;r.on("mousemove",function(e){u.resizeTo({x:e.clientX-d.left,y:e.clientY-(d.top-m)},p,!e.shiftKey),c.update(i,{image:h},g),l.update(s,{image:h},g)}).one("mouseup",function(){r.off("mousemove"),u.afterCommand(o)}),p.data("ratio")||p.data("ratio",p.height()/p.width())}},A=function(t){var n=e(t.target).closest("[data-event]");n.length&&t.preventDefault()},O=function(t){var n=e(t.target).closest("[data-event]");if(n.length){var r=n.attr("data-event"),i=n.attr("data-value"),s=n.attr("data-hide"),f=v(t.target);t.preventDefault();var c;if(-1!==e.inArray(r,["resize","floatMe","removeMedia","imageShape"])){var h=f.handle().find(".note-control-selection");c=e(h.data("target"))}if(s&&n.parents(".popover").hide(),u[r]){var p=f.editable();p.trigger("focus"),u[r](p,i,c)}else g[r]?g[r].call(this,f):e.isFunction(e.summernote.pluginEvents[r])&&e.summernote.pluginEvents[r](f,i,c);if(-1!==e.inArray(r,["backColor","foreColor"])){var d=f.editor().data("options",d),m=d.airMode?l:a;m.updateRecentColor(o.head(n),r,i)}N(t)}},M=24,_=function(e){e.preventDefault(),e.stopPropagation();var t=v(e.target).editable(),n=t.offset().top-r.scrollTop(),i=v(e.currentTarget||e.target),s=i.editor().data("options");r.on("mousemove",function(e){var r=e.clientY-(n+M);r=s.minHeight>0?Math.max(r,s.minHeight):r,r=s.maxHeight>0?Math.min(r,s.maxHeight):r,t.height(r)}).one("mouseup",function(){r.off("mousemove")})},D=18,P=function(t,n){var r,i=e(t.target.parentNode),s=i.next(),o=i.find(".note-dimension-picker-mousecatcher"),u=i.find(".note-dimension-picker-highlighted"),a=i.find(".note-dimension-picker-unhighlighted");if(void 0===t.offsetX){var f=e(t.target).offset();r={x:t.pageX-f.left,y:t.pageY-f.top}}else r={x:t.offsetX,y:t.offsetY};var l={c:Math.ceil(r.x/D)||1,r:Math.ceil(r.y/D)||1};u.css({width:l.c+"em",height:l.r+"em"}),o.attr("data-value",l.c+"x"+l.r),3<l.c&&l.c<n.insertTableMaxSize.col&&a.css({width:l.c+1+"em"}),3<l.r&&l.r<n.insertTableMaxSize.row&&a.css({height:l.r+1+"em"}),s.html(l.c+" x "+l.r)},H=function(e,t){t.disableDragAndDrop?r.on("drop",function(e){e.preventDefault()}):B(e,t)},B=function(t,n){var i=e(),s=t.dropzone,o=t.dropzone.find(".note-dropzone-message");r.on("dragenter",function(e){var r=t.editor.hasClass("codeview");r||i.length||(t.editor.addClass("dragover"),s.width(t.editor.width()),s.height(t.editor.height()),o.text(n.langInfo.image.dragImageHere)),i=i.add(e.target)}).on("dragleave",function(e){i=i.not(e.target),i.length||t.editor.removeClass("dragover")}).on("drop",function(){i=e(),t.editor.removeClass("dragover")}),s.on("dragenter",function(){s.addClass("hover"),o.text(n.langInfo.image.dropImage)}).on("dragleave",function(){s.removeClass("hover"),o.text(n.langInfo.image.dragImageHere)}),s.on("drop",function(e){e.preventDefault();var t=e.originalEvent.dataTransfer,n=t.getData("text/plain"),r=v(e.currentTarget||e.target);r.editable().focus(),t&&t.files&&t.files.length?m(r,t.files):n&&u.insertText(r.editable(),n)}).on("dragover",!1)};this.bindKeyMap=function(t,n){var r=t.editor,i=t.editable;t=v(i),i.on("keydown",function(s){var o=[];s.metaKey&&o.push("CMD"),s.ctrlKey&&!s.altKey&&o.push("CTRL"),s.shiftKey&&o.push("SHIFT");var a=p.nameFromCode[s.keyCode];a&&o.push(a);var f=n[o.join("+")];if(f){if(s.preventDefault(),u[f])u[f](i,r.data("options"));else if(g[f])g[f].call(this,t);else if(e.summernote.plugins[f]){var l=e.summernote.plugins[f];e.isFunction(l.event)&&l.event(s,u,t)}}else p.isEdit(s.keyCode)&&u.afterCommand(i)})},this.attach=function(e,t){t.shortcuts&&this.bindKeyMap(e,t.keyMap[i.isMac?"mac":"pc"]),e.editable.on("mousedown",w),e.editable.on("keyup mouseup",N),e.editable.on("scroll",C),e.editable.on("paste",k),e.handle.on("mousedown",L),e.popover.on("click",O),e.popover.on("mousedown",A),t.airMode||(H(e,t),e.toolbar.on("click",O),e.toolbar.on("mousedown",A),t.disableResizeEditor||e.statusbar.on("mousedown",_));var n=t.airMode?e.popover:e.toolbar,r=n.find(".note-dimension-picker-mousecatcher");r.css({width:t.insertTableMaxSize.col+"em",height:t.insertTableMaxSize.row+"em"}).on("mousemove",function(e){P(e,t)}),e.editor.data("options",t),i.isMSIE||setTimeout(function(){document.execCommand("styleWithCSS",0,t.styleWithSpan)},0);var s=new b(e.editable);if(e.editable.data("NoteHistory",s),t.onenter&&e.editable.keypress(function(e){e.keyCode===p.ENTER&&t.onenter(e)}),t.onfocus&&e.editable.focus(t.onfocus),t.onblur&&e.editable.blur(t.onblur),t.onkeyup&&e.editable.keyup(t.onkeyup),t.onkeydown&&e.editable.keydown(t.onkeydown),t.onpaste&&e.editable.on("paste",t.onpaste),t.onToolbarClick&&e.toolbar.click(t.onToolbarClick),t.onChange){var o=function(){u.triggerOnChange(e.editable)};if(i.isMSIE){var a="DOMCharacterDataModified DOMSubtreeModified DOMNodeInserted";e.editable.on(a,o)}else e.editable.on("input",o)}e.editable.data("callbacks",{onChange:t.onChange,onAutoSave:t.onAutoSave,onImageUpload:t.onImageUpload,onImageUploadError:t.onImageUploadError,onFileUpload:t.onFileUpload,onFileUploadError:t.onFileUpload})},this.detach=function(e,t){e.editable.off(),e.popover.off(),e.handle.off(),e.dialog.off(),t.airMode||(e.dropzone.off(),e.toolbar.off(),e.statusbar.off())}},C=function(){var t=function(e,t){var n=t.event,r=t.value,i=t.title,s=t.className,o=t.dropdown,u=t.hide;return'<button type="button" class="btn btn-default btn-sm btn-small'+(s?" "+s:"")+(o?" dropdown-toggle":"")+'"'+(o?' data-toggle="dropdown"':"")+(i?' title="'+i+'"':"")+(n?' data-event="'+n+'"':"")+(r?" data-value='"+r+"'":"")+(u?" data-hide='"+u+"'":"")+' tabindex="-1">'+e+(o?' <span class="caret"></span>':"")+"</button>"+(o||"")},n=function(e,n){var r='<i class="'+e+'"></i>';return t(r,n)},r=function(e,t){return'<div class="'+e+' popover bottom in" style="display: none;"><div class="arrow"></div><div class="popover-content">'+t+"</div></div>"},o=function(e,t,n,r){return'<div class="'+e+' modal" aria-hidden="false"><div class="modal-dialog"><div class="modal-content">'+(t?'<div class="modal-header"><button type="button" class="close" aria-hidden="true" tabindex="-1">&times;</button><h4 class="modal-title">'+t+"</h4></div>":"")+'<form class="note-modal-form"><div class="modal-body">'+n+"</div>"+(r?'<div class="modal-footer">'+r+"</div>":"")+"</form></div></div></div>"},u={picture:function(e){return n("fa fa-picture-o",{event:"showImageDialog",title:e.image.image,hide:!0})},link:function(e){return n("fa fa-link",{event:"showLinkDialog",title:e.link.link,hide:!0})},table:function(e){var t='<ul class="note-table dropdown-menu"><div class="note-dimension-picker"><div class="note-dimension-picker-mousecatcher" data-event="insertTable" data-value="1x1"></div><div class="note-dimension-picker-highlighted"></div><div class="note-dimension-picker-unhighlighted"></div></div><div class="note-dimension-display"> 1 x 1 </div></ul>';return n("fa fa-table",{title:e.table.table,dropdown:t})},style:function(e,t){var r=t.styleTags.reduce(function(t,n){var r=e.style["p"===n?"normal":n];return t+'<li><a data-event="formatBlock" href="#" data-value="'+n+'">'+("p"===n||"pre"===n?r:"<"+n+">"+r+"</"+n+">")+"</a></li>"},"");return n("fa fa-magic",{title:e.style.style,dropdown:'<ul class="dropdown-menu">'+r+"</ul>"})},fontname:function(e,n){var r=n.fontNames.reduce(function(e,t){return i.isFontInstalled(t)?e+'<li><a data-event="fontName" href="#" data-value="'+t+'"><i class="fa fa-check"></i> '+t+"</a></li>":e},""),s='<span class="note-current-fontname">'+n.defaultFontName+"</span>";return t(s,{title:e.font.name,dropdown:'<ul class="dropdown-menu">'+r+"</ul>"})},color:function(e){var n='<i class="fa fa-font" style="color:black;background-color:yellow;"></i>',r=t(n,{className:"note-recent-color",title:e.color.recent,event:"color",value:'{"backColor":"yellow"}'}),i='<ul class="dropdown-menu"><li><div class="btn-group"><div class="note-palette-title">'+e.color.background+'</div><div class="note-color-reset" data-event="backColor" data-value="inherit" title="'+e.color.transparent+'">'+e.color.setTransparent+'</div><div class="note-color-palette" data-target-event="backColor"></div></div><div class="btn-group"><div class="note-palette-title">'+e.color.foreground+'</div><div class="note-color-reset" data-event="foreColor" data-value="inherit" title="'+e.color.reset+'">'+e.color.resetToDefault+'</div><div class="note-color-palette" data-target-event="foreColor"></div></div></li></ul>',s=t("",{title:e.color.more,dropdown:i});return r+s},bold:function(e){return n("fa fa-bold",{event:"bold",title:e.font.bold})},italic:function(e){return n("fa fa-italic",{event:"italic",title:e.font.italic})},underline:function(e){return n("fa fa-underline",{event:"underline",title:e.font.underline})},clear:function(e){return n("fa fa-eraser",{event:"removeFormat",title:e.font.clear})},ul:function(e){return n("fa fa-list-ul",{event:"insertUnorderedList",title:e.lists.unordered})},ol:function(e){return n("fa fa-list-ol",{event:"insertOrderedList",title:e.lists.ordered})},paragraph:function(e){var t=n("fa fa-align-left",{title:e.paragraph.left,event:"justifyLeft"}),r=n("fa fa-align-center",{title:e.paragraph.center,event:"justifyCenter"}),i=n("fa fa-align-right",{title:e.paragraph.right,event:"justifyRight"}),s=n("fa fa-align-justify",{title:e.paragraph.justify,event:"justifyFull"}),o=n("fa fa-outdent",{title:e.paragraph.outdent,event:"outdent"}),u=n("fa fa-indent",{title:e.paragraph.indent,event:"indent"}),a='<div class="dropdown-menu"><div class="note-align btn-group">'+t+r+i+s+'</div><div class="note-list btn-group">'+u+o+"</div></div>";return n("fa fa-align-left",{title:e.paragraph.paragraph,dropdown:a})},height:function(e,t){var r=t.lineHeights.reduce(function(e,t){return e+'<li><a data-event="lineHeight" href="#" data-value="'+parseFloat(t)+'"><i class="fa fa-check"></i> '+t+"</a></li>"},"");return n("fa fa-text-height",{title:e.font.height,dropdown:'<ul class="dropdown-menu">'+r+"</ul>"})},help:function(e){return n("fa fa-question",{event:"showHelpDialog",title:e.options.help,hide:!0})},fullscreen:function(e){return n("fa fa-arrows-alt",{event:"fullscreen",title:e.options.fullscreen})},codeview:function(e){return n("fa fa-code",{event:"codeview",title:e.options.codeview})},undo:function(e){return n("fa fa-undo",{event:"undo",title:e.history.undo})},redo:function(e){return n("fa fa-repeat",{event:"redo",title:e.history.redo})},hr:function(e){return n("fa fa-minus",{event:"insertHorizontalRule",title:e.hr.insert})}},a=function(e,i){var s=function(){var t=n("fa fa-edit",{title:e.link.edit,event:"showLinkDialog",hide:!0}),i=n("fa fa-unlink",{title:e.link.unlink,event:"unlink"}),s='<a href="http://www.google.com" target="_blank">www.google.com</a>&nbsp;&nbsp;<div class="note-insert btn-group">'+t+i+"</div>";return r("note-link-popover",s)},o=function(){var i=t('<span class="note-fontsize-10">100%</span>',{title:e.image.resizeFull,event:"resize",value:"1"}),s=t('<span class="note-fontsize-10">50%</span>',{title:e.image.resizeHalf,event:"resize",value:"0.5"}),o=t('<span class="note-fontsize-10">25%</span>',{title:e.image.resizeQuarter,event:"resize",value:"0.25"}),u=n("fa fa-align-left",{title:e.image.floatLeft,event:"floatMe",value:"left"}),a=n("fa fa-align-right",{title:e.image.floatRight,event:"floatMe",value:"right"}),f=n("fa fa-align-justify",{title:e.image.floatNone,event:"floatMe",value:"none"}),l=n("fa fa-square",{title:e.image.shapeRounded,event:"imageShape",value:"img-rounded"}),c=n("fa fa-circle-o",{title:e.image.shapeCircle,event:"imageShape",value:"img-circle"}),h=n("fa fa-picture-o",{title:e.image.shapeThumbnail,event:"imageShape",value:"img-thumbnail"}),p=n("fa fa-times",{title:e.image.shapeNone,event:"imageShape",value:""}),d=n("fa fa-trash-o",{title:e.image.remove,event:"removeMedia",value:"none"}),v='<div class="btn-group">'+i+s+o+'</div><div class="btn-group">'+u+a+f+'</div><div class="btn-group">'+l+c+h+p+'</div><div class="btn-group">'+d+"</div>";return r("note-image-popover",v)},a=function(){for(var t="",n=0,s=i.airPopover.length;s>n;n++){var o=i.airPopover[n];t+='<div class="note-'+o[0]+' btn-group">';for(var a=0,f=o[1].length;f>a;a++)t+=u[o[1][a]](e,i);t+="</div>"}return r("note-air-popover",t)};return'<div class="note-popover">'+s()+o()+(i.airMode?a():"")+"</div>"},l=function(){return'<div class="note-handle"><div class="note-control-selection"><div class="note-control-selection-bg"></div><div class="note-control-holder note-control-nw"></div><div class="note-control-holder note-control-ne"></div><div class="note-control-holder note-control-sw"></div><div class="note-control-sizing note-control-se"></div><div class="note-control-selection-info"></div></div></div>'},c=function(e,t){var n="note-shortcut-col col-xs-6 note-shortcut-",r=[];for(var i in t)r.push('<div class="'+n+'key">'+t[i].kbd+'</div><div class="'+n+'name">'+t[i].text+"</div>");return'<div class="note-shortcut-row row"><div class="'+n+'title col-xs-offset-6">'+e+'</div></div><div class="note-shortcut-row row">'+r.join('</div><div class="note-shortcut-row row">')+"</div>"},h=function(e){var t=[{kbd:"⌘ + B",text:e.font.bold},{kbd:"⌘ + I",text:e.font.italic},{kbd:"⌘ + U",text:e.font.underline},{kbd:"⌘ + \\",text:e.font.clear}];return c(e.shortcut.textFormatting,t)},p=function(e){var t=[{kbd:"⌘ + Z",text:e.history.undo},{kbd:"⌘ + ⇧ + Z",text:e.history.redo},{kbd:"⌘ + ]",text:e.paragraph.indent},{kbd:"⌘ + [",text:e.paragraph.outdent},{kbd:"⌘ + ENTER",text:e.hr.insert}];return c(e.shortcut.action,t)},d=function(e){var t=[{kbd:"⌘ + ⇧ + L",text:e.paragraph.left},{kbd:"⌘ + ⇧ + E",text:e.paragraph.center},{kbd:"⌘ + ⇧ + R",text:e.paragraph.right},{kbd:"⌘ + ⇧ + J",text:e.paragraph.justify},{kbd:"⌘ + ⇧ + NUM7",text:e.lists.ordered},{kbd:"⌘ + ⇧ + NUM8",text:e.lists.unordered}];return c(e.shortcut.paragraphFormatting,t)},v=function(e){var t=[{kbd:"⌘ + NUM0",text:e.style.normal},{kbd:"⌘ + NUM1",text:e.style.h1},{kbd:"⌘ + NUM2",text:e.style.h2},{kbd:"⌘ + NUM3",text:e.style.h3},{kbd:"⌘ + NUM4",text:e.style.h4},{kbd:"⌘ + NUM5",text:e.style.h5},{kbd:"⌘ + NUM6",text:e.style.h6}];return c(e.shortcut.documentStyle,t)},m=function(e,t){var n=t.extraKeys,r=[];for(var i in n)n.hasOwnProperty(i)&&r.push({kbd:i,text:n[i]});return c(e.shortcut.extraKeys,r)},g=function(e,t){var n='class="note-shortcut note-shortcut-col col-sm-6 col-xs-12"',r=["<div "+n+">"+p(e,t)+"</div><div "+n+">"+h(e,t)+"</div>","<div "+n+">"+v(e,t)+"</div><div "+n+">"+d(e,t)+"</div>"];return t.extraKeys&&r.push("<div "+n+">"+m(e,t)+"</div>"),'<div class="note-shortcut-row row">'+r.join('</div><div class="note-shortcut-row row">')+"</div>"},y=function(e){return e.replace(/⌘/g,"Ctrl").replace(/⇧/g,"Shift")},b={image:function(e,t){var n="";if(t.maximumImageFileSize){var r=Math.floor(Math.log(t.maximumImageFileSize)/Math.log(1024)),i=1*(t.maximumImageFileSize/Math.pow(1024,r)).toFixed(2)+" "+" KMGTP"[r]+"B";n="<small>"+e.image.maximumFileSize+" : "+i+"</small>"}var s='<div class="form-group row-fluid note-group-select-from-files"><label>'+e.image.selectFromFiles+'</label><input class="note-image-input" type="file" name="files" accept="image/*" multiple="multiple" />'+n+'</div><div class="form-group row-fluid"><label>'+e.image.url+'</label><input class="note-image-url form-control span12" type="text" /></div>',u='<button href="#" class="btn btn-primary note-image-btn disabled" disabled>'+e.image.insert+"</button>";return o("note-image-dialog",e.image.insert,s,u)},link:function(e,t){var n='<div class="form-group row-fluid"><label>'+e.link.textToDisplay+'</label><input class="note-link-text form-control span12" type="text" /></div><div class="form-group row-fluid"><label>'+e.link.url+'</label><input class="note-link-url form-control span12" type="text" /></div>'+(t.disableLinkTarget?"":'<div class="checkbox"><label><input type="checkbox" checked> '+e.link.openInNewWindow+"</label></div>"),r='<button href="#" class="btn btn-primary note-link-btn disabled" disabled>'+e.link.insert+"</button>";return o("note-link-dialog",e.link.insert,n,r)},help:function(e,t){var n='<a class="modal-close pull-right" aria-hidden="true" tabindex="-1">'+e.shortcut.close+'</a><div class="title">'+e.shortcut.shortcuts+"</div>"+(i.isMac?g(e,t):y(g(e,t)))+'<p class="text-center"><a href="//hackerwins.github.io/summernote/" target="_blank">Summernote 0.6.0</a> · <a href="//github.com/HackerWins/summernote" target="_blank">Project</a> · <a href="//github.com/HackerWins/summernote/issues" target="_blank">Issues</a></p>';return o("note-help-dialog","",n,"")}},w=function(t,n){var r="";return e.each(b,function(e,i){r+=i(t,n)}),'<div class="note-dialog">'+r+"</div>"},E=function(){return'<div class="note-resizebar"><div class="note-icon-bar"></div><div class="note-icon-bar"></div><div class="note-icon-bar"></div></div>'},S=function(e){return i.isMac&&(e=e.replace("CMD","⌘").replace("SHIFT","⇧")),e.replace("BACKSLASH","\\").replace("SLASH","/").replace("LEFTBRACKET","[").replace("RIGHTBRACKET","]")},x=function(t,n,r){var i=s.invertObject(n),o=t.find("button");o.each(function(t,n){var r=e(n),s=i[r.data("event")];s&&r.attr("title",function(e,t){return t+" ("+S(s)+")"})}).tooltip({container:"body",trigger:"hover",placement:r||"top"}).on("click",function(){e(this).tooltip("hide")})},T=function(t,n){var r=n.colors;t.find(".note-color-palette").each(function(){for(var t=e(this),n=t.attr("data-target-event"),i=[],s=0,o=r.length;o>s;s++){for(var u=r[s],a=[],f=0,l=u.length;l>f;f++){var c=u[f];a.push(['<button type="button" class="note-color-btn" style="background-color:',c,';" data-event="',n,'" data-value="',c,'" title="',c,'" data-toggle="button" tabindex="-1"></button>'].join(""))}i.push('<div class="note-color-row">'+a.join("")+"</div>")}t.html(i.join(""))})};this.createLayoutByAirMode=function(t,n){var r=n.langInfo,o=n.keyMap[i.isMac?"mac":"pc"],u=s.uniqueId();t.addClass("note-air-editor note-editable"),t.attr({id:"note-editor-"+u,contentEditable:!0});var f=document.body,c=e(a(r,n));c.addClass("note-air-layout"),c.attr("id","note-popover-"+u),c.appendTo(f),x(c,o),T(c,n);var h=e(l());h.addClass("note-air-layout"),h.attr("id","note-handle-"+u),h.appendTo(f);var p=e(w(r,n));p.addClass("note-air-layout"),p.attr("id","note-dialog-"+u),p.find("button.close, a.modal-close").click(function(){e(this).closest(".modal").modal("hide")}),p.appendTo(f)},this.createLayoutByFrame=function(t,n){var r=n.langInfo,s=e('<div class="note-editor"></div>');n.width&&s.width(n.width),n.height>0&&e('<div class="note-statusbar">'+(n.disableResizeEditor?"":E())+"</div>").prependTo(s);var o=!t.is(":disabled"),c=e('<div class="note-editable" contentEditable="'+o+'"></div>').prependTo(s);n.height&&c.height(n.height),n.direction&&c.attr("dir",n.direction),n.placeholder&&c.attr("data-placeholder",n.placeholder),c.html(f.html(t)),e('<textarea class="note-codable"></textarea>').prependTo(s);for(var h="",p=0,d=n.toolbar.length;d>p;p++){var v=n.toolbar[p][0],m=n.toolbar[p][1];h+='<div class="note-'+v+' btn-group">';for(var g=0,y=m.length;y>g;g++){var b=u[m[g]];e.isFunction(b)&&(h+=b(r,n))}h+="</div>"}h='<div class="note-toolbar btn-toolbar">'+h+"</div>";var S=e(h).prependTo(s),N=n.keyMap[i.isMac?"mac":"pc"];T(S,n),x(S,N,"bottom");var C=e(a(r,n)).prependTo(s);T(C,n),x(C,N),e(l()).prependTo(s);var k=e(w(r,n)).prependTo(s);k.find("button.close, a.modal-close").click(function(){e(this).closest(".modal").modal("hide")}),e('<div class="note-dropzone"><div class="note-dropzone-message"></div></div>').prependTo(s),s.insertAfter(t),t.hide()},this.noteEditorFromHolder=function(t){return t.hasClass("note-air-editor")?t:t.next().hasClass("note-editor")?t.next():e()},this.createLayout=function(e,t){this.noteEditorFromHolder(e).length||(t.airMode?this.createLayoutByAirMode(e,t):this.createLayoutByFrame(e,t))},this.layoutInfoFromHolder=function(e){var t=this.noteEditorFromHolder(e);if(t.length){var n=f.buildLayoutInfo(t);for(var r in n)n.hasOwnProperty(r)&&(n[r]=n[r].call());return n}},this.removeLayout=function(e,t,n){n.airMode?(e.removeClass("note-air-editor note-editable").removeAttr("id contentEditable"),t.popover.remove(),t.handle.remove(),t.dialog.remove()):(e.html(t.editable.html()),t.editor.remove(),e.show())},this.getTemplate=function(){return{button:t,iconButton:n,dialog:o}},this.addButtonInfo=function(e,t){u[e]=t},this.addDialogInfo=function(e,t){b[e]=t}};e.summernote=e.summernote||{},e.extend(e.summernote,c);var k=new C,L=new N;e.extend(e.summernote,{renderer:k,eventHandler:L,core:{agent:i,dom:f,range:l},pluginEvents:{}}),e.summernote.addPlugin=function(t){t.buttons&&e.each(t.buttons,function(e,t){k.addButtonInfo(e,t)}),t.dialogs&&e.each(t.dialogs,function(e,t){k.addDialogInfo(e,t)}),t.events&&e.each(t.events,function(t,n){e.summernote.pluginEvents[t]=n}),t.langs&&e.each(t.langs,function(t,n){e.summernote.lang[t]&&e.extend(e.summernote.lang[t],n)}),t.options&&e.extend(e.summernote.options,t.options)},e.fn.extend({summernote:function(t){if(t=e.extend({},e.summernote.options,t),t.langInfo=e.extend(!0,{},e.summernote.lang["en-US"],e.summernote.lang[t.lang]),this.each(function(n,r){var i=e(r);k.createLayout(i,t);var s=k.layoutInfoFromHolder(i);L.attach(s,t),f.isTextarea(i[0])&&i.closest("form").submit(function(){var e=i.code();i.val(e),t.onsubmit&&t.onsubmit(e)})}),this.first().length&&t.focus){var n=k.layoutInfoFromHolder(this.first());n.editable.focus()}return this.length&&t.oninit&&t.oninit(),this},code:function(t){if(void 0===t){var n=this.first();if(!n.length)return;var r=k.layoutInfoFromHolder(n);if(r&&r.editable){var s=r.editor.hasClass("codeview");return s&&i.hasCodeMirror&&r.codable.data("cmEditor").save(),s?r.codable.val():r.editable.html()}return f.isTextarea(n[0])?n.val():n.html()}return this.each(function(n,r){var i=k.layoutInfoFromHolder(e(r));i&&i.editable&&i.editable.html(t)}),this},destroy:function(){return this.each(function(t,n){var r=e(n),i=k.layoutInfoFromHolder(r);if(i&&i.editable){var s=i.editor.data("options");L.detach(i,s),k.removeLayout(r,i,s)}}),this}})}),function(e,t){typeof define=="function"&&define.amd?define("sifter",t):typeof exports=="object"?module.exports=t():e.Sifter=t()}(this,function(){var e=function(e,t){this.items=e,this.settings=t||{diacritics:!0}};e.prototype.tokenize=function(e){e=r(String(e||"").toLowerCase());if(!e||!e.length)return[];var t,n,s,u,a=[],f=e.split(/ +/);for(t=0,n=f.length;t<n;t++){s=i(f[t]);if(this.settings.diacritics)for(u in o)o.hasOwnProperty(u)&&(s=s.replace(new RegExp(u,"g"),o[u]));a.push({string:f[t],regex:new RegExp(s,"i")})}return a},e.prototype.iterator=function(e,t){var n;s(e)?n=Array.prototype.forEach||function(e){for(var t=0,n=this.length;t<n;t++)e(this[t],t,this)}:n=function(e){for(var t in this)this.hasOwnProperty(t)&&e(this[t],t,this)},n.apply(e,[t])},e.prototype.getScoreFunction=function(e,t){var n,r,i,s;n=this,e=n.prepareSearch(e,t),i=e.tokens,r=e.options.fields,s=i.length;var o=function(e,t){var n,r;return e?(e=String(e||""),r=e.search(t.regex),r===-1?0:(n=t.string.length/e.length,r===0&&(n+=.5),n)):0},u=function(){var e=r.length;return e?e===1?function(e,t){return o(t[r[0]],e)}:function(t,n){for(var i=0,s=0;i<e;i++)s+=o(n[r[i]],t);return s/e}:function(){return 0}}();return s?s===1?function(e){return u(i[0],e)}:e.options.conjunction==="and"?function(e){var t;for(var n=0,r=0;n<s;n++){t=u(i[n],e);if(t<=0)return 0;r+=t}return r/s}:function(e){for(var t=0,n=0;t<s;t++)n+=u(i[t],e);return n/s}:function(){return 0}},e.prototype.getSortFunction=function(e,n){var r,i,s,o,u,a,f,l,c,h,p;s=this,e=s.prepareSearch(e,n),p=!e.query&&n.sort_empty||n.sort,c=function(e,t){return e==="$score"?t.score:s.items[t.id][e]},u=[];if(p)for(r=0,i=p.length;r<i;r++)(e.query||p[r].field!=="$score")&&u.push(p[r]);if(e.query){h=!0;for(r=0,i=u.length;r<i;r++)if(u[r].field==="$score"){h=!1;break}h&&u.unshift({field:"$score",direction:"desc"})}else for(r=0,i=u.length;r<i;r++)if(u[r].field==="$score"){u.splice(r,1);break}l=[];for(r=0,i=u.length;r<i;r++)l.push(u[r].direction==="desc"?-1:1);return a=u.length,a?a===1?(o=u[0].field,f=l[0],function(e,n){return f*t(c(o,e),c(o,n))}):function(e,n){var r,i,s,o,f;for(r=0;r<a;r++){f=u[r].field,i=l[r]*t(c(f,e),c(f,n));if(i)return i}return 0}:null},e.prototype.prepareSearch=function(e,t){if(typeof e=="object")return e;t=n({},t);var r=t.fields,i=t.sort,o=t.sort_empty;return r&&!s(r)&&(t.fields=[r]),i&&!s(i)&&(t.sort=[i]),o&&!s(o)&&(t.sort_empty=[o]),{options:t,query:String(e||"").toLowerCase(),tokens:this.tokenize(e),total:0,items:[]}},e.prototype.search=function(e,t){var n=this,r,i,s,o,u,a;return s=this.prepareSearch(e,t),t=s.options,e=s.query,a=t.score||n.getScoreFunction(s),e.length?n.iterator(n.items,function(e,n){i=a(e),(t.filter===!1||i>0)&&s.items.push({score:i,id:n})}):n.iterator(n.items,function(e,t){s.items.push({score:1,id:t})}),u=n.getSortFunction(s,t),u&&s.items.sort(u),s.total=s.items.length,typeof t.limit=="number"&&(s.items=s.items.slice(0,t.limit)),s};var t=function(e,t){return typeof e=="number"&&typeof t=="number"?e>t?1:e<t?-1:0:(e=u(String(e||"")),t=u(String(t||"")),e>t?1:t>e?-1:0)},n=function(e,t){var n,r,i,s;for(n=1,r=arguments.length;n<r;n++){s=arguments[n];if(!s)continue;for(i in s)s.hasOwnProperty(i)&&(e[i]=s[i])}return e},r=function(e){return(e+"").replace(/^\s+|\s+$|/g,"")},i=function(e){return(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||$&&$.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"},o={a:"[aÀÁÂÃÄÅàáâãäåĀāąĄ]",c:"[cÇçćĆčČ]",d:"[dđĐďĎ]",e:"[eÈÉÊËèéêëěĚĒēęĘ]",i:"[iÌÍÎÏìíîïĪī]",l:"[lłŁ]",n:"[nÑñňŇńŃ]",o:"[oÒÓÔÕÕÖØòóôõöøŌō]",r:"[rřŘ]",s:"[sŠšśŚ]",t:"[tťŤ]",u:"[uÙÚÛÜùúûüůŮŪū]",y:"[yŸÿýÝ]",z:"[zŽžżŻźŹ]"},u=function(){var e,t,n,r,i="",s={};for(n in o)if(o.hasOwnProperty(n)){r=o[n].substring(2,o[n].length-1),i+=r;for(e=0,t=r.length;e<t;e++)s[r.charAt(e)]=n}var u=new RegExp("["+i+"]","g");return function(e){return e.replace(u,function(e){return s[e]}).toLowerCase()}}();return e}),function(e,t){typeof define=="function"&&define.amd?define("microplugin",t):typeof exports=="object"?module.exports=t():e.MicroPlugin=t()}(this,function(){var e={};e.mixin=function(e){e.plugins={},e.prototype.initializePlugins=function(e){var n,r,i,s=this,o=[];s.plugins={names:[],settings:{},requested:{},loaded:{}};if(t.isArray(e))for(n=0,r=e.length;n<r;n++)typeof e[n]=="string"?o.push(e[n]):(s.plugins.settings[e[n].name]=e[n].options,o.push(e[n].name));else if(e)for(i in e)e.hasOwnProperty(i)&&(s.plugins.settings[i]=e[i],o.push(i));while(o.length)s.require(o.shift())},e.prototype.loadPlugin=function(t){var n=this,r=n.plugins,i=e.plugins[t];if(!e.plugins.hasOwnProperty(t))throw new Error('Unable to find "'+t+'" plugin');r.requested[t]=!0,r.loaded[t]=i.fn.apply(n,[n.plugins.settings[t]||{}]),r.names.push(t)},e.prototype.require=function(e){var t=this,n=t.plugins;if(!t.plugins.loaded.hasOwnProperty(e)){if(n.requested[e])throw new Error('Plugin has circular dependency ("'+e+'")');t.loadPlugin(e)}return n.loaded[e]},e.define=function(t,n){e.plugins[t]={name:t,fn:n}}};var t={isArray:Array.isArray||function(e){return Object.prototype.toString.call(e)==="[object Array]"}};return e}),function(e,t){typeof define=="function"&&define.amd?define("selectize",["jquery","sifter","microplugin"],t):typeof exports=="object"?module.exports=t(require("jquery"),require("sifter"),require("microplugin")):e.Selectize=t(e.jQuery,e.Sifter,e.MicroPlugin)}(this,function(e,t,n){var r=function(e,t){if(typeof t=="string"&&!t.length)return;var n=typeof t=="string"?new RegExp(t,"i"):t,r=function(e){var t=0;if(e.nodeType===3){var i=e.data.search(n);if(i>=0&&e.data.length>0){var s=e.data.match(n),o=document.createElement("span");o.className="highlight";var u=e.splitText(i),a=u.splitText(s[0].length),f=u.cloneNode(!0);o.appendChild(f),u.parentNode.replaceChild(o,u),t=1}}else if(e.nodeType===1&&e.childNodes&&!/(script|style)/i.test(e.tagName))for(var l=0;l<e.childNodes.length;++l)l+=r(e.childNodes[l]);return t};return e.each(function(){r(this)})},i=function(){};i.prototype={on:function(e,t){this._events=this._events||{},this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){var n=arguments.length;if(n===0)return delete this._events;if(n===1)return delete this._events[e];this._events=this._events||{};if(e in this._events==0)return;this._events[e].splice(this._events[e].indexOf(t),1)},trigger:function(e){this._events=this._events||{};if(e in this._events==0)return;for(var t=0;t<this._events[e].length;t++)this._events[e][t].apply(this,Array.prototype.slice.call(arguments,1))}},i.mixin=function(e){var t=["on","off","trigger"];for(var n=0;n<t.length;n++)e.prototype[t[n]]=i.prototype[t[n]]};var s=/Mac/.test(navigator.userAgent),o=65,u=188,a=13,f=27,l=37,c=38,h=80,p=39,d=40,v=78,m=8,g=46,y=16,b=s?91:17,w=s?18:17,E=9,S=1,x=2,T=!/android/i.test(window.navigator.userAgent)&&!!document.createElement("form").validity,N=function(e){return typeof e!="undefined"},C=function(e){return typeof e=="undefined"||e===null?null:typeof e=="boolean"?e?"1":"0":e+""},k=function(e){return(e+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},L=function(e){return(e+"").replace(/\$/g,"$$$$")},A={};A.before=function(e,t,n){var r=e[t];e[t]=function(){return n.apply(e,arguments),r.apply(e,arguments)}},A.after=function(e,t,n){var r=e[t];e[t]=function(){var t=r.apply(e,arguments);return n.apply(e,arguments),t}};var O=function(e){var t=!1;return function(){if(t)return;t=!0,e.apply(this,arguments)}},M=function(e,t){var n;return function(){var r=this,i=arguments;window.clearTimeout(n),n=window.setTimeout(function(){e.apply(r,i)},t)}},_=function(e,t,n){var r,i=e.trigger,s={};e.trigger=function(){var n=arguments[0];if(t.indexOf(n)===-1)return i.apply(e,arguments);s[n]=arguments},n.apply(e,[]),e.trigger=i;for(r in s)s.hasOwnProperty(r)&&i.apply(e,s[r])},D=function(e,t,n,r){e.on(t,n,function(t){var n=t.target;while(n&&n.parentNode!==e[0])n=n.parentNode;return t.currentTarget=n,r.apply(this,[t])})},P=function(e){var t={};if("selectionStart"in e)t.start=e.selectionStart,t.length=e.selectionEnd-t.start;else if(document.selection){e.focus();var n=document.selection.createRange(),r=document.selection.createRange().text.length;n.moveStart("character",-e.value.length),t.start=n.text.length-r,t.length=r}return t},H=function(e,t,n){var r,i,s={};if(n)for(r=0,i=n.length;r<i;r++)s[n[r]]=e.css(n[r]);else s=e.css();t.css(s)},B=function(t,n){if(!t)return 0;var r=e("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"pre"}).text(t).appendTo("body");H(n,r,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var i=r.width();return r.remove(),i},j=function(e){var t=null,n=function(n,r){var i,s,o,u,a,f,l,c;n=n||window.event||{},r=r||{};if(n.metaKey||n.altKey)return;if(!r.force&&e.data("grow")===!1)return;i=e.val(),n.type&&n.type.toLowerCase()==="keydown"&&(s=n.keyCode,o=s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||s===32,s===g||s===m?(c=P(e[0]),c.length?i=i.substring(0,c.start)+i.substring(c.start+c.length):s===m&&c.start?i=i.substring(0,c.start-1)+i.substring(c.start+1):s===g&&typeof c.start!="undefined"&&(i=i.substring(0,c.start)+i.substring(c.start+1))):o&&(f=n.shiftKey,l=String.fromCharCode(n.keyCode),f?l=l.toUpperCase():l=l.toLowerCase(),i+=l)),u=e.attr("placeholder"),!i&&u&&(i=u),a=B(i,e)+4,a!==t&&(t=a,e.width(a),e.triggerHandler("resize"))};e.on("keydown keyup update blur",n),n()},F=function(n,r){var i,s,o,u,a,f=this;a=n[0],a.selectize=f;var l=window.getComputedStyle&&window.getComputedStyle(a,null);u=l?l.getPropertyValue("direction"):a.currentStyle&&a.currentStyle.direction,u=u||n.parents("[dir]:first").attr("dir")||"",e.extend(f,{order:0,settings:r,$input:n,tabIndex:n.attr("tabindex")||"",tagType:a.tagName.toLowerCase()==="select"?S:x,rtl:/rtl/i.test(u),eventNS:".selectize"+ ++F.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isRequired:n.is("[required]"),isInvalid:!1,isLocked:!1,isFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreBlur:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:r.loadThrottle===null?f.onSearchChange:M(f.onSearchChange,r.loadThrottle)}),f.sifter=new t(this.options,{diacritics:r.diacritics});if(f.settings.options){for(s=0,o=f.settings.options.length;s<o;s++)f.registerOption(f.settings.options[s]);delete f.settings.options}if(f.settings.optgroups){for(s=0,o=f.settings.optgroups.length;s<o;s++)f.registerOptionGroup(f.settings.optgroups[s]);delete f.settings.optgroups}f.settings.mode=f.settings.mode||(f.settings.maxItems===1?"single":"multi"),typeof f.settings.hideSelected!="boolean"&&(f.settings.hideSelected=f.settings.mode==="multi"),f.initializePlugins(f.settings.plugins),f.setupCallbacks(),f.setupTemplates(),f.setup()};return i.mixin(F),n.mixin(F),e.extend(F.prototype,{setup:function(){var t=this,n=t.settings,r=t.eventNS,i=e(window),o=e(document),u=t.$input,a,f,l,c,h,p,d,v,m,g,E;d=t.settings.mode,g=u.attr("class")||"",a=e("<div>").addClass(n.wrapperClass).addClass(g).addClass(d),f=e("<div>").addClass(n.inputClass).addClass("items").appendTo(a),l=e('<input type="text" autocomplete="off" />').appendTo(f).attr("tabindex",u.is(":disabled")?"-1":t.tabIndex),p=e(n.dropdownParent||a),c=e("<div>").addClass(n.dropdownClass).addClass(d).hide().appendTo(p),h=e("<div>").addClass(n.dropdownContentClass).appendTo(c),t.settings.copyClassesToDropdown&&c.addClass(g),a.css({width:u[0].style.width}),t.plugins.names.length&&(E="plugin-"+t.plugins.names.join(" plugin-"),a.addClass(E),c.addClass(E)),(n.maxItems===null||n.maxItems>1)&&t.tagType===S&&u.attr("multiple","multiple"),t.settings.placeholder&&l.attr("placeholder",n.placeholder);if(!t.settings.splitOn&&t.settings.delimiter){var x=t.settings.delimiter.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");t.settings.splitOn=new RegExp("\\s*"+x+"+\\s*")}u.attr("autocorrect")&&l.attr("autocorrect",u.attr("autocorrect")),u.attr("autocapitalize")&&l.attr("autocapitalize",u.attr("autocapitalize")),t.$wrapper=a,t.$control=f,t.$control_input=l,t.$dropdown=c,t.$dropdown_content=h,c.on("mouseenter","[data-selectable]",function(){return t.onOptionHover.apply(t,arguments)}),c.on("mousedown click","[data-selectable]",function(){return t.onOptionSelect.apply(t,arguments)}),D(f,"mousedown","*:not(input)",function(){return t.onItemSelect.apply(t,arguments)}),j(l),f.on({mousedown:function(){return t.onMouseDown.apply(t,arguments)},click:function(){return t.onClick.apply(t,arguments)}}),l.on({mousedown:function(e){e.stopPropagation()},keydown:function(){return t.onKeyDown.apply(t,arguments)},keyup:function(){return t.onKeyUp.apply(t,arguments)},keypress:function(){return t.onKeyPress.apply(t,arguments)},resize:function(){t.positionDropdown.apply(t,[])},blur:function(){return t.onBlur.apply(t,arguments)},focus:function(){return t.ignoreBlur=!1,t.onFocus.apply(t,arguments)},paste:function(){return t.onPaste.apply(t,arguments)}}),o.on("keydown"+r,function(e){t.isCmdDown=e[s?"metaKey":"ctrlKey"],t.isCtrlDown=e[s?"altKey":"ctrlKey"],t.isShiftDown=e.shiftKey}),o.on("keyup"+r,function(e){e.keyCode===w&&(t.isCtrlDown=!1),e.keyCode===y&&(t.isShiftDown=!1),e.keyCode===b&&(t.isCmdDown=!1)}),o.on("mousedown"+r,function(e){if(t.isFocused){if(e.target===t.$dropdown[0]||e.target.parentNode===t.$dropdown[0])return!1;!t.$control.has(e.target).length&&e.target!==t.$control[0]&&t.blur(e.target)}}),i.on(["scroll"+r,"resize"+r].join(" "),function(){t.isOpen&&t.positionDropdown.apply(t,arguments)}),i.on("mousemove"+r,function(){t.ignoreHover=!1}),this.revertSettings={$children:u.children().detach(),tabindex:u.attr("tabindex")},u.attr("tabindex",-1).hide().after(t.$wrapper),e.isArray(n.items)&&(t.setValue(n.items),delete n.items),T&&u.on("invalid"+r,function(e){e.preventDefault(),t.isInvalid=!0,t.refreshState()}),t.updateOriginalInput(),t.refreshItems(),t.refreshState(),t.updatePlaceholder(),t.isSetup=!0,u.is(":disabled")&&t.disable(),t.on("change",this.onChange),u.data("selectize",t),u.addClass("selectized"),t.trigger("initialize"),n.preload===!0&&t.onSearchChange("")},setupTemplates:function(){var t=this,n=t.settings.labelField,r=t.settings.optgroupLabelField,i={optgroup:function(e){return'<div class="optgroup">'+e.html+"</div>"},optgroup_header:function(e,t){return'<div class="optgroup-header">'+t(e[r])+"</div>"},option:function(e,t){return'<div class="option">'+t(e[n])+"</div>"},item:function(e,t){return'<div class="item">'+t(e[n])+"</div>"},option_create:function(e,t){return'<div class="create">Add <strong>'+t(e.input)+"</strong>&hellip;</div>"}};t.settings.render=e.extend({},i,t.settings.render)},setupCallbacks:function(){var e,t,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(e in n)n.hasOwnProperty(e)&&(t=this.settings[n[e]],t&&this.on(e,t))},onClick:function(e){var t=this;t.isFocused||(t.focus(),e.preventDefault())},onMouseDown:function(t){var n=this,r=t.isDefaultPrevented(),i=e(t.target);if(n.isFocused){if(t.target!==n.$control_input[0])return n.settings.mode==="single"?n.isOpen?n.close():n.open():r||n.setActiveItem(null),!1}else r||window.setTimeout(function(){n.focus()},0)},onChange:function(){this.$input.trigger("change")},onPaste:function(t){var n=this;n.isFull()||n.isInputHidden||n.isLocked?t.preventDefault():n.settings.splitOn&&setTimeout(function(){var t=e.trim(n.$control_input.val()||"").split(n.settings.splitOn);for(var r=0,i=t.length;r<i;r++)n.createItem(t[r])},0)},onKeyPress:function(e){if(this.isLocked)return e&&e.preventDefault();var t=String.fromCharCode(e.keyCode||e.which);if(this.settings.create&&this.settings.mode==="multi"&&t===this.settings.delimiter)return this.createItem(),e.preventDefault(),!1},onKeyDown:function(e){var t=e.target===this.$control_input[0],n=this;if(n.isLocked){e.keyCode!==E&&e.preventDefault();return}switch(e.keyCode){case o:if(n.isCmdDown){n.selectAll();return}break;case f:n.isOpen&&(e.preventDefault(),e.stopPropagation(),n.close());return;case v:if(!e.ctrlKey||e.altKey)break;case d:if(!n.isOpen&&n.hasOptions)n.open();else if(n.$activeOption){n.ignoreHover=!0;var r=n.getAdjacentOption(n.$activeOption,1);r.length&&n.setActiveOption(r,!0,!0)}e.preventDefault();return;case h:if(!e.ctrlKey||e.altKey)break;case c:if(n.$activeOption){n.ignoreHover=!0;var i=n.getAdjacentOption(n.$activeOption,-1);i.length&&n.setActiveOption(i,!0,!0)}e.preventDefault();return;case a:n.isOpen&&n.$activeOption&&(n.onOptionSelect({currentTarget:n.$activeOption}),e.preventDefault());return;case l:n.advanceSelection(-1,e);return;case p:n.advanceSelection(1,e);return;case E:n.settings.selectOnTab&&n.isOpen&&n.$activeOption&&(n.onOptionSelect({currentTarget:n.$activeOption}),n.isFull()||e.preventDefault()),n.settings.create&&n.createItem()&&e.preventDefault();return;case m:case g:n.deleteSelection(e);return}if((n.isFull()||n.isInputHidden)&&(s?!e.metaKey:!e.ctrlKey)){e.preventDefault();return}},onKeyUp:function(e){var t=this;if(t.isLocked)return e&&e.preventDefault();var n=t.$control_input.val()||"";t.lastValue!==n&&(t.lastValue=n,t.onSearchChange(n),t.refreshOptions(),t.trigger("type",n))},onSearchChange:function(e){var t=this,n=t.settings.load;if(!n)return;if(t.loadedSearches.hasOwnProperty(e))return;t.loadedSearches[e]=!0,t.load(function(r){n.apply(t,[e,r])})},onFocus:function(e){var t=this,n=t.isFocused;if(t.isDisabled)return t.blur(),e&&e.preventDefault(),!1;if(t.ignoreFocus)return;t.isFocused=!0,t.settings.preload==="focus"&&t.onSearchChange(""),n||t.trigger("focus"),t.$activeItems.length||(t.showInput(),t.setActiveItem(null),t.refreshOptions(!!t.settings.openOnFocus)),t.refreshState()},onBlur:function(e,t){var n=this;if(!n.isFocused)return;n.isFocused=!1;if(n.ignoreFocus)return;if(!n.ignoreBlur&&document.activeElement===n.$dropdown_content[0]){n.ignoreBlur=!0,n.onFocus(e);return}var r=function(){n.close(),n.setTextboxValue(""),n.setActiveItem(null),n.setActiveOption(null),n.setCaret(n.items.length),n.refreshState(),(t||document.body).focus(),n.ignoreFocus=!1,n.trigger("blur")};n.ignoreFocus=!0,n.settings.create&&n.settings.createOnBlur?n.createItem(null,!1,r):r()},onOptionHover:function(e){if(this.ignoreHover)return;this.setActiveOption(e.currentTarget,!1)},onOptionSelect:function(t){var n,r,i,s=this;t.preventDefault&&(t.preventDefault(),t.stopPropagation()),r=e(t.currentTarget),r.hasClass("create")?s.createItem(null,function(){s.settings.closeAfterSelect&&s.close()}):(n=r.attr("data-value"),typeof n!="undefined"&&(s.lastQuery=null,s.setTextboxValue(""),s.addItem(n),s.settings.closeAfterSelect?s.close():!s.settings.hideSelected&&t.type&&/mouse/.test(t.type)&&s.setActiveOption(s.getOption(n))))},onItemSelect:function(e){var t=this;if(t.isLocked)return;t.settings.mode==="multi"&&(e.preventDefault(),t.setActiveItem(e.currentTarget,e))},load:function(e){var t=this,n=t.$wrapper.addClass(t.settings.loadingClass);t.loading++,e.apply(t,[function(e){t.loading=Math.max(t.loading-1,0),e&&e.length&&(t.addOption(e),t.refreshOptions(t.isFocused&&!t.isInputHidden)),t.loading||n.removeClass(t.settings.loadingClass),t.trigger("load",e)}])},setTextboxValue:function(e){var t=this.$control_input,n=t.val()!==e;n&&(t.val(e).triggerHandler("update"),this.lastValue=e)},getValue:function(){return this.tagType===S&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e,t){var n=t?[]:["change"];_(this,n,function(){this.clear(),this.addItems(e,t)})},setActiveItem:function(t,n){var r=this,i,s,o,u,a,f,l,c;if(r.settings.mode==="single")return;t=e(t);if(!t.length){e(r.$activeItems).removeClass("active"),r.$activeItems=[],r.isFocused&&r.showInput();return}i=n&&n.type.toLowerCase();if(i==="mousedown"&&r.isShiftDown&&r.$activeItems.length){c=r.$control.children(".active:last"),u=Array.prototype.indexOf.apply(r.$control[0].childNodes,[c[0]]),a=Array.prototype.indexOf.apply(r.$control[0].childNodes,[t[0]]),u>a&&(l=u,u=a,a=l);for(s=u;s<=a;s++)f=r.$control[0].childNodes[s],r.$activeItems.indexOf(f)===-1&&(e(f).addClass("active"),r.$activeItems.push(f));n.preventDefault()}else i==="mousedown"&&r.isCtrlDown||i==="keydown"&&this.isShiftDown?t.hasClass("active")?(o=r.$activeItems.indexOf(t[0]),r.$activeItems.splice(o,1),t.removeClass("active")):r.$activeItems.push(t.addClass("active")[0]):(e(r.$activeItems).removeClass("active"),r.$activeItems=[t.addClass("active")[0]]);r.hideInput(),this.isFocused||r.focus()},setActiveOption:function(t,n,r){var i,s,o,u,a,f=this;f.$activeOption&&f.$activeOption.removeClass("active"),f.$activeOption=null,t=e(t);if(!t.length)return;f.$activeOption=t.addClass("active");if(n||!N(n))i=f.$dropdown_content.height(),s=f.$activeOption.outerHeight(!0),n=f.$dropdown_content.scrollTop()||0,o=f.$activeOption.offset().top-f.$dropdown_content.offset().top+n,u=o,a=o-i+s,o+s>i+n?f.$dropdown_content.stop().animate({scrollTop:a},r?f.settings.scrollDuration:0):o<n&&f.$dropdown_content.stop().animate({scrollTop:u},r?f.settings.scrollDuration:0)},selectAll:function(){var e=this;if(e.settings.mode==="single")return;e.$activeItems=Array.prototype.slice.apply(e.$control.children(":not(input)").addClass("active")),e.$activeItems.length&&(e.hideInput(),e.close()),e.focus()},hideInput:function(){var e=this;e.setTextboxValue(""),e.$control_input.css({opacity:0,position:"absolute",left:e.rtl?1e4:-1e4}),e.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(){var e=this;if(e.isDisabled)return;e.ignoreFocus=!0,e.$control_input[0].focus(),window.setTimeout(function(){e.ignoreFocus=!1,e.onFocus()},0)},blur:function(e){this.$control_input[0].blur(),this.onBlur(null,e)},getScoreFunction:function(e){return this.sifter.getScoreFunction(e,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings,t=e.sortField;return typeof t=="string"&&(t=[{field:t}]),{fields:e.searchField,conjunction:e.searchConjunction,sort:t}},search:function(t){var n,r,i,s,o,u=this,a=u.settings,f=this.getSearchOptions();if(a.score){o=u.settings.score.apply(this,[t]);if(typeof o!="function")throw new Error('Selectize "score" setting must be a function that returns a function')}t!==u.lastQuery?(u.lastQuery=t,s=u.sifter.search(t,e.extend(f,{score:o})),u.currentResults=s):s=e.extend(!0,{},u.currentResults);if(a.hideSelected)for(n=s.items.length-1;n>=0;n--)u.items.indexOf(C(s.items[n].id))!==-1&&s.items.splice(n,1);return s},refreshOptions:function(t){var n,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y;typeof t=="undefined"&&(t=!0);var b=this,w=e.trim(b.$control_input.val()),E=b.search(w),S=b.$dropdown_content,x=b.$activeOption&&C(b.$activeOption.attr("data-value"));o=E.items.length,typeof b.settings.maxOptions=="number"&&(o=Math.min(o,b.settings.maxOptions)),u={},a=[];for(n=0;n<o;n++){f=b.options[E.items[n].id],l=b.render("option",f),c=f[b.settings.optgroupField]||"",h=e.isArray(c)?c:[c];for(i=0,s=h&&h.length;i<s;i++)c=h[i],b.optgroups.hasOwnProperty(c)||(c=""),u.hasOwnProperty(c)||(u[c]=[],a.push(c)),u[c].push(l)}this.settings.lockOptgroupOrder&&a.sort(function(e,t){var n=b.optgroups[e].$order||0,r=b.optgroups[t].$order||0;return n-r}),p=[];for(n=0,o=a.length;n<o;n++)c=a[n],b.optgroups.hasOwnProperty(c)&&u[c].length?(d=b.render("optgroup_header",b.optgroups[c])||"",d+=u[c].join(""),p.push(b.render("optgroup",e.extend({},b.optgroups[c],{html:d})))):p.push(u[c].join(""));S.html(p.join(""));if(b.settings.highlight&&E.query.length&&E.tokens.length)for(n=0,o=E.tokens.length;n<o;n++)r(S,E.tokens[n].regex);if(!b.settings.hideSelected)for(n=0,o=b.items.length;n<o;n++)b.getOption(b.items[n]).addClass("selected");v=b.canCreate(w),v&&(S.prepend(b.render("option_create",{input:w})),y=e(S[0].childNodes[0])),b.hasOptions=E.items.length>0||v;if(b.hasOptions){if(E.items.length>0){g=x&&b.getOption(x),g&&g.length?m=g:b.settings.mode==="single"&&b.items.length&&(m=b.getOption(b.items[0]));if(!m||!m.length)y&&!b.settings.addPrecedence?m=b.getAdjacentOption(y,1):m=S.find("[data-selectable]:first")}else m=y;b.setActiveOption(m),t&&!b.isOpen&&b.open()}else b.setActiveOption(null),t&&b.isOpen&&b.close()},addOption:function(t){var n,r,i,s=this;if(e.isArray(t)){for(n=0,r=t.length;n<r;n++)s.addOption(t[n]);return}if(i=s.registerOption(t))s.userOptions[i]=!0,s.lastQuery=null,s.trigger("option_add",i,t)},registerOption:function(e){var t=C(e[this.settings.valueField]);return!t||this.options.hasOwnProperty(t)?!1:(e.$order=e.$order||++this.order,this.options[t]=e,t)},registerOptionGroup:function(e){var t=C(e[this.settings.optgroupValueField]);return t?(e.$order=e.$order||++this.order,this.optgroups[t]=e,t):!1},addOptionGroup:function(e,t){t[this.settings.optgroupValueField]=e,(e=this.registerOptionGroup(t))&&this.trigger("optgroup_add",e,t)},removeOptionGroup:function(e){this.optgroups.hasOwnProperty(e)&&(delete this.optgroups[e],this.renderCache={},this.trigger("optgroup_remove",e))},clearOptionGroups:function(){this.optgroups={},this.renderCache={},this.trigger("optgroup_clear")},updateOption:function(t,n){var r=this,i,s,o,u,a,f,l;t=C(t),o=C(n[r.settings.valueField]);if(t===null)return;if(!r.options.hasOwnProperty(t))return;if(typeof o!="string")throw new Error("Value must be set in option data");l=r.options[t].$order,o!==t&&(delete r.options[t],u=r.items.indexOf(t),u!==-1&&r.items.splice(u,1,o)),n.$order=n.$order||l,r.options[o]=n,a=r.renderCache.item,f=r.renderCache.option,a&&(delete a[t],delete a[o]),f&&(delete f[t],delete f[o]),r.items.indexOf(o)!==-1&&(i=r.getItem(t),s=e(r.render("item",n)),i.hasClass("active")&&s.addClass("active"),i.replaceWith(s)),r.lastQuery=null,r.isOpen&&r.refreshOptions(!1)},removeOption:function(e,t){var n=this;e=C(e);var r=n.renderCache.item,i=n.renderCache.option;r&&delete r[e],i&&delete i[e],delete n.userOptions[e],delete n.options[e],n.lastQuery=null,n.trigger("option_remove",e),n.removeItem(e,t)},clearOptions:function(){var e=this;e.loadedSearches={},e.userOptions={},e.renderCache={},e.options=e.sifter.items={},e.lastQuery=null,e.trigger("option_clear"),e.clear()},getOption:function(e){return this.getElementWithValue(e,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(t,n){var r=this.$dropdown.find("[data-selectable]"),i=r.index(t)+n;return i>=0&&i<r.length?r.eq(i):e()},getElementWithValue:function(t,n){t=C(t);if(typeof t!="undefined"&&t!==null)for(var r=0,i=n.length;r<i;r++)if(n[r].getAttribute("data-value")===t)return e(n[r]);return e()},getItem:function(e){return this.getElementWithValue(e,this.$control.children())},addItems:function(t,n){var r=e.isArray(t)?t:[t];for(var i=0,s=r.length;i<s;i++)this.isPending=i<s-1,this.addItem(r[i],n)},addItem:function(t,n){var r=n?[]:["change"];_(this,r,function(){var r,i,s,o=this,u=o.settings.mode,a,f,l,c;t=C(t);if(o.items.indexOf(t)!==-1){u==="single"&&o.close();return}if(!o.options.hasOwnProperty(t))return;u==="single"&&o.clear();if(u==="multi"&&o.isFull())return;r=e(o.render("item",o.options[t])),c=o.isFull(),o.items.splice(o.caretPos,0,t),o.insertAtCaret(r),(!o.isPending||!c&&o.isFull())&&o.refreshState(),o.isSetup&&(s=o.$dropdown_content.find("[data-selectable]"),o.isPending||(i=o.getOption(t),l=o.getAdjacentOption(i,1).attr("data-value"),o.refreshOptions(o.isFocused&&u!=="single"),l&&o.setActiveOption(o.getOption(l))),!s.length||o.isFull()?o.close():o.positionDropdown(),o.updatePlaceholder(),o.trigger("item_add",t,r,n),o.updateOriginalInput({silent:n}))})},removeItem:function(e,t){var n=this,r,i,s;r=typeof e=="object"?e:n.getItem(e),e=C(r.attr("data-value")),i=n.items.indexOf(e),i!==-1&&(r.remove(),r.hasClass("active")&&(s=n.$activeItems.indexOf(r[0]),n.$activeItems.splice(s,1)),n.items.splice(i,1),n.lastQuery=null,!n.settings.persist&&n.userOptions.hasOwnProperty(e)&&n.removeOption(e,t),i<n.caretPos&&n.setCaret(n.caretPos-1),n.refreshState(),n.updatePlaceholder(),n.trigger("item_remove",e,r,t),n.updateOriginalInput({silent:t}),n.positionDropdown())},createItem:function(t,n){var r=this,i=r.caretPos;t=t||e.trim(r.$control_input.val()||"");var s=arguments[arguments.length-1];typeof s!="function"&&(s=function(){}),typeof n!="boolean"&&(n=!0);if(!r.canCreate(t))return s(),!1;r.lock();var o=typeof r.settings.create=="function"?this.settings.create:function(e){var t={};return t[r.settings.labelField]=e,t[r.settings.valueField]=e,t},u=O(function(e){r.unlock();if(!e||typeof e!="object")return s();var t=C(e[r.settings.valueField]);if(typeof t!="string")return s();r.setTextboxValue(""),r.addOption(e),r.setCaret(i),r.addItem(t),r.refreshOptions(n&&r.settings.mode!=="single"),s(e)}),a=o.apply(this,[t,u]);return typeof a!="undefined"&&u(a),!0},refreshItems:function(){this.lastQuery=null,this.isSetup&&this.addItem(this.items),this.refreshState(),this.updateOriginalInput()},refreshState:function(){var e,t=this;t.isRequired&&(t.items.length&&(t.isInvalid=!1),t.$control_input.prop("required",e)),t.refreshClasses()},refreshClasses:function(){var t=this,n=t.isFull(),r=t.isLocked;t.$wrapper.toggleClass("rtl",t.rtl),t.$control.toggleClass("focus",t.isFocused).toggleClass("disabled",t.isDisabled).toggleClass("required",t.isRequired).toggleClass("invalid",t.isInvalid).toggleClass("locked",r).toggleClass("full",n).toggleClass("not-full",!n).toggleClass("input-active",t.isFocused&&!t.isInputHidden).toggleClass("dropdown-active",t.isOpen).toggleClass("has-options",!e.isEmptyObject(t.options)).toggleClass("has-items",t.items.length>0),t.$control_input.data("grow",!n&&!r)},isFull:function(){return this.settings.maxItems!==null&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(e){var t,n,r,i,s=this;e=e||{};if(s.tagType===S){r=[];for(t=0,n=s.items.length;t<n;t++)i=s.options[s.items[t]][s.settings.labelField]||"",r.push('<option value="'+k(s.items[t])+'" selected="selected">'+k(i)+"</option>");!r.length&&!this.$input.attr("multiple")&&r.push('<option value="" selected="selected"></option>'),s.$input.html(r.join(""))}else s.$input.val(s.getValue()),s.$input.attr("value",s.$input.val());s.isSetup&&(e.silent||s.trigger("change",s.$input.val()))},updatePlaceholder:function(){if(!this.settings.placeholder)return;var e=this.$control_input;this.items.length?e.removeAttr("placeholder"):e.attr("placeholder",this.settings.placeholder),e.triggerHandler("update",{force:!0})},open:function(){var e=this;if(e.isLocked||e.isOpen||e.settings.mode==="multi"&&e.isFull())return;e.focus(),e.isOpen=!0,e.refreshState(),e.$dropdown.css({visibility:"hidden",display:"block"}),e.positionDropdown(),e.$dropdown.css({visibility:"visible"}),e.trigger("dropdown_open",e.$dropdown)},close:function(){var e=this,t=e.isOpen;e.settings.mode==="single"&&e.items.length&&e.hideInput(),e.isOpen=!1,e.$dropdown.hide(),e.setActiveOption(null),e.refreshState(),t&&e.trigger("dropdown_close",e.$dropdown)},positionDropdown:function(){var e=this.$control,t=this.settings.dropdownParent==="body"?e.offset():e.position();t.top+=e.outerHeight(!0),this.$dropdown.css({width:e.outerWidth(),top:t.top,left:t.left})},clear:function(e){var t=this;if(!t.items.length)return;t.$control.children(":not(input)").remove(),t.items=[],t.lastQuery=null,t.setCaret(0),t.setActiveItem(null),t.updatePlaceholder(),t.updateOriginalInput({silent:e}),t.refreshState(),t.showInput(),t.trigger("clear")},insertAtCaret:function(t){var n=Math.min(this.caretPos,this.items.length);n===0?this.$control.prepend(t):e(this.$control[0].childNodes[n]).before(t),this.setCaret(n+1)},deleteSelection:function(t){var n,r,i,s,o,u,a,f,l,c=this;i=t&&t.keyCode===m?-1:1,s=P(c.$control_input[0]),c.$activeOption&&!c.settings.hideSelected&&(a=c.getAdjacentOption(c.$activeOption,-1).attr("data-value")),o=[];if(c.$activeItems.length){l=c.$control.children(".active:"+(i>0?"last":"first")),u=c.$control.children(":not(input)").index(l),i>0&&u++;for(n=0,r=c.$activeItems.length;n<r;n++)o.push(e(c.$activeItems[n]).attr("data-value"));t&&(t.preventDefault(),t.stopPropagation())}else(c.isFocused||c.settings.mode==="single")&&c.items.length&&(i<0&&s.start===0&&s.length===0?o.push(c.items[c.caretPos-1]):i>0&&s.start===c.$control_input.val().length&&o.push(c.items[c.caretPos]));if(!o.length||typeof c.settings.onDelete=="function"&&c.settings.onDelete.apply(c,[o])===!1)return!1;typeof u!="undefined"&&c.setCaret(u);while(o.length)c.removeItem(o.pop());return c.showInput(),c.positionDropdown(),c.refreshOptions(!0),a&&(f=c.getOption(a),f.length&&c.setActiveOption(f)),!0},advanceSelection:function(e,t){var n,r,i,s,o,u,a=this;if(e===0)return;a.rtl&&(e*=-1),n=e>0?"last":"first",r=P(a.$control_input[0]),a.isFocused&&!a.isInputHidden?(s=a.$control_input.val().length,o=e<0?r.start===0&&r.length===0:r.start===s,o&&!s&&a.advanceCaret(e,t)):(u=a.$control.children(".active:"+n),u.length&&(i=a.$control.children(":not(input)").index(u),a.setActiveItem(null),a.setCaret(e>0?i+1:i)))},advanceCaret:function(e,t){var n=this,r,i;if(e===0)return;r=e>0?"next":"prev",n.isShiftDown?(i=n.$control_input[r](),i.length&&(n.hideInput(),n.setActiveItem(i),t&&t.preventDefault())):n.setCaret(n.caretPos+e)},setCaret:function(t){var n=this;n.settings.mode==="single"?t=n.items.length:t=Math.max(0,Math.min(n.items.length,t));if(!n.isPending){var r,i,s,o,u;o=n.$control.children(":not(input)");for(r=0,i=o.length;r<i;r++)u=e(o[r]).detach(),r<t?n.$control_input.before(u):n.$control.append(u)}n.caretPos=t},lock:function(){this.close(),this.isLocked=!0,this.refreshState()},unlock:function(){this.isLocked=!1,this.refreshState()},disable:function(){var e=this;e.$input.prop("disabled",!0),e.$control_input.prop("disabled",!0).prop("tabindex",-1),e.isDisabled=!0,e.lock()},enable:function(){var e=this;e.$input.prop("disabled",!1),e.$control_input.prop("disabled",!1).prop("tabindex",e.tabIndex),e.isDisabled=!1,e.unlock()},destroy:function(){var t=this,n=t.eventNS,r=t.revertSettings;t.trigger("destroy"),t.off(),t.$wrapper.remove(),t.$dropdown.remove(),t.$input.html("").append(r.$children).removeAttr("tabindex").removeClass("selectized").attr({tabindex:r.tabindex}).show(),t.$control_input.removeData("grow"),t.$input.removeData("selectize"),e(window).off(n),e(document).off(n),e(document.body).off(n),delete t.$input[0].selectize},render:function(e,t){var n,r,i,s="",o=!1,u=this,a=/^[\t \r\n]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;if(e==="option"||e==="item")n=C(t[u.settings.valueField]),o=!!n;if(o){N(u.renderCache[e])||(u.renderCache[e]={});if(u.renderCache[e].hasOwnProperty(n))return u.renderCache[e][n]}s=u.settings.render[e].apply(this,[t,k]);if(e==="option"||e==="option_create")s=s.replace(a,"<$1 data-selectable");e==="optgroup"&&(r=t[u.settings.optgroupValueField]||"",s=s.replace(a,'<$1 data-group="'+L(k(r))+'"'));if(e==="option"||e==="item")s=s.replace(a,'<$1 data-value="'+L(k(n||""))+'"');return o&&(u.renderCache[e][n]=s),s},clearCache:function(e){var t=this;typeof e=="undefined"?t.renderCache={}:delete t.renderCache[e]},canCreate:function(e){var t=this;if(!t.settings.create)return!1;var n=t.settings.createFilter;return e.length&&(typeof n!="function"||n.apply(t,[e]))&&(typeof n!="string"||(new RegExp(n)).test(e))&&(!(n instanceof RegExp)||n.test(e))}}),F.count=0,F.defaults={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:!1,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,addPrecedence:!1,selectOnTab:!1,preload:!1,allowEmptyOption:!1,closeAfterSelect:!1,scrollDuration:60,loadThrottle:300,loadingClass:"loading",dataAttr:"data-data",optgroupField:"optgroup",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,copyClassesToDropdown:!0,render:{}},e.fn.selectize=function(t){var n=e.fn.selectize.defaults,r=e.extend({},n,t),i=r.dataAttr,s=r.labelField,o=r.valueField,u=r.optgroupField,a=r.optgroupLabelField,f=r.optgroupValueField,l={},c=function(t,n){var u,a,f,l,c=t.attr(i);if(!c){var h=e.trim(t.val()||"");if(!r.allowEmptyOption&&!h.length)return;f=h.split(r.delimiter);for(u=0,a=f.length;u<a;u++)l={},l[s]=f[u],l[o]=f[u],n.options.push(l);n.items=f}else{n.options=JSON.parse(c);for(u=0,a=n.options.length;u<a;u++)n.items.push(n.options[u][o])}},h=function(t,n){var c,h,p,d,v=0,m=n.options,g=function(e){var t=i&&e.attr(i);return typeof t=="string"&&t.length?JSON.parse(t):null},y=function(t,i){t=e(t);var a=C(t.attr("value"));if(!a&&!r.allowEmptyOption)return;if(l.hasOwnProperty(a)){if(i){var f=l[a][u];f?e.isArray(f)?f.push(i):l[a][u]=[f,i]:l[a][u]=i}return}var c=g(t)||{};c[s]=c[s]||t.text(),c[o]=c[o]||a,c[u]=c[u]||i,l[a]=c,m.push(c),t.is(":selected")&&n.items.push(a)},b=function(t){var r,i,s,o,u;t=e(t),s=t.attr("label"),s&&(o=g(t)||{},o[a]=s,o[f]=s,n.optgroups.push(o)),u=e("option",t);for(r=0,i=u.length;r<i;r++)y(u[r],s)};n.maxItems=t.attr("multiple")?null:1,d=t.children();for(c=0,h=d.length;c<h;c++)p=d[c].tagName.toLowerCase(),p==="optgroup"?b(d[c]):p==="option"&&y(d[c])};return this.each(function(){if(this.selectize)return;var i,s=e(this),o=this.tagName.toLowerCase(),u=s.attr("placeholder")||s.attr("data-placeholder");!u&&!r.allowEmptyOption&&(u=s.children('option[value=""]').text());var a={placeholder:u,options:[],optgroups:[],items:[]};o==="select"?h(s,a):c(s,a),i=new F(s,e.extend(!0,{},n,a,t))})},e.fn.selectize.defaults=F.defaults,e.fn.selectize.support={validity:T},F.define("drag_drop",function(t){if(!e.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if(this.settings.mode!=="multi")return;var n=this;n.lock=function(){var e=n.lock;return function(){var t=n.$control.data("sortable");return t&&t.disable(),e.apply(n,arguments)}}(),n.unlock=function(){var e=n.unlock;return function(){var t=n.$control.data("sortable");return t&&t.enable(),e.apply(n,arguments)}}(),n.setup=function(){var t=n.setup;return function(){t.apply(this,arguments);var r=n.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,disabled:n.isLocked,start:function(e,t){t.placeholder.css("width",t.helper.css("width")),r.css({overflow:"visible"})},stop:function(){r.css({overflow:"hidden"});var t=n.$activeItems?n.$activeItems.slice():null,i=[];r.children("[data-value]").each(function(){i.push(e(this).attr("data-value"))}),n.setValue(i),n.setActiveItem(t)}})}}()}),F.define("dropdown_header",function(t){var n=this;t=e.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(e){return'<div class="'+e.headerClass+'">'+'<div class="'+e.titleRowClass+'">'+'<span class="'+e.labelClass+'">'+e.title+"</span>"+'<a href="javascript:void(0)" class="'+e.closeClass+'">&times;</a>'+"</div>"+"</div>"}},t),n.setup=function(){var r=n.setup;return function(){r.apply(n,arguments),n.$dropdown_header=e(t.html(t)),n.$dropdown.prepend(n.$dropdown_header)}}()}),F.define("optgroup_columns",function(t){var n=this;t=e.extend({equalizeWidth:!0,equalizeHeight:!0},t),this.getAdjacentOption=function(t,n){var r=t.closest("[data-group]").find("[data-selectable]"),i=r.index(t)+n;return i>=0&&i<r.length?r.eq(i):e()},this.onKeyDown=function(){var e=n.onKeyDown;return function(t){var r,i,s,o;if(!this.isOpen||t.keyCode!==l&&t.keyCode!==p)return e.apply(this,arguments);n.ignoreHover=!0,o=this.$activeOption.closest("[data-group]"),r=o.find("[data-selectable]").index(this.$activeOption),t.keyCode===l?o=o.prev("[data-group]"):o=o.next("[data-group]"),s=o.find("[data-selectable]"),i=s.eq(Math.min(s.length-1,r)),i.length&&this.setActiveOption(i);return}}();var r=function(){var e,t=r.width,n=document;return typeof t=="undefined"&&(e=n.createElement("div"),e.innerHTML='<div style="width:50px;height:50px;position:absolute;left:-50px;top:-50px;overflow:auto;"><div style="width:1px;height:100px;"></div></div>',e=e.firstChild,n.body.appendChild(e),t=r.width=e.offsetWidth-e.clientWidth,n.body.removeChild(e)),t},i=function(){var i,s,o,u,a,f,l;l=e("[data-group]",n.$dropdown_content),s=l.length;if(!s||!n.$dropdown_content.width())return;if(t.equalizeHeight){o=0;for(i=0;i<s;i++)o=Math.max(o,l.eq(i).height());l.css({height:o})}t.equalizeWidth&&(f=n.$dropdown_content.innerWidth()-r(),u=Math.round(f/s),l.css({width:u}),s>1&&(a=f-u*(s-1),l.eq(s-1).css({width:a})))};if(t.equalizeHeight||t.equalizeWidth)A.after(this,"positionDropdown",i),A.after(this,"refreshOptions",i)}),F.define("remove_button",function(t){if(this.settings.mode==="single")return;t=e.extend({label:"&times;",title:"Remove",className:"remove",append:!0},t);var n=this,r='<a href="javascript:void(0)" class="'+t.className+'" tabindex="-1" title="'+k(t.title)+'">'+t.label+"</a>",i=function(e,t){var n=e.search(/(<\/[^>]+>\s*)$/);return e.substring(0,n)+t+e.substring(n)};this.setup=function(){var s=n.setup;return function(){if(t.append){var o=n.settings.render.item;n.settings.render.item=function(e){return i(o.apply(this,arguments),r)}}s.apply(this,arguments),this.$control.on("click","."+t.className,function(t){t.preventDefault();if(n.isLocked)return;var r=e(t.currentTarget).parent();n.setActiveItem(r),n.deleteSelection()&&n.setCaret(n.items.length)})}}()}),F.define("restore_on_backspace",function(e){var t=this;e.text=e.text||function(e){return e[this.settings.labelField]},this.onKeyDown=function(){var n=t.onKeyDown;return function(t){var r,i;if(t.keyCode===m&&this.$control_input.val()===""&&!this.$activeItems.length){r=this.caretPos-1;if(r>=0&&r<this.items.length){i=this.options[this.items[r]],this.deleteSelection(t)&&(this.setTextboxValue(e.text.apply(this,[i])),this.refreshOptions(!0)),t.preventDefault();return}}return n.apply(this,arguments)}}()}),F}),define("app/components/pickupOrders",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs","summernote","selectize"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"pickup-tabs",template:"",scope:u.extend({init:function(){var n=this;this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.datepickers_initialised=!1,this.total_quantity=t.compute(0),this.row_count=t.compute(0),this.number_print_copies=t.compute(2),this.nanobar=new s({id:"mybar",bg:"#FF6600"});var r=JSON.parse(localStorage.getItem("statuses"));e.each(r,function(e,t){n.order_status.attr(e,t)});var i=JSON.parse(localStorage.getItem("timeslots"));e.each(i,function(e,t){n.timeslots.attr(e,t)})},intervalFunc:function(){var e=moment(),t=moment(this.orderDate());e.format("YYYY-MM-DD")==t.format("YYYY-MM-DD")&&this._pollData("order",e)},orderData:new t.Map({}),loaded:!1,cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),selectize:{},pickupRescheduleOldValue:new t.Map({}),pickupFailureReasons:new t.List([]),variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),rowCount:function(){return this.row_count()},getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},getNumberPrintCopies:function(){return this.number_print_copies()},changeNumberPrintCopies:function(e,t,n){this.number_print_copies(parseInt(t.val()))},_editOrderData:function(e,t){this.orderData.each(function(n,r){n.each(function(n,r){n.attr(e["key"])==e["value"]&&n.attr(t.key,t.value)})})},orderRefresh:function(e,t,n){var r=moment(this.orderDate());this._pollData("order",r,!1,!0)},getTotalQuantity:function(){return this.total_quantity()},pickupPrevday:function(e,t,n){var r=moment(this.attr("variableDate"));r.subtract(1,"days"),this.attr("variableDate",r.toDate()),this._pollData("order",this.orderDate())},pickupTimeSlotChange:function(t,n,r){var i=e(n).val(),s=this.timeslots.attr(i),o=this.modalCustomerDetails.attr("data.schedules.pickup.schedule_time");this.pickupRescheduleOldValue.attr("timeslot",o),this.modalCustomerDetails.attr("data.schedules.pickup.schedule_time",s)},savePickupReschedule:function(t,n,r){var s=e("#pickup-order-details-modal").attr("index"),o=this.modalCustomerDetails.attr("data.schedules.pickup.schedule_date"),u=this.modalCustomerDetails.attr("data.schedules.pickup.schedule_time");e.ajax({url:"/api/pickup",type:"put",dataType:"json",context:this,data:{order_id:s,time:u,date:o},success:function(e){i.success("Reschedule successful.")},error:function(e,t,n){i.error("Reschedule unsuccessful."),this.modalCustomerDetails.attr("data.schedules.pickup.schedule_date",this.pickupRescheduleOldValue.attr("date")),this.modalCustomerDetails.attr("data.schedules.pickup.schedule",this.pickupRescheduleOldValue.attr("timeslot"))}})},pickupNextday:function(e,t,n){var r=moment(this.attr("variableDate"));r.add(1,"days"),this.attr("variableDate",r.toDate()),this._pollData("order",this.orderDate())},_addData:function(n){this.row_count(n.length);var r=t.Map.keys(this.orderData),i=this,s={};e.each(n,function(e,t){var n=i.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.user_info.name=t.user_info.name.trim(),s[t.schedule_time]||(s[t.schedule_time]={}),s[t.schedule_time][t.order_id]=t}),this.orderData.attr(s,!0)},_updateData:function(t){this.row_count(t.length);var n=this,r={};e.each(t,function(e,t){r[t.order_id]=t.schedule_time;var i=n.getStatusDetails(t.status);t.status=i.formal_name,t.status_color=i.color,t.user_info.name=t.user_info.name.trim();var s=n.orderData.attr(t.schedule_time);s||n.orderData.attr(t.schedule_time,{}),s.attr(t.order_id)?(s.attr(t["order_id"]).attr("status")!=t["status"]&&(s.attr(t.order_id).attr("status",t.status),s.attr(t.order_id).attr("status_color",t.status_color)),s.attr(t["order_id"]).attr("pickup_sheet_printed")!=t["pickup_sheet_printed"]&&s.attr(t.order_id).attr("pickup_sheet_printed",t.pickup_sheet_printed),s.attr(t.order_id).attr("hub")&&s.attr(t["order_id"]).attr("hub.short")!=t["hub"]["short"]&&s.attr(t.order_id).attr("hub",t.hub)):s.attr(t.order_id,t)});var i={};this.orderData.each(function(e,t){e.each(function(e,n){if(!r[n]||r[n]!=e.attr("schedule_time"))i[n]=t})}),e.each(i,function(e,t){n.orderData.attr(t).removeAttr(e)})},_pollData:function(t,n,r,i){n&&(n=this.getFormattedDate(moment(n))),r&&(r=this.getFormattedTime(moment(r))),i||(i=!1);var s="";r?s="/api/pickup/"+n+"/"+r:s="/api/pickup/"+n,this.nanobar.go(30),e.ajax({url:s,type:"get",context:this,dataType:"json",success:function(e){this.nanobar.go(50),e.data&&(i?this._updateData(e.data):this._addData(e.data)),this.nanobar.go(100)}})},selectWashType:function(e,t,n){var r=t.parents("tr").find('input[type="number"]');r=parseInt(r.val());var i=t.parents("tr").attr("item-index"),s=this.cleaningItems.attr(i);t.hasClass("choice-laundry")?s.attr("cleaning_type","laundry"):t.hasClass("choice-dryclean")&&s.attr("cleaning_type","dry_cleaning"),this._update_total_cost()},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u);a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):(a.attr("quantity.iron")||a.attr("quantity.iron",0),a.attr("quantity.iron",i));var f=a.attr("quantity.laundry")*a.attr("price.laundry")||0,l=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,c=a.attr("quantity.iron")*a.attr("price.iron")||0;a.attr("final_cost",f+l+c)}this._update_total_cost(),this._update_total_quantity()},openOrderModal:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=null;this.nanobar.go(30);var o=e.ajax({url:"/api/orderitem/"+i,type:"get",context:this,dataType:"json"}),u=e.ajax({url:"/api/failurereason/pickup",type:"get",dataType:"json"}),a=this;e.when(o,u).then(function(t,n){t=t[0],n=n[0],a.pickupFailureReasons.replace(n.data),a.nanobar.go(50),a.cleaningItems.replace(t.data),t.customer_details.status=a.getStatusDetails(t.customer_details.status).attr("name_id"),a.modalCustomerDetails.attr("data",t.customer_details),a.modalCustomerDetails.attr("data.bag.laundry")&&a.modalCustomerDetails.attr("data.bag.laundry").each(function(e,t){a.selectize.laundry.addOption({value:e,text:e}),a.selectize.laundry.addItem(e,!0)}),a.modalCustomerDetails.attr("data.bag.dryclean")&&a.modalCustomerDetails.attr("data.bag.dryclean").each(function(e,t){a.selectize.dryclean.addOption({value:e,text:e}),a.selectize.dryclean.addItem(e,!0)}),a.modalCustomerDetails.attr("data.bag.iron")&&a.modalCustomerDetails.attr("data.bag.iron").each(function(e,t){a.selectize.iron.addOption({value:e,text:e}),a.selectize.iron.addItem(e,!0)}),e("#pickup-order-details-modal").attr("index",i);var r=e("#pickup-order-details-modal .summernote");r.html(a.modalCustomerDetails.attr("data.remark")),e(r).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){a.modalCustomerDetails.attr("data.remark",e("#pickup-order-details-modal .summernote").code())}}),e("#pickup-order-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),a.nanobar.go(100),e("#pickup-order-details-modal table").focus(),a._update_total_cost(),a._update_total_quantity()})},_get_sub_total_cost:function(){var e=0;return this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0;e+=i+s+o}),e},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_total_cost:function(){var e=this._get_sub_total_cost(),t=null,n=this.modalCustomerDetails.attr("data.discount.amount")||0,r=this.modalCustomerDetails.attr("data.discount.max")||0;this.allCosts.attr("sub_total_cost",e),this.modalCustomerDetails.attr("data.discount.percentage")?(t=e*n/100,r&&(r=parseInt(r),t>r&&(t=r))):t=n;var i=e-t,s=this.modalCustomerDetails.attr("data.credits.available");s||(s=this.modalCustomerDetails.attr("data.user.credits"),this.modalCustomerDetails.attr("data.credits.available",s));var o=null;s>=i?o=i:o=s,i-=o,this.modalCustomerDetails.attr("data.credits.used",o),this.allCosts.attr("total_cost",Math.round(i))},changeMaxDiscount:function(t,n,r){var i=e("#pickup-order-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#pickup-order-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},changePaymentStatus:function(t,n,r){var s=e(n).val(),o=e("#pickup-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{is_paid:s},success:function(t){i.success("Payment status change successful."),e(n).val()=="paid"?this.modalCustomerDetails.attr("data.is_paid",!0):this.modalCustomerDetails.attr("data.is_paid",!1)},error:function(e,t,n){i.error("Payment status change failed.")}})},applyDiscount:function(t,n,r){var i=e(n).hasClass("modal-discount-percentage"),s=e("#pickup-order-details-modal .modal-discount-amount").val()||0;i?this.modalCustomerDetails.attr("data.discount.percentage",!0):this.modalCustomerDetails.attr("data.discount.percentage",!1),this.modalCustomerDetails.attr("data.discount.amount",s),this._update_total_cost()},saveOrderChanges:function(t,n,r){var s=e("#pickup-order-details-modal").attr("index");e(n).button("loading");var o=this.modalCustomerDetails.attr("data.discount").attr(),u=this.modalCustomerDetails.attr("data.bag").attr()||{};e.ajax({url:"/api/orderitem/"+s,type:"post",context:this,data:{data:JSON.stringify(this.cleaningItems.attr()),remark:this.modalCustomerDetails.attr("data.remark"),discount:JSON.stringify(o),bag:JSON.stringify(u)},success:function(t){i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeOrderStatus:function(t,n,r){var i=e(n).val();this.modalCustomerDetails.attr("data.status",i),i!="pickup_failed"&&this.saveOrderStatus(t,n,r)},changePickupFailedReason:function(t,n,r){this.modalCustomerDetails.attr("data.failure_reason.pickup")&&this.modalCustomerDetails.attr("data.failure_reason").attr("pickup",{}),this.modalCustomerDetails.attr("data.failure_reason.pickup",{full_reason:e(n).text(),reason:e(n).val()})},saveOrderStatus:function(t,n,r){var s=this.modalCustomerDetails.attr("data.status"),o=e("#pickup-order-details-modal").attr("index"),u={status:s};if(s=="pickup_failed"){if(!this.modalCustomerDetails.attr("data.failure_reason.pickup.reason")){i.error("No reason selected.");return}u.failure_reason=JSON.stringify({reason:this.modalCustomerDetails.attr("data.failure_reason.pickup.reason"),type:"pickup"})}e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:u,success:function(e){this.modalCustomerDetails.attr("data.status",s),i.success("Status change successful.")},error:function(e,t,n){i.error("Status change failed.")}})},closeModal:function(t,n,r){this.selectize.laundry.clear(!0),this.selectize.laundry.clearOptions(),this.selectize.dryclean.clear(!0),this.selectize.dryclean.clearOptions(),this.selectize.iron.clear(!0),this.selectize.iron.clearOptions(),this.pickupRescheduleOldValue.attr({},!0),e("#pickup-order-details-modal .summernote").destroy(),e("pickup-tabs .btn-refresh").trigger("click")},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}},showPrintConfirmDialog:function(t,n,r){e("#pickup-print-settings-modal").modal({backdrop:"static",keyboard:!1,show:!0})},printPickupSheet:function(t,n,r){var s=e(".pickup-checkbox.btn-success").parents("tr"),o=[];e.each(s,function(t,n){o.push(e(n).attr("index"))}),s.length?e.ajax({url:"/api/pickupsheetinfo/"+JSON.stringify(o),type:"get",context:this,dataType:"json",success:function(t){var n=this,r=3e3,i=0;e.each(t.data,function(t,s){var o=e("<div>"),u=e("<div>");u.append(e("<h5>").text("Customer details")),u.append(e("<p>").text("Order id: #"+s.real_order_id)),u.append(e("<p>").text(s.user.name)),u.append(e("<p>").text(s.address.apartment_number+", "+s.address.address_1+", "+s.address.address_2)),u.append(e("<p>").text(s.address.city+", "+s.address.state)),u.append(e("<p>").text(s.address.pincode||"")),u.append(e("<p>").text("Ph- "+s.user.phone));var a=e("<div>");a.append(e("<h5>").text("Pickup")),a.append(e("<p>").text("Date: "+s.schedules[0].pickup.schedule_date)),a.append(e("<p>").text("Time: "+s.schedules[0].pickup.schedule_time));var f=e("<div>");f.append(e("<h5>").text("Delivery")),f.append(e("<p>").text("Date: "+s.schedules[0].delivery.schedule_date)),f.append(e("<p>").text("Time: "+s.schedules[0].delivery.schedule_time)),o.append(u),o.append("<hr>"),o.append(a),o.append("<hr>"),o.append(f);var l=e("<div>").addClass("container-fluid pickup-sheet-font").css({padding:"50px","margin-top":"20px","font-size":"10px"}).append(o);setTimeout(function(){for(var t=0;t<n.getNumberPrintCopies();t++)l.print({mediaPrint:!0});e.ajax({url:"/api/order/"+s.order_id,type:"put",dataType:"json",context:n,data:{pickup_sheet_printed:!0},success:function(e){n._editOrderData({key:"order_id",value:s.order_id},{key:"pickup_sheet_printed",value:!0})}})},i),i+=r}),e("#pickup-print-settings-modal").modal("hide")}}):i.warning("Select an order first.")}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-pickup"&&!this.scope.loaded&&(this.scope._pollData("order",moment()),setInterval(this.scope.intervalFunc.bind(this.scope),3e5),this.scope.loaded=!0)},"#pickup-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)},inserted:function(){var t=this,n={format:"yyyy-mm-dd",startdate:"2014-10-22",autoclose:!0,todayBtn:!0};e("pickup-tabs .order-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,i=moment(new Date(Date.parse(e(this).datepicker("getDate")))),s=e("#pickup-order-details-modal").attr("index"),o=i.format("YYYY/MM/DD");t.scope._pollData("order",i),t.scope.attr("variableDate",i.toDate())}),e("#pickup-order-details-modal .modal-pickup-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,i=moment(new Date(Date.parse(e(this).datepicker("getDate")))),s=e("#pickup-order-details-modal").attr("index"),o=i.format("YYYY/MM/DD"),u=t.scope.modalCustomerDetails.attr("data.schedules.pickup.schedule_date");t.scope.pickupRescheduleOldValue.attr("date",u),t.scope.modalCustomerDetails.attr("data.schedules.pickup.schedule_date",i.format("YYYY/MM/DD"))});var r=e("#pickup-modal-others .bag-laundry").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("laundry")||n.attr("bag").attr("laundry",[]),n.attr("bag").attr("laundry").indexOf(e)==-1&&n.attr("bag").attr("laundry").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("laundry"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"laundry",name:r,action:s}])},success:function(e){},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}}),s=e("#pickup-modal-others .bag-dryclean").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("dryclean")||n.attr("bag").attr("dryclean",[]),n.attr("bag").attr("dryclean").indexOf(e)==-1&&n.attr("bag").attr("dryclean").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("dryclean"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"dryclean",name:r,action:s}])},success:function(e){},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}}),o=e("#pickup-modal-others .bag-iron").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("iron")||n.attr("bag").attr("iron",[]),n.attr("bag").attr("iron").indexOf(e)==-1&&n.attr("bag").attr("iron").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("iron"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"iron",name:r,action:s}])},success:function(e){},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}});t.scope.selectize={laundry:r[0].selectize,dryclean:s[0].selectize,iron:o[0].selectize}},".click-to-assign click":function(t,n){var r=this,s=t.parents("tr").attr("index"),o=null;r.scope.orderData.each(function(e,t){e.attr(s)&&(o=t)});var u=e('<select type="text" placeholder="Select staff">');e(t).parents("td").append(u),e(t).hide();var a=e(u).selectize({valueField:"str_id",labelField:"name",searchField:["name","emp_id"],preload:!0,create:!1,dataAttr:"data-data",render:{item:function(e,t){return"<div><span>"+t(e.name)+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name)+" <b>("+e.emp_id+")</b>"+"</span>&nbsp;"+"</div>"}},load:function(t,n){e.ajax({url:"/api/employee",type:"get",context:this,dataType:"json",success:function(t){var i=[];e.each(t.data,function(e,t){i.push({emp_id:t.emp_id,name:t.data.name,str_id:t.str_id})}),n(i);var u=r.scope.orderData.attr(o).attr(s+".assigned_to"),a=this.$input[0].selectize;u&&a.addItem(u.str_id,!0)},error:function(e,t,r){n()}})},onItemAdd:function(e,t){}}).change(function(n){e.ajax({url:"/api/pickup",type:"put",dataType:"json",context:this,data:{order_id:s,assign_to:u.val()},success:function(n){var u=a[0].selectize;i.success("Assigned "+u.getItem(u.getValue()).text());var f={name:u.getItem(u.getValue()).text().toLowerCase().trim(),str_id:u.getValue()},l=r.scope.orderData.attr(o).attr(s);l.attr("assigned_to")||l.attr("assigned_to",{}),l.attr("assigned_to").attr("name",f.name),l.attr("assigned_to").attr("str_id",f.str_id),l.attr("status",r.scope.getStatusDetails("pickup_progress").formal_name),u.destroy(),e(t).siblings("select").remove(),e(t).show()},error:function(){i.error("Unable to update.")}})})},"#pickup-orders click":function(t,n){var r=e("#pickup-orders .click-to-assign + .selectized"),i=e("#pickup-orders .click-to-assign-hub + .selectized");r.length&&r.each(function(t,r){if(e(r).parents("tr").attr("index")!=e(n.target).parents("tr").attr("index")){var i=e(r).selectize();i=i[0].selectize,i.destroy(),e(r).siblings("a").show(),e(r).remove()}}),i.length&&i.each(function(t,r){if(e(r).parents("tr").attr("index")!=e(n.target).parents("tr").attr("index")){var i=e(r).selectize();i=i[0].selectize,i.destroy(),e(r).siblings("span.label").show(),e(r).remove()}})},".click-to-assign-hub click":function(t,n){var r=this,s=t.parents("tr").attr("index"),o=null;r.scope.orderData.each(function(e,t){e.attr(s)&&(o=t)});var u=e('<select type="text" placeholder="Select hub">');e(t).parents("td").append(u),e(t).hide();var a=e(u).selectize({valueField:"str_id",labelField:"name",searchField:["name","short"],preload:!0,create:!1,render:{item:function(e,t){return"<div><span>"+t(e.name)+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name)+" <b>("+e.short+")</b>"+"</span>&nbsp;"+"</div>"}},load:function(t,n){e.ajax({url:"/api/hub",type:"get",context:this,dataType:"json",success:function(t){var i=[];e.each(t.data,function(e,t){i.push({"short":t.short,name:t.name,str_id:t.str_id})}),n(i);var u=r.scope.orderData.attr(o).attr(s+".hub"),a=this.$input[0].selectize;u&&a.addItem(u.str_id,!0)},error:function(e,t,r){n()}})},onChange:function(n){var u=r.scope.orderData.attr(o).attr(s);e.ajax({url:"/api/address/"+u.attr("address_id"),type:"put",dataType:"json",context:this,data:{assigned_hub:n},success:function(n){var r=n.update_data.assigned_hub,s=this.$input[0].selectize;i.success("Assigned to "+r.name),u.attr("hub")||u.attr("hub",{}),u.attr("hub",r),s.destroy(),e(t).siblings("select").remove(),e(t).show()},error:function(){i.error("Unable to update.")}})}})}}})}),define("app/components/deliveryOrders",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs","summernote"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"delivery-tabs",template:"",scope:u.extend({init:function(){var n=this;this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.total_quantity=t.compute(0),this.row_count=t.compute(0),this.nanobar=new s({id:"mybar",bg:"#FF6600"});var r=JSON.parse(localStorage.getItem("statuses"));e.each(r,function(e,t){n.order_status.attr(e,t)});var i=JSON.parse(localStorage.getItem("timeslots"));e.each(i,function(e,t){n.timeslots.attr(e,t)})},orderData:new t.Map({}),loaded:!1,failureReasons:new t.List([]),cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({is_paid:!1}),allCosts:new t.Map({}),deliveryRescheduleOldValue:new t.Map({}),variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),rowCount:function(){return this.row_count()},getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},orderRefresh:function(e,t,n){var r=moment(this.orderDate());this._pollData("order",r,!1,!0)},getTotalQuantity:function(){return this.total_quantity()},getOrderDataKey:function(e){var t;return this.orderData.each(function(n,r){n.attr(e)&&(t=r)}),t},deliveryPrevday:function(e,t,n){var r=moment(this.attr("variableDate"));r.subtract(1,"days"),this.attr("variableDate",r.toDate()),this._pollData("order",this.orderDate())},deliveryTimeSlotChange:function(t,n,r){var i=e(n).val();i==0&&(i=e(n).attr("value"));var s=this.timeslots.attr(i),o=this.modalCustomerDetails.attr("data.schedules.delivery.schedule");this.deliveryRescheduleOldValue.attr("timeslot",o),this.modalCustomerDetails.attr("data.schedules.delivery.schedule",s)},saveDeliveryReschedule:function(t,n,r){var s=e("#delivery-order-details-modal").attr("index"),o=this.modalCustomerDetails.attr("data.schedules.delivery.schedule_date"),u=this.modalCustomerDetails.attr("data.schedules.delivery.schedule_time");e.ajax({url:"/api/delivery",type:"put",dataType:"json",context:this,data:{order_id:s,time:u,date:o},success:function(e){i.success("Reschedule successful.")},error:function(e,t,n){i.success("Reschedule unsuccessful."),this.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",this.deliveryRescheduleOldValue.attr("date")),this.modalCustomerDetails.attr("data.schedules.delivery.schedule",this.deliveryRescheduleOldValue.attr("timeslot"))}})},changeFailureReason:function(t,n,r){var i=this.modalCustomerDetails.attr("data.is_paid");this.modalCustomerDetails.attr("is_paid",i);var s=e(n).val(),o="";this.modalCustomerDetails.attr("data").attr("reason")||this.modalCustomerDetails.attr("data").attr("reason",{type:null,value:null}),s!=undefined&&s!="none"&&(s!="other"?(this.modalCustomerDetails.attr("failure_reason",s),this.modalCustomerDetails.attr("data").attr("reason",{type:null})):(this.modalCustomerDetails.attr("data.reason.value")!=undefined&&this.modalCustomerDetails.attr("data.reason.value",undefined),this.modalCustomerDetails.attr("data.failure_reason.partial_payment.full_reason")!=undefined&&this.modalCustomerDetails.attr("data.failure_reason.partial_payment.full_reason",undefined),this.modalCustomerDetails.attr("failure_reason",s),this.modalCustomerDetails.attr("data").attr("reason",{type:"others"})))},deliveryNextday:function(e,t,n){var r=moment(this.attr("variableDate"));r.add(1,"days"),this.attr("variableDate",r.toDate()),this._pollData("order",this.orderDate())},_addData:function(n){this.row_count(n.length);var r=t.Map.keys(this.orderData),i=this,s={};e.each(n,function(e,t){var n=i.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.user_info.name=t.user_info.name.trim(),s[t.schedule_time]||(s[t.schedule_time]={}),s[t.schedule_time][t.order_id]=t}),this.orderData.attr(s,!0)},_updateData:function(t){this.row_count(t.length);var n=this,r={};e.each(t,function(e,t){r[t.order_id]=t.schedule_time;var i=n.getStatusDetails(t.status);t.status=i.formal_name,t.status_color=i.color,t.user_info.name=t.user_info.name.trim(),n.orderData.attr(t.schedule_time)||n.orderData.attr(t.schedule_time,{}),n.orderData.attr(t.schedule_time).attr(t.order_id)?!n.orderData.attr(t["schedule_time"]).attr(t["order_id"]).attr("status")!=t["status"]&&n.orderData.attr(t.schedule_time).attr(t.order_id).attr("status",t.status):n.orderData.attr(t.schedule_time).attr(t.order_id,t)});var i={};this.orderData.each(function(e,t){e.each(function(e,n){if(!r[n]||r[n]!=e.attr("schedule_time"))i[t]=n})}),e.each(i,function(e,t){n.orderData.attr(e).removeAttr(t)})},_pollData:function(t,n,r,i){n&&(n=this.getFormattedDate(moment(n))),r&&(r=this.getFormattedTime(moment(r))),i||(i=!1);var s="";r?s="/api/delivery/"+n+"/"+r:s="/api/delivery/"+n,this.nanobar.go(30),e.ajax({url:s,type:"get",context:this,dataType:"json",success:function(e){this.nanobar.go(50),e.data&&(i?this._updateData(e.data):this._addData(e.data)),this.nanobar.go(100)}})},selectWashType:function(e,t,n){var r=t.parents("tr").find('input[type="number"]');r=parseInt(r.val());var i=t.parents("tr").attr("item-index"),s=this.cleaningItems.attr(i);t.hasClass("choice-laundry")?s.attr("cleaning_type","laundry"):t.hasClass("choice-dryclean")&&s.attr("cleaning_type","dry_cleaning"),this._update_total_cost()},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u);a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):(a.attr("quantity.iron")||a.attr("quantity.iron",0),a.attr("quantity.iron",i));var f=a.attr("quantity.laundry")*a.attr("price.laundry")||0,l=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,c=a.attr("quantity.iron")*a.attr("price.iron")||0;a.attr("final_cost",f+l+c)}this._update_total_cost(),this._update_total_quantity()},openOrderModal:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=null;this.nanobar.go(30);var o=e.ajax({url:"/api/orderitem/"+i,type:"get",context:this,dataType:"json"}),u=e.ajax({url:"/api/failurereason/partial_payment",type:"get",dataType:"json"}),a=this;e.when(o,u).done(function(t,n){t=t[0],n=n[0],a.failureReasons.attr(n.data),a.nanobar.go(50),a.cleaningItems.replace(t.data),t.customer_details.status=a.getStatusDetails(t.customer_details.status).attr("name_id"),a.modalCustomerDetails.attr("data",t.customer_details),a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")!=undefined&&a.modalCustomerDetails.attr("failure_reason",a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")),a.modalCustomerDetails.attr("data.failure_reason.partial_payment.full_reason")=="other"&&a.modalCustomerDetails.attr("failure_reason","other"),a.modalCustomerDetails.attr("data").attr("reason")||a.modalCustomerDetails.attr("data").attr("reason",{type:null,value:null});var r=a.modalCustomerDetails.attr("data.is_paid");r=="not_paid"?a.modalCustomerDetails.attr("disable_amt",!0):a.modalCustomerDetails.attr("disable_amt",!1);var s=!0;a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")?(a.failureReasons.each(function(e,t){a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")==e.attr("str_id")&&(a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason",e.attr("str_id")),s=!1)}),s&&a.modalCustomerDetails.attr("data.reason.type","others")):a.modalCustomerDetails.attr("data.reason.type","none"),e("#delivery-order-details-modal").attr("index",i);var o=e("#delivery-order-details-modal .summernote");o.html(a.modalCustomerDetails.attr("data.remark")),e(o).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){a.modalCustomerDetails.attr("data.remark",e("#delivery-order-details-modal .summernote").code())}}),e("#delivery-order-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),a.nanobar.go(100),e("#delivery-order-details-modal table").focus(),a._update_total_cost(),a._update_total_quantity()})},_get_sub_total_cost:function(){var e=0;return this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0;e+=i+s+o}),e},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_credits:function(e,t,n){var r=this.modalCustomerDetails.attr("data.credits.available"),i=this.modalCustomerDetails.attr("data.cost.total"),s=this.modalCustomerDetails.attr("data.cash_collected");if(s>i){var o=s-i;r?(r=this.modalCustomerDetails.attr("data.user.credits"),r+=o,this.modalCustomerDetails.attr("data.user.credits",Math.round(r))):(r=this.modalCustomerDetails.attr("data.user.credits"),r+=o,this.modalCustomerDetails.attr("data.user.credits",Math.round(r)))}},_update_total_cost:function(){var e=this._get_sub_total_cost(),t=null,n=this.modalCustomerDetails.attr("data.discount.amount")||0,r=this.modalCustomerDetails.attr("data.discount.max")||0;this.allCosts.attr("sub_total_cost",e),this.modalCustomerDetails.attr("data.discount.percentage")?(t=e*n/100,r&&(r=parseInt(r),t>r&&(t=r))):t=n;var i=e-t,s=this.modalCustomerDetails.attr("data.credits.available");s||(s=this.modalCustomerDetails.attr("data.user.credits"),this.modalCustomerDetails.attr("data.credits.available",s));var o=null;s>=i?o=i:o=s,i-=o,this.modalCustomerDetails.attr("data.credits.used",o),this.modalCustomerDetails.attr("data.service_tax.type")=="inclusive"?this.allCosts.attr("service_tax",this.modalCustomerDetails.attr("data.service_tax.amount")):this.modalCustomerDetails.attr("data.service_tax.type")=="exclusive"&&(i+=this.modalCustomerDetails.attr("data.service_tax.amount"),this.allCosts.attr("service_tax",this.modalCustomerDetails.attr("data.service_tax.amount"))),this.allCosts.attr("total_cost",Math.round(i))},changeMaxDiscount:function(t,n,r){var i=e("#delivery-order-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#delivery-order-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},applyDiscount:function(t,n,r){var i=e(n).hasClass("modal-discount-percentage"),s=e("#delivery-order-details-modal .modal-discount-amount").val()||0;i?this.modalCustomerDetails.attr("data.discount.percentage",!0):this.modalCustomerDetails.attr("data.discount.percentage",!1),this.modalCustomerDetails.attr("data.discount.amount",s),this._update_total_cost()},saveOrderChanges:function(t,n,r){var s=e("#delivery-order-details-modal").attr("index");e(n).button("loading"),e.ajax({url:"/api/orderitem/"+s,type:"post",context:this,data:{remark:this.modalCustomerDetails.attr("data.remark")},success:function(t){i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeBagNumber:function(t,n,r){typeof this.modalCustomerDetails.attr("data").attr("bag")=="undefined"&&this.modalCustomerDetails.attr("data").attr("bag",{}),e(n).hasClass("bag-laundry")?this.modalCustomerDetails.attr("data.bag").attr("laundry",e(n).val()):e(n).hasClass("bag-dryclean")?this.modalCustomerDetails.attr("data.bag").attr("dryclean",e(n).val()):e(n).hasClass("bag-iron")&&this.modalCustomerDetails.attr("data.bag").attr("iron",e(n).val())},changeOrderStatus:function(t,n,r){var s=e(n).val(),o=e("#delivery-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{status:s},success:function(e){this.modalCustomerDetails.attr("data.status",s),i.success("Status changed successfully!")}})},closeModal:function(t,n,r){e("#delivery-order-details-modal .summernote").destroy(),e("delivery-tabs .btn-refresh").trigger("click"),this.deliveryRescheduleOldValue.attr({},!0)},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){var t=moment();e.sidebarmenu=="main-content-delivery"&&!this.scope.loaded&&(this.scope._pollData("order",t),this.scope.loaded=!0)},"#delivery-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)},inserted:function(){var t=this,n={format:"yyyy-mm-dd",startdate:"2014-10-22",autoclose:!0,todayBtn:!0};e("delivery-tabs .datepicker-here").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,i=moment(new Date(Date.parse(e(this).datepicker("getDate")))),s=e("#delivery-order-details-modal").attr("index"),o=i.format("YYYY/MM/DD");if(e(r).hasClass("order-datepicker"))t.scope._pollData("order",i),t.scope.attr("variableDate",i.toDate());else if(e(r).hasClass("modal-delivery-datepicker")){var u=t.scope.modalCustomerDetails.attr("data.schedules.delivery.schedule_date");t.scope.deliveryRescheduleOldValue.attr("date",u),t.scope.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",i.format("YYYY/MM/DD"))}})},".click-to-assign click":function(t,n){var r=this,s=t.parents("tr").attr("index"),o=null;r.scope.orderData.each(function(e,t){e.attr(s)&&(o=t)});var u=e('<select type="text" placeholder="Select staff">');e(t).parents("td").append(u),e(t).hide();var a=e(u).selectize({plugins:["remove_button"],valueField:"str_id",labelField:"name",searchField:["name","emp_id"],preload:!0,create:!1,dataAttr:"data-data",render:{item:function(e,t){return"<div><span>"+t(e.name)+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name)+" <b>("+e.emp_id+")</b>"+"</span>&nbsp;"+"</div>"}},load:function(t,n){e.ajax({url:"/api/employee",type:"get",context:this,dataType:"json",success:function(t){var i=[];e.each(t.data,function(e,t){i.push({emp_id:t.emp_id,name:t.data.name,str_id:t.str_id})}),n(i);var u=r.scope.orderData.attr(o).attr(s+".assigned_to"),a=this.$input[0].selectize;u&&a.addItem(u.str_id,!0)},error:function(e,t,r){n()}})},onItemAdd:function(e,t){}}).change(function(n){e.ajax({url:"/api/delivery",type:"put",dataType:"json",context:this,data:{order_id:s,assign_to:u.val()},success:function(n){var u=a[0].selectize;i.success("Assigned "+u.getItem(u.getValue()).text());var f={name:u.getItem(u.getValue()).text().toLowerCase().trim(),str_id:u.getValue()},l=r.scope.orderData.attr(o).attr(s);l.attr("assigned_to")||l.attr("assigned_to",{}),l.attr("assigned_to").attr("name",f.name),l.attr("assigned_to").attr("str_id",f.str_id),l.attr("status",r.scope.getStatusDetails("delivery_progress").formal_name),u.destroy(),e(t).siblings("select").remove(),e(t).show()},error:function(){i.error("Unable to update.")}})})},"#delivery-orders click":function(t,n){var r=e("#delivery-orders .click-to-assign + .selectized");if(!r.length)return!1;r.each(function(t,r){if(e(r).parents("tr").attr("index")!=e(n.target).parents("tr").attr("index")){var i=e(r).selectize();i=i[0].selectize,i.destroy(),e(r).siblings("a").show(),e(r).remove()}})}}})}),!function(e){"function"==typeof define&&define.amd?define("ajaxForm",["jquery"],e):e("undefined"!=typeof jQuery?jQuery:window.Zepto)}(function(e){function t(t){var n=t.data;t.isDefaultPrevented()||(t.preventDefault(),e(t.target).ajaxSubmit(n))}function n(t){var n=t.target,r=e(n);if(!r.is("[type=submit],[type=image]")){var i=r.closest("[type=submit]");if(0===i.length)return;n=i[0]}var s=this;if(s.clk=n,"image"==n.type)if(void 0!==t.offsetX)s.clk_x=t.offsetX,s.clk_y=t.offsetY;else if("function"==typeof e.fn.offset){var o=r.offset();s.clk_x=t.pageX-o.left,s.clk_y=t.pageY-o.top}else s.clk_x=t.pageX-n.offsetLeft,s.clk_y=t.pageY-n.offsetTop;setTimeout(function(){s.clk=s.clk_x=s.clk_y=null},100)}function r(){if(e.fn.ajaxSubmit.debug){var t="[jquery.form] "+Array.prototype.join.call(arguments,"");window.console&&window.console.log?window.console.log(t):window.opera&&window.opera.postError&&window.opera.postError(t)}}var i={};i.fileapi=void 0!==e("<input type='file'/>").get(0).files,i.formdata=void 0!==window.FormData;var s=!!e.fn.prop;e.fn.attr2=function(){if(!s)return this.attr.apply(this,arguments);var e=this.prop.apply(this,arguments);return e&&e.jquery||"string"==typeof e?e:this.attr.apply(this,arguments)},e.fn.ajaxSubmit=function(t){function n(n){var r,i,s=e.param(n,t.traditional).split("&"),o=s.length,u=[];for(r=0;o>r;r++)s[r]=s[r].replace(/\+/g," "),i=s[r].split("="),u.push([decodeURIComponent(i[0]),decodeURIComponent(i[1])]);return u}function o(r){for(var i=new FormData,s=0;s<r.length;s++)i.append(r[s].name,r[s].value);if(t.extraData){var o=n(t.extraData);for(s=0;s<o.length;s++)o[s]&&i.append(o[s][0],o[s][1])}t.data=null;var u=e.extend(!0,{},e.ajaxSettings,t,{contentType:!1,processData:!1,cache:!1,type:f||"POST"});t.uploadProgress&&(u.xhr=function(){var n=e.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(e){var n=0,r=e.loaded||e.position,i=e.total;e.lengthComputable&&(n=Math.ceil(r/i*100)),t.uploadProgress(e,r,i,n)},!1),n}),u.data=null;var a=u.beforeSend;return u.beforeSend=function(e,n){n.data=t.formData?t.formData:i,a&&a.call(this,e,n)},e.ajax(u)}function u(n){function i(e){var t=null;try{e.contentWindow&&(t=e.contentWindow.document)}catch(n){r("cannot get iframe.contentWindow document: "+n)}if(t)return t;try{t=e.contentDocument?e.contentDocument:e.document}catch(n){r("cannot get iframe.contentDocument: "+n),t=e.document}return t}function o(){function t(){try{var e=i(y).readyState;r("state = "+e),e&&"uninitialized"==e.toLowerCase()&&setTimeout(t,50)}catch(n){r("Server abort: ",n," (",n.name,")"),u(k),x&&clearTimeout(x),x=void 0}}var n=h.attr2("target"),s=h.attr2("action"),o="multipart/form-data",l=h.attr("enctype")||h.attr("encoding")||o;T.setAttribute("target",v),(!f||/post/i.test(f))&&T.setAttribute("method","POST"),s!=p.url&&T.setAttribute("action",p.url),p.skipEncodingOverride||f&&!/post/i.test(f)||h.attr({encoding:"multipart/form-data",enctype:"multipart/form-data"}),p.timeout&&(x=setTimeout(function(){S=!0,u(C)},p.timeout));var c=[];try{if(p.extraData)for(var d in p.extraData)p.extraData.hasOwnProperty(d)&&c.push(e.isPlainObject(p.extraData[d])&&p.extraData[d].hasOwnProperty("name")&&p.extraData[d].hasOwnProperty("value")?e('<input type="hidden" name="'+p.extraData[d].name+'">').val(p.extraData[d].value).appendTo(T)[0]:e('<input type="hidden" name="'+d+'">').val(p.extraData[d]).appendTo(T)[0]);p.iframeTarget||g.appendTo("body"),y.attachEvent?y.attachEvent("onload",u):y.addEventListener("load",u,!1),setTimeout(t,15);try{T.submit()}catch(m){var b=document.createElement("form").submit;b.apply(T)}}finally{T.setAttribute("action",s),T.setAttribute("enctype",l),n?T.setAttribute("target",n):h.removeAttr("target"),e(c).remove()}}function u(t){if(!b.aborted&&!_){if(M=i(y),M||(r("cannot access response document"),t=k),t===C&&b)return b.abort("timeout"),void N.reject(b,"timeout");if(t==k&&b)return b.abort("server abort"),void N.reject(b,"error","server abort");if(M&&M.location.href!=p.iframeSrc||S){y.detachEvent?y.detachEvent("onload",u):y.removeEventListener("load",u,!1);var n,s="success";try{if(S)throw"timeout";var o="xml"==p.dataType||M.XMLDocument||e.isXMLDoc(M);if(r("isXml="+o),!o&&window.opera&&(null===M.body||!M.body.innerHTML)&&--D)return r("requeing onLoad callback, DOM not available"),void setTimeout(u,250);var f=M.body?M.body:M.documentElement;b.responseText=f?f.innerHTML:null,b.responseXML=M.XMLDocument?M.XMLDocument:M,o&&(p.dataType="xml"),b.getResponseHeader=function(e){var t={"content-type":p.dataType};return t[e.toLowerCase()]},f&&(b.status=Number(f.getAttribute("status"))||b.status,b.statusText=f.getAttribute("statusText")||b.statusText);var l=(p.dataType||"").toLowerCase(),c=/(json|script|text)/.test(l);if(c||p.textarea){var h=M.getElementsByTagName("textarea")[0];if(h)b.responseText=h.value,b.status=Number(h.getAttribute("status"))||b.status,b.statusText=h.getAttribute("statusText")||b.statusText;else if(c){var v=M.getElementsByTagName("pre")[0],m=M.getElementsByTagName("body")[0];v?b.responseText=v.textContent?v.textContent:v.innerText:m&&(b.responseText=m.textContent?m.textContent:m.innerText)}}else"xml"==l&&!b.responseXML&&b.responseText&&(b.responseXML=P(b.responseText));try{O=B(b,l,p)}catch(w){s="parsererror",b.error=n=w||s}}catch(w){r("error caught: ",w),s="error",b.error=n=w||s}b.aborted&&(r("upload aborted"),s=null),b.status&&(s=b.status>=200&&b.status<300||304===b.status?"success":"error"),"success"===s?(p.success&&p.success.call(p.context,O,"success",b),N.resolve(b.responseText,"success",b),d&&e.event.trigger("ajaxSuccess",[b,p])):s&&(void 0===n&&(n=b.statusText),p.error&&p.error.call(p.context,b,s,n),N.reject(b,"error",n),d&&e.event.trigger("ajaxError",[b,p,n])),d&&e.event.trigger("ajaxComplete",[b,p]),d&&!--e.active&&e.event.trigger("ajaxStop"),p.complete&&p.complete.call(p.context,b,s),_=!0,p.timeout&&clearTimeout(x),setTimeout(function(){p.iframeTarget?g.attr("src",p.iframeSrc):g.remove(),b.responseXML=null},100)}}}var l,c,p,d,v,g,y,b,w,E,S,x,T=h[0],N=e.Deferred();if(N.abort=function(e){b.abort(e)},n)for(c=0;c<m.length;c++)l=e(m[c]),s?l.prop("disabled",!1):l.removeAttr("disabled");if(p=e.extend(!0,{},e.ajaxSettings,t),p.context=p.context||p,v="jqFormIO"+(new Date).getTime(),p.iframeTarget?(g=e(p.iframeTarget),E=g.attr2("name"),E?v=E:g.attr2("name",v)):(g=e('<iframe name="'+v+'" src="'+p.iframeSrc+'" />'),g.css({position:"absolute",top:"-1000px",left:"-1000px"})),y=g[0],b={aborted:0,responseText:null,responseXML:null,status:0,statusText:"n/a",getAllResponseHeaders:function(){},getResponseHeader:function(){},setRequestHeader:function(){},abort:function(t){var n="timeout"===t?"timeout":"aborted";r("aborting upload... "+n),this.aborted=1;try{y.contentWindow.document.execCommand&&y.contentWindow.document.execCommand("Stop")}catch(i){}g.attr("src",p.iframeSrc),b.error=n,p.error&&p.error.call(p.context,b,n,t),d&&e.event.trigger("ajaxError",[b,p,n]),p.complete&&p.complete.call(p.context,b,n)}},d=p.global,d&&0===e.active++&&e.event.trigger("ajaxStart"),d&&e.event.trigger("ajaxSend",[b,p]),p.beforeSend&&p.beforeSend.call(p.context,b,p)===!1)return p.global&&e.active--,N.reject(),N;if(b.aborted)return N.reject(),N;w=T.clk,w&&(E=w.name,E&&!w.disabled&&(p.extraData=p.extraData||{},p.extraData[E]=w.value,"image"==w.type&&(p.extraData[E+".x"]=T.clk_x,p.extraData[E+".y"]=T.clk_y)));var C=1,k=2,L=e("meta[name=csrf-token]").attr("content"),A=e("meta[name=csrf-param]").attr("content");A&&L&&(p.extraData=p.extraData||{},p.extraData[A]=L),p.forceSync?o():setTimeout(o,10);var O,M,_,D=50,P=e.parseXML||function(e,t){return window.ActiveXObject?(t=new ActiveXObject("Microsoft.XMLDOM"),t.async="false",t.loadXML(e)):t=(new DOMParser).parseFromString(e,"text/xml"),t&&t.documentElement&&"parsererror"!=t.documentElement.nodeName?t:null},H=e.parseJSON||function(e){return window.eval("("+e+")")},B=function(t,n,r){var i=t.getResponseHeader("content-type")||"",s="xml"===n||!n&&i.indexOf("xml")>=0,o=s?t.responseXML:t.responseText;return s&&"parsererror"===o.documentElement.nodeName&&e.error&&e.error("parsererror"),r&&r.dataFilter&&(o=r.dataFilter(o,n)),"string"==typeof o&&("json"===n||!n&&i.indexOf("json")>=0?o=H(o):("script"===n||!n&&i.indexOf("javascript")>=0)&&e.globalEval(o)),o};return N}if(!this.length)return r("ajaxSubmit: skipping submit process - no element selected"),this;var f,l,c,h=this;"function"==typeof t?t={success:t}:void 0===t&&(t={}),f=t.type||this.attr2("method"),l=t.url||this.attr2("action"),c="string"==typeof l?e.trim(l):"",c=c||window.location.href||"",c&&(c=(c.match(/^([^#]+)/)||[])[1]),t=e.extend(!0,{url:c,success:e.ajaxSettings.success,type:f||e.ajaxSettings.type,iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank"},t);var p={};if(this.trigger("form-pre-serialize",[this,t,p]),p.veto)return r("ajaxSubmit: submit vetoed via form-pre-serialize trigger"),this;if(t.beforeSerialize&&t.beforeSerialize(this,t)===!1)return r("ajaxSubmit: submit aborted via beforeSerialize callback"),this;var d=t.traditional;void 0===d&&(d=e.ajaxSettings.traditional);var v,m=[],g=this.formToArray(t.semantic,m);if(t.data&&(t.extraData=t.data,v=e.param(t.data,d)),t.beforeSubmit&&t.beforeSubmit(g,this,t)===!1)return r("ajaxSubmit: submit aborted via beforeSubmit callback"),this;if(this.trigger("form-submit-validate",[g,this,t,p]),p.veto)return r("ajaxSubmit: submit vetoed via form-submit-validate trigger"),this;var y=e.param(g,d);v&&(y=y?y+"&"+v:v),"GET"==t.type.toUpperCase()?(t.url+=(t.url.indexOf("?")>=0?"&":"?")+y,t.data=null):t.data=y;var b=[];if(t.resetForm&&b.push(function(){h.resetForm()}),t.clearForm&&b.push(function(){h.clearForm(t.includeHidden)}),!t.dataType&&t.target){var w=t.success||function(){};b.push(function(n){var r=t.replaceTarget?"replaceWith":"html";e(t.target)[r](n).each(w,arguments)})}else t.success&&b.push(t.success);if(t.success=function(e,n,r){for(var i=t.context||this,s=0,o=b.length;o>s;s++)b[s].apply(i,[e,n,r||h,h])},t.error){var E=t.error;t.error=function(e,n,r){var i=t.context||this;E.apply(i,[e,n,r,h])}}if(t.complete){var S=t.complete;t.complete=function(e,n){var r=t.context||this;S.apply(r,[e,n,h])}}var x=e("input[type=file]:enabled",this).filter(function(){return""!==e(this).val()}),T=x.length>0,N="multipart/form-data",C=h.attr("enctype")==N||h.attr("encoding")==N,k=i.fileapi&&i.formdata;r("fileAPI :"+k);var L,A=(T||C)&&!k;t.iframe!==!1&&(t.iframe||A)?t.closeKeepAlive?e.get(t.closeKeepAlive,function(){L=u(g)}):L=u(g):L=(T||C)&&k?o(g):e.ajax(t),h.removeData("jqxhr").data("jqxhr",L);for(var O=0;O<m.length;O++)m[O]=null;return this.trigger("form-submit-notify",[this,t]),this},e.fn.ajaxForm=function(i){if(i=i||{},i.delegation=i.delegation&&e.isFunction(e.fn.on),!i.delegation&&0===this.length){var s={s:this.selector,c:this.context};return!e.isReady&&s.s?(r("DOM not ready, queuing ajaxForm"),e(function(){e(s.s,s.c).ajaxForm(i)}),this):(r("terminating; zero elements found by selector"+(e.isReady?"":" (DOM not ready)")),this)}return i.delegation?(e(document).off("submit.form-plugin",this.selector,t).off("click.form-plugin",this.selector,n).on("submit.form-plugin",this.selector,i,t).on("click.form-plugin",this.selector,i,n),this):this.ajaxFormUnbind().bind("submit.form-plugin",i,t).bind("click.form-plugin",i,n)},e.fn.ajaxFormUnbind=function(){return this.unbind("submit.form-plugin click.form-plugin")},e.fn.formToArray=function(t,n){var r=[];if(0===this.length)return r;var s,o=this[0],u=this.attr("id"),a=t?o.getElementsByTagName("*"):o.elements;if(a&&!/MSIE [678]/.test(navigator.userAgent)&&(a=e(a).get()),u&&(s=e(':input[form="'+u+'"]').get(),s.length&&(a=(a||[]).concat(s))),!a||!a.length)return r;var f,l,c,h,p,d,v;for(f=0,d=a.length;d>f;f++)if(p=a[f],c=p.name,c&&!p.disabled)if(t&&o.clk&&"image"==p.type)o.clk==p&&(r.push({name:c,value:e(p).val(),type:p.type}),r.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}));else if(h=e.fieldValue(p,!0),h&&h.constructor==Array)for(n&&n.push(p),l=0,v=h.length;v>l;l++)r.push({name:c,value:h[l]});else if(i.fileapi&&"file"==p.type){n&&n.push(p);var m=p.files;if(m.length)for(l=0;l<m.length;l++)r.push({name:c,value:m[l],type:p.type});else r.push({name:c,value:"",type:p.type})}else null!==h&&"undefined"!=typeof h&&(n&&n.push(p),r.push({name:c,value:h,type:p.type,required:p.required}));if(!t&&o.clk){var g=e(o.clk),y=g[0];c=y.name,c&&!y.disabled&&"image"==y.type&&(r.push({name:c,value:g.val()}),r.push({name:c+".x",value:o.clk_x},{name:c+".y",value:o.clk_y}))}return r},e.fn.formSerialize=function(t){return e.param(this.formToArray(t))},e.fn.fieldSerialize=function(t){var n=[];return this.each(function(){var r=this.name;if(r){var i=e.fieldValue(this,t);if(i&&i.constructor==Array)for(var s=0,o=i.length;o>s;s++)n.push({name:r,value:i[s]});else null!==i&&"undefined"!=typeof i&&n.push({name:this.name,value:i})}}),e.param(n)},e.fn.fieldValue=function(t){for(var n=[],r=0,i=this.length;i>r;r++){var s=this[r],o=e.fieldValue(s,t);null===o||"undefined"==typeof o||o.constructor==Array&&!o.length||(o.constructor==Array?e.merge(n,o):n.push(o))}return n},e.fieldValue=function(t,n){var r=t.name,i=t.type,s=t.tagName.toLowerCase();if(void 0===n&&(n=!0),n&&(!r||t.disabled||"reset"==i||"button"==i||("checkbox"==i||"radio"==i)&&!t.checked||("submit"==i||"image"==i)&&t.form&&t.form.clk!=t||"select"==s&&-1==t.selectedIndex))return null;if("select"==s){var o=t.selectedIndex;if(0>o)return null;for(var u=[],a=t.options,f="select-one"==i,l=f?o+1:a.length,c=f?o:0;l>c;c++){var h=a[c];if(h.selected){var p=h.value;if(p||(p=h.attributes&&h.attributes.value&&!h.attributes.value.specified?h.text:h.value),f)return p;u.push(p)}}return u}return e(t).val()},e.fn.clearForm=function(t){return this.each(function(){e("input,select,textarea",this).clearFields(t)})},e.fn.clearFields=e.fn.clearInputs=function(t){var n=/^(?:color|date|datetime|email|month|number|password|range|search|tel|text|time|url|week)$/i;return this.each(function(){var r=this.type,i=this.tagName.toLowerCase();n.test(r)||"textarea"==i?this.value="":"checkbox"==r||"radio"==r?this.checked=!1:"select"==i?this.selectedIndex=-1:"file"==r?/MSIE/.test(navigator.userAgent)?e(this).replaceWith(e(this).clone(!0)):e(this).val(""):t&&(t===!0&&/hidden/.test(r)||"string"==typeof t&&e(this).is(t))&&(this.value="")})},e.fn.resetForm=function(){return this.each(function(){("function"==typeof this.reset||"object"==typeof this.reset&&!this.reset.nodeType)&&this.reset()})},e.fn.enable=function(e){return void 0===e&&(e=!0),this.each(function(){this.disabled=!e})},e.fn.selected=function(t){return void 0===t&&(t=!0),this.each(function(){var n=this.type;if("checkbox"==n||"radio"==n)this.checked=t;else if("option"==this.tagName.toLowerCase()){var r=e(this).parent("select");t&&r[0]&&"select-one"==r[0].type&&r.find("option").selected(!1),this.selected=t}})},e.fn.ajaxSubmit.debug=!1}),define("app/components/cleaningItemsConf",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","nanobar","toastr","datepicker","momentjs","ajaxForm"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"cleaning-items-app",template:"",scope:u.extend({init:function(){this.nanobar=new i({id:"mybar",bg:"#FF6600"}),this.activeEditId=t.compute(0);var e=new Image;e.src="/static/core/img/items/default.png",this.defaultItemImage=t.compute(e)},allItems:new t.List([]),loaded:!1,editingItem:new t.Map({}),getAllItems:function(){var t=e.ajax({url:"/api/items",type:"get",dataType:"json",context:this});t.done(function(e){this.allItems.replace(e.items)})},getItemImage:function(){return this.defaultItemImage()},editItem:function(t,n,r){var i=this,s=n.attr("index"),o=e.ajax({url:"/api/items/"+s,type:"get",context:this});o.done(function(t){this.activeEditId(s),e.each(t.item,function(e,t){i.editingItem.attr(e,t)});var n=e("#item-image-input");n.replaceWith(n.val("").clone(!0));var r=new Image;r.src=this.editingItem.attr("imageUrl"),this.defaultItemImage(r),e("#cleaning-items-modal").modal("show")})},addItem:function(t,n,r){this.activeEditId(-1);var i=new Image;i.src="/static/core/img/items/default.png",this.defaultItemImage(i),e("#cleaning-items-modal").modal("show")},closeModal:function(t,n,r){var i=this;this.editingItem.each(function(e,t){i.editingItem.attr(t,null)}),e("#cleaning-items-modal").modal("hide")},previewImage:function(e,t,n){var r=new FileReader;r.readAsDataURL(t[0].files[0]),self=this,r.onload=function(e){var t=new Image;t.src=e.target.result,self.defaultItemImage(t)}},saveItem:function(t,n,r){var i=this,o=null,u="/api/items";this.activeEditId()<0?o="post":(o="put",u+="/"+this.activeEditId()),e("#cleaning-items-modal form").ajaxSubmit({url:u,type:o,dataType:"json",beforeSubmit:function(e,t,n){i.activeEditId()>=0&&e.push({name:"item_id",type:"hidden",value:i.activeEditId()})},success:function(e){i.getAllItems(),s.success("Success."),i.closeModal()},error:function(){s.error("Failed.")}})}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-configuration"&&!this.scope.loaded&&(this.scope.getAllItems(),this.scope.loaded=!0)}}})}),define("app/components/cancelledOrders",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs","summernote"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"cancel-tabs",template:"",scope:u.extend({init:function(){var n=this,r=moment();this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.datepickers_initialised=!1,this.poll_skip=0,this.poll_limit=20,this.last_action=null,this.total_quantity=t.compute(0),this.search_skip=0,this.search_limit=20,this.nanobar=new s({id:"mybar",bg:"#FF6600"});var i=JSON.parse(localStorage.getItem("statuses"));e.each(i,function(e,t){n.order_status.attr(e,t)});var o=JSON.parse(localStorage.getItem("timeslots"));e.each(o,function(e,t){n.timeslots.attr(e,t)})},orderData:new t.List([]),loaded:!1,cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},selectSearchOption:function(t,n,r){var i=e(n).parents(".input-group").find(".search-input"),s=e(n).attr("data-option");s=="name"?i.val("name:"):s=="email"?i.val("email:"):s=="phone"?i.val("phone:"):s=="oid"&&i.val("oid:"),i.focus()},getStatusDetails:function(t){var n=null,r=null;t==1?n="order_placed":t==2?n="pickup_complete":t==3?n="delivery_ready":t==4?n="clothes_delivered":t==5?n="order_cancelled":t==6?n="order_rejected":n=t;for(;;){var i=e.map(this.order_status.attr(),function(e,t){return t}).length;if(i)break}return this.order_status.each(function(e,t){e.status.each(function(t,i){t.name_id==n&&(t.color=e.color,r=t)})}),r},captureEnterKey:function(t,n,r){r.keyCode==13&&e("cancel-tabs .btn-search-go").trigger("click")},searchOrders:function(e,t,n){this._searchOrders(0,this.search_limit),this._searchOrdersDeferred()},_searchOrders:function(t,n){var r=e.trim(e("cancel-tabs .search-input").val());if(r==""){e("cancel-tabs .btn-refresh").trigger("click");return}t=typeof t=="undefined"?this.search_skip:t,n=typeof n=="undefined"?this.search_limit:n,this.nanobar.go(30),this.cancelled_search_defer=e.ajax({url:"/api/order/search/cancelled/"+r+"/"+t+"/"+n,type:"get",dataType:"json",context:this})},_searchOrdersDeferred:function(t){typeof t=="undefined"&&(t=!0),this.cancelled_search_defer.done(function(n){var r=this;this.nanobar.go(50),t&&this.orderData.replace([]);var i=[];e.each(n.data,function(e,t){var n=r.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,i.push(t)}),this.orderData.replace(i),this.search_skip+=n.data.length,this.nanobar.go(100),this.last_action="search",t||e("cancel-tabs .block-load-more").find(".fa-repeat").removeClass("fa-spin")}),this.cancelled_search_defer.fail(function(e,t,n){this.nanobar.go(100),i.error("Proper search criteria not used.")})},orderRefresh:function(t,n,r){this._pollData(0,this.poll_skip),this._pollDataDeferExec(!0),e("cancel-tabs .block-load-more").show()},getTotalQuantity:function(){return this.total_quantity()},loadMoreRows:function(t,n,r){e(n).button("load"),e(n).find(".fa-repeat").addClass("fa-spin"),this.last_action=="search"?(this._searchOrders(),this._searchOrdersDeferred(!1)):(this._pollData(),this._pollDataDefer.done(function(t){this.nanobar.go(50);var r=this;e.each(t.data,function(e,t){var n=r.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,r.orderData.push(t)}),this.poll_skip+=t.data.length,e(n).button("reset"),e(n).find(".fa-repeat").removeClass("fa-spin"),this.nanobar.go(100)}))},_pollData:function(t,n){t=typeof t=="undefined"?this.poll_skip:t,n=typeof n=="undefined"?this.poll_limit:n,this.nanobar.go(30),this._pollDataDefer=e.ajax({url:"/api/cancelled/"+t+"/"+n,type:"get",context:this,dataType:"json"})},_pollDataDeferExec:function(n){typeof n=="undefined"&&(n=!1);var r=this;t.when(this._pollDataDefer).then(function(t){this.nanobar.go(50);if(!t.data)return this.nanobar.go(100),!1;if(!n)e.each(t.data,function(e,t){var n=r.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.user_info.name=t.user_info.name.trim(),r.orderData.push(t)}),this.poll_skip=this.poll_skip+t.data.length;else{var i=[];e.each(t.data,function(e,t){var n=r.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.user_info.name=t.user_info.name.trim(),i.push(t)}),this.orderData.replace(i),this.poll_skip=t.data.length}r.nanobar.go(100),r.last_action="query"})},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u);a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):(a.attr("quantity.iron")||a.attr("quantity.iron",0),a.attr("quantity.iron",i));var f=a.attr("quantity.laundry")*a.attr("price.laundry")||0,l=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,c=a.attr("quantity.iron")*a.attr("price.iron")||0;a.attr("final_cost",f+l+c)}this._update_total_cost(),this._update_total_quantity()},openOrderModal:function(t,n,r){var i=this,s=e(n).parents("tr").attr("index"),o=null;this.nanobar.go(30);var u=e.ajax({url:"/api/orderitem/"+s,type:"get",context:this,dataType:"json"});u.done(function(t){var n=this;this.nanobar.go(50),this.cleaningItems.replace(t.data),t.customer_details.status=this.getStatusDetails(t.customer_details.status).attr("name_id"),this.modalCustomerDetails.attr("data",t.customer_details),e("#cancel-order-details-modal").attr("index",s);var r=e("#cancel-order-details-modal .summernote");r.html(this.modalCustomerDetails.attr("data.remark")),e(r).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){n.modalCustomerDetails.attr("data.remark",e("#cancel-order-details-modal .summernote").code())}}),e("#cancel-order-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),this.nanobar.go(100),e("#cancel-order-details-modal table").focus(),this._update_total_cost(),this._update_total_quantity()})},_get_sub_total_cost:function(){var e=0;return this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0;e+=i+s+o}),e},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_total_cost:function(){var e=this._get_sub_total_cost(),t=null,n=this.modalCustomerDetails.attr("data.discount.amount")||0,r=this.modalCustomerDetails.attr("data.discount.max")||0;this.allCosts.attr("sub_total_cost",e),this.modalCustomerDetails.attr("data.discount.percentage")?(t=e*n/100,r&&(r=parseInt(r),t>r&&(t=r))):t=n;var i=e-t;this.allCosts.attr("total_cost",Math.round(i))},changeMaxDiscount:function(t,n,r){var i=e("#cancel-order-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#cancel-order-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},changePaymentStatus:function(t,n,r){var s=e(n).val(),o=e("#cancel-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{is_paid:s},success:function(t){i.success("Payment status change successful."),e(n).val()=="paid"?this.modalCustomerDetails.attr("data.is_paid",!0):this.modalCustomerDetails.attr("data.is_paid",!1)},error:function(e,t,n){i.error("Payment status change failed.")}})},applyDiscount:function(t,n,r){var i=e(n).hasClass("modal-discount-percentage"),s=e("#cancel-order-details-modal .modal-discount-amount").val()||0;i?this.modalCustomerDetails.attr("data.discount.percentage",!0):this.modalCustomerDetails.attr("data.discount.percentage",!1),this.modalCustomerDetails.attr("data.discount.amount",s),this._update_total_cost()},saveOrderChanges:function(t,n,r){self=this;var s=e("#cancel-order-details-modal").attr("index");e(n).button("loading");var o=self.modalCustomerDetails.attr("data.discount").attr(),u=this.modalCustomerDetails.attr("data.bag").attr()||{};e.ajax({url:"/api/orderitem/"+s,type:"post",data:{data:JSON.stringify(self.cleaningItems.attr()),remark:self.modalCustomerDetails.attr("data.remark"),discount:JSON.stringify(o),bag:JSON.stringify(u)},success:function(t){i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeBagNumber:function(t,n,r){typeof this.modalCustomerDetails.attr("data").attr("bag")=="undefined"&&this.modalCustomerDetails.attr("data").attr("bag",{}),e(n).hasClass("bag-laundry")?this.modalCustomerDetails.attr("data.bag").attr("laundry",e(n).val()):e(n).hasClass("bag-dryclean")?this.modalCustomerDetails.attr("data.bag").attr("dryclean",e(n).val()):e(n).hasClass("bag-iron")&&this.modalCustomerDetails.attr("data.bag").attr("iron",e(n).val())},changeOrderStatus:function(t,n,r){var s=e(n).val(),o=e("#cancel-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{status:s},success:function(e){this.modalCustomerDetails.attr("data.status",s),i.success("Status change successful.")},error:function(e,t,n){i.error("Status change failed.")}})},closeModal:function(t,n,r){e("#cancel-order-details-modal .summernote").destroy(),this.last_action=="query"?e("cancel-tabs .btn-refresh").trigger("click"):e("cancel-tabs .btn-search-go").trigger("click")},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-cancelled"&&!this.scope.loaded&&(this.scope._pollData(),this.scope._pollDataDeferExec(),this.scope.loaded=!0)},"#cancelled-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)}}})}),define("app/components/completedOrders",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs","summernote","selectize"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"completed-tabs",template:"",scope:u.extend({init:function(){var n=this;this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.datepickers_initialised=!1,this.poll_skip=0,this.poll_limit=20,this.last_action=null,this.total_quantity=t.compute(0),this.row_count=t.compute(0),this.search_skip=0,this.search_limit=20,this.nanobar=new s({id:"mybar",bg:"#FF6600"});var r=JSON.parse(localStorage.getItem("statuses"));e.each(r,function(e,t){n.order_status.attr(e,t)});var i=JSON.parse(localStorage.getItem("timeslots"));e.each(i,function(e,t){n.timeslots.attr(e,t)})},orderData:new t.Map({}),loaded:!1,failureReasons:new t.List([]),cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),selectize:{},variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),rowCount:function(){return this.row_count()},getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},pickupPrevday:function(e,t,n){var r=moment(this.attr("variableDate"));r.subtract(1,"days"),this.attr("variableDate",r.toDate()),this._pollData(this.orderDate()),this._pollDataDeferExec()},pickupNextday:function(e,t,n){var r=moment(this.attr("variableDate"));r.add(1,"days"),this.attr("variableDate",r.toDate()),this._pollData(this.orderDate()),this._pollDataDeferExec()},selectSearchOption:function(t,n,r){var i=e(n).parents(".input-group").find(".search-input"),s=e(n).attr("data-option");s=="name"?i.val("name:"):s=="email"?i.val("email:"):s=="phone"?i.val("phone:"):s=="oid"&&i.val("oid:"),i.focus()},captureEnterKey:function(t,n,r){r.keyCode==13&&e("completed-tabs .btn-search-go").trigger("click")},searchOrders:function(e,t,n){this._searchOrders(0,this.search_limit),this._searchOrdersDeferred()},_searchOrders:function(t,n){var r=e.trim(e("completed-tabs .search-input").val());if(r==""){e("completed-tabs .btn-refresh").trigger("click");return}t=typeof t=="undefined"?this.search_skip:t,n=typeof n=="undefined"?this.search_limit:n,this.nanobar.go(30),this.completed_search_defer=e.ajax({url:"/api/order/search/completed/"+r+"/"+t+"/"+n,type:"get",dataType:"json",context:this})},_searchOrdersDeferred:function(){this.completed_search_defer.done(function(t){var n=this;this.nanobar.go(50);var r=[];e.each(t.data,function(e,t){var i=n.getStatusDetails(t.status);t.status_formal=i.formal_name,t.status_color=i.color,t.user_info.name=t.user_info.name.trim(),r.push(t)}),this.orderData.attr(r,!0),this.search_skip+=t.data.length,this.nanobar.go(100),this.last_action="search"}),this.completed_search_defer.fail(function(e,t,n){this.nanobar.go(100),i.error("Proper search criteria not used.")})},orderRefresh:function(e,t,n){this.last_action=="query"?(this._pollData(this.orderDate()),this._pollDataDeferExec(!0)):this.searchOrders()},getTotalQuantity:function(){return this.total_quantity()},getOrderDataKey:function(e){var t;return this.orderData.each(function(n,r){n.attr(e)&&(t=r)}),t},loadMoreRows:function(t,n,r){e(n).button("load"),e(n).find(".fa-repeat").addClass("fa-spin"),this.last_action=="search"?(this._searchOrders(),this._searchOrdersDeferred(!1)):(this._pollData(),this._pollDataDefer.done(function(t){this.nanobar.go(50);var r=this;e.each(t.data,function(e,t){r.orderData.push(t)}),this.poll_skip+=t.data.length,e(n).button("reset"),e(n).find(".fa-repeat").removeClass("fa-spin"),this.nanobar.go(100)}))},_pollData:function(t){t&&(t=this.getFormattedDate(moment(t))),this.nanobar.go(30),this._pollDataDefer=e.ajax({url:"/api/completed/"+t,type:"get",context:this,dataType:"json"})},_addData:function(t){this.row_count(t.length);var n=this,r={};e.each(t,function(e,t){var i=n.getStatusDetails(t.status);t.status_formal=i.formal_name,t.status_color=i.color,t.pickup_date=t.pickup_data.schedule_date,t.delivery_date=t.delivery_data.schedule_date,t.user_info.name=t.user_info.name.trim(),delete t.delivery_data,delete t.pickup_data,r[t.order_id]=t}),n.orderData.attr(r,!0)},_updateData:function(t){this.row_count(t.length);var n=this,r=[];e.each(t,function(e,t){r.push(t.order_id);if(!n.orderData.attr(t.order_id)){var i=n.getStatusDetails(t.status);t.status_formal=i.formal_name,t.status_color=i.color,t.user_info.name=t.user_info.name.trim(),delete t.delivery_data,delete t.pickup_data,n.orderData.attr(t.order_id,t)}else if(n.orderData.attr(t["order_id"]+".status")!=t["status"]){var i=n.getStatusDetails(t.status);n.orderData.attr(t.order_id+".status_formal",i.formal_name),n.orderData.attr(t.order_id+".status_color",i.color),n.orderData.attr(t.order_id+".status",t.status)}});var i=[];this.orderData.each(function(e,t){r.indexOf(t)==-1&&i.push(t)}),e.each(i,function(e,t){n.orderData.removeAttr(t)})},_pollDataDeferExec:function(e){typeof e=="undefined"&&(e=!1),this._pollDataDefer.done(function(t){this.nanobar.go(50);if(!t.data)return this.nanobar.go(100),!1;e?this._updateData(t.data):this._addData(t.data),this.poll_skip=t.data.length,this.last_action="query",this.nanobar.go(100)})},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u);a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):(a.attr("quantity.iron")||a.attr("quantity.iron",0),a.attr("quantity.iron",i));var f=a.attr("quantity.laundry")*a.attr("price.laundry")||0,l=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,c=a.attr("quantity.iron")*a.attr("price.iron")||0;a.attr("final_cost",f+l+c)}this._update_total_cost(),this._update_total_quantity()},changeFailureReason:function(t,n,r){var i=e(n).val(),s="";i&&(i!="other"?(this.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason",i),this.modalCustomerDetails.attr("data.failure_reason.partial_payment.type","")):(this.modalCustomerDetails.attr("data.failure_reason.partial_payment.type","others"),this.modalCustomerDetails.attr("data.failure_reason.partial_payment.full_reason",""),this.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason",i)))},changeOtherReason:function(e,t,n){this.modalCustomerDetails.attr("data.failure_reason.partial_payment.full_reason",t.val())},changeCashCollected:function(t,n,r){var i=parseInt(e(n).val());this.modalCustomerDetails.attr("data.cash_collected",i)},openOrderModal:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=null;this.nanobar.go(30);var o=e.ajax({url:"/api/orderitem/"+i,type:"get",context:this,dataType:"json"}),u=e.ajax({url:"/api/failurereason/partial_payment",type:"get",dataType:"json"}),a=this;e.when(o,u).done(function(t,n){t=t[0],n=n[0],a.failureReasons.attr(n.data),a.nanobar.go(50),a.cleaningItems.replace(t.data),t.customer_details.status=a.getStatusDetails(t.customer_details.status).attr("name_id"),a.modalCustomerDetails.attr("data",t.customer_details),a.modalCustomerDetails.attr("data.bag.laundry")&&a.modalCustomerDetails.attr("data.bag.laundry").each(function(e,t){a.selectize.laundry.createItem(e)}),a.modalCustomerDetails.attr("data.bag.dryclean")&&a.modalCustomerDetails.attr("data.bag.dryclean").each(function(e,t){a.selectize.dryclean.createItem(e)}),a.modalCustomerDetails.attr("data.bag.iron")&&a.modalCustomerDetails.attr("data.bag.iron").each(function(e,t){a.selectize.iron.createItem(e)}),a.modalCustomerDetails.attr("data.failure_reason.partial_payment")?a.modalCustomerDetails.attr("data.failure_reason.partial_payment").attr("type",""):a.modalCustomerDetails.attr("data.failure_reason.partial_payment",{type:""});var r=!0;a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")&&(a.failureReasons.each(function(e,t){a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")==e.attr("str_id")&&(a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason",e.attr("str_id")),r=!1)}),r&&a.modalCustomerDetails.attr("data.failure_reason.partial_payment.type","others")),e("#completed-order-details-modal").attr("index",i);var s=e("#completed-order-details-modal .summernote");s.html(a.modalCustomerDetails.attr("data.remark")),e(s).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){a.modalCustomerDetails.attr("data.remark",e("#completed-order-details-modal .summernote").code())}}),e("#completed-order-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),a.nanobar.go(100),e("#completed-order-details-modal table").focus(),a._update_total_cost(),a._update_total_quantity()})},_get_sub_total_cost:function(){var e=0;return this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0;e+=i+s+o}),e},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_total_cost:function(){var e=this._get_sub_total_cost(),t=null,n=this.modalCustomerDetails.attr("data.discount.amount")||0,r=this.modalCustomerDetails.attr("data.discount.max")||0,i=this.modalCustomerDetails.attr("data.service_type"),s=this.modalCustomerDetails.attr("data.service_tax").attr(),o=this.modalCustomerDetails.attr("data.discount.min_order")||0;this.allCosts.attr("sub_total_cost",e),this.modalCustomerDetails.attr("data.discount.percentage")?o?e>=o?t=e*n/100:t=0:t=e*n/100:o?e>=o?t=n:t=0:t=n,r&&(r=parseInt(r),t>r&&(t=r)),this.modalCustomerDetails.attr("data.discount.percentage")||this.modalCustomerDetails.attr("data.discount.amount",t);var u=e-t,a=Math.round(u*s.rate/100);this.modalCustomerDetails.attr("data.service_tax.type")=="inclusive"?this.allCosts.attr("service_tax",a):this.modalCustomerDetails.attr("data.service_tax.type")=="exclusive"&&(u+=a,this.allCosts.attr("service_tax",a));var f=this.modalCustomerDetails.attr("data.credits.available");f||(f=this.modalCustomerDetails.attr("data.user.credits"),this.modalCustomerDetails.attr("data.credits.available",f));var l=null;f>=u?l=u:l=f,u-=l,this.modalCustomerDetails.attr("data.credits.used",l),this.allCosts.attr("total_cost",Math.round(u))},changeMaxDiscount:function(t,n,r){var i=e("#completed-order-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#completed-order-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},changePaymentStatus:function(t,n,r){var i=e(n).val(),s=e("#completed-order-details-modal").attr("index");i?this.modalCustomerDetails.attr("data.is_paid",i):this.modalCustomerDetails.attr("data.is_paid",!1),i=="paid"?this.modalCustomerDetails.attr("data.cash_collected",this.modalCustomerDetails.attr("data.cost.total")):i=="not_paid"?(this.modalCustomerDetails.attr("data.cash_collected",0),this.modalCustomerDetails.attr("data.failure_reason.partial_payment").attr("type",""),this.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason","none")):i=="partially_paid"?(this.modalCustomerDetails.attr("data.cash_collected",1),this.modalCustomerDetails.attr("data.failure_reason.partial_payment").attr("type",""),this.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason","none")):i=="excess_paid"&&this.modalCustomerDetails.attr("data.cash_collected",this.modalCustomerDetails.attr("data.cost.total")+1)},savePaymentChanges:function(t,n,r){var s=e("#completed-order-details-modal").attr("index");e(n).button("loading");var o=this.modalCustomerDetails.attr("data.cash_collected"),u=this.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason"),a=this.modalCustomerDetails.attr("data.failure_reason.partial_payment.type"),f=this.modalCustomerDetails.attr("data.is_paid"),l=this.modalCustomerDetails.attr("data.cost.total"),c=this.modalCustomerDetails.attr("data.cost.total");if(isNaN(o)){i.error("Please Enter only Number in Cash Collected.."),e(n).button("reset");return}if(f=="partially_paid"){if(o>=c){i.error("Please Enter Number in cash Collected..\n Max Allowed = "+(c-1)),e(n).button("reset");return}}else if(f=="excess_paid"&&o<=c){i.error("Entered amount can not be less then "+(c+1)),e(n).button("reset");return}if(f!="excess_paid"&&f!="paid")if(!u||u=="none"){i.error("Please select reason.."),e(n).button("reset");return}var h={is_paid:f,cash_collected:o};f!="paid"&&f!="excess_paid"&&(a!="others"?h.failure_reason=JSON.stringify({reason:u,type:"partial_payment"}):h.failure_reason=JSON.stringify({reason:this.modalCustomerDetails.attr("data.failure_reason.partial_payment.full_reason"),type:"partial_payment",type2:"other"})),e.ajax({url:"/api/order/"+s,type:"put",dataType:"json",context:this,data:h,success:function(t){this.orderData.attr(s).attr("cash_collected",h.cash_collected),i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},applyDiscount:function(t,n,r){var i=e(n).hasClass("modal-discount-percentage"),s=e("#completed-order-details-modal .modal-discount-amount").val()||0;i?this.modalCustomerDetails.attr("data.discount.percentage",!0):this.modalCustomerDetails.attr("data.discount.percentage",!1),this.modalCustomerDetails.attr("data.discount.amount",s),this._update_total_cost()},saveOrderChanges:function(t,n,r){self=this;var s=e("#completed-order-details-modal").attr("index");e(n).button("loading");var o=self.modalCustomerDetails.attr("data.discount").attr(),u=this.modalCustomerDetails.attr("data.bag").attr()||{};e.ajax({url:"/api/orderitem/"+s,type:"post",data:{data:JSON.stringify(self.cleaningItems.attr()),remark:self.modalCustomerDetails.attr("data.remark"),discount:JSON.stringify(o),bag:JSON.stringify(u)},success:function(t){i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeBagNumber:function(t,n,r){typeof this.modalCustomerDetails.attr("data").attr("bag")=="undefined"&&this.modalCustomerDetails.attr("data").attr("bag",{}),e(n).hasClass("bag-laundry")?this.modalCustomerDetails.attr("data.bag").attr("laundry",e(n).val()):e(n).hasClass("bag-dryclean")?this.modalCustomerDetails.attr("data.bag").attr("dryclean",e(n).val()):e(n).hasClass("bag-iron")&&this.modalCustomerDetails.attr("data.bag").attr("iron",e(n).val())},changeOrderStatus:function(t,n,r){var s=e(n).val(),o=e("#completed-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{status:s},success:function(e){this.modalCustomerDetails.attr("data.status",s),i.success("Status change successful.")},error:function(e,t,n){i.error("Status change failed.")}})},closeModal:function(t,n,r){this.selectize.laundry.clear(),this.selectize.dryclean.clear(),this.selectize.iron.clear(),e("#completed-order-details-modal .summernote").destroy(),this.last_action=="query"?e("completed-tabs .btn-refresh").trigger("click"):e("completed-tabs .btn-search-go").trigger("click")},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-completed"&&!this.scope.loaded&&(this.scope._pollData(this.scope.orderDate()),this.scope._pollDataDeferExec(),this.scope.loaded=!0)},"#completed-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)},inserted:function(){var t=this,n={format:"yyyy-mm-dd",startdate:"2014-10-22",autoclose:!0,todayBtn:!0};e("#completed-orders .order-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,i=moment(new Date(Date.parse(e(this).datepicker("getDate")))),s=e("#completed-order-details-modal").attr("index"),o=i.format("YYYY/MM/DD");t.scope._pollData(i),t.scope._pollDataDeferExec(),t.scope.attr("variableDate",i.toDate())});var r=e("#completed-modal-others .bag-laundry").selectize({delimiter:"|",persist:!1,create:function(e){return e||(e=""),{value:e.toUpperCase(),text:e.toUpperCase()}},onInitialize:function(){var e=this.$input[0].selectize;e.disable()}}),i=e("#completed-modal-others .bag-dryclean").selectize({delimiter:"|",persist:!1,create:function(e){return e||(e=""),{value:e.toUpperCase(),text:e.toUpperCase()}},onInitialize:function(){var e=this.$input[0].selectize;e.disable()}}),s=e("#completed-modal-others .bag-iron").selectize({delimiter:"|",persist:!1,create:function(e){return e||(e=""),{value:e.toUpperCase(),text:e.toUpperCase()}},onInitialize:function(){var e=this.$input[0].selectize;e.disable()}});t.scope.selectize={laundry:r[0].selectize,dryclean:i[0].selectize,iron:s[0].selectize}}}})}),define("app/components/allOrders",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","momentjs","summernote"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"all-orders-tabs",template:"",scope:u.extend({init:function(){var n=this,r=moment();this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.poll_skip=0,this.poll_limit=20,this.last_action=null,this.total_quantity=t.compute(0),this.row_count=t.compute(0),this.search_skip=0,this.search_limit=20,this.nanobar=new s({id:"mybar",bg:"#FF6600"});var i=JSON.parse(localStorage.getItem("statuses"));e.each(i,function(e,t){n.order_status.attr(e,t)});var o=JSON.parse(localStorage.getItem("timeslots"));e.each(o,function(e,t){n.timeslots.attr(e,t)})},orderData:new t.Map({}),loaded:!1,failureReasons:new t.List([]),cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),selectize:{},variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),rowCount:function(){return this.row_count()},getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},pickupPrevday:function(e,t,n){var r=moment(this.attr("variableDate"));r.subtract(1,"days"),this.attr("variableDate",r.toDate()),this._pollData(this.orderDate()),this._pollDataDeferExec()},pickupNextday:function(e,t,n){var r=moment(this.attr("variableDate"));r.add(1,"days"),this.attr("variableDate",r.toDate()),this._pollData(this.orderDate()),this._pollDataDeferExec()},pickupTimeSlotChange:function(t,n,r){var s=e("#all-orders-order-details-modal").attr("index"),o=e(n).val(),u=this.timeslots.attr(o);this.modalCustomerDetails.attr("data.schedules.pickup.schedule",u),e.ajax({url:"/api/pickup",type:"put",dataType:"json",data:{order_id:s,time:u},success:function(e){i.success("Timeslot changed.")},error:function(e,t,n){i.error("Timeslot change error.")}})},deliveryTimeSlotChange:function(t,n,r){var s=e("#all-orders-order-details-modal").attr("index"),o=e(n).val();o==0&&(o=e(n).attr("value"));var u=this.timeslots.attr(o);e.ajax({url:"/api/delivery",type:"put",dataType:"json",context:this,data:{order_id:s,time:u},success:function(e){this.modalCustomerDetails.attr("data.schedules.delivery.schedule",u),i.success("Timeslot changed.")},error:function(e,t,n){i.error("Timeslot change error.")}})},selectSearchOption:function(t,n,r){var i=e(n).parents(".input-group").find(".search-input"),s=e(n).attr("data-option");s=="name"?i.val("name:"):s=="email"?i.val("email:"):s=="phone"?i.val("phone:"):s=="oid"&&i.val("oid:"),i.focus()},captureEnterKey:function(t,n,r){r.keyCode==13&&e("all-orders-tabs .btn-search-go").trigger("click")},searchOrders:function(e,t,n){this._searchOrders(0,this.search_limit),this._searchOrdersDeferred()},_searchOrders:function(t,n){var r=e.trim(e("all-orders-tabs .search-input").val());if(r==""){e("all-orders-tabs .btn-refresh").trigger("click");return}t=typeof t=="undefined"?this.search_skip:t,n=typeof n=="undefined"?this.search_limit:n,this.nanobar.go(30),this.all_orders_search_defer=e.ajax({url:"/api/order/search/"+r+"/"+t+"/"+n,type:"get",dataType:"json",context:this})},_searchOrdersDeferred:function(){this.all_orders_search_defer.done(function(t){var n=this;this.nanobar.go(50);var r={};e.each(t.data,function(e,t){var i=n.getStatusDetails(t.status);t.status_formal=i.formal_name,t.status_color=i.color,t.user_info.name=t.user_info.name.trim(),r[t.order_id]=t}),this.orderData.attr(r,!0),this.search_skip+=t.data.length,this.nanobar.go(100),this.last_action="search"}),this.all_orders_search_defer.fail(function(e,t,n){this.nanobar.go(100),i.error("Proper search criteria not used.")})},orderRefresh:function(e,t,n){this.last_action=="query"?(this._pollData(this.orderDate()),this._pollDataDeferExec(!0)):this.searchOrders()},getTotalQuantity:function(){return this.total_quantity()},loadMoreRows:function(t,n,r){e(n).button("load"),e(n).find(".fa-repeat").addClass("fa-spin"),this.last_action=="search"?(this._searchOrders(),this._searchOrdersDeferred(!1)):(this._pollData(),this._pollDataDefer.done(function(t){this.nanobar.go(50);var r=this;e.each(t.data,function(e,t){var n=r.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,r.orderData.push(t)}),this.poll_skip+=t.data.length,e(n).button("reset"),e(n).find(".fa-repeat").removeClass("fa-spin"),this.nanobar.go(100)}))},_pollData:function(t){t&&(t=this.getFormattedDate(moment(t))),this.nanobar.go(30),this._pollDataDefer=e.ajax({url:"/api/order/pickup/"+t,type:"get",context:this,dataType:"json"})},_addData:function(t){this.row_count(t.length);var n=this,r={};e.each(t,function(e,t){var i=n.getStatusDetails(t.status);t.status_formal=i.formal_name,t.status_color=i.color,t.pickup_date=t.pickup_data.schedule_date,t.delivery_date=t.delivery_data.schedule_date,t.user_info.name=t.user_info.name.trim(),delete t.delivery_data,delete t.pickup_data,r[t.order_id]=t}),n.orderData.attr(r,!0)},_updateData:function(t){this.row_count(t.length);var n=this,r=[];e.each(t,function(e,t){r.push(t.order_id);if(!n.orderData.attr(t.order_id)){var i=n.getStatusDetails(t.status);t.status_formal=i.formal_name,t.status_color=i.color,t.user_info.name=t.user_info.name.trim(),delete t.delivery_data,delete t.pickup_data,n.orderData.attr(t.order_id,t)}else if(n.orderData.attr(t["order_id"]+".status")!=t["status"]){var i=n.getStatusDetails(t.status);n.orderData.attr(t.order_id+".status_formal",i.formal_name),n.orderData.attr(t.order_id+".status_color",i.color),n.orderData.attr(t.order_id+".status",t.status)}});var i=[];this.orderData.each(function(e,t){r.indexOf(t)==-1&&i.push(t)}),e.each(i,function(e,t){n.orderData.removeAttr(t)})},_pollDataDeferExec:function(e){typeof e=="undefined"&&(e=!1),this._pollDataDefer.done(function(t){this.nanobar.go(50);if(!t.data)return this.nanobar.go(100),!1;e?this._updateData(t.data):this._addData(t.data),this.poll_skip=t.data.length,this.last_action="query",this.nanobar.go(100)})},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u);a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):(a.attr("quantity.iron")||a.attr("quantity.iron",0),a.attr("quantity.iron",i));var f=a.attr("quantity.laundry")*a.attr("price.laundry")||0,l=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,c=a.attr("quantity.iron")*a.attr("price.iron")||0;a.attr("final_cost",f+l+c)}this._update_total_cost(),this._update_total_quantity()},changeFailureReason:function(t,n,r){var i=this.modalCustomerDetails.attr("data.is_paid");this.modalCustomerDetails.attr("is_paid",i);var s=e(n).val(),o="";this.modalCustomerDetails.attr("data").attr("reason")||this.modalCustomerDetails.attr("data").attr("reason",{type:null,value:null}),s!=undefined&&(s!="other"?(this.modalCustomerDetails.attr("failure_reason",s),this.modalCustomerDetails.attr("data").attr("reason",{type:null})):(this.modalCustomerDetails.attr("failure_reason",s),this.modalCustomerDetails.attr("data").attr("reason",{type:"others"})))},changeOtherReason:function(e,t,n){this.modalCustomerDetails.attr("data").attr("reason.value",t.val())},saveOtherReason:function(t,n,r){e.ajax({url:"/api/order/"+this.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{failure_reason:JSON.stringify({reason:this.modalCustomerDetails.attr("data.reason.value"),type:"delivery",type2:"other"})},success:function(e){i.success("Successfully changed.")},error:function(e,t,n){i.error("Failed.")}})},changeCashCollected:function(t,n,r){var s=parseInt(e(n).val()),o=this.modalCustomerDetails.attr("data.cost.total"),u=this.modalCustomerDetails.attr("data.cash_collected"),a=this.modalCustomerDetails.attr("data.is_paid"),f=0,l=o-1,c=o+1;a!="excess_paid"&&s>=o&&(i.error("Please Enter Number in cash Collected..\n Max Allowed = "+l),e("#cashCollected").val(l));var s=parseInt(e(n).val());this.modalCustomerDetails.attr("data.cash_collected",s),this.saveCashCollected()},saveCashCollected:function(t,n,r){var i=e("#all-orders-order-details-modal").attr("index"),s=this.modalCustomerDetails.attr("data.cash_collected")},openOrderModal:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=null;this.nanobar.go(30);var o=e.ajax({url:"/api/orderitem/"+i,type:"get",context:this,dataType:"json"}),u=e.ajax({url:"/api/failurereason/partial_payment",type:"get",dataType:"json"}),a=this;e.when(o,u).done(function(t,n){t=t[0],n=n[0],a.failureReasons.attr(n.data),a.nanobar.go(50),a.cleaningItems.replace(t.data),t.customer_details.status=a.getStatusDetails(t.customer_details.status).attr("name_id"),a.modalCustomerDetails.attr("data",t.customer_details),a.modalCustomerDetails.attr("data.failure_reason.partial_payment")?a.modalCustomerDetails.attr("data.failure_reason.partial_payment").attr("type",""):a.modalCustomerDetails.attr("data.failure_reason.partial_payment",{type:""}),a.modalCustomerDetails.attr("data.bag.laundry")&&a.modalCustomerDetails.attr("data.bag.laundry").each(function(e,t){a.selectize.laundry.addOption({value:e,text:e}),a.selectize.laundry.addItem(e,!0)});if(a.modalCustomerDetails.attr("data.bag.dryclean")){var r=e("#all-orders-modal-others .bag-dryclean")[0].selectize;a.modalCustomerDetails.attr("data.bag.dryclean").each(function(e,t){a.selectize.dryclean.addOption({value:e,text:e}),a.selectize.dryclean.addItem(e,!0)})}if(a.modalCustomerDetails.attr("data.bag.iron")){var s=e("#all-orders-modal-others .bag-iron")[0].selectize;a.modalCustomerDetails.attr("data.bag.iron").each(function(e,t){a.selectize.iron.addOption({value:e,text:e}),a.selectize.iron.addItem(e,!0)})}var o=!0;a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")&&(a.failureReasons.each(function(e,t){a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")==e.attr("str_id")&&(a.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason",e.attr("str_id")),o=!1)}),o&&a.modalCustomerDetails.attr("data.failure_reason.partial_payment.type","others")),e("#all-orders-order-details-modal").attr("index",i);var u=e("#all-orders-order-details-modal .summernote");u.html(a.modalCustomerDetails.attr("data.remark")),e(u).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){a.modalCustomerDetails.attr("data.remark",e("#all-orders-order-details-modal .summernote").code())}}),e("#all-orders-order-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),a.nanobar.go(100),e("#all-orders-order-details-modal table").focus(),a._update_total_cost(),a._update_total_quantity()})},_get_sub_total_cost:function(){var e=0;return this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0;e+=i+s+o}),e},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_total_cost:function(){var e=this._get_sub_total_cost(),t=null,n=this.modalCustomerDetails.attr("data.discount.amount")||0,r=this.modalCustomerDetails.attr("data.discount.max")||0,i=this.modalCustomerDetails.attr("data.service_type"),s=this.modalCustomerDetails.attr("data.service_tax").attr(),o=this.modalCustomerDetails.attr("data.discount.min_order")||0;this.allCosts.attr("sub_total_cost",e),this.modalCustomerDetails.attr("data.discount.percentage")?o?e>=o?t=e*n/100:t=0:t=e*n/100:o?e>=o?t=n:t=0:t=n,r&&(r=parseInt(r),t>r&&(t=r)),this.modalCustomerDetails.attr("data.discount.percentage")||this.modalCustomerDetails.attr("data.discount.amount",t);var u=e-t,a=Math.round(u*s.rate/100);this.modalCustomerDetails.attr("data.service_tax.type")=="inclusive"?this.allCosts.attr("service_tax",a):this.modalCustomerDetails.attr("data.service_tax.type")=="exclusive"&&(u+=a,this.allCosts.attr("service_tax",a));var f=this.modalCustomerDetails.attr("data.credits.available");f||(f=this.modalCustomerDetails.attr("data.user.credits"),this.modalCustomerDetails.attr("data.credits.available",f));var l=null;f>=u?l=u:l=f,u-=l,this.modalCustomerDetails.attr("data.credits.used",l),this.allCosts.attr("total_cost",Math.round(u))},changeMaxDiscount:function(t,n,r){var i=e("#all-orders-order-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#all-orders-order-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},changePaymentStatus:function(t,n,r){var i=e(n).val(),s=e("#all-orders-order-details-modal").attr("index");i?this.modalCustomerDetails.attr("data.is_paid",i):this.modalCustomerDetails.attr("data.is_paid",!1),i=="paid"?(this.modalCustomerDetails.attr("disable_amt",!1),this.modalCustomerDetails.attr("data.cash_collected",this.allCosts.total_cost),this.saveCashCollected()):i=="not_paid"?(this.modalCustomerDetails.attr("data.cash_collected",0),this.saveCashCollected(),this.modalCustomerDetails.attr("disable_amt",!0)):i=="partially_paid"?(this.modalCustomerDetails.attr("data.cash_collected",0),this.modalCustomerDetails.attr("disable_amt",!1)):i=="excess_paid"?this.modalCustomerDetails.attr("data.cash_collected",0):(this.modalCustomerDetails.attr("data.cash_collected",-1),this.modalCustomerDetails.attr("disable_amt",!0))},applyDiscount:function(t,n,r){var i=e(n).hasClass("modal-discount-percentage"),s=e("#all-orders-order-details-modal .modal-discount-amount").val()||0;i?this.modalCustomerDetails.attr("data.discount.percentage",!0):this.modalCustomerDetails.attr("data.discount.percentage",!1),this.modalCustomerDetails.attr("data.discount.amount",s),this._update_total_cost()},saveOrderChanges:function(t,n,r){var s=e("#all-orders-order-details-modal").attr("index");e(n).button("loading");var o=this.modalCustomerDetails.attr("data.discount").attr(),u=this.modalCustomerDetails.attr("data.bag").attr()||{};e.ajax({url:"/api/orderitem/"+s,type:"post",context:this,data:{remark:this.modalCustomerDetails.attr("data.remark")},success:function(t){i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeBagNumber:function(t,n,r){typeof this.modalCustomerDetails.attr("data").attr("bag")=="undefined"&&this.modalCustomerDetails.attr("data").attr("bag",{}),e(n).hasClass("bag-laundry")?this.modalCustomerDetails.attr("data.bag").attr("laundry",e(n).val()):e(n).hasClass("bag-dryclean")?this.modalCustomerDetails.attr("data.bag").attr("dryclean",e(n).val()):e(n).hasClass("bag-iron")&&this.modalCustomerDetails.attr("data.bag").attr("iron",e(n).val())},changeOrderStatus:function(t,n,r){var s=e(n).val(),o=e("#all-orders-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{status:s},success:function(e){var t=this.getStatusDetails(s);this.orderData.attr(o+".status",t.formal_name),this.orderData.attr(o+".status_color",t.color),i.success("Status change successful.")},error:function(e,t,n){i.error("Status change failed.")}})},closeModal:function(t,n,r){this.selectize.laundry.clear(!0),this.selectize.laundry.clearOptions(),this.selectize.dryclean.clear(!0),this.selectize.dryclean.clearOptions(),this.selectize.iron.clear(!0),this.selectize.iron.clearOptions(),e("#all-orders-order-details-modal .summernote").destroy()},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-all-orders"&&!this.scope.loaded&&(this.scope._pollData(this.scope.orderDate()),this.scope._pollDataDeferExec(),this.scope.loaded=!0)},"#all-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)},inserted:function(){var t=this,n={format:"yyyy-mm-dd",startdate:"2014-10-22",autoclose:!0,todayBtn:!0};e("all-orders-tabs .order-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,i=moment(new Date(Date.parse(e(this).datepicker("getDate")))),s=e("#all-orders-order-details-modal").attr("index"),o=i.format("YYYY/MM/DD");t.scope._pollData(i),t.scope._pollDataDeferExec(),t.scope.attr("variableDate",i.toDate())}),e("#all-orders-order-details-modal .modal-pickup-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,s=moment(new Date(Date.parse(e(this).datepicker("getDate")))),o=e("#all-orders-order-details-modal").attr("index"),u=s.format("YYYY/MM/DD");e.ajax({url:"/api/pickup",type:"put",dataType:"json",context:t,data:{order_id:o,date:u},success:function(e){i.success("Date changed."),t.scope.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",u)},error:function(e,t,n){i.error("Date change error.")}}),t.scope.modalCustomerDetails.attr("data.schedules.pickup.schedule_date",s.format("YYYY/MM/DD"))}),e("#all-orders-order-details-modal .modal-delivery-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,s=moment(new Date(Date.parse(e(this).datepicker("getDate")))),o=e("#all-orders-order-details-modal").attr("index"),u=s.format("YYYY/MM/DD");e.ajax({url:"/api/delivery",type:"put",dataType:"json",context:t,data:{order_id:o,date:u},success:function(e){i.success("Date changed."),t.scope.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",u)},error:function(e,t,n){i.error("Date change error.")}})});var r=e("#all-orders-modal-others .bag-laundry").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("laundry")||n.attr("bag").attr("laundry",[]),n.attr("bag").attr("laundry").indexOf(e)==-1&&n.attr("bag").attr("laundry").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("laundry"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"laundry",name:r,action:s}])},success:function(e){},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}}),s=e("#all-orders-modal-others .bag-dryclean").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("dryclean")||n.attr("bag").attr("dryclean",[]),n.attr("bag").attr("dryclean").indexOf(e)==-1&&n.attr("bag").attr("dryclean").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("dryclean"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"dryclean",name:r,action:s}])},success:function(e){},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}}),o=e("#all-orders-modal-others .bag-iron").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("iron")||n.attr("bag").attr("iron",[]),n.attr("bag").attr("iron").indexOf(e)==-1&&n.attr("bag").attr("iron").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("iron"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"iron",name:r,action:s}])},success:function(e){},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}});t.scope.selectize={laundry:r[0].selectize,dryclean:s[0].selectize,iron:o[0].selectize}}}})}),!function(e){function t(t){var n=e("");try{n=e(t).clone()}catch(r){n=e("<span />").html(t)}return n}function n(t){var n=e.Deferred();try{setTimeout(function(){t.focus();try{t.document.execCommand("print",!1,null)||t.print()}catch(e){t.print()}t.close(),n.resolve()},250)}catch(r){n.reject(r)}return n}function r(e){var t=window.open();return t.document.write(e),t.document.close(),n(t)}function i(e){return!!("object"==typeof Node?e instanceof Node:e&&"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName)}e.print=e.fn.print=function(){var s,u,a=this;a instanceof e&&(a=a.get(0)),i(a)?(u=e(a),arguments.length>0&&(s=arguments[0])):arguments.length>0?(u=e(arguments[0]),i(u[0])?arguments.length>1&&(s=arguments[1]):(s=arguments[0],u=e("html"))):u=e("html");var f={globalStyles:!0,mediaPrint:!1,stylesheet:null,noPrintSelector:".no-print",iframe:!0,append:null,prepend:null,manuallyCopyFormValues:!0,deferred:e.Deferred()};s=e.extend({},f,s||{});var l=e("");s.globalStyles?l=e("style, link, meta, title"):s.mediaPrint&&(l=e("link[media=print]")),s.stylesheet&&(l=e.merge(l,e('<link rel="stylesheet" href="'+s.stylesheet+'">')));var c=u.clone();c=e("<span/>").append(c),c.find(s.noPrintSelector).remove(),c.append(l.clone()),c.append(t(s.append)),c.prepend(t(s.prepend)),s.manuallyCopyFormValues&&c.find("input, select, textarea").each(function(){var t=e(this);t.is("[type='radio']")||t.is("[type='checkbox']")?t.prop("checked")&&t.attr("checked","checked"):t.is("select")?t.find(":selected").attr("selected","selected"):t.attr("value",t.val())});var h=c.html();try{s.deferred.notify("generated_markup",h,c)}catch(p){console.warn("Error notifying deferred",p)}if(c.remove(),s.iframe)try{var d=e(s.iframe+""),v=d.length;0===v&&(d=e('<iframe height="0" width="0" border="0" wmode="Opaque"/>').prependTo("body").css({position:"absolute",top:-999,left:-999}));var m,g;m=d.get(0),m=m.contentWindow||m.contentDocument||m,g=m.document||m.contentDocument||m,g.open(),g.write(h),g.close(),n(m).done(function(){setTimeout(function(){0===v&&d.remove()},100)}).fail(function(e){console.error("Failed to print from iframe",e),r(h)}).always(function(){try{s.deferred.resolve()}catch(e){console.warn("Error notifying deferred",e)}})}catch(y){console.error("Failed to print from iframe",y.stack,y.message),r(h).always(function(){try{s.deferred.resolve()}catch(e){console.warn("Error notifying deferred",e)}})}else r(h).always(function(){try{s.deferred.resolve()}catch(e){console.warn("Error notifying deferred",e)}});return this}}(jQuery),define("jqprint",["jquery"],function(){}),define("app/components/taggingOrders",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs","summernote","jqprint","selectize"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"tagging-tabs",template:"",scope:u.extend({init:function(){var e=this;this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.total_quantity=t.compute(0),this.row_count=t.compute(0),this.nanobar=new s({id:"mybar",bg:"#FF6600"}),this.statuses=JSON.parse(localStorage.getItem("statuses")),this.order_status.attr(this.statuses,!0);var n=JSON.parse(localStorage.getItem("timeslots"));this.timeslots.attr(n,!0)},tabchange:function(t,n,r){r.preventDefault();var i=e(n).find("input").attr("href").substr(1),s=e('input[href="#'+i+'"]').parents(".btn-group").find("input");s.each(function(){var t=e(this).attr("href").substr(1);t===i?(i=="tagging-pane-bundles"?(e("#tagging-btn-add-bundle").show(),e("#tagging-btn-print-tags").hide()):(e("#tagging-btn-add-bundle").hide(),e("#tagging-btn-print-tags").show()),e(this).parent().addClass("active"),e("#"+t).show()):(e("#"+t).hide(),e(this).parent().removeClass("active"))})},intervalFunc:function(){var e=moment(),t=moment(this.orderDate());e.format("YYYY-MM-DD")==t.format("YYYY-MM-DD")&&this._pollData("order",e)},orderData:new t.Map({}),loaded:!1,cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),tags:new t.List([]),selectize:{},variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),rowCount:function(){return this.row_count()},getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},getTotalQuantity:function(){return this.total_quantity()},orderRefresh:function(e,t,n){var r=moment(this.orderDate());this._pollData("order",r,!1,!0)},taggingPrevday:function(e,t,n){var r=moment(this.attr("variableDate"));r.subtract(1,"days"),this.attr("variableDate",r.toDate()),this._pollData("order",this.orderDate())},pickupTimeSlotChange:function(t,n,r){var s=e("#tagging-order-details-modal").attr("index"),o=e(n).val(),u=this.timeslots.attr(o);this.modalCustomerDetails.attr("data.schedules.pickup.schedule",u),e.ajax({url:"/api/pickup",type:"put",dataType:"json",data:{order_id:s,time:u},success:function(e){i.success("Timeslot changed.")},error:function(e,t,n){i.error("Timeslot change error.")}})},deliveryTimeSlotChange:function(t,n,r){var s=e("#tagging-order-details-modal").attr("index"),o=e(n).val(),u=this.timeslots.attr(o);this.modalCustomerDetails.attr("data.schedules.pickup.schedule",u),e.ajax({url:"/api/delivery",type:"put",dataType:"json",data:{order_id:s,time:u},success:function(e){i.success("Timeslot changed.")},error:function(e,t,n){i.error("Timeslot change error.")}})},taggingNextday:function(e,t,n){var r=moment(this.attr("variableDate"));r.add(1,"days"),this.attr("variableDate",r.toDate()),this._pollData("order",this.orderDate())},getOrderDataKey:function(e){var t;return this.orderData.each(function(n,r){n.attr(e)&&(t=r)}),t},_addData:function(n,r){this.row_count(n.length);var i=t.Map.keys(this.orderData),s=this,o={};e.each(n,function(e,t){var n=s.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.user_info.name=t.user_info.name.trim(),o[t.schedule_time]||(o[t.schedule_time]={}),o[t.schedule_time][t.order_id]=t}),this.orderData.attr(o,!0)},_updateData:function(t){this.row_count(t.length);var n=this,r={};e.each(t,function(e,t){r[t.order_id]=t.schedule_time;var i=n.orderData.attr(t.schedule_time);i||n.orderData.attr(t.schedule_time,{});if(!i.attr(t.order_id)){var s=n.getStatusDetails(t.status);t.status=s.formal_name,t.status_color=s.color,t.user_info.name=t.user_info.name.trim(),i.attr(t.order_id,t)}});var i={};this.orderData.each(function(e,t){e.each(function(e,n){if(!r[n]||r[n]!=e.attr("schedule_time"))i[t]=n})}),e.each(i,function(e,t){n.orderData.attr(e).removeAttr(t)})},_pollData:function(t,n,r,i){var s=this;n&&(n=this.getFormattedDate(moment(n))),r&&(r=this.getFormattedTime(moment(r))),i||(i=!1);var o="";r?o="/api/tagging/"+t+"/"+n+"/"+r:o="/api/tagging/"+t+"/"+n,this.nanobar.go(30);var u=e.ajax({url:o,type:"get",dataType:"json"}),a=e.ajax({url:"/api/bundles/"+n,type:"get",dataType:"json"});e.when(u,a).done(function(t,n){t=t[0].data,n=n[0].data,s.nanobar.go(50),i?e.each(n,function(e,t){if(!s.allBundles.attr(e))s.allBundles.attr(e,{name:t.name,date:t.date,contents:t.contents,vendor:t.vendor,total_quantity:t.total_quantity});else{s.allBundles.attr(e).attr("name")!=t["name"]&&s.allBundles.attr(e).attr("name",t.name),s.allBundles.attr(e).attr("total_quantity")!=t["total_quantity"]&&s.allBundles.attr(e).attr("total_quantity",t.total_quantity),s.allBundles.attr(e).attr("contents")!=t["contents"]&&s.allBundles.attr(e).attr("contents",t.contents),s.allBundles.attr(e).attr("date")!=t["date"]&&s.allBundles.attr(e).attr("date",t.date),s.allBundles.attr(e).attr("vendor")!=t["vendor"]&&s.allBundles.attr(e).attr("vendor",t.vendor);var n=!1;s.allBundles.attr(e).attr("bags").each(function(e,r){t["bags"].indexOf(e)==-1&&(n=!0)}),n&&s.allBundles.attr(e).attr("bags",t.bags)}}):s.allBundles.attr(n,!0),t&&(i?s._updateData(t):s._addData(t)),s.nanobar.go(100)})},selectWashType:function(e,t,n){var r=t.parents("tr").find('input[type="number"]');r=parseInt(r.val());var i=t.parents("tr").attr("item-index"),s=this.cleaningItems.attr(i);t.hasClass("choice-laundry")?s.attr("cleaning_type","laundry"):t.hasClass("choice-dryclean")&&s.attr("cleaning_type","dry_cleaning"),this._update_total_cost()},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u),f=this.modalCustomerDetails.attr("data.service_type");a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):(a.attr("quantity.iron")||a.attr("quantity.iron",0),a.attr("quantity.iron",i));var l=a.attr("quantity.laundry")*a.attr("price.laundry")||0,c=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,h=a.attr("quantity.iron")*a.attr("price.iron")||0;f=="express"?a.attr("final_cost",(l+c+h)*2):a.attr("final_cost",l+c+h)}this._update_total_cost(),this._update_total_quantity()},openOrderModal:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=null;this.nanobar.go(30);var o=e.ajax({url:"/api/orderitem/"+i,type:"get",context:this,dataType:"json"});o.done(function(t){var n=this;this.nanobar.go(50),this.cleaningItems.replace(t.data),t.customer_details.status=this.getStatusDetails(t.customer_details.status).attr("name_id"),this.modalCustomerDetails.attr("data",t.customer_details),this.modalCustomerDetails.attr("data.bag.laundry")&&this.modalCustomerDetails.attr("data.bag.laundry").each(function(e,t){n.selectize.laundry.addOption({value:e,text:e}),n.selectize.laundry.addItem(e,!0)}),this.modalCustomerDetails.attr("data.bag.dryclean")&&this.modalCustomerDetails.attr("data.bag.dryclean").each(function(e,t){n.selectize.dryclean.addOption({value:e,text:e}),n.selectize.dryclean.addItem(e,!0)}),this.modalCustomerDetails.attr("data.bag.iron")&&this.modalCustomerDetails.attr("data.bag.iron").each(function(e,t){n.selectize.iron.addOption({value:e,text:e}),n.selectize.iron.addItem(e,!0)}),e("#tagging-order-details-modal").attr("index",i);var r=e("#tagging-order-details-modal .summernote");r.html(this.modalCustomerDetails.attr("data.remark")),e(r).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){n.modalCustomerDetails.attr("data.remark",e("#tagging-order-details-modal .summernote").code())}}),e("#tagging-order-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),this.nanobar.go(100),e("#tagging-order-details-modal table").focus(),this._update_total_cost(),this._update_total_quantity()})},_get_sub_total_cost:function(){var e=0,t=this.modalCustomerDetails.attr("data.service_type");return this.cleaningItems.each(function(t,n){var r=t,i,s,o;i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0,e+=i+s+o}),e},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_total_cost:function(){var e=this._get_sub_total_cost(),t=null,n=this.modalCustomerDetails.attr("data.discount.amount")||0,r=this.modalCustomerDetails.attr("data.discount.max")||0;this.allCosts.attr("sub_total_cost",e),this.modalCustomerDetails.attr("data.discount.percentage")?(t=e*n/100,r&&(r=parseInt(r),t>r&&(t=r))):t=n;var i=e-t;this.allCosts.attr("total_cost",Math.round(i))},changeMaxDiscount:function(t,n,r){var i=e("#tagging-order-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#tagging-order-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},changePaymentStatus:function(t,n,r){var s=e(n).val(),o=e("#tagging-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{is_paid:s},success:function(t){i.success("Payment status change successful."),e(n).val()=="paid"?this.modalCustomerDetails.attr("data.is_paid",!0):this.modalCustomerDetails.attr("data.is_paid",!1)},error:function(e,t,n){i.error("Payment status change failed.")}})},applyDiscount:function(t,n,r){var i=e(n).hasClass("modal-discount-percentage"),s=e("#tagging-order-details-modal .modal-discount-amount").val()||0;i?this.modalCustomerDetails.attr("data.discount.percentage",!0):this.modalCustomerDetails.attr("data.discount.percentage",!1),this.modalCustomerDetails.attr("data.discount.amount",s),this._update_total_cost()},saveOrderChanges:function(t,n,r){var s=e("#tagging-order-details-modal").attr("index");e(n).button("loading");var o=this.modalCustomerDetails.attr("data.discount").attr(),u=this.modalCustomerDetails.attr("data.bag").attr()||{};e.ajax({url:"/api/orderitem/"+s,type:"post",context:this,data:{data:JSON.stringify(this.cleaningItems.attr()),remark:this.modalCustomerDetails.attr("data.remark"),discount:JSON.stringify(o),bag:JSON.stringify(u),is_paid:this.modalCustomerDetails.attr("data.is_paid")||!1,credits_left:this.modalCustomerDetails.attr("data.credits.available")},success:function(t){i.success("Saved successfully.");var r=this.getOrderDataKey(s),o=this.orderData.attr(r).attr(s);o.attr("total_quantity",this.total_quantity()),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeOrderStatus:function(t,n,r){var s=e(n).val(),o=e("#tagging-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{status:s},success:function(e){this.modalCustomerDetails.attr("data.status",s),i.success("Status change successful.");var t=this.getOrderDataKey(o),n=this.orderData.attr(t).removeAttr(o)},error:function(e,t,n){i.error("Status change failed.")}})},closeModal:function(t,n,r){this.selectize.laundry.clear(!0),this.selectize.laundry.clearOptions(),this.selectize.dryclean.clear(!0),this.selectize.dryclean.clearOptions(),this.selectize.iron.clear(!0),this.selectize.iron.clearOptions(),e("#tagging-order-details-modal .summernote").destroy()},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}},openTagsModal:function(t,n,r){var s=e(".tagging-checkbox.btn-success").parents("tr"),o=[];e.each(s,function(t,n){o.push(e(n).attr("index"))});if(!o.length)return i.warning("Select an order first."),!1;this.nanobar.go(30),e.ajax({url:"/api/tags/"+JSON.stringify(o),type:"get",context:this,dataType:"json",success:function(t){this.nanobar.go(50),e.each(t.data,function(e,t){t.laundryTags=[],t.drycleanTags=[],t.ironTags=[],t.totalQuantity=t.dryclean.quantity+t.laundry.quantity+t.iron.quantity;for(var n=0;n<t.laundry.quantity;n++){var r={};r.name=t.name,r.phone=t.phone,r.bag=t.laundry.bag,r.quantity=t.laundry.quantity,r.pickup_date=moment(t.pickup_date).format("DD-MM-YYYY"),r.delivery_date=moment(t.delivery_date).format("DD-MM-YYYY"),r.pickup_time=t.pickup_time,r.delivery_time=t.delivery_time,t.laundryTags.push(r)}for(var n=0;n<t.dryclean.quantity;n++){var r={};r.name=t.name,r.phone=t.phone,r.bag=t.dryclean.bag,r.quantity=t.dryclean.quantity,r.pickup_date=moment(t.pickup_date).format("DD-MM-YYYY"),r.delivery_date=moment(t.delivery_date).format("DD-MM-YYYY"),r.pickup_time=t.pickup_time,r.delivery_time=t.delivery_time,t.drycleanTags.push(r)}for(var n=0;n<t.iron.quantity;n++){var r={};r.name=t.name,r.phone=t.phone,r.bag=t.iron.bag,r.quantity=t.iron.quantity,r.pickup_date=moment(t.pickup_date).format("DD-MM-YYYY"),r.delivery_date=moment(t.delivery_date).format("DD-MM-YYYY"),r.pickup_time=t.pickup_time,r.delivery_time=t.delivery_time,t.ironTags.push(r)}}),this.tags.replace(t.data),e("tagging-tabs .tags-print").modal("show"),this.nanobar.go(100)},error:function(e,t,n){}})},printTags:function(t,n,r){e(n).parents(".modal-content").find(".modal-body").print()},allBundles:new t.Map({}),selectedBundle:new t.Map({}),openAddBundleModal:function(n,r,i){this.selectedBundle.attr("name",t.Map.keys(this.allBundles).length+1),this.selectedBundle.attr("date",moment(this.orderDate()).format("YYYY-MM-DD")),e("#tagging-bundles-modal").modal({backdrop:"static",keyboard:!1,show:!0})},bundleEditChange:function(t,n,r){n.attr("name")=="name"&&this.selectedBundle.attr("name",e(n).val().trim()),n.attr("name")=="date"&&this.selectedBundle.attr("name",e(n).val().trim())},editBundleModal:function(t,n,r){var s=e(n).parents("tr").attr("index");e.ajax({url:"/api/bundle/"+s,type:"get",context:this,dataType:"json",success:function(t){var n=this,r=[];this.selectedBundle.attr(t,!0),e.each(t.bags,function(e,t){r.push(t.bag),n.selectize.bundle.addOption(t),n.selectize.bundle.addItem(t.bag)}),this.selectize.vendor.addOption({id:t.vendor.id,name:t.vendor.name}),this.selectize.vendor.addItem(t.vendor.id),this.selectedBundle.attr("bags",r),this.selectedBundle.attr("str_id",s),e("#tagging-bundles-modal").modal({backdrop:"static",keyboard:!1,show:!0})},error:function(){i.danger("Try again later.")}})},closeBundleModal:function(e,t,n){this.selectize.bundle.clearOptions(),this.selectize.bundle.clear(),this.selectize.vendor.clear(),this.selectedBundle.attr({},!0)},saveBundle:function(t,n,r){var s="post",o="/api/bundle",u=this.selectedBundle.attr("name");typeof u=="number"&&(u=u.toString());if(!u)return i.error("Please give a name to the bundle."),!1;var a=[];this.selectedBundle.attr("bags")&&(a=this.selectedBundle.attr("bags").attr());var f=this.selectedBundle.attr("str_id")||null;f&&(s="put",o="/api/bundle/"+this.selectedBundle.attr("str_id")),e.ajax({url:o,type:s,context:this,dataType:"json",data:{name:u,date:this.selectedBundle.attr("date"),vendor:this.selectedBundle.attr("vendor")||null,bags:JSON.stringify(a)},success:function(t){this.selectedBundle.attr({},!0),f&&this.allBundles.attr(f).attr("bags",a),e("#tagging-bundles-modal").modal("hide"),this.closeBundleModal(),e("#tagging-orders .fa-refresh").parent().trigger("click")}})}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()},timeslotBackColor:function(e,t,n){var r=moment(),t=moment(t());return r.format("YYYY-MM-DD")!=t.format("YYYY-MM-DD")?"#FFF5A3":e<r.hours()?"#ff6c60":e-r.hours()<2?"#FF8134":"#FFF5A3"}}),events:{"{can.route} sidebarmenu":function(e){var t=moment();if(e.sidebarmenu=="main-content-tagging"&&!this.scope.loaded){var t=moment();this.scope._pollData("order",t),setInterval(this.scope.intervalFunc.bind(this.scope),3e5),this.scope.loaded=!0}},"#tagging-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)},inserted:function(){var t=this,n={format:"yyyy-mm-dd",startdate:"2014-10-22",autoclose:!0,todayBtn:!0};e("tagging-tabs .order-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,i=moment(new Date(Date.parse(e(this).datepicker("getDate")))),s=e("#tagging-order-details-modal").attr("index"),o=i.format("YYYY/MM/DD");t.scope._pollData("order",i),t.scope.attr("variableDate",i.toDate())}),e("#tagging-order-details-modal .modal-pickup-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,s=moment(new Date(Date.parse(e(this).datepicker("getDate")))),o=e("#tagging-order-details-modal").attr("index"),u=s.format("YYYY/MM/DD");e.ajax({url:"/api/pickup",type:"put",dataType:"json",context:t,data:{order_id:o,date:u},success:function(e){i.success("Date changed."),t.scope.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",u)},error:function(e,t,n){i.error("Date change error.")}}),t.scope.modalCustomerDetails.attr("data.schedules.pickup.schedule_date",s.format("YYYY/MM/DD"))}),e("#tagging-order-details-modal .modal-delivery-datepicker").datepicker(n).on("changeDate",function(t){var n=t.currentTarget,r=moment(new Date(Date.parse(e(this).datepicker("getDate")))),s=e("#tagging-order-details-modal").attr("index"),o=r.format("YYYY/MM/DD");e.ajax({url:"/api/delivery",type:"put",dataType:"json",context:self,data:{order_id:s,date:o},success:function(e){i.success("Date changed."),self.scope.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",o)},error:function(e,t,n){i.error("Date change error.")}})}),e("#tagging-bundles-modal .add-bundle-datepicker").datepicker(n).on("changeDate",function(n){var r=n.currentTarget,i=moment(new Date(Date.parse(e(this).datepicker("getDate"))));t.scope.selectedBundle.attr("order_date",i)});var r=e("#tagging-bundles-modal .add-bags-input").selectize({plugins:["remove_button"],valueField:"bag",labelField:"name",searchField:"bag",create:!1,render:{item:function(e,t){return'<div style="color:#fff"><span>'+t(e.name)+"</span>&nbsp;"+'(<span class="bold">'+t(e.bag)+"</span>)"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name)+"</span>&nbsp;"+'(<span class="bold">'+t(e.bag)+"</span>)"+"</div>"}},load:function(n,r){if(!n.length)return r();n=n.toUpperCase(),e.ajax({url:"/api/tagbags/"+moment(t.scope.orderDate()).format("YYYY-MM-DD")+"/"+n,type:"get",dataType:"json",success:function(e){r(e.data)},error:function(e,t,n){r()}})},onItemAdd:function(e,n){t.scope.selectedBundle.attr("bags")||t.scope.selectedBundle.attr("bags",[]),t.scope.selectedBundle.attr("bags").indexOf(e)==-1&&t.scope.selectedBundle.attr("bags").push(e)},onItemRemove:function(e){var n=t.scope.selectedBundle.attr("bags").indexOf(e);t.scope.selectedBundle.attr("bags").removeAttr(n)}}),s=e("#tagging-modal-edit .bag-laundry").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("laundry")||n.attr("bag").attr("laundry",[]),n.attr("bag").attr("laundry").indexOf(e)==-1&&n.attr("bag").attr("laundry").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("laundry"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"laundry",name:r,action:s}])},success:function(e){var n=t.scope.modalCustomerDetails.attr("data._id"),i=t.scope.getOrderDataKey(n),o=t.scope.orderData.attr(i).attr(n);s=="add"?(o.attr("bag.laundry")||o.attr("bag.laundry",[]),o.attr("bag.laundry").push(r[0])):o.attr("bag.laundry").removeAttr(o.attr("bag.laundry").indexOf(r[0]))},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}}),o=e("#tagging-modal-edit .bag-dryclean").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("dryclean")||n.attr("bag").attr("dryclean",[]),n.attr("bag").attr("dryclean").indexOf(e)==-1&&n.attr("bag").attr("dryclean").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("dryclean"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"dryclean",name:r,action:s}])},success:function(e){var n=t.scope.modalCustomerDetails.attr("data._id"),i=t.scope.getOrderDataKey(n),o=t.scope.orderData.attr(i).attr(n);s=="add"?(o.attr("bag.dryclean")||o.attr("bag.dryclean",[]),o.attr("bag.dryclean").push(r[0])):o.attr("bag.dryclean").removeAttr(o.attr("bag.dryclean").indexOf(r[0]))},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}}),u=e("#tagging-modal-edit .bag-iron").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e.toUpperCase(),text:e.toUpperCase()}},onItemAdd:function(e,n,r){r||(this.addedItem=e,this.addEvent=!0);var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("bag")=="undefined"&&n.attr("bag",{}),n.attr("bag").attr("iron")||n.attr("bag").attr("iron",[]),n.attr("bag").attr("iron").indexOf(e)==-1&&n.attr("bag").attr("iron").push(e)},onItemRemove:function(e,n,r){r||(this.removeEvent=!0,this.removedItem=e);var n=t.scope.modalCustomerDetails.attr("data.bag").attr("iron"),i=n.indexOf(e);n.removeAttr(i)},onChange:function(n){var r=[],s="add";this.addEvent?r.push(this.addedItem):this.removeEvent&&(s="remove",r.push(this.removedItem)),e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{bags:JSON.stringify([{type:"iron",name:r,action:s}])},success:function(e){var n=t.scope.modalCustomerDetails.attr("data._id"),i=t.scope.getOrderDataKey(n),o=t.scope.orderData.attr(i).attr(n);s=="add"?(o.attr("bag.iron")||o.attr("bag.iron",[]),o.attr("bag.iron").push(r[0])):o.attr("bag.iron").removeAttr(o.attr("bag.iron").indexOf(r[0]))},error:function(e){i.error(e.responseJSON.error)}}),this.addEvent=!1,this.removeEvent=!1}}),a=e("#tagging-bundles-modal .add-vendor-input").selectize({plugins:["remove_button"],valueField:"id",labelField:"name",searchField:"name",create:!1,preload:!0,render:{item:function(e,t){return"<div><span>"+t(e.name)+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name)+"</span>&nbsp;"+"</div>"}},load:function(t,n){e.ajax({url:"/api/vendor/search",type:"get",dataType:"json",success:function(e){n(e)},error:function(e,t,r){n()}})},onItemAdd:function(e,n){t.scope.selectedBundle.attr("vendor",e)},onItemRemove:function(e){t.scope.selectedBundle.removeAttr("vendor",e)}});t.scope.selectize={laundry:s[0].selectize,dryclean:o[0].selectize,iron:u[0].selectize,vendor:a[0].selectize,bundle:r[0].selectize}}}})}),define("app/components/packageOrders",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs","summernote"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"package-tabs",template:"",scope:u.extend({init:function(){var n=this,r=moment();this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.datepickers_initialised=!1,this.poll_skip=0,this.poll_limit=20,this.last_action=null,this.total_quantity=t.compute(0),this.row_count=t.compute(0),this.invoice_now=t.compute(moment()),this.currentInvoiceIndex=t.compute(0),this.search_skip=0,this.search_limit=20,this.nanobar=new s({id:"mybar",bg:"#FF6600"});var i=JSON.parse(localStorage.getItem("statuses"));e.each(i,function(e,t){n.order_status.attr(e,t)});var o=JSON.parse(localStorage.getItem("timeslots"));e.each(o,function(e,t){n.timeslots.attr(e,t)})},orderData:new t.Map({}),selectize:{},loaded:!1,cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),invoiceStore:new t.List([]),variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),rowCount:function(){return this.row_count()},getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},getCurrentDate:function(){return this.getFormattedDate(this.invoice_now())},getCurrentInvoiceIndex:function(){return this.currentInvoiceIndex()},selectSearchOption:function(t,n,r){var i=e(n).parents(".input-group").find(".search-input"),s=e(n).attr("data-option");s=="name"?i.val("name:"):s=="email"?i.val("email:"):s=="phone"?i.val("phone:"):s=="oid"&&i.val("oid:"),i.focus()},_editOrderData:function(e,t){var n=this.orderData.attr(e.value);n&&n.attr(e["key"])==e["value"]&&n.attr(t.key,t.value)},captureEnterKey:function(t,n,r){r.keyCode==13&&e("package-tabs .btn-search-go").trigger("click")},searchOrders:function(e,t,n){this._searchOrders(0,this.search_limit),this._searchOrdersDeferred()},_searchOrders:function(t,n){var r=e.trim(e("package-tabs .search-input").val());if(r==""){e("package-tabs .btn-refresh").trigger("click");return}t=typeof t=="undefined"?this.search_skip:t,n=typeof n=="undefined"?this.search_limit:n,this.nanobar.go(30),this.package_search_defer=e.ajax({url:"/api/order/search/package/"+r+"/"+t+"/"+n,type:"get",dataType:"json",context:this})},_searchOrdersDeferred:function(n){typeof n=="undefined"&&(n=!0),t.when(this.package_search_defer).then(function(t){var r=this;this.nanobar.go(50),n&&this.orderData.attr({},!0);var i={};e.each(t.data,function(e,t){var n=r.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.delivery_date=t.delivery_data.schedule_date,t.user_info.name=t.user_info.name.trim(),delete t.delivery_data,delete t.pickup_data,i[t.order_id]=t}),this.orderData.attr(i,!0),this.search_skip+=t.data.length,this.nanobar.go(100),this.last_action="search"}),this.package_search_defer.fail(function(e,t,n){this.nanobar.go(100),i.error("Proper search criteria not used.")})},orderRefresh:function(e,t,n){this._pollData(0,this.poll_skip),this._pollDataDeferExec(!0)},getTotalQuantity:function(){return this.total_quantity()},loadMoreRows:function(t,n,r){e(n).button("load"),e(n).find(".fa-repeat").addClass("fa-spin"),this.last_action=="search"?(this._searchOrders(),this._searchOrdersDeferred(!1)):(this._pollData(),this._pollDataDefer.done(function(t){this.nanobar.go(50);var r=this,i={};e.each(t.data,function(e,t){var n=r.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.delivery_date=t.delivery_data.schedule_date,t.user_info.name=t.user_info.name.trim(),delete t.delivery_data,delete t.pickup_data,i[t.order_id]=t}),this.orderData.attr(i),this.poll_skip+=t.data.length,e(n).button("reset"),e(n).find(".fa-repeat").removeClass("fa-spin"),this.nanobar.go(100)}))},_pollData:function(t,n){t=typeof t=="undefined"?this.poll_skip:t,n=typeof n=="undefined"?this.poll_limit:n,this.nanobar.go(30),this._pollDataDefer=e.ajax({url:"/api/package/"+t+"/"+n,type:"get",context:this,dataType:"json"})},_updateData:function(t){this.row_count(t.length);var n=this,r=[],i={},s=[];e.each(t,function(e,t){i[t.order_id]=t}),e.each(i,function(t,r){var i=n.orderData.attr(t),s=n.getStatusDetails(r.status);r.status=s.formal_name,r.status_color=s.color,r.user_info.name=r.user_info.name.trim(),r.delivery_date=r.delivery_data.schedule_date,r.user_info.name=r.user_info.name.trim(),delete r.delivery_data,delete r.pickup_data;if(i){i.attr("status")!=r.status&&i.attr("status",r.status),i.attr("total_price")!=r.total_price&&i.attr("total_price",r.total_price),i.attr("invoice_printed")!=r.invoice_printed&&i.attr("invoice_printed",r.invoice_printed);if(i.attr("racks").attr().length!=r.racks.length)i.attr("racks",r.racks);else{var o=!1;e.each(r.racks,function(e,t){i.attr("racks.laundry")&&i.attr("racks.laundry").indexOf(t)==-1&&(o=!0),i.attr("racks.dryclean")&&i.attr("racks.dryclean").indexOf(t)==-1&&(o=!0),i.attr("racks.iron")&&i.attr("racks.iron").indexOf(t)==-1&&(o=!0)}),o&&i.attr("racks",r.racks)}}else n.orderData.attr(r.order_id,r)}),this.orderData.each(function(e,t){i[t]||s.push(t)}),e.each(s,function(e,t){n.orderData.removeAttr(t)})},_pollDataDeferExec:function(t){typeof t=="undefined"&&(t=!1);var n=this;this._pollDataDefer.done(function(r){this.nanobar.go(50);if(!r.data)return this.nanobar.go(100),!1;var i={};t?(this._updateData(r.data),this.poll_skip=r.data.length):(this.row_count(r.item_count),e.each(r.data,function(e,t){var r=n.getStatusDetails(t.status);t.status=r.formal_name,t.status_color=r.color,t.delivery_date=t.delivery_data.schedule_date,t.user_info.name=t.user_info.name.trim(),delete t.delivery_data,delete t.pickup_data,i[t.order_id]=t}),this.orderData.attr(i,!0),this.poll_skip=this.poll_skip+r.data.length),this.nanobar.go(100),this.last_action="query"})},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u),f=this.modalCustomerDetails.attr("data.service_type");a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):a.attr("quantity.iron")||(a.attr("quantity.iron",0),a.attr("quantity.iron",i));var l=a.attr("quantity.laundry")*a.attr("price.laundry")||0,c=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,h=a.attr("quantity.iron")*a.attr("price.iron")||0;a.attr("final_cost",l+c+h)}this._update_total_cost(),this._update_total_quantity()},openOrderModal:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=null;this.nanobar.go(30);var o=e.ajax({url:"/api/orderitem/"+i,type:"get",context:this,dataType:"json"});o.done(function(t){var n=this;this.nanobar.go(50),t.customer_details.status=this.getStatusDetails(t.customer_details.status).attr("name_id"),this.modalCustomerDetails.attr("data",t.customer_details);var r=!1;this.modalCustomerDetails.attr("data.coupon.name")?r=!0:r=moment(this.modalCustomerDetails.attr("data.created_date")).format("YYYY-MM-DD")>="2015-11-30",this.modalCustomerDetails.attr("data").attr("disable_discount_edit",r);var s=this.modalCustomerDetails.attr("data.service_type");this.cleaningItems.replace(t.data),this.modalCustomerDetails.attr("data.racks.laundry")&&this.modalCustomerDetails.attr("data.racks.laundry").each(function(e,t){n.selectize.rack_laundry.addOption({value:e,text:e}),n.selectize.rack_laundry.addItem(e,!0)}),this.modalCustomerDetails.attr("data.racks.dryclean")&&this.modalCustomerDetails.attr("data.racks.dryclean").each(function(e,t){n.selectize.rack_dryclean.addOption({value:e,text:e}),n.selectize.rack_dryclean.addItem(e,!0)}),this.modalCustomerDetails.attr("data.racks.iron")&&this.modalCustomerDetails.attr("data.racks.iron").each(function(e,t){n.selectize.rack_iron.addOption({value:e,text:e}),n.selectize.rack_iron.addItem(e,!0)}),e("#package-order-details-modal").attr("index",i);var o=e("#package-order-details-modal .summernote");o.html(this.modalCustomerDetails.attr("data.remark")),e(o).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){n.modalCustomerDetails.attr("data.remark",e("#package-order-details-modal .summernote").code())}}),e("#package-order-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),this.nanobar.go(100),e("#package-order-details-modal table").focus(),this._update_total_cost(),this._update_total_quantity()})},_get_sub_total_cost:function(e){typeof e=="undefined"&&(e=!1);var t=0,n=this.modalCustomerDetails.attr("data.service_type");return this.cleaningItems.each(function(e,n){var r=e,i,s,o;i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0,t+=i+s+o}),n=="express"&&!e?t*2:t},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_total_cost:function(e){var t=this._get_sub_total_cost(e),n=null,r=this.modalCustomerDetails.attr("data.discount.amount")||0,i=this.modalCustomerDetails.attr("data.discount.max")||0,s=this.modalCustomerDetails.attr("data.service_type"),o=this.modalCustomerDetails.attr("data.service_tax").attr(),u=this.modalCustomerDetails.attr("data.discount.min_order")||0;this.allCosts.attr("sub_total_cost",t),this.modalCustomerDetails.attr("data.discount.percentage")?u?t>=u?n=t*r/100:n=0:n=t*r/100:u?t>=u?n=r:n=0:n=r,i&&(i=parseInt(i),n>i&&(n=i)),this.modalCustomerDetails.attr("data.discount.percentage")||this.modalCustomerDetails.attr("data.discount.amount",n);var a=t-n,f=Math.round(a*o.rate/100);this.modalCustomerDetails.attr("data.service_tax.type")=="inclusive"?this.allCosts.attr("service_tax",f):this.modalCustomerDetails.attr("data.service_tax.type")=="exclusive"&&(a+=f,this.allCosts.attr("service_tax",f));var l=this.modalCustomerDetails.attr("data.credits.available");l||(l=this.modalCustomerDetails.attr("data.user.credits"),this.modalCustomerDetails.attr("data.credits.available",l));var c=null;l>=a?c=a:c=l,a-=c,this.modalCustomerDetails.attr("data.credits.used",c),this.allCosts.attr("total_cost",Math.round(a))},changeMaxDiscount:function(t,n,r){var i=e("#package-order-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#package-order-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},applyDiscount:function(t,n,r){var i=this._get_sub_total_cost(),s=e(n).hasClass("modal-discount-percentage"),o=e("#package-order-details-modal .modal-discount-amount").val()||0;s?(this.modalCustomerDetails.attr("data.discount.percentage",!0),o>100&&(o=0)):(this.modalCustomerDetails.attr("data.discount.percentage",!1),o>i&&(o=0)),this.modalCustomerDetails.attr("data.discount.amount",o),this._update_total_cost()},saveOrderChanges:function(t,n,r){self=this;var s=e("#package-order-details-modal").attr("index");e(n).button("loading");var o=self.modalCustomerDetails.attr("data.discount").attr();e.ajax({url:"/api/orderitem/"+s,type:"post",data:{data:JSON.stringify(self.cleaningItems.attr()),remark:self.modalCustomerDetails.attr("data.remark"),discount:JSON.stringify(o)},success:function(t){i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeBagNumber:function(t,n,r){typeof this.modalCustomerDetails.attr("data").attr("bag")=="undefined"&&this.modalCustomerDetails.attr("data").attr("bag",{}),e(n).hasClass("bag-laundry")?this.modalCustomerDetails.attr("data.bag").attr("laundry",e(n).val()):e(n).hasClass("bag-dryclean")?this.modalCustomerDetails.attr("data.bag").attr("dryclean",e(n).val()):e(n).hasClass("bag-iron")&&this.modalCustomerDetails.attr("data.bag").attr("iron",e(n).val())},changeOrderStatus:function(t,n,r){var s=e(n).val(),o=e("#package-order-details-modal").attr("index");e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:{status:s},success:function(e){this.modalCustomerDetails.attr("data.status",s),i.success("Status change successful.")},error:function(e,t,n){i.error("Status change failed.")}})},closeModal:function(t,n,r){e("#package-order-details-modal .summernote").destroy(),this.last_action=="query"?e("package-tabs .btn-refresh").trigger("click"):e("package-tabs .btn-search-go").trigger("click"),this.selectize.rack_laundry.clear(!0),this.selectize.rack_laundry.clearOptions(),this.selectize.rack_dryclean.clear(!0),this.selectize.rack_dryclean.clearOptions(),this.selectize.rack_iron.clear(!0),this.selectize.rack_iron.clearOptions()},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}},__invoiceDirectionShowHide:function(){this.invoiceStore[this.currentInvoiceIndex()-1]?e("#package-invoice-modal .direction-left").prop({disabled:!1}):e("#package-invoice-modal .direction-left").prop({disabled:!0}),this.invoiceStore[this.currentInvoiceIndex()+1]?e("#package-invoice-modal .direction-right").prop({disabled:!1}):e("#package-invoice-modal .direction-right").prop({disabled:!0})},showInvoice:function(t,n,r){var s={format:"yyyy-mm-dd",startdate:"2014-10-22",autoclose:!0,todayBtn:!0};this.invoice_now(moment());var o=e("#package-invoice-modal .invoice-date");o.hasClass("datepicker-initialized")||(e(o).addClass("datepicker-initialized"),e(o).datepicker(s).on("changeDate",function(t){var n=moment(new Date(Date.parse(e(o).datepicker("getDate"))));package_self.now(n)}));var u=e("#package-invoice-modal .invoice-due-date");u.hasClass("datepicker-initialized")||(e(u).addClass("datepicker-initialized"),e(u).datepicker(s).on("changeDate",function(t){var n=moment(new Date(Date.parse(e(u).datepicker("getDate"))));package_self.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",n.format("YYYY/MM/DD"))}));var a=[],f=e(".package-checkbox.btn-success").parents("tr");e.each(f,function(t,n){a.push(e(n).attr("index"))}),this.invoiceStore.replace(a),f.length?(this._update_print_data(this.invoiceStore[0]),this.currentInvoiceIndex(0),e("#package-invoice-modal").modal({backdrop:"static",keyboard:!1,show:!0}),this.__invoiceDirectionShowHide()):i.warning("Select an order first.")},nextInvoice:function(e,t,n){var r=this.currentInvoiceIndex();this.currentInvoiceIndex(++r),this._update_print_data(this.invoiceStore[this.currentInvoiceIndex()]),this.__invoiceDirectionShowHide()},prevInvoice:function(e,t,n){var r=this.currentInvoiceIndex();this.currentInvoiceIndex(--r),this._update_print_data(this.invoiceStore[this.currentInvoiceIndex()]),this.__invoiceDirectionShowHide()},sendInvoice:function(t,n,r){var s=this.invoiceStore[this.currentInvoiceIndex()];e.ajax({url:"/api/invoice/send",type:"post",context:this,data:{order_id:s},success:function(e){i.success("Sent successfully.")},error:function(e,t,n){i.error(e.responseJSON.error)}})},saveInvoice:function(t,n,r){var s=this.invoiceStore[this.currentInvoiceIndex()];e(n).button("load"),e.ajax({url:"/api/saveinvoice/"+s,type:"post",success:function(t){i.success("Invoice saved."),e(n).button("reset")},error:function(t,r,s){i.error("Invoice not saved."),e(n).button("reset")}})},printInvoice:function(t,n,r){window.print(),e.ajax({url:"/api/order/"+this.invoiceStore[this.currentInvoiceIndex()],type:"put",dataType:"json",context:this,data:{invoice_printed:!0},success:function(e){this._editOrderData({key:"order_id",value:this.invoiceStore[this.currentInvoiceIndex()]},{key:"invoice_printed",value:!0}),this.saveInvoice()}})},addInvoiceRow:function(n,r,i){var s=e("#package-invoice-modal tbody tr:first").clone()[0];e(s).removeAttr("style").addClass("addedRow");var o=e("<div>").append(s),u=t.mustache(o.html()),a=u({removeInvoiceRow:this.removeInvoiceRow});e("#package-invoice-modal tbody").append(a)},removeInvoiceRow:function(t,n,r){e(n).parents("tr").remove()},_update_print_data:function(t){var n=e.ajax({url:"/api/orderitem/"+t,type:"get",context:this,dataType:"json"});n.done(function(t){this.modalCustomerDetails.attr("data",t.customer_details);var n=this.modalCustomerDetails.attr("data.service_type");n=="express"&&e.each(t.data,function(e,t){isNaN(t.price.laundry)||(t.price.laundry*=2),isNaN(t.price.dryclean)||(t.price.dryclean*=2),isNaN(t.price.iron)||(t.price.iron*=2)}),this.cleaningItems.replace(t.data),this._update_total_cost()})},closeInvoice:function(t,n,r){e("#package-invoice-modal .items-list .addedRow").remove()}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-package"&&!this.scope.loaded&&(this.scope._pollData(),this.scope._pollDataDeferExec(),this.scope.loaded=!0)},"#package-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)},inserted:function(){var t=this,n=e("#package-modal-others .rack-laundry").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e,text:e}},onItemAdd:function(e,n){if(isNaN(parseInt(e))){var r=this.$input[0].selectize;r.removeItem(e,!0)}var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("racks")=="undefined"&&n.attr("racks",{}),typeof n.attr("racks.laundry")=="undefined"&&n.attr("racks.laundry",[]),n.attr("racks.laundry").indexOf(e)==-1&&n.attr("racks.laundry").push(e)},onItemRemove:function(e){var n=t.scope.modalCustomerDetails.attr("data.racks.laundry"),r=n.indexOf(e);n.removeAttr(r)},onChange:function(n){n=n.trim();var r=[];n.length&&(r=n.split("|"));var s=!1;e.each(r,function(e,t){var n=t.trim();n.length&&isNaN(parseInt(t))&&(s=!0)});if(s)return i.error("Rack must be a number."),!1;e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{racks:JSON.stringify({type:"laundry",racks:r})},success:function(e){},error:function(e){i.error(e.responseJSON.error)}})}}),r=e("#package-modal-others .rack-dryclean").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e,text:e}},onItemAdd:function(e,n){if(isNaN(parseInt(e))){var r=this.$input[0].selectize;r.removeItem(e,!0)}var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("racks")=="undefined"&&n.attr("racks",{}),typeof n.attr("racks.dryclean")=="undefined"&&n.attr("racks.dryclean",[]),n.attr("racks.dryclean").indexOf(e)==-1&&n.attr("racks.dryclean").push(e)},onItemRemove:function(e){var n=t.scope.modalCustomerDetails.attr("data.racks.dryclean"),r=n.indexOf(e);n.removeAttr(r)},onChange:function(n){n=n.trim();var r=[];n.length&&(r=n.split("|"));var s=!1;e.each(r,function(e,t){var n=t.trim();n.length&&isNaN(parseInt(t))&&(s=!0)});if(s)return i.error("Rack must be a number."),!1;e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{racks:JSON.stringify({type:"dryclean",racks:r})},success:function(e){},error:function(e){i.error(e.responseJSON.error)}})}}),s=e("#package-modal-others .rack-iron").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e,text:e}},onItemAdd:function(e,n){if(isNaN(parseInt(e))){var r=this.$input[0].selectize;r.removeItem(e,!0)}var n=t.scope.modalCustomerDetails.attr("data");typeof n.attr("racks")=="undefined"&&n.attr("racks",{}),typeof n.attr("racks.iron")=="undefined"&&n.attr("racks.iron",[]),n.attr("racks.iron").indexOf(e)==-1&&n.attr("racks.iron").push(e)},onItemRemove:function(e){var n=t.scope.modalCustomerDetails.attr("data.racks.iron"),r=n.indexOf(e);n.removeAttr(r)},onChange:function(n){n=n.trim();var r=[];n.length&&(r=n.split("|"));var s=!1;e.each(r,function(e,t){var n=t.trim();n.length&&isNaN(parseInt(t))&&(s=!0)});if(s)return i.error("Rack must be a number."),!1;e.ajax({url:"/api/order/"+t.scope.modalCustomerDetails.attr("data._id"),type:"put",dataType:"json",data:{racks:JSON.stringify({type:"iron",racks:r})},success:function(e){},error:function(e){i.error(e.responseJSON.error)}})}});t.scope.selectize={rack_laundry:n[0].selectize,rack_dryclean:r[0].selectize,rack_iron:s[0].selectize}}}})}),define("async",[],function(){function n(e){var t,n;t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src=e,n=document.getElementsByTagName("script")[0],n.parentNode.insertBefore(t,n)}function r(t,n){var r=/!(.+)/,i=t.replace(r,""),s=r.test(t)?t.replace(/.+!/,""):e;return i+=i.indexOf("?")<0?"?":"&",i+s+"="+n}function i(){return t+=1,"__async_req_"+t+"__"}var e="callback",t=0;return{load:function(e,t,s,o){if(o.isBuild)s(null);else{var u=i();window[u]=s,n(r(t.toUrl(e),u))}}}}),define("app/components/usersList",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","gmaps","datepicker","momentjs","selectize"],function(e,t,n,r,i,s,o){var u=r[0],a=r[1];return u.extend({tag:"users-tab",template:"",scope:a.extend({init:function(){var n=this,r=moment();this.poll_skip=0,this.poll_limit=20,this.last_action=null,this.user_count=t.compute(0),this.timeslots=new t.Map({}),this.order_status=new t.Map({}),this.search_skip=0,this.search_limit=20,this.nanobar=new s({id:"mybar",bg:"#FF6600"});var i=JSON.parse(localStorage.getItem("statuses"));e.each(i,function(e,t){n.order_status.attr(e,t)});var o=JSON.parse(localStorage.getItem("timeslots"));e.each(o,function(e,t){n.timeslots.attr(e,t)})},userData:new t.List([]),loaded:!1,cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),selectedUser:new t.Map({}),orderHistory:new t.List([]),newOrder:new t.Map({}),addressList:new t.List([]),selectedAddress:new t.Map({}),variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),selectize:null,getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},getUserCount:function(){return this.user_count()},getTimeSlots:function(){return this.timeslots},selectSearchOption:function(t,n,r){var i=e(n).parents(".input-group").find(".search-input"),s=e(n).attr("data-option");s=="name"?i.val("name:"):s=="email"?i.val("email:"):s=="phone"&&i.val("phone:"),i.focus()},captureEnterKey:function(t,n,r){r.keyCode==13&&e("#users .btn-search-go").trigger("click")},searchUsers:function(e,t,n){this._searchUsers(0,this.search_limit),this._searchUsersDeferred()},addUser:function(t,n,r){e("#user-data-modal").modal({backdrop:"static",keyboard:!1,show:!0})},closeUserAddModal:function(t,n,r){e("#user-data-modal").modal("hide"),this.selectedUser.attr({},!0)},closeUserEditModal:function(t,n,r){e("#user-data-edit-modal").modal("hide"),this.selectedUser.attr({},!0)},editUser:function(t,n,r){var s=e(n).parents("tr").attr("index"),o=parseInt(e(n).parents("tr").attr("array-index"));this.selectedUser.attr("user_id",s),this.selectedUser.attr("array_index",o),this.nanobar.go(30);var u=e.ajax({url:"/api/user/"+s,type:"get",dataType:"json"}),a=e.ajax({url:"/api/address/user/"+s,type:"get",dataType:"json"}),f=e.ajax({url:"/api/orderhistory/"+s,type:"get",dataType:"json"}),l=this;e.when(u,a,f).done(function(t,n,r){t=t[0],n=n[0],r=r[0],l.nanobar.go(50),l.selectedUser.attr("name",t.data.users[0].user_data.name),l.selectedUser.attr("phone",t.data.users[0].user_data.phone),l.selectedUser.attr("email",t.data.users[0].user_data.email),l.selectedUser.attr("credits",parseInt(t.data.users[0].user_data.credits)||0),l.selectedUser.attr("backup_credits",parseInt(t.data.users[0].user_data.credits)||0),l.selectedUser.attr("backup_credits_add",0),l.selectedUser.attr("backup_credits_deduct",0),l.newOrder.attr("phone",t.data.users[0].user_data.phone),l.newOrder.attr("user_id",l.selectedUser.attr("user_id")),l.addressList.replace(n.data),e.each(r.data,function(e,t){var n=l.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color}),l.orderHistory.replace(r.data),e("#user-data-edit-modal").modal({backdrop:"static",keyboard:!1,show:!0}),l.nanobar.go(100)}).fail(function(){l.nanobar.go(100),i.error("Some error occured. Try again.")})},saveUserDetails:function(t,n,r){if(!this.__validateSelectedUserDetails())return!1;var s=JSON.stringify({add:parseInt(this.selectedUser.attr("backup_credits_add")),deduct:parseInt(this.selectedUser.attr("backup_credits_deduct"))}),o=e.ajax({url:"/api/user/"+this.selectedUser.user_id,type:"put",dataType:"json",context:this,data:{name:this.selectedUser.attr("name"),phone:this.selectedUser.attr("phone"),credits:s,email:this.selectedUser.attr("email")},success:function(e){i.success("User details successfully saved.");var t=this.userData.attr(this.selectedUser.attr("array_index"));t.attr("user_data.phone",this.selectedUser.attr("phone")),t.attr("user_data.name",this.selectedUser.attr("name")),t.attr("user_data.credits",this.selectedUser.attr("credits")),t.attr("user_data.email",this.selectedUser.attr("email")),this.closeUserEditModal()},error:function(e,t,n){i.error("Error saving user details. Try again.")}})},saveUser:function(t,n,r){if(!this.__validateSelectedUser())return!1;var s=e.ajax({url:"/api/user",type:"post",dataType:"json",context:this,data:{email:this.selectedUser.attr("email"),name:this.selectedUser.attr("name"),phone:this.selectedUser.attr("phone")},success:function(e){i.success("User successfully added."),this.closeUserAddModal()},error:function(e,t,n){i.error("Error adding user. Try again.")}})},__validateSelectedUserDetails:function(){return this.selectedUser.attr("name")?this.selectedUser.attr("phone")?this._validatePhone(this.selectedUser.attr("phone"))?this.selectedUser.attr("email")&&!this._validateEmail(this.selectedUser.attr("email"))?(i.error("Email is incorrect."),!1):!0:(i.error("Phone number is incorrect."),!1):(i.error("Phone number not provided."),!1):(i.error("Name not provided."),!1)},__validateSelectedUser:function(){return this.selectedUser.attr("name")?this.selectedUser.attr("phone")?this._validatePhone(this.selectedUser.attr("phone"))?this.selectedUser.attr("email")?this._validateEmail(this.selectedUser.attr("email"))?!0:(i.error("Email is incorrect."),!1):(i.error("Email not provided."),!1):(i.error("Phone number is incorrect."),!1):(i.error("Phone number not provided."),!1):(i.error("Name not provided."),!1)},__validateOrder:function(){return this.newOrder.attr("address_id")?this.newOrder.attr("service")?this.newOrder.attr("washtypes")?this.newOrder.attr("pickup_date_submit")?this.newOrder.attr("pickup_time")?this.newOrder.attr("schedule_date_submit")?this.newOrder.attr("schedule_time")?this.newOrder.attr("phone")?this._validatePhone(this.newOrder.attr("phone"))?!0:(i.error("Phone number incorrect."),!1):(i.error("Phone number not provided."),!1):(i.error("Delivery time not selected."),!1):(i.error("Delivery date not selected."),!1):(i.error("Pickup time not selected."),!1):(i.error("Pickup date not selected."),!1):(i.error("Service types not selected."),!1):(i.error("Service not selected."),!1):(i.error("Address not selected."),!1)},orderFormChange:function(t,n,r){if(e(n).attr("name")=="service"){this.newOrder.attr("service",e(n).val());if(this.newOrder.attr("service")=="express"){var i=e('#add-order-form input[name="delivery-date"]'),s=e('#add-order-form input[name="pickup-date"]'),o=moment(s.datepicker("getDate"));o=o.add(1,"days"),i.datepicker("setDate",o.format("YYYY-MM-DD"))}else{var s=e('#add-order-form input[name="pickup-date"]');s.datepicker("setDate",moment(s.datepicker("getDate")).format("YYYY-MM-DD"))}}else e(n).attr("name")=="address"?this.newOrder.attr("address_id",e(n).val()):e(n).attr("name")=="pickup-time"?this.newOrder.attr("pickup_time",e(n).val()):e(n).attr("name")=="delivery-time"?this.newOrder.attr("schedule_time",e(n).val()):e(n).attr("name")=="phone"?this.newOrder.attr("phone",e(n).val()):e(n).attr("name")=="coupon"&&this.newOrder.attr("coupon",e(n).val())},saveOrder:function(t,n,r){if(!this.__validateOrder())return!1;e(n).button("loading"),e.ajax({url:"/api/order",type:"post",dataType:"json",context:this,data:this.newOrder.attr(),success:function(s){var o=this;e(n).button("reset"),this.newOrder.attr("_id",s._id),this.newOrder.attr("status","order_placed"),this.newOrder.attr("pickup_data",{schedule_date:o.newOrder.attr("pickup_date_submit"),schedule_time:o.timeslots.attr(o.newOrder.attr("pickup_time"))}),this.newOrder.attr("delivery_data",{schedule_date:o.newOrder.attr("schedule_date_submit"),schedule_time:o.timeslots.attr(o.newOrder.attr("schedule_time"))}),this.orderHistory.unshift(this.newOrder.attr()),this.cancelOrder(t,n,r),i.success("Order placed.")},error:function(t,r,s){e(n).button("reset"),i.error(t.responseJSON.error)}})},cancelOrder:function(t,n,r){this.newOrder.attr({},!0),this.newOrder.attr("phone",this.selectedUser.attr("phone")),this.newOrder.attr("user_id",this.selectedUser.attr("user_id")),this.selectize.service.clear(),e('#add-order-form input[name="pickup-date"]').datepicker("setDate",moment().format("YYYY-MM-DD")),e("#add-order-form select").each(function(t,n){e(n).find("option:first").attr("selected","selected")})},selectedUserChange:function(t,n,r){var i=e(n).val().trim();if(e(n).attr("name")=="name")this.selectedUser.attr("name",i);else if(e(n).attr("name")=="phone")this.selectedUser.attr("phone",i);else if(e(n).attr("name")=="email")this.selectedUser.attr("email",i);else if(e(n).attr("name")=="credits_add"){this.selectedUser.attr("backup_credits_add",parseInt(i)||0);var s=this.selectedUser.attr("backup_credits"),o=this.selectedUser.attr("backup_credits_add"),u=this.selectedUser.attr("backup_credits_deduct"),a=s+o-u;a<0&&(a=0),this.selectedUser.attr("credits",a)}else if(e(n).attr("name")=="credits_deduct"){this.selectedUser.attr("backup_credits_deduct",parseInt(i)||0);var s=this.selectedUser.attr("backup_credits"),o=this.selectedUser.attr("backup_credits_add"),u=this.selectedUser.attr("backup_credits_deduct"),a=s+o-u;a<0&&(a=0),this.selectedUser.attr("credits",a)}},selectedUserAddressChange:function(t,n,r){var i=e(n).val().trim();e(n).attr("name")=="address_1"?this.selectedAddress.attr("address_1",i):e(n).attr("name")=="address_2"?this.selectedAddress.attr("address_2",i):e(n).attr("name")=="apartment_number"?this.selectedAddress.attr("apartment_number",i):e(n).attr("name")=="tag"&&this.selectedAddress.attr("tag",i)},__validateAddress:function(){return this.selectedAddress.attr("tag")?this.selectedAddress.attr("address_1")?this.selectedAddress.attr("address_2")?this.selectedAddress.attr("apartment_number")?this.selectedAddress.attr("locality")?!0:(i.error("Locality not provided."),!1):(i.error("Flat number not provided."),!1):(i.error("Landmark not provided."),!1):(i.error("Address not provided."),!1):(i.error("Tag not provided."),!1)},saveAddress:function(t,n,r){if(!this.__validateAddress())return!1;var i="/api/address",s="post";this.selectedAddress.attr("_id")&&(i+="/"+this.selectedAddress.attr("_id"),s="put"),e(n).button("loading"),e.ajax({url:i,type:s,dataType:"json",context:this,data:{tag:this.selectedAddress.attr("tag"),address_1:this.selectedAddress.attr("address_1"),address_2:this.selectedAddress.attr("address_2"),apartment_number:this.selectedAddress.attr("apartment_number"),user_id:this.selectedUser.attr("user_id")||null,locality:JSON.stringify(this.selectedAddress.attr("locality").attr())},success:function(t){e(n).button("reset"),this.selectedAddress.attr("assigned_hub",t.assigned_hub);if(this.selectedAddress.attr("_id")){var r=this.addressList.attr(this.selectedAddress.attr("array_index")),i=r.attr();i.address_1!=this.selectedAddress.attr("address_1")&&r.attr("address_1",this.selectedAddress.attr("address_1")),i.apartment_number!=this.selectedAddress.attr("apartment_number")&&r.attr("apartment_number",this.selectedAddress.attr("apartment_number")),i.address_2!=this.selectedAddress.attr("address_2")&&r.attr("address_2",this.selectedAddress.attr("address_2")),i.tag!=this.selectedAddress.attr("tag")&&r.attr("tag",this.selectedAddress.attr("tag")),i.locality!=this.selectedAddress.attr("locality")&&r.attr("locality",this.selectedAddress.attr("locality")),i.assigned_hub!=this.selectedAddress.attr("assigned_hub")&&r.attr("assigned_hub",this.selectedAddress.attr("assigned_hub"))}else this.selectedAddress.attr("_id",t.address_id),this.addressList.unshift(this.selectedAddress.attr());this.selectedAddress.attr({},!0)},error:function(t,r,i){e(n).button("reset")}})},editAddress:function(t,n,r){this.nanobar.go(30);var i=parseInt(e(n).attr("array-index"));e.ajax({url:"/api/address/"+e(n).attr("index"),type:"get",dataType:"json",context:this,success:function(e){e=e.data[0],this.selectedAddress.attr({_id:e._id,tag:e.tag,address_1:e.address_1,address_2:e.address_2,apartment_number:e.apartment_number,locality:e.locality||null,assigned_hub:e.assigned_hub||null,array_index:i},!0),this.nanobar.go(50),this.nanobar.go(100)},error:function(){this.nanobar.go(100)}})},cancelAddress:function(e,t,n){this.selectedAddress.attr({},!0)},_searchUsers:function(t,n){var r=e.trim(e("#users .search-input").val());if(r==""){e("#users .btn-refresh").trigger("click");return}t=typeof t=="undefined"?this.search_skip:t,n=typeof n=="undefined"?this.search_limit:n,this.nanobar.go(30),this.user_search_defer=e.ajax({url:"/api/user/search/"+r+"/"+t+"/"+n,type:"get",dataType:"json",context:this})},_searchUsersDeferred:function(t){typeof t=="undefined"&&(t=!0),this.user_search_defer.done(function(n){var r=this;this.nanobar.go(50),t&&this.userData.replace([]),e.each(n.data.users,function(e,t){r.userData.push(t)}),this.search_skip+=n.data.users.length,this.nanobar.go(100),this.last_action="search",t||e("#users .block-load-more").find(".fa-repeat").removeClass("fa-spin")}),this.user_search_defer.fail(function(e,t,n){this.nanobar.go(100),i.error("Proper search criteria not used.")})},userRefresh:function(e,t,n){this._pollData(0,this.poll_skip),this._pollDataDeferExec(!0)},loadMoreRows:function(t,n,r){e(n).button("load"),e(n).find(".fa-repeat").addClass("fa-spin"),this.last_action=="search"?(this._searchUsers(),this._searchUsersDeferred(!1)):(this._pollData(),this._pollDataDefer.done(function(t){this.nanobar.go(50);var r=this;e.each(t.data.users,function(e,t){r.userData.push(t)}),this.poll_skip+=t.data.users.length,e(n).button("reset"),e(n).find(".fa-repeat").removeClass("fa-spin"),this.nanobar.go(100)}))},_pollData:function(t,n){t=typeof t=="undefined"?this.poll_skip:t,n=typeof n=="undefined"?this.poll_limit:n,this.nanobar.go(30),this._pollDataDefer=e.ajax({url:"/api/user/"+t+"/"+n,type:"get",context:this,dataType:"json"})},_pollDataDeferExec:function(t){typeof t=="undefined"&&(t=!1),this._pollDataDefer.done(function(n){var r=this;this.nanobar.go(50);if(!n.data)return r.nanobar.go(100),!1;t?(this.userData.replace(n.data.users),this.poll_skip=n.data.users.length):(e.each(n.data.users,function(e,t){r.userData.push(t)}),this.poll_skip=this.poll_skip+n.data.users.length),this.user_count(n.data.total_count),this.nanobar.go(100),this.last_action="query"})},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-users"&&!this.scope.loaded&&(this.scope._pollData(),this.scope._pollDataDeferExec(),this.scope.loaded=!0)},inserted:function(t){var n=this,r={format:"yyyy-mm-dd",startDate:moment().format("YYYY-MM-DD"),autoclose:!0,immediateUpdates:!0},i=e.extend(r,{startdate:moment().add(3,"days").format("YYYY-MM-DD")});e('#add-order-form input[name="pickup-date"]').datepicker(r).on("changeDate",function(t){var r=moment(e(this).datepicker("getDate"));n.scope.newOrder.attr("pickup_date_submit",r.format("YYYY/MM/DD"));var i=n.scope.newOrder.attr("washtypes")||null,s=e('#add-order-form input[name="delivery-date"]'),o=e('#add-order-form select[name="service"] option:selected').val();if(o=="regular"){if(!i)r=r.add(3,"days");else if(i.indexOf("dryclean")>-1)r=r.add(5,"days");else if(i.indexOf("laundry")>-1||i.indexOf("iron")>-1)r=r.add(3,"days")}else r=r.add(1,"days");s.datepicker("setDate",r.format("YYYY-MM-DD"))}),e('#add-order-form input[name="delivery-date"]').datepicker(i).on("changeDate",function(t){n.scope.newOrder.attr("schedule_date_submit",moment(e(this).datepicker("getDate")).format("YYYY/MM/DD"))});var s=null;e('#add-order-form input[name="service"]').change(function(){s=n.scope.newOrder.attr("service")});var u=e('input[name="service-types"]').selectize({plugins:["remove_button"],valueField:"name",labelField:"name",searchField:"name",preload:!0,create:!1,render:{item:function(e,t){return'<div style="color:#fff"><span>'+t(e.name.replace(e.name.substr(0,1),e.name.substr(0,1).toUpperCase()))+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name.replace(e.name.substr(0,1),e.name.substr(0,1).toUpperCase()))+"</span>&nbsp;"+"</div>"}},load:function(t,n){localStorage.getItem("servicetype")?n(JSON.parse(localStorage.getItem("servicetype"))):e.ajax({url:"/api/servicetype",type:"get",dataType:"json",success:function(e){n(e),localStorage.setItem("servicetype",JSON.stringify(e))},error:function(e,t,r){n()}})},onItemAdd:function(e,t){n.scope.newOrder.attr("washtypes",this.$input[0].selectize.getValue())},onItemRemove:function(e){n.scope.newOrder.attr("washtypes",this.$input[0].selectize.getValue())}});n.scope.selectize={service:u[0].selectize},e('#add-order-form input[name="pickup-date"]').datepicker("setDate",moment().format("YYYY-MM-DD"));var a=new o.LatLng(13.094677,77.794881),f=new o.LatLng(12.788851,77.405553),l=new o.LatLngBounds(f,a),r={bounds:l,regions:["sublocality"],componentRestrictions:{country:"in"}},c=new o.places.Autocomplete(e("#users-locality")[0],r);o.event.addListener(c,"place_changed",function(){var e=c.getPlace();n.scope.selectedAddress.attr("locality",{map_string:e.formatted_address,lat:e.geometry.location.lat(),lng:e.geometry.location.lng()})})}}})}),define("app/components/vendorsList",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","momentjs","selectize"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"vendor-tab",template:"",scope:u.extend({init:function(){this.skip=0,this.limit=20},vendorList:new t.Map({}),loaded:!1,selectedVendor:new t.Map({}),selectize:null,selectedVendorChange:function(t,n,r){if(e(n).attr("name")=="name")this.selectedVendor.attr("name",e(n).val());else if(e(n).attr("name")=="address")this.selectedVendor.attr("address",e(n).val().trim());else if(e(n).attr("name")=="status"){var i=e(n).val();i=="active"?this.selectedVendor.attr("is_active",!0):i=="inactive"&&this.selectedVendor.attr("is_active",!1)}},addVendor:function(t,n,r){this.selectedVendor.attr("is_active",!0),e("#vendor-data-modal").modal({backdrop:"static",keyboard:!1,show:!0})},vendorRefresh:function(e,t,n){this._pollData(!1,0,this.skip)},_pollData:function(n,r,i){typeof n=="undefined"&&(n=!1),typeof r=="undefined"&&(r=this.skip),typeof i=="undefined"&&(i=this.limit),e.ajax({url:"/api/vendor/"+r+"/"+i,type:"get",context:this,dataType:"json",success:function(r){var i=this;if(n){e.each(r,function(e,t){i.vendorList.attr(e)?(i.vendorList.attr(e+".data.name")!=t["data"]["name"]&&i.vendorList.attr(e+".data.name",t.data.name),i.vendorList.attr(e+".data.address")!=t["data"]["address"]&&i.vendorList.attr(e+".data.address",t.data.address),i.vendorList.attr(e+".is_active")!=t["is_active"]&&i.vendorList.attr(e+".is_active",t.is_active),i.vendorList.attr(e+".services",t.services),i.vendorList.attr(e+".data.phone",t.data.phone),i.vendorList.attr(e+".data.email",t.data.email)):i.vendorList.attr(e,t)});var s=[];this.vendorList.each(function(e,t){r[t]||s.push(t)}),e.each(s,function(e,t){i.vendorList.removeAttr(t)})}else this.vendorList.attr(r,!0),this.skip=t.Map.keys(this.vendorList).length}})},editVendor:function(t,n,r){var i=e(n).parents("tr").attr("index");e.ajax({url:"/api/vendor/"+i,type:"get",context:this,dataType:"json",success:function(t){var n=this;t.address=t.address.trim(),this.selectedVendor.attr(t,!0),this.selectedVendor.attr("str_id",i),e.each(t.phone,function(e,t){n.selectize.phone.createItem(t)}),e.each(t.email,function(e,t){n.selectize.email.createItem(t)});var r=[];e.each(t.services,function(e,t){n.selectize.service.addItem(t.id),r.push(t.id)}),this.selectedVendor.attr("services",r),e("#vendor-data-modal").modal({backdrop:"static",keyboard:!1,show:!0})}})},_validateVendorForm:function(){return this.selectedVendor.attr("name")?!this.selectedVendor.attr("phone")||!this.selectedVendor.attr("phone").attr().length?(i.error("Phone number not provided."),!1):this.selectedVendor.attr("email")?this.selectedVendor.attr("services")?typeof this.selectedVendor.attr("is_active")!="boolean"?(i.error("Status not selected."),!1):!0:(i.error("Services not selected."),!1):(i.error("Email not provided."),!1):(i.error("Name not provided."),!1)},saveVendor:function(t,n,r){if(!this._validateVendorForm())return!1;var i=null;this.selectedVendor.attr("str_id")&&(i=this.selectedVendor.attr("str_id"));var s="post",o="/api/vendor";i&&(s="put",o="/api/vendor/"+i),e.ajax({url:o,type:s,dataType:"json",context:this,data:{name:this.selectedVendor.attr("name"),email:JSON.stringify(this.selectedVendor.attr("email").attr()),phone:JSON.stringify(this.selectedVendor.attr("phone").attr()),address:this.selectedVendor.attr("address"),services:JSON.stringify(this.selectedVendor.attr("services").attr()),is_active:this.selectedVendor.attr("is_active")},success:function(e){var e={data:{name:this.selectedVendor.attr("name"),email:JSON.stringify(this.selectedVendor.attr("email").attr()),phone:JSON.stringify(this.selectedVendor.attr("phone").attr()),address:this.selectedVendor.attr("address")},is_active:this.selectedVendor.attr("is_active"),services:this.selectedVendor.attr("services").attr()};this.selectedVendor.attr("str_id")?(e.str_id=this.selectedVendor.attr("str_id"),this.vendorList.attr(e.str_id,e)):(e.str_id=e.str_id,this.vendorList.attr(e.str_id,e),this.limit+=1,console.log(this.limit)),this.closeVendorModal(t,n,r)}})},loadMoreRows:function(e,t,n){this._pollData(!0)},closeVendorModal:function(t,n,r){e("#vendor-data-modal").modal("hide"),this.selectedVendor.attr({},!0),e.each(this.selectize,function(e,t){t.clear(),e!="service"&&t.clearOptions()})}}),helpers:e.extend(n,{}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-vendors"&&!this.scope.loaded&&(this.scope._pollData(!1),this.scope.loaded=!0)},inserted:function(){var t=this,n=e("#vendor-data-modal .add-phone-input").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e,text:e}},onItemAdd:function(e,n){var r=this.$input[0].selectize,s=/^((\+?91)|(0))?\d{8,12}$/;if(!s.test(e))return i.error("Invalid number",e),r.removeItem(e),!1;t.scope.selectedVendor.attr("phone")||t.scope.selectedVendor.attr("phone",[]),t.scope.selectedVendor.attr("phone").indexOf(e)==-1&&t.scope.selectedVendor.attr("phone").push(e)},onItemRemove:function(e){console.log(t.scope.selectedVendor.attr());var n=t.scope.selectedVendor.attr("phone").indexOf(e);t.scope.selectedVendor.attr("phone").removeAttr(n)}}),r=e("#vendor-data-modal .add-email-input").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:function(e){return{value:e,text:e}},onItemAdd:function(e,n){var r=this.$input[0].selectize,s=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;if(!s.test(e))return i.error("Invalid email",e),r.removeItem(e),!1;t.scope.selectedVendor.attr("email")||t.scope.selectedVendor.attr("email",[]),t.scope.selectedVendor.attr("email").indexOf(e)==-1&&t.scope.selectedVendor.attr("email").push(e)},onItemRemove:function(e){var n=t.scope.selectedVendor.attr("email").indexOf(e);t.scope.selectedVendor.attr("email").removeAttr(n)}}),s=e("#vendor-data-modal .add-service-input").selectize({plugins:["remove_button"],valueField:"id",labelField:"name",searchField:"name",preload:!0,create:!1,render:{item:function(e,t){return'<div style="color:#fff"><span>'+t(e.name.replace(e.name.substr(0,1),e.name.substr(0,1).toUpperCase()))+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name.replace(e.name.substr(0,1),e.name.substr(0,1).toUpperCase()))+"</span>&nbsp;"+"</div>"}},load:function(t,n){localStorage.getItem("servicetype")?n(JSON.parse(localStorage.getItem("servicetype"))):e.ajax({url:"/api/servicetype",type:"get",dataType:"json",success:function(e){n(e),localStorage.setItem("servicetype",JSON.stringify(e))},error:function(e,t,r){n()}})},onItemAdd:function(e,n){t.scope.selectedVendor.attr("services")||t.scope.selectedVendor.attr("services",[]),t.scope.selectedVendor.attr("services").indexOf(e)==-1&&t.scope.selectedVendor.attr("services").push(e)},onItemRemove:function(e){var n=t.scope.selectedVendor.attr("services").indexOf(e);t.scope.selectedVendor.attr("services").removeAttr(n)}});t.scope.selectize={phone:n[0].selectize,email:r[0].selectize,service:s[0].selectize}}}})}),define("app/components/logisticStaffs",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","momentjs"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"logistic-staffs-tab",template:"",scope:u.extend({init:function(){var n=this,r=moment();this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.poll_skip=0,this.poll_limit=20,this.last_action=null,this.user_count=t.compute(0),this.search_skip=0,this.search_limit=20,this.nanobar=new s({id:"mybar",bg:"#FF6600"});var i=JSON.parse(localStorage.getItem("statuses"));e.each(i,function(e,t){n.order_status.attr(e,t)});var o=JSON.parse(localStorage.getItem("timeslots"));e.each(o,function(e,t){n.timeslots.attr(e,t)})},staffData:new t.List([]),loaded:!1,selectedStaff:new t.Map({}),selectize:null,getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},getUserCount:function(){return this.user_count()},selectSearchOption:function(t,n,r){var i=e(n).parents(".input-group").find(".search-input"),s=e(n).attr("data-option");s=="name"?i.val("name:"):s=="email"?i.val("email:"):s=="phone"&&i.val("phone:"),i.focus()},captureEnterKey:function(t,n,r){r.keyCode==13&&e("#users .btn-search-go").trigger("click")},searchUsers:function(e,t,n){this._searchUsers(0,this.search_limit),this._searchUsersDeferred()},addStaff:function(e,t,n){this.selectedStaff.attr("data")||this.selectedStaff.attr("data",{}),this.selectedStaff.attr("is_active",!0),this.selectedStaff.attr("data.shift","1"),this.__openStaffModal()},__openStaffModal:function(){e("#add-logistic-staff-modal").modal({backdrop:"static",keyboard:!1,show:!0})},editStaff:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=parseInt(e(n).parents("tr").attr("arr-index"));e.ajax({url:"/api/employee/"+i,type:"get",dataType:"json",context:this,success:function(t){var n=this;this.selectedStaff.attr(t.data[0],!0),this.selectedStaff.attr("arr-index",s),e.each(t.data[0].data.phone,function(e,t){n.selectize.phone.createItem(t)}),t.data[0].hub&&n.selectize.hub.addItem(t.data[0].hub.str_id),this.__openStaffModal()}})},_validateStaffData:function(){return this.selectedStaff.attr("data.name")?!this.selectedStaff.attr("data.phone")||!this.selectedStaff.attr("data.phone").attr().length?(i.error("Phone number not provided."),!1):this.selectedStaff.attr("data.shift")?typeof this.selectedStaff.attr("is_active")!="boolean"?(i.error("Status not selected."),!1):this.selectedStaff.attr("hub")?!0:(i.error("Hub not selected."),!1):(i.error("Shift not selected."),!1):(i.error("Name not provided."),!1)},saveStaff:function(t,n,r){var s="/api/employee",o="post";if(!this._validateStaffData())return!1;this.selectedStaff.attr("str_id")&&(s="/api/employee/"+this.selectedStaff.attr("str_id"),o="put"),e.ajax({url:s,type:o,dataType:"json",context:this,data:{name:this.selectedStaff.attr("data.name"),phone:JSON.stringify(this.selectedStaff.attr("data.phone").attr()),shift:this.selectedStaff.attr("data.shift"),hub_id:this.selectedStaff.attr("hub").attr("str_id"),is_active:this.selectedStaff.attr("is_active")},success:function(e){var i=this;if(!this.selectedStaff.attr("str_id"))this.selectedStaff.attr("str_id",e.str_id),this.selectedStaff.attr("emp_id",e.emp_id),this.staffData.unshift(this.selectedStaff.attr()),this.poll_skip+=1;else{var s=this.selectedStaff.attr("arr-index");this.selectedStaff.each(function(e,t){i.staffData.attr(s).attr(t)&&i.staffData.attr(s).attr(t,e)})}this.closeStaffModal(t,n,r)},error:function(){i.error("Some error occured.")}})},staffDataChange:function(t,n,r){var i=e(n).val().trim();e(n).attr("name")=="name"?this.selectedStaff.attr("data.name",i):e(n).attr("name")=="phone"?this.selectedStaff.attr("data.phone",i):e(n).attr("name")=="shift"?this.selectedStaff.attr("data.shift",i):e(n).attr("name")=="is_active"&&(i=="active"?this.selectedStaff.attr("is_active",!0):this.selectedStaff.attr("is_active",!1))},closeStaffModal:function(t,n,r){e("#add-logistic-staff-modal").modal("hide"),this.selectedStaff.attr({},!0),this.selectize.phone.clearOptions(),this.selectize.phone.clear(),this.selectize.hub.clear()},_searchUsers:function(t,n){var r=e.trim(e("#users .search-input").val());if(r==""){e("#users .btn-refresh").trigger("click");return}t=typeof t=="undefined"?this.search_skip:t,n=typeof n=="undefined"?this.search_limit:n,this.nanobar.go(30),this.user_search_defer=e.ajax({url:"/api/user/search/"+r+"/"+t+"/"+n,type:"get",dataType:"json",context:this})},_searchUsersDeferred:function(t){typeof t=="undefined"&&(t=!0),this.user_search_defer.done(function(n){var r=this;this.nanobar.go(50),t&&this.userData.replace([]),e.each(n.data.users,function(e,t){r.userData.push(t)}),this.search_skip+=n.data.users.length,this.nanobar.go(100),this.last_action="search",t||e("#users .block-load-more").find(".fa-repeat").removeClass("fa-spin")}),this.user_search_defer.fail(function(e,t,n){this.nanobar.go(100),i.error("Proper search criteria not used.")})},staffRefresh:function(e,t,n){this._pollData(0,this.poll_skip),this._pollDataDeferExec(!0)},loadMoreRows:function(t,n,r){e(n).button("load"),e(n).find(".fa-repeat").addClass("fa-spin"),this.last_action=="search"?(this._searchUsers(),this._searchUsersDeferred(!1)):(this._pollData(),this._pollDataDefer.done(function(t){this.nanobar.go(50);var r=this;e.each(t.data,function(e,t){r.staffData.push(t)}),this.poll_skip+=t.data.length,e(n).button("reset"),e(n).find(".fa-repeat").removeClass("fa-spin"),this.nanobar.go(100)}))},_pollData:function(t,n){t=typeof t=="undefined"?this.poll_skip:t,n=typeof n=="undefined"?this.poll_limit:n,this.nanobar.go(30),this._pollDataDefer=e.ajax({url:"/api/employee/"+t+"/"+n,type:"get",context:this,dataType:"json"})},_pollDataDeferExec:function(t){typeof t=="undefined"&&(t=!0),this._pollDataDefer.done(function(n){var r=this;this.nanobar.go(50);if(!n.data)return r.nanobar.go(100),!1;t?(this.staffData.replace(n.data),this.poll_skip=n.data.length):(e.each(n.data,function(e,t){r.staffData.push(t)}),this.poll_skip=this.poll_skip+n.data.length),this.nanobar.go(100),this.last_action="query"})},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-logistic-staffs"&&!this.scope.loaded&&(this.scope._pollData(),this.scope._pollDataDeferExec(),this.scope.loaded=!0)},inserted:function(){var t=this,n=e("#add-logistic-staff-modal .add-phone-input").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,maxItems:1,create:function(e){return{value:e,text:e}},onItemAdd:function(e,n){var r=this.$input[0].selectize,s=/^((\+?91)|(0))?\d{8,12}$/;if(!t.scope._validatePhone(e))return i.error("Invalid number",e),r.removeItem(e),!1;t.scope.selectedStaff.attr("data.phone")||t.scope.selectedStaff.attr("data.phone",[]),t.scope.selectedStaff.attr("data.phone").indexOf(e)==-1&&t.scope.selectedStaff.attr("data.phone").push(e)},onItemRemove:function(e){var n=t.scope.selectedStaff.attr("data.phone").indexOf(e);t.scope.selectedStaff.attr("data.phone").removeAttr(n)}}),r=e("#add-logistic-staff-modal .select-hub-input").selectize({plugins:["remove_button"],valueField:"str_id",labelField:"name",searchField:["name","short"],preload:!0,create:!1,render:{item:function(e,t){return"<div><span>"+t(e.name)+" "+"<b>("+e.short.toUpperCase()+")</b>"+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name)+" "+"<b>("+e.short.toUpperCase()+")</b>"+"</span>&nbsp;"+"</div>"}},load:function(t,n){e.ajax({url:"/api/hub",type:"get",context:this,dataType:"json",success:function(e){n(e.data)},error:function(e,t,r){n()}})},onItemAdd:function(e,n){var r=n.text().split("(");t.scope.selectedStaff.attr("hub",{str_id:e,name:r[0],"short":r[1].replace("(","").replace(")","").replace(" ","")})}});t.scope.selectize={phone:n[0].selectize,hub:r[0].selectize}}}})}),define("app/components/failureReasonsConf",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","nanobar","toastr","datepicker","momentjs"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"failure-reason-app",template:"",scope:u.extend({init:function(){this.nanobar=new i({id:"mybar",bg:"#FF6600"}),this.activeEditId=t.compute(0)},allItems:new t.List([]),loaded:!1,editingItem:new t.Map({}),selectize:{},getAllItems:function(){var t=e.ajax({url:"/api/failurereason",type:"get",dataType:"json",context:this,success:function(e){this.allItems.replace(e.data)}})},editItem:function(t,n,r){var i=this,s=n.attr("index"),o=e.ajax({url:"/api/failurereason/"+s,type:"get",context:this});o.done(function(t){this.activeEditId(s),e.each(t.data,function(e,t){i.editingItem.attr(e,t)}),e.each(t.data[0].type,function(e,t){i.selectize.reason.addItem(t.name)}),e("#failure-reason-modal").modal("show")})},addItem:function(t,n,r){this.activeEditId(-1),e("#failure-reason-modal").modal("show")},closeModal:function(t,n,r){var i=this;this.editingItem.each(function(e,t){i.editingItem.attr(t,null)}),this.selectize.reason.clear(),e("#failure-reason-modal").modal("hide")},saveItem:function(t,n,r){self=this;var i=null,s="/api/failurereason";this.activeEditId()<0?i="post":(i="put",s="/api/failurereason/"+this.activeEditId());var o=e("#failure-reason-modal .reason-type").val();e.ajax({url:s,type:i,dataType:"json",context:this,data:{reason:e('#failure-reason-modal input[name="reason"]').val(),type:JSON.stringify(o)},success:function(e){this.getAllItems(),this.closeModal(t,n,r)}})}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-configuration"&&!this.scope.loaded&&(this.scope.getAllItems(),this.scope.loaded=!0)},inserted:function(){var t=e("#failure-reason-modal .reason-type").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:!1});this.scope.selectize={reason:t[0].selectize}}}})}),define("app/components/deliveryProgress",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs","summernote"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"ofd-tabs",template:"",scope:u.extend({init:function(){var n=this;this.order_status=new t.Map({}),this.timeslots=new t.Map({}),this.total_quantity=t.compute(0),this.row_count=t.compute(0),this.nanobar=new s({id:"mybar",bg:"#FF6600"});var r=JSON.parse(localStorage.getItem("statuses"));e.each(r,function(e,t){n.order_status.attr(e,t)});var i=JSON.parse(localStorage.getItem("timeslots"));e.each(i,function(e,t){n.timeslots.attr(e,t)})},orderData:new t.Map({}),loaded:!1,failureReasons:new t.List([]),cleaningItems:new t.List([]),modalCustomerDetails:new t.Map({}),allCosts:new t.Map({}),deliveryRescheduleOldValue:new t.Map({}),deliveryFailureReasons:new t.List([]),variableDate:new Date,orderDate:t.compute(function(){return this.attr("variableDate")}),rowCount:function(){return this.row_count()},getFormattedDate:function(e){return e.format("YYYY-MM-DD")},getFormattedTime:function(e){return e.format("HH-mm")},orderStatusHash:function(){return this.order_status},getTimeSlots:function(){return this.timeslots},captureEnterKey:function(t,n,r){r.keyCode==13&&e("#ofd-orders .btn-search-go").trigger("click")},searchOrders:function(e,t,n){this._searchOrders(),this._searchOrdersDeferred()},getOrderDataKey:function(e){var t;return this.orderData.each(function(n,r){n.attr(e)&&(t=r)}),t},_searchOrders:function(){var t=e.trim(e("#ofd-orders .search-input").val()).toUpperCase();if(t==""){this.orderRefresh();return}this.ofd_search_defer=e.ajax({url:"/api/order/"+t,type:"put",dataType:"json",context:this,data:{status:"delivery_progress"}})},_searchOrdersDeferred:function(){this.ofd_search_defer.done(function(t){e("#ofd-orders .search-input").val(""),this.orderRefresh()}),this.ofd_search_defer.fail(function(e,t,n){this.nanobar.go(100),i.error(e.responseJSON.error)})},orderRefresh:function(e,t,n){var r=moment(this.orderDate());this._pollData()},getTotalQuantity:function(){return this.total_quantity()},deliveryTimeSlotChange:function(t,n,r){var i=e(n).val();i==0&&(i=e(n).attr("value"));var s=this.timeslots.attr(i),o=this.modalCustomerDetails.attr("data.schedules.delivery.schedule");this.deliveryRescheduleOldValue.attr("timeslot",o),this.modalCustomerDetails.attr("data.schedules.delivery.schedule",s)},saveDeliveryReschedule:function(t,n,r){var s=e("#ofd-details-modal").attr("index"),o=this.modalCustomerDetails.attr("data.schedules.delivery.schedule_date"),u=this.modalCustomerDetails.attr("data.schedules.delivery.schedule");e.ajax({url:"/api/delivery",type:"put",dataType:"json",context:this,data:{order_id:s,time:value},success:function(e){i.success("Reschedule successful.")},error:function(e,t,n){i.success("Reschedule unsuccessful."),this.modalCustomerDetails.attr("data.schedules.delivery.schedule_date",this.deliveryRescheduleOldValue.attr("date")),this.modalCustomerDetails.attr("data.schedules.delivery.schedule",this.deliveryRescheduleOldValue.attr("timeslot"))}})},_addData:function(n){this.row_count(n.length);var r=t.Map.keys(this.orderData),i=this,s={};e.each(n,function(e,t){var n=i.getStatusDetails(t.status);t.status=n.formal_name,t.status_color=n.color,t.user_info.name=t.user_info.name.trim(),s[t.schedule_time]||(s[t.schedule_time]={}),s[t.schedule_time][t.order_id]=t}),this.orderData.attr(s,!0)},_updateData:function(t){this.row_count(t.length);var n=this,r={};e.each(t,function(e,t){r[t.order_id]=t.schedule_time;var i=n.getStatusDetails(t.status);t.status=i.formal_name,t.status_color=i.color,t.user_info.name=t.user_info.name.trim(),n.orderData.attr(t.schedule_time)||n.orderData.attr(t.schedule_time,{}),n.orderData.attr(t.schedule_time).attr(t.order_id)?!n.orderData.attr(t["schedule_time"]).attr(t["order_id"]).attr("status")!=t["status"]&&(n.orderData.attr(t.schedule_time).attr(t.order_id).attr("status",t.status),n.orderData.attr(t.schedule_time).attr(t.order_id).attr("status_color",t.status_color)):n.orderData.attr(t.schedule_time).attr(t.order_id,t)});var i={};this.orderData.each(function(e,t){e.each(function(e,n){if(!r[n]||r[n]!=e.attr("schedule_time"))i[t]=n})}),e.each(i,function(e,t){n.orderData.attr(e).removeAttr(t)})},_pollData:function(t){t||(t=!1);var n="/api/ofd";this.nanobar.go(30),e.ajax({url:n,type:"get",context:this,dataType:"json",success:function(e){this.nanobar.go(50),e.data&&(t?this._updateData(e.data):this._addData(e.data)),this.nanobar.go(100)}})},selectWashType:function(e,t,n){var r=t.parents("tr").find('input[type="number"]');r=parseInt(r.val());var i=t.parents("tr").attr("item-index"),s=this.cleaningItems.attr(i);t.hasClass("choice-laundry")?s.attr("cleaning_type","laundry"):t.hasClass("choice-dryclean")&&s.attr("cleaning_type","dry_cleaning"),this._update_total_cost()},quantityChange:function(e,t,n){var r=t.parent(),i=parseInt(t.val()),s=t.parents("tr").find(".item-cost"),o=0;if(i>-1){var u=t.parents("tr").attr("item-index"),a=this.cleaningItems.attr(u);a.attr("price.iron")||a.attr("price.iron",0),a.attr("quantity")||a.attr("quantity",{}),r.hasClass("laundry-quantity")?(a.attr("quantity.laundry")||a.attr("quantity.laundry",0),a.attr("quantity.laundry",i)):r.hasClass("dryclean-quantity")?(a.attr("quantity.dryclean")||a.attr("quantity.dryclean",0),a.attr("quantity.dryclean",i)):(a.attr("quantity.iron")||a.attr("quantity.iron",0),a.attr("quantity.iron",i));var f=a.attr("quantity.laundry")*a.attr("price.laundry")||0,l=a.attr("quantity.dryclean")*a.attr("price.dry_cleaning")||0,c=a.attr("quantity.iron")*a.attr("price.iron")||0;a.attr("final_cost",f+l+c)}this._update_total_cost(),this._update_total_quantity()},openOrderModal:function(t,n,r){var i=e(n).parents("tr").attr("index"),s=null;this.nanobar.go(30);var o=e.ajax({url:"/api/orderitem/"+i,type:"get",context:this,dataType:"json"}),u=e.ajax({url:"/api/failurereason/partial_payment",type:"get",dataType:"json"}),a=e.ajax({url:"/api/failurereason/delivery",type:"get",dataType:"json"}),f=this;e.when(o,u,a).done(function(t,n,r){t=t[0],n=n[0],r=r[0],f.deliveryFailureReasons.replace(r.data),f.failureReasons.attr(n.data),f.nanobar.go(50),f.cleaningItems.replace(t.data),t.customer_details.status=f.getStatusDetails(t.customer_details.status).attr("name_id"),f.modalCustomerDetails.attr("data",t.customer_details),f.modalCustomerDetails.attr("data.failure_reason.partial_payment")?f.modalCustomerDetails.attr("data.failure_reason.partial_payment").attr("type",""):f.modalCustomerDetails.attr("data.failure_reason.partial_payment",{type:""});var s=!0;f.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")&&(f.failureReasons.each(function(e,t){f.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason")==e.attr("str_id")&&(f.modalCustomerDetails.attr("data.failure_reason.partial_payment.reason",e.attr("str_id")),s=!1)}),s&&f.modalCustomerDetails.attr("data.failure_reason.partial_payment.type","others")),e("#ofd-details-modal").attr("index",i);var o=e("#ofd-details-modal .summernote");o.html(f.modalCustomerDetails.attr("data.remark")),e(o).summernote({height:250,focus:!0,placeholder:"Write notes!",toolbar:[["style",["style"]],["font",["bold","italic","underline","clear"]],["color",["color"]],["para",["ul","ol","paragraph"]],["insert",["link","picture","hr"]]],onChange:function(){f.modalCustomerDetails.attr("data.remark",e("#ofd-details-modal .summernote").code())}}),e("#ofd-details-modal").modal({backdrop:"static",keyboard:!1,show:!0}),f.nanobar.go(100),e("#ofd-details-modal table").focus(),f._update_total_cost(),f._update_total_quantity()})},_get_sub_total_cost:function(){var e=0;return this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")*r.attr("price.laundry")||0,s=r.attr("quantity.dryclean")*r.attr("price.dry_cleaning")||0,o=r.attr("quantity.iron")*r.attr("price.iron")||0;e+=i+s+o}),e},_update_total_quantity:function(){var e=0;this.cleaningItems.each(function(t,n){var r=t,i=r.attr("quantity.laundry")||0,s=r.attr("quantity.dryclean")||0,o=r.attr("quantity.iron")||0;e+=i+s+o}),this.total_quantity(e)},_update_total_cost:function(){var e=this._get_sub_total_cost(),t=null,n=this.modalCustomerDetails.attr("data.discount.amount")||0,r=this.modalCustomerDetails.attr("data.discount.max")||0,i=this.modalCustomerDetails.attr("data.service_type"),s=this.modalCustomerDetails.attr("data.service_tax").attr(),o=this.modalCustomerDetails.attr("data.discount.min_order")||0;this.allCosts.attr("sub_total_cost",e),this.modalCustomerDetails.attr("data.discount.percentage")?o?e>=o?t=e*n/100:t=0:t=e*n/100:o?e>=o?t=n:t=0:t=n,r&&(r=parseInt(r),t>r&&(t=r)),this.modalCustomerDetails.attr("data.discount.percentage")||this.modalCustomerDetails.attr("data.discount.amount",t);var u=e-t,a=Math.round(u*s.rate/100);this.modalCustomerDetails.attr("data.service_tax.type")=="inclusive"?this.allCosts.attr("service_tax",a):this.modalCustomerDetails.attr("data.service_tax.type")=="exclusive"&&(u+=a,this.allCosts.attr("service_tax",a));var f=this.modalCustomerDetails.attr("data.credits.available");f||(f=this.modalCustomerDetails.attr("data.user.credits"),this.modalCustomerDetails.attr("data.credits.available",f));var l=null;f>=u?l=u:l=f,u-=l,this.modalCustomerDetails.attr("data.credits.used",l),this.allCosts.attr("total_cost",Math.round(u))},changeMaxDiscount:function(t,n,r){var i=e("#ofd-details-modal .modal-discount-max-amount").val()||0;this.modalCustomerDetails.attr("data.discount.max",i),this._update_total_cost()},changeDiscount:function(t,n,r){var i=e("#ofd-details-modal .modal-discount-type li.active");this.applyDiscount(t,i,r)},applyDiscount:function(t,n,r){var i=e(n).hasClass("modal-discount-percentage"),s=e("#ofd-details-modal .modal-discount-amount").val()||0;i?this.modalCustomerDetails.attr("data.discount.percentage",!0):this.modalCustomerDetails.attr("data.discount.percentage",!1),this.modalCustomerDetails.attr("data.discount.amount",s),this._update_total_cost()},saveOrderChanges:function(t,n,r){var s=e("#ofd-details-modal").attr("index");e(n).button("loading");var o=this.modalCustomerDetails.attr("data.discount").attr(),u=this.modalCustomerDetails.attr("data.bag").attr()||{};e.ajax({url:"/api/orderitem/"+s,type:"post",context:this,data:{data:JSON.stringify(this.cleaningItems.attr()),remark:this.modalCustomerDetails.attr("data.remark"),discount:JSON.stringify(o),bag:JSON.stringify(u)},success:function(t){i.success("Saved successfully."),e(n).button("reset")},error:function(t,r,s){i.error("Saving unsuccessful. Try again."),e(n).button("reset")}})},changeBagNumber:function(t,n,r){typeof this.modalCustomerDetails.attr("data").attr("bag")=="undefined"&&this.modalCustomerDetails.attr("data").attr("bag",{}),e(n).hasClass("bag-laundry")?this.modalCustomerDetails.attr("data.bag").attr("laundry",e(n).val()):e(n).hasClass("bag-dryclean")?this.modalCustomerDetails.attr("data.bag").attr("dryclean",e(n).val()):e(n).hasClass("bag-iron")&&this.modalCustomerDetails.attr("data.bag").attr("iron",e(n).val())},changeOrderStatus:function(t,n,r){var i=e(n).val();this.modalCustomerDetails.attr("data.status",i),i!="delivery_failed"&&this.saveOrderStatus(t,n,r)},changeDeliveryFailedReason:function(t,n,r){this.modalCustomerDetails.attr("data.failure_reason.delivery")&&this.modalCustomerDetails.attr("data.failure_reason").attr("delivery",{}),this.modalCustomerDetails.attr("data.failure_reason.delivery",{full_reason:e(n).text(),reason:e(n).val()})},saveOrderStatus:function(t,n,r){var s=this.modalCustomerDetails.attr("data.status"),o=e("#ofd-details-modal").attr("index"),u={status:s};if(s=="delivery_failed"){if(!this.modalCustomerDetails.attr("data.failure_reason.delivery.reason")){i.error("No reason selected.");return}u.failure_reason=JSON.stringify({reason:this.modalCustomerDetails.attr("data.failure_reason.delivery.reason"),type:"delivery"})}e.ajax({url:"/api/order/"+o,type:"put",dataType:"json",context:this,data:u,success:function(e){this.modalCustomerDetails.attr("data.status",s),i.success("Status changed successfully!")}})},closeModal:function(t,n,r){e("#ofd-details-modal .summernote").destroy(),this.orderRefresh(),this.deliveryRescheduleOldValue.attr({},!0)},toggleRowCheck:function(t,n,r){if(e(n).find("i").hasClass("check-all")){var i=e(n).parents("table").find("button i.fa-check").parent();e(n).hasClass("btn-default")?e.each(i,function(t,n){e(n).addClass("btn-success"),e(n).removeClass("btn-default")}):e.each(i,function(t,n){e(n).removeClass("btn-success"),e(n).addClass("btn-default")})}else if(e(n).hasClass("btn-default")){e(n).addClass("btn-success"),e(n).removeClass("btn-default");var s=n.parents("tbody").find(".fa-check").parent(),o=n.parents("tbody").find(".fa-check").parents("button.btn-success");if(s.length==o.length){var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-default"),u.addClass("btn-success")}}else{e(n).removeClass("btn-success"),e(n).addClass("btn-default");var u=n.parents("table").find(".check-all").parent();u.removeClass("btn-success"),u.addClass("btn-default")}}}),helpers:e.extend(n,{multiply:function(e,t,n){return e()*t()}}),events:{"{can.route} sidebarmenu":function(e){var t=moment();e.sidebarmenu=="main-content-ofd"&&!this.scope.loaded&&(this.scope._pollData(),this.scope.loaded=!0)},"#ofd-orders .openOrderModal click":function(e,t){this.scope.openOrderModal(null,e,t)},inserted:function(){var e=this,t={format:"yyyy-mm-dd",startdate:"2014-10-22",autoclose:!0,todayBtn:!0}},".click-to-assign click":function(t,n){var r=this,s=t.parents("tr").attr("index"),o=null;r.scope.orderData.each(function(e,t){e.attr(s)&&(o=t)});var u=e('<select type="text" placeholder="Select staff">');e(t).parents("td").append(u),e(t).hide();var a=e(u).selectize({plugins:["remove_button"],valueField:"str_id",labelField:"name",searchField:["name","emp_id"],preload:!0,create:!1,dataAttr:"data-data",render:{item:function(e,t){return"<div><span>"+t(e.name)+"</span>&nbsp;"+"</div>"},option:function(e,t){return"<div><span>"+t(e.name)+" <b>("+e.emp_id+")</b>"+"</span>&nbsp;"+"</div>"}},load:function(t,n){e.ajax({url:"/api/employee",type:"get",context:this,dataType:"json",success:function(t){var i=[];e.each(t.data,function(e,t){i.push({emp_id:t.emp_id,name:t.data.name,str_id:t.str_id})}),n(i);var u=r.scope.orderData.attr(o).attr(s+".assigned_to"),a=this.$input[0].selectize;u&&a.addItem(u.str_id,!0)},error:function(e,t,r){n()}})},onItemAdd:function(e,t){}}).change(function(n){e.ajax({url:"/api/delivery",type:"put",dataType:"json",context:this,data:{order_id:s,assign_to:u.val()},success:function(n){var u=a[0].selectize;i.success("Assigned "+u.getItem(u.getValue()).text());var f={name:u.getItem(u.getValue()).text().toLowerCase().trim(),str_id:u.getValue()},l=r.scope.orderData.attr(o).attr(s);l.attr("assigned_to")||l.attr("assigned_to",{}),l.attr("assigned_to").attr("name",f.name),l.attr("assigned_to").attr("str_id",f.str_id),l.attr("status",r.scope.getStatusDetails("delivery_progress").formal_name),u.destroy(),e(t).siblings("select").remove(),e(t).show()},error:function(){i.error("Unable to update.")}})})},"#delivery-orders click":function(t,n){var r=e("#delivery-orders .click-to-assign + .selectized");if(!r.length)return!1;r.each(function(t,r){if(e(r).parents("tr").attr("index")!=e(n.target).parents("tr").attr("index")){var i=e(r).selectize();i=i[0].selectize,i.destroy(),e(r).siblings("a").show(),e(r).remove()}})}}})}),define("app/components/timeslotsBlockConf",["jquery","can","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","nanobar","toastr","datepicker","momentjs"],function(e,t,n,r,i,s){var o=r[0],u=r[1];return o.extend({tag:"timeslot-block-app",template:"",scope:u.extend({init:function(){var n=this;this.nanobar=new i({id:"mybar",bg:"#FF6600"}),this.activeEditId=t.compute(0),this.order_status=new t.Map({}),this.timeslots=new t.Map({});var r=JSON.parse(localStorage.getItem("timeslots"));e.each(r,function(e,t){n.timeslots.attr(e,t)})},allItems:new t.Map({}),loaded:!1,editingItem:new t.Map({}),selectize:{},getTimeSlots:function(){return this.timeslots},getAllItems:function(t){var n="/api/timeslot";t&&(n=n+"/"+t);var r=e.ajax({url:n,type:"get",dataType:"json",context:this,success:function(e){this.allItems.attr({},!0),this.allItems.attr(e,!0)}})},addItem:function(t,n,r){this.activeEditId(-1),e("#timeslot-block-modal").modal("show")},timeslotRefresh:function(e,t,n){this.getAllItems()},closeModal:function(t,n,r){var i=this;this.editingItem.each(function(e,t){i.editingItem.attr(t,null)}),this.selectize.type.clear(),this.selectize.slots.clear(),e("#timeslot-block-modal").modal("hide")},editItem:function(t,n,r){var i=this,s=n.attr("index"),o=e.ajax({url:"/api/timeslot/"+s,type:"get",context:this});o.done(function(t){this.activeEditId(s),e.each(t.data,function(e,t){i.editingItem.attr(e,t)}),i.selectize.type.addItem(t.data.type),e.each(t.data.slots,function(e,t){i.selectize.slots.addItem(t)}),e("#timeslot-block-modal").modal("show")})},saveItem:function(t,n,r){self=this;var i=n[0].id,o=null,u="/api/timeslot";this.activeEditId()<0?o="post":(o="put",u="/api/timeslot/"+this.activeEditId());var a=e("#timeslot-block-modal .block-slots").val()||{};a==null&&(a={}),e.ajax({url:u,type:o,dataType:"json",context:this,data:{date:e("#timeslot-block-modal .block-date").val(),type:e("#timeslot-block-modal .block-type").val(),slots:JSON.stringify(a),action:i},success:function(e){s.success("Saved successfully."),this.getAllItems(),this.closeModal(t,n,r)}})}}),events:{"{can.route} sidebarmenu":function(e){e.sidebarmenu=="main-content-configuration"&&!this.scope.loaded&&(this.scope.getAllItems(),this.scope.loaded=!0)},inserted:function(){var t=e("#timeslot-block-modal .block-slots").selectize({plugins:["remove_button"],delimiter:"|",persist:!1,create:!1}),n=e("#timeslot-block-modal .block-type").selectize({persist:!1,create:!1});this.scope.selectize={type:n[0].selectize,slots:t[0].selectize};var r=this,i={format:"yyyy-mm-dd",startDate:moment().format("YYYY-MM-DD"),autoclose:!0,immediateUpdates:!0};e("#timeslot-block-modal .block-date").datepicker(i).on("changeDate",function(t){var n=moment(e(this).datepicker("getDate"))})}}})}),d3=function(){function e(e){return null!=e&&!isNaN(e)}function t(e){return e.length}function n(e){for(var t=1;e*t%1;)t*=10;return t}function r(e,t){try{for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}catch(r){e.prototype=t}}function i(){}function s(){}function o(e,t,n){return function(){var r=n.apply(t,arguments);return r===t?e:r}}function u(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.substring(1);for(var n=0,r=cu.length;r>n;++n){var i=cu[n]+t;if(i in e)return i}}function a(){}function f(){}function l(e){function t(){for(var t,r=n,i=-1,s=r.length;++i<s;)(t=r[i].on)&&t.apply(this,arguments);return e}var n=[],r=new i;return t.on=function(t,i){var s,o=r.get(t);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,s=n.indexOf(o)).concat(n.slice(s+1)),r.remove(t)),i&&n.push(r.set(t,{on:i})),e)},t}function c(){Jo.event.preventDefault()}function h(){for(var e,t=Jo.event;e=t.sourceEvent;)t=e;return t}function p(e){for(var t=new f,n=0,r=arguments.length;++n<r;)t[arguments[n]]=l(t);return t.of=function(n,r){return function(i){try{var s=i.sourceEvent=Jo.event;i.target=e,Jo.event=i,t[i.type].apply(n,r)}finally{Jo.event=s}}},t}function d(e){return pu(e,yu),e}function v(e){return"function"==typeof e?e:function(){return du(e,this)}}function m(e){return"function"==typeof e?e:function(){return vu(e,this)}}function g(e,t){function n(){this.removeAttribute(e)}function r(){this.removeAttributeNS(e.space,e.local)}function i(){this.setAttribute(e,t)}function s(){this.setAttributeNS(e.space,e.local,t)}function o(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}function u(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}return e=Jo.ns.qualify(e),null==t?e.local?r:n:"function"==typeof t?e.local?u:o:e.local?s:i}function y(e){return e.trim().replace(/\s+/g," ")}function b(e){return new RegExp("(?:^|\\s+)"+Jo.requote(e)+"(?:\\s+|$)","g")}function w(e,t){function n(){for(var n=-1;++n<i;)e[n](this,t)}function r(){for(var n=-1,r=t.apply(this,arguments);++n<i;)e[n](this,r)}e=e.trim().split(/\s+/).map(E);var i=e.length;return"function"==typeof t?r:n}function E(e){var t=b(e);return function(n,r){if(i=n.classList)return r?i.add(e):i.remove(e);var i=n.getAttribute("class")||"";r?(t.lastIndex=0,t.test(i)||n.setAttribute("class",y(i+" "+e))):n.setAttribute("class",y(i.replace(t," ")))}}function S(e,t,n){function r(){this.style.removeProperty(e)}function i(){this.style.setProperty(e,t,n)}function s(){var r=t.apply(this,arguments);null==r?this.style.removeProperty(e):this.style.setProperty(e,r,n)}return null==t?r:"function"==typeof t?s:i}function x(e,t){function n(){delete this[e]}function r(){this[e]=t}function i(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}return null==t?n:"function"==typeof t?i:r}function T(e){return"function"==typeof e?e:(e=Jo.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,e)}}function N(e){return{__data__:e}}function C(e){return function(){return gu(this,e)}}function k(e){return arguments.length||(e=Jo.ascending),function(t,n){return t&&n?e(t.__data__,n.__data__):!t-!n}}function L(e,t){for(var n=0,r=e.length;r>n;n++)for(var i,s=e[n],o=0,u=s.length;u>o;o++)(i=s[o])&&t(i,o,n);return e}function A(e){return pu(e,wu),e}function O(e){var t,n;return function(r,i,s){var o,u=e[s].update,a=u.length;for(s!=n&&(n=s,t=0),i>=t&&(t=i+1);!(o=u[t])&&++t<a;);return o}}function M(){var e=this.__transition__;e&&++e.active}function _(e,t,n){function r(){var t=this[o];t&&(this.removeEventListener(e,t,t.$),delete this[o])}function i(){var i=f(t,Qo(arguments));r.call(this),this.addEventListener(e,this[o]=i,i.$=n),i._=t}function s(){var t,n=new RegExp("^__on([^.]+)"+Jo.requote(e)+"$");for(var r in this)if(t=r.match(n)){var i=this[r];this.removeEventListener(t[1],i,i.$),delete this[r]}}var o="__on"+e,u=e.indexOf("."),f=D;u>0&&(e=e.substring(0,u));var l=Su.get(e);return l&&(e=l,f=P),u?t?i:r:t?a:s}function D(e,t){return function(n){var r=Jo.event;Jo.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{Jo.event=r}}}function P(e,t){var n=D(e,t);return function(e){var t=this,r=e.relatedTarget;r&&(r===t||8&r.compareDocumentPosition(t))||n.call(t,e)}}function H(){var e=".dragsuppress-"+ ++Tu,t="click"+e,n=Jo.select(Zo).on("touchmove"+e,c).on("dragstart"+e,c).on("selectstart"+e,c);if(xu){var r=Yo.style,i=r[xu];r[xu]="none"}return function(s){function o(){n.on(t,null)}n.on(e,null),xu&&(r[xu]=i),s&&(n.on(t,function(){c(),o()},!0),setTimeout(o,0))}}function B(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var r=n.createSVGPoint();if(0>Nu&&(Zo.scrollX||Zo.scrollY)){n=Jo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var i=n[0][0].getScreenCTM();Nu=!i.f&&!i.e,n.remove()}return Nu?(r.x=t.pageX,r.y=t.pageY):(r.x=t.clientX,r.y=t.clientY),r=r.matrixTransform(e.getScreenCTM().inverse()),[r.x,r.y]}var s=e.getBoundingClientRect();return[t.clientX-s.left-e.clientLeft,t.clientY-s.top-e.clientTop]}function j(e){return e>0?1:0>e?-1:0}function F(e){return e>1?0:-1>e?Cu:Math.acos(e)}function I(e){return e>1?Lu:-1>e?-Lu:Math.asin(e)}function q(e){return((e=Math.exp(e))-1/e)/2}function R(e){return((e=Math.exp(e))+1/e)/2}function U(e){return((e=Math.exp(2*e))-1)/(e+1)}function z(e){return(e=Math.sin(e/2))*e}function W(){}function X(e,t,n){return new V(e,t,n)}function V(e,t,n){this.h=e,this.s=t,this.l=n}function $(e,t,n){function r(e){return e>360?e-=360:0>e&&(e+=360),60>e?s+(o-s)*e/60:180>e?o:240>e?s+(o-s)*(240-e)/60:s}function i(e){return Math.round(255*r(e))}var s,o;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:0>t?0:t>1?1:t,n=0>n?0:n>1?1:n,o=.5>=n?n*(1+t):n+t-n*t,s=2*n-o,ot(i(e+120),i(e),i(e-120))}function J(e,t,n){return new K(e,t,n)}function K(e,t,n){this.h=e,this.c=t,this.l=n}function Q(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),G(n,Math.cos(e*=Mu)*t,Math.sin(e)*t)}function G(e,t,n){return new Y(e,t,n)}function Y(e,t,n){this.l=e,this.a=t,this.b=n}function Z(e,t,n){var r=(e+16)/116,i=r+t/500,s=r-n/200;return i=tt(i)*Uu,r=tt(r)*zu,s=tt(s)*Wu,ot(rt(3.2404542*i-1.5371385*r-.4985314*s),rt(-0.969266*i+1.8760108*r+.041556*s),rt(.0556434*i-.2040259*r+1.0572252*s))}function et(e,t,n){return e>0?J(Math.atan2(n,t)*_u,Math.sqrt(t*t+n*n),e):J(0/0,0/0,e)}function tt(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function nt(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function rt(e){return Math.round(255*(.00304>=e?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function it(e){return ot(e>>16,255&e>>8,255&e)}function st(e){return it(e)+""}function ot(e,t,n){return new ut(e,t,n)}function ut(e,t,n){this.r=e,this.g=t,this.b=n}function at(e){return 16>e?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function ft(e,t,n){var r,i,s,o=0,u=0,a=0;if(r=/([a-z]+)\((.*)\)/i.exec(e))switch(i=r[2].split(","),r[1]){case"hsl":return n(parseFloat(i[0]),parseFloat(i[1])/100,parseFloat(i[2])/100);case"rgb":return t(pt(i[0]),pt(i[1]),pt(i[2]))}return(s=$u.get(e))?t(s.r,s.g,s.b):(null!=e&&"#"===e.charAt(0)&&(4===e.length?(o=e.charAt(1),o+=o,u=e.charAt(2),u+=u,a=e.charAt(3),a+=a):7===e.length&&(o=e.substring(1,3),u=e.substring(3,5),a=e.substring(5,7)),o=parseInt(o,16),u=parseInt(u,16),a=parseInt(a,16)),t(o,u,a))}function lt(e,t,n){var r,i,s=Math.min(e/=255,t/=255,n/=255),o=Math.max(e,t,n),u=o-s,a=(o+s)/2;return u?(i=.5>a?u/(o+s):u/(2-o-s),r=e==o?(t-n)/u+(n>t?6:0):t==o?(n-e)/u+2:(e-t)/u+4,r*=60):(r=0/0,i=a>0&&1>a?0:r),X(r,i,a)}function ct(e,t,n){e=ht(e),t=ht(t),n=ht(n);var r=nt((.4124564*e+.3575761*t+.1804375*n)/Uu),i=nt((.2126729*e+.7151522*t+.072175*n)/zu),s=nt((.0193339*e+.119192*t+.9503041*n)/Wu);return G(116*i-16,500*(r-i),200*(i-s))}function ht(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function pt(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function dt(e){return"function"==typeof e?e:function(){return e}}function vt(e){return e}function mt(e){return function(t,n,r){return 2===arguments.length&&"function"==typeof n&&(r=n,n=null),gt(t,n,e,r)}}function gt(e,t,n,r){function i(){var e,t=a.status;if(!t&&a.responseText||t>=200&&300>t||304===t){try{e=n.call(s,a)}catch(r){return o.error.call(s,r),void 0}o.load.call(s,e)}else o.error.call(s,a)}var s={},o=Jo.dispatch("beforesend","progress","load","error"),u={},a=new XMLHttpRequest,f=null;return!Zo.XDomainRequest||"withCredentials"in a||!/^(http(s)?:)?\/\//.test(e)||(a=new XDomainRequest),"onload"in a?a.onload=a.onerror=i:a.onreadystatechange=function(){a.readyState>3&&i()},a.onprogress=function(e){var t=Jo.event;Jo.event=e;try{o.progress.call(s,a)}finally{Jo.event=t}},s.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?u[e]:(null==t?delete u[e]:u[e]=t+"",s)},s.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",s):t},s.responseType=function(e){return arguments.length?(f=e,s):f},s.response=function(e){return n=e,s},["get","post"].forEach(function(e){s[e]=function(){return s.send.apply(s,[e].concat(Qo(arguments)))}}),s.send=function(n,r,i){if(2===arguments.length&&"function"==typeof r&&(i=r,r=null),a.open(n,e,!0),null==t||"accept"in u||(u.accept=t+",*/*"),a.setRequestHeader)for(var l in u)a.setRequestHeader(l,u[l]);return null!=t&&a.overrideMimeType&&a.overrideMimeType(t),null!=f&&(a.responseType=f),null!=i&&s.on("error",i).on("load",function(e){i(null,e)}),o.beforesend.call(s,a),a.send(null==r?null:r),s},s.abort=function(){return a.abort(),s},Jo.rebind(s,o,"on"),null==r?s:s.get(yt(r))}function yt(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function bt(){var e=wt(),t=Et()-e;t>24?(isFinite(t)&&(clearTimeout(Gu),Gu=setTimeout(bt,t)),Qu=0):(Qu=1,Zu(bt))}function wt(){var e=Date.now();for(Yu=Ju;Yu;)e>=Yu.t&&(Yu.f=Yu.c(e-Yu.t)),Yu=Yu.n;return e}function Et(){for(var e,t=Ju,n=1/0;t;)t.f?t=e?e.n=t.n:Ju=t.n:(t.t<n&&(n=t.t),t=(e=t).n);return Ku=e,n}function St(e,t){var n=Math.pow(10,3*au(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}}function xt(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function Tt(e){return e+""}function Nt(){}function Ct(e,t,n){var r=n.s=e+t,i=r-e,s=r-i;n.t=e-s+(t-i)}function kt(e,t){e&&ca.hasOwnProperty(e.type)&&ca[e.type](e,t)}function Lt(e,t,n){var r,i=-1,s=e.length-n;for(t.lineStart();++i<s;)r=e[i],t.point(r[0],r[1],r[2]);t.lineEnd()}function At(e,t){var n=-1,r=e.length;for(t.polygonStart();++n<r;)Lt(e[n],t,1);t.polygonEnd()}function Ot(){function e(e,t){e*=Mu,t=t*Mu/2+Cu/4;var n=e-r,o=Math.cos(t),u=Math.sin(t),a=s*u,f=i*o+a*Math.cos(n),l=a*Math.sin(n);pa.add(Math.atan2(l,f)),r=e,i=o,s=u}var t,n,r,i,s;da.point=function(o,u){da.point=e,r=(t=o)*Mu,i=Math.cos(u=(n=u)*Mu/2+Cu/4),s=Math.sin(u)},da.lineEnd=function(){e(t,n)}}function Mt(e){var t=e[0],n=e[1],r=Math.cos(n);return[r*Math.cos(t),r*Math.sin(t),Math.sin(n)]}function _t(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Dt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function Pt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function Ht(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function Bt(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function jt(e){return[Math.atan2(e[1],e[0]),I(e[2])]}function Ft(e,t){return au(e[0]-t[0])<Au&&au(e[1]-t[1])<Au}function It(e,t){e*=Mu;var n=Math.cos(t*=Mu);qt(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function qt(e,t,n){++va,ga+=(e-ga)/va,ya+=(t-ya)/va,ba+=(n-ba)/va}function Rt(){function e(e,i){e*=Mu;var s=Math.cos(i*=Mu),o=s*Math.cos(e),u=s*Math.sin(e),a=Math.sin(i),f=Math.atan2(Math.sqrt((f=n*a-r*u)*f+(f=r*o-t*a)*f+(f=t*u-n*o)*f),t*o+n*u+r*a);ma+=f,wa+=f*(t+(t=o)),Ea+=f*(n+(n=u)),Sa+=f*(r+(r=a)),qt(t,n,r)}var t,n,r;Ca.point=function(i,s){i*=Mu;var o=Math.cos(s*=Mu);t=o*Math.cos(i),n=o*Math.sin(i),r=Math.sin(s),Ca.point=e,qt(t,n,r)}}function Ut(){Ca.point=It}function zt(){function e(e,t){e*=Mu;var n=Math.cos(t*=Mu),o=n*Math.cos(e),u=n*Math.sin(e),a=Math.sin(t),f=i*a-s*u,l=s*o-r*a,c=r*u-i*o,h=Math.sqrt(f*f+l*l+c*c),p=r*o+i*u+s*a,d=h&&-F(p)/h,v=Math.atan2(h,p);xa+=d*f,Ta+=d*l,Na+=d*c,ma+=v,wa+=v*(r+(r=o)),Ea+=v*(i+(i=u)),Sa+=v*(s+(s=a)),qt(r,i,s)}var t,n,r,i,s;Ca.point=function(o,u){t=o,n=u,Ca.point=e,o*=Mu;var a=Math.cos(u*=Mu);r=a*Math.cos(o),i=a*Math.sin(o),s=Math.sin(u),qt(r,i,s)},Ca.lineEnd=function(){e(t,n),Ca.lineEnd=Ut,Ca.point=It}}function Wt(){return!0}function Xt(e,t,n,r,i){var s=[],o=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],r=e[t];if(Ft(n,r)){i.lineStart();for(var u=0;t>u;++u)i.point((n=e[u])[0],n[1]);return i.lineEnd(),void 0}var a=new $t(n,e,null,!0),f=new $t(n,null,a,!1);a.o=f,s.push(a),o.push(f),a=new $t(r,e,null,!1),f=new $t(r,null,a,!0),a.o=f,s.push(a),o.push(f)}}),o.sort(t),Vt(s),Vt(o),s.length){for(var u=0,a=n,f=o.length;f>u;++u)o[u].e=a=!a;for(var l,c,h=s[0];;){for(var p=h,d=!0;p.v;)if((p=p.n)===h)return;l=p.z,i.lineStart();do{if(p.v=p.o.v=!0,p.e){if(d)for(var u=0,f=l.length;f>u;++u)i.point((c=l[u])[0],c[1]);else r(p.x,p.n.x,1,i);p=p.n}else{if(d){l=p.p.z;for(var u=l.length-1;u>=0;--u)i.point((c=l[u])[0],c[1])}else r(p.x,p.p.x,-1,i);p=p.p}p=p.o,l=p.z,d=!d}while(!p.v);i.lineEnd()}}}function Vt(e){if(t=e.length){for(var t,n,r=0,i=e[0];++r<t;)i.n=n=e[r],n.p=i,i=n;i.n=n=e[0],n.p=i}}function $t(e,t,n,r){this.x=e,this.z=t,this.o=n,this.e=r,this.v=!1,this.n=this.p=null}function Jt(e,t,n,r){return function(i,s){function o(t,n){var r=i(t,n);e(t=r[0],n=r[1])&&s.point(t,n)}function u(e,t){var n=i(e,t);m.point(n[0],n[1])}function a(){y.point=u,m.lineStart()}function f(){y.point=o,m.lineEnd()}function l(e,t){v.push([e,t]);var n=i(e,t);w.point(n[0],n[1])}function c(){w.lineStart(),v=[]}function h(){l(v[0][0],v[0][1]),w.lineEnd();var e,t=w.clean(),n=b.buffer(),r=n.length;if(v.pop(),d.push(v),v=null,r){if(1&t){e=n[0];var i,r=e.length-1,o=-1;for(s.lineStart();++o<r;)s.point((i=e[o])[0],i[1]);return s.lineEnd(),void 0}r>1&&2&t&&n.push(n.pop().concat(n.shift())),p.push(n.filter(Kt))}}var p,d,v,m=t(s),g=i.invert(r[0],r[1]),y={point:o,lineStart:a,lineEnd:f,polygonStart:function(){y.point=l,y.lineStart=c,y.lineEnd=h,p=[],d=[],s.polygonStart()},polygonEnd:function(){y.point=o,y.lineStart=a,y.lineEnd=f,p=Jo.merge(p);var e=Yt(g,d);p.length?Xt(p,Gt,e,n,s):e&&(s.lineStart(),n(null,null,1,s),s.lineEnd()),s.polygonEnd(),p=d=null},sphere:function(){s.polygonStart(),s.lineStart(),n(null,null,1,s),s.lineEnd(),s.polygonEnd()}},b=Qt(),w=t(b);return y}}function Kt(e){return e.length>1}function Qt(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:a,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Gt(e,t){return((e=e.x)[0]<0?e[1]-Lu-Au:Lu-e[1])-((t=t.x)[0]<0?t[1]-Lu-Au:Lu-t[1])}function Yt(e,t){var n=e[0],r=e[1],i=[Math.sin(n),-Math.cos(n),0],s=0,o=0;pa.reset();for(var u=0,a=t.length;a>u;++u){var f=t[u],l=f.length;if(l)for(var c=f[0],h=c[0],p=c[1]/2+Cu/4,d=Math.sin(p),v=Math.cos(p),m=1;;){m===l&&(m=0),e=f[m];var g=e[0],y=e[1]/2+Cu/4,b=Math.sin(y),w=Math.cos(y),E=g-h,S=au(E)>Cu,x=d*b;if(pa.add(Math.atan2(x*Math.sin(E),v*w+x*Math.cos(E))),s+=S?E+(E>=0?ku:-ku):E,S^h>=n^g>=n){var T=Dt(Mt(c),Mt(e));Bt(T);var N=Dt(i,T);Bt(N);var C=(S^E>=0?-1:1)*I(N[2]);(r>C||r===C&&(T[0]||T[1]))&&(o+=S^E>=0?1:-1)}if(!(m++))break;h=g,d=b,v=w,c=e}}return(-Au>s||Au>s&&0>pa)^1&o}function Zt(e){var t,n=0/0,r=0/0,i=0/0;return{lineStart:function(){e.lineStart(),t=1},point:function(s,o){var u=s>0?Cu:-Cu,a=au(s-n);au(a-Cu)<Au?(e.point(n,r=(r+o)/2>0?Lu:-Lu),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),e.point(s,r),t=0):i!==u&&a>=Cu&&(au(n-i)<Au&&(n-=i*Au),au(s-u)<Au&&(s-=u*Au),r=en(n,r,s,o),e.point(i,r),e.lineEnd(),e.lineStart(),e.point(u,r),t=0),e.point(n=s,r=o),i=u},lineEnd:function(){e.lineEnd(),n=r=0/0},clean:function(){return 2-t}}}function en(e,t,n,r){var i,s,o=Math.sin(e-n);return au(o)>Au?Math.atan((Math.sin(t)*(s=Math.cos(r))*Math.sin(n)-Math.sin(r)*(i=Math.cos(t))*Math.sin(e))/(i*s*o)):(t+r)/2}function tn(e,t,n,r){var i;if(null==e)i=n*Lu,r.point(-Cu,i),r.point(0,i),r.point(Cu,i),r.point(Cu,0),r.point(Cu,-i),r.point(0,-i),r.point(-Cu,-i),r.point(-Cu,0),r.point(-Cu,i);else if(au(e[0]-t[0])>Au){var s=e[0]<t[0]?Cu:-Cu;i=n*s/2,r.point(-s,i),r.point(0,i),r.point(s,i)}else r.point(t[0],t[1])}function nn(e){function t(e,t){return Math.cos(e)*Math.cos(t)>s}function n(e){var n,s,a,f,l;return{lineStart:function(){f=a=!1,l=1},point:function(c,h){var p,d=[c,h],v=t(c,h),m=o?v?0:i(c,h):v?i(c+(0>c?Cu:-Cu),h):0;if(!n&&(f=a=v)&&e.lineStart(),v!==a&&(p=r(n,d),(Ft(n,p)||Ft(d,p))&&(d[0]+=Au,d[1]+=Au,v=t(d[0],d[1]))),v!==a)l=0,v?(e.lineStart(),p=r(d,n),e.point(p[0],p[1])):(p=r(n,d),e.point(p[0],p[1]),e.lineEnd()),n=p;else if(u&&n&&o^v){var g;m&s||!(g=r(d,n,!0))||(l=0,o?(e.lineStart(),e.point(g[0][0],g[0][1]),e.point(g[1][0],g[1][1]),e.lineEnd()):(e.point(g[1][0],g[1][1]),e.lineEnd(),e.lineStart(),e.point(g[0][0],g[0][1])))}!v||n&&Ft(n,d)||e.point(d[0],d[1]),n=d,a=v,s=m},lineEnd:function(){a&&e.lineEnd(),n=null},clean:function(){return l|(f&&a)<<1}}}function r(e,t,n){var r=Mt(e),i=Mt(t),o=[1,0,0],u=Dt(r,i),a=_t(u,u),f=u[0],l=a-f*f;if(!l)return!n&&e;var c=s*a/l,h=-s*f/l,p=Dt(o,u),d=Ht(o,c),v=Ht(u,h);Pt(d,v);var m=p,g=_t(d,m),y=_t(m,m),b=g*g-y*(_t(d,d)-1);if(!(0>b)){var w=Math.sqrt(b),E=Ht(m,(-g-w)/y);if(Pt(E,d),E=jt(E),!n)return E;var S,x=e[0],T=t[0],N=e[1],C=t[1];x>T&&(S=x,x=T,T=S);var k=T-x,L=au(k-Cu)<Au,A=L||Au>k;if(!L&&N>C&&(S=N,N=C,C=S),A?L?N+C>0^E[1]<(au(E[0]-x)<Au?N:C):N<=E[1]&&E[1]<=C:k>Cu^(x<=E[0]&&E[0]<=T)){var O=Ht(m,(-g+w)/y);return Pt(O,d),[E,jt(O)]}}}function i(t,n){var r=o?e:Cu-e,i=0;return-r>t?i|=1:t>r&&(i|=2),-r>n?i|=4:n>r&&(i|=8),i}var s=Math.cos(e),o=s>0,u=au(s)>Au,a=Mn(e,6*Mu);return Jt(t,n,a,o?[0,-e]:[-Cu,e-Cu])}function rn(e,t,n,r){return function(i){var s,o=i.a,u=i.b,a=o.x,f=o.y,l=u.x,c=u.y,h=0,p=1,d=l-a,v=c-f;if(s=e-a,d||!(s>0)){if(s/=d,0>d){if(h>s)return;p>s&&(p=s)}else if(d>0){if(s>p)return;s>h&&(h=s)}if(s=n-a,d||!(0>s)){if(s/=d,0>d){if(s>p)return;s>h&&(h=s)}else if(d>0){if(h>s)return;p>s&&(p=s)}if(s=t-f,v||!(s>0)){if(s/=v,0>v){if(h>s)return;p>s&&(p=s)}else if(v>0){if(s>p)return;s>h&&(h=s)}if(s=r-f,v||!(0>s)){if(s/=v,0>v){if(s>p)return;s>h&&(h=s)}else if(v>0){if(h>s)return;p>s&&(p=s)}return h>0&&(i.a={x:a+h*d,y:f+h*v}),1>p&&(i.b={x:a+p*d,y:f+p*v}),i}}}}}}function sn(e,t,n,r){function i(r,i){return au(r[0]-e)<Au?i>0?0:3:au(r[0]-n)<Au?i>0?2:1:au(r[1]-t)<Au?i>0?1:0:i>0?3:2}function s(e,t){return o(e.x,t.x)}function o(e,t){var n=i(e,1),r=i(t,1);return n!==r?n-r:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(u){function a(e){for(var t=0,n=g.length,r=e[1],i=0;n>i;++i)for(var s,o=1,u=g[i],a=u.length,l=u[0];a>o;++o)s=u[o],l[1]<=r?s[1]>r&&f(l,s,e)>0&&++t:s[1]<=r&&f(l,s,e)<0&&--t,l=s;return 0!==t}function f(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(n[0]-e[0])*(t[1]-e[1])}function l(s,u,a,f){var l=0,c=0;if(null==s||(l=i(s,a))!==(c=i(u,a))||o(s,u)<0^a>0){do f.point(0===l||3===l?e:n,l>1?r:t);while((l=(l+a+4)%4)!==c)}else f.point(u[0],u[1])}function c(i,s){return i>=e&&n>=i&&s>=t&&r>=s}function h(e,t){c(e,t)&&u.point(e,t)}function p(){O.point=v,g&&g.push(y=[]),N=!0,T=!1,S=x=0/0}function d(){m&&(v(b,w),E&&T&&L.rejoin(),m.push(L.buffer())),O.point=h,T&&u.lineEnd()}function v(e,t){e=Math.max(-La,Math.min(La,e)),t=Math.max(-La,Math.min(La,t));var n=c(e,t);if(g&&y.push([e,t]),N)b=e,w=t,E=n,N=!1,n&&(u.lineStart(),u.point(e,t));else if(n&&T)u.point(e,t);else{var r={a:{x:S,y:x},b:{x:e,y:t}};A(r)?(T||(u.lineStart(),u.point(r.a.x,r.a.y)),u.point(r.b.x,r.b.y),n||u.lineEnd(),C=!1):n&&(u.lineStart(),u.point(e,t),C=!1)}S=e,x=t,T=n}var m,g,y,b,w,E,S,x,T,N,C,k=u,L=Qt(),A=rn(e,t,n,r),O={point:h,lineStart:p,lineEnd:d,polygonStart:function(){u=L,m=[],g=[],C=!0},polygonEnd:function(){u=k,m=Jo.merge(m);var t=a([e,r]),n=C&&t,i=m.length;(n||i)&&(u.polygonStart(),n&&(u.lineStart(),l(null,null,1,u),u.lineEnd()),i&&Xt(m,s,t,l,u),u.polygonEnd()),m=g=y=null}};return O}}function on(e,t){function n(n,r){return n=e(n,r),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,r){return n=t.invert(n,r),n&&e.invert(n[0],n[1])}),n}function un(e){var t=0,n=Cu/3,r=xn(e),i=r(t,n);return i.parallels=function(e){return arguments.length?r(t=e[0]*Cu/180,n=e[1]*Cu/180):[180*(t/Cu),180*(n/Cu)]},i}function an(e,t){function n(e,t){var n=Math.sqrt(s-2*i*Math.sin(t))/i;return[n*Math.sin(e*=i),o-n*Math.cos(e)]}var r=Math.sin(e),i=(r+Math.sin(t))/2,s=1+r*(2*i-r),o=Math.sqrt(s)/i;return n.invert=function(e,t){var n=o-t;return[Math.atan2(e,n)/i,I((s-(e*e+n*n)*i*i)/(2*i))]},n}function fn(){function e(e,t){Oa+=i*e-r*t,r=e,i=t}var t,n,r,i;Ha.point=function(s,o){Ha.point=e,t=r=s,n=i=o},Ha.lineEnd=function(){e(t,n)}}function ln(e,t){Ma>e&&(Ma=e),e>Da&&(Da=e),_a>t&&(_a=t),t>Pa&&(Pa=t)}function cn(){function e(e,t){o.push("M",e,",",t,s)}function t(e,t){o.push("M",e,",",t),u.point=n}function n(e,t){o.push("L",e,",",t)}function r(){u.point=e}function i(){o.push("Z")}var s=hn(4.5),o=[],u={point:e,lineStart:function(){u.point=t},lineEnd:r,polygonStart:function(){u.lineEnd=i},polygonEnd:function(){u.lineEnd=r,u.point=e},pointRadius:function(e){return s=hn(e),u},result:function(){if(o.length){var e=o.join("");return o=[],e}}};return u}function hn(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+ -2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function pn(e,t){ga+=e,ya+=t,++ba}function dn(){function e(e,r){var i=e-t,s=r-n,o=Math.sqrt(i*i+s*s);wa+=o*(t+e)/2,Ea+=o*(n+r)/2,Sa+=o,pn(t=e,n=r)}var t,n;ja.point=function(r,i){ja.point=e,pn(t=r,n=i)}}function vn(){ja.point=pn}function mn(){function e(e,t){var n=e-r,s=t-i,o=Math.sqrt(n*n+s*s);wa+=o*(r+e)/2,Ea+=o*(i+t)/2,Sa+=o,o=i*e-r*t,xa+=o*(r+e),Ta+=o*(i+t),Na+=3*o,pn(r=e,i=t)}var t,n,r,i;ja.point=function(s,o){ja.point=e,pn(t=r=s,n=i=o)},ja.lineEnd=function(){e(t,n)}}function gn(e){function t(t,n){e.moveTo(t,n),e.arc(t,n,o,0,ku)}function n(t,n){e.moveTo(t,n),u.point=r}function r(t,n){e.lineTo(t,n)}function i(){u.point=t}function s(){e.closePath()}var o=4.5,u={point:t,lineStart:function(){u.point=n},lineEnd:i,polygonStart:function(){u.lineEnd=s},polygonEnd:function(){u.lineEnd=i,u.point=t},pointRadius:function(e){return o=e,u},result:a};return u}function yn(e){function t(e){return(u?r:n)(e)}function n(t){return En(t,function(n,r){n=e(n,r),t.point(n[0],n[1])})}function r(t){function n(n,r){n=e(n,r),t.point(n[0],n[1])}function r(){b=0/0,T.point=s,t.lineStart()}function s(n,r){var s=Mt([n,r]),o=e(n,r);i(b,w,y,E,S,x,b=o[0],w=o[1],y=n,E=s[0],S=s[1],x=s[2],u,t),t.point(b,w)}function o(){T.point=n,t.lineEnd()}function a(){r(),T.point=f,T.lineEnd=l}function f(e,t){s(c=e,h=t),p=b,d=w,v=E,m=S,g=x,T.point=s}function l(){i(b,w,y,E,S,x,p,d,c,v,m,g,u,t),T.lineEnd=o,o()}var c,h,p,d,v,m,g,y,b,w,E,S,x,T={point:n,lineStart:r,lineEnd:o,polygonStart:function(){t.polygonStart(),T.lineStart=a},polygonEnd:function(){t.polygonEnd(),T.lineStart=r}};return T}function i(t,n,r,u,a,f,l,c,h,p,d,v,m,g){var y=l-t,b=c-n,w=y*y+b*b;if(w>4*s&&m--){var E=u+p,S=a+d,x=f+v,T=Math.sqrt(E*E+S*S+x*x),N=Math.asin(x/=T),C=au(au(x)-1)<Au||au(r-h)<Au?(r+h)/2:Math.atan2(S,E),k=e(C,N),L=k[0],A=k[1],O=L-t,M=A-n,_=b*O-y*M;(_*_/w>s||au((y*O+b*M)/w-.5)>.3||o>u*p+a*d+f*v)&&(i(t,n,r,u,a,f,L,A,C,E/=T,S/=T,x,m,g),g.point(L,A),i(L,A,C,E,S,x,l,c,h,p,d,v,m,g))}}var s=.5,o=Math.cos(30*Mu),u=16;return t.precision=function(e){return arguments.length?(u=(s=e*e)>0&&16,t):Math.sqrt(s)},t}function bn(e){var t=yn(function(t,n){return e([t*_u,n*_u])});return function(e){return Tn(t(e))}}function wn(e){this.stream=e}function En(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function Sn(e){return xn(function(){return e})()}function xn(e){function t(e){return e=u(e[0]*Mu,e[1]*Mu),[e[0]*h+a,f-e[1]*h]}function n(e){return e=u.invert((e[0]-a)/h,(f-e[1])/h),e&&[e[0]*_u,e[1]*_u]}function r(){u=on(o=kn(g,y,b),s);var e=s(v,m);return a=p-e[0]*h,f=d+e[1]*h,i()}function i(){return l&&(l.valid=!1,l=null),t}var s,o,u,a,f,l,c=yn(function(e,t){return e=s(e,t),[e[0]*h+a,f-e[1]*h]}),h=150,p=480,d=250,v=0,m=0,g=0,y=0,b=0,w=ka,E=vt,S=null,x=null;return t.stream=function(e){return l&&(l.valid=!1),l=Tn(w(o,c(E(e)))),l.valid=!0,l},t.clipAngle=function(e){return arguments.length?(w=null==e?(S=e,ka):nn((S=+e)*Mu),i()):S},t.clipExtent=function(e){return arguments.length?(x=e,E=e?sn(e[0][0],e[0][1],e[1][0],e[1][1]):vt,i()):x},t.scale=function(e){return arguments.length?(h=+e,r()):h},t.translate=function(e){return arguments.length?(p=+e[0],d=+e[1],r()):[p,d]},t.center=function(e){return arguments.length?(v=e[0]%360*Mu,m=e[1]%360*Mu,r()):[v*_u,m*_u]},t.rotate=function(e){return arguments.length?(g=e[0]%360*Mu,y=e[1]%360*Mu,b=e.length>2?e[2]%360*Mu:0,r()):[g*_u,y*_u,b*_u]},Jo.rebind(t,c,"precision"),function(){return s=e.apply(this,arguments),t.invert=s.invert&&n,r()}}function Tn(e){return En(e,function(t,n){e.point(t*Mu,n*Mu)})}function Nn(e,t){return[e,t]}function Cn(e,t){return[e>Cu?e-ku:-Cu>e?e+ku:e,t]}function kn(e,t,n){return e?t||n?on(An(e),On(t,n)):An(e):t||n?On(t,n):Cn}function Ln(e){return function(t,n){return t+=e,[t>Cu?t-ku:-Cu>t?t+ku:t,n]}}function An(e){var t=Ln(e);return t.invert=Ln(-e),t}function On(e,t){function n(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*r+u*i;return[Math.atan2(a*s-l*o,u*r-f*i),I(l*s+a*o)]}var r=Math.cos(e),i=Math.sin(e),s=Math.cos(t),o=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),u=Math.cos(e)*n,a=Math.sin(e)*n,f=Math.sin(t),l=f*s-a*o;return[Math.atan2(a*s+f*o,u*r+l*i),I(l*r-u*i)]},n}function Mn(e,t){var n=Math.cos(e),r=Math.sin(e);return function(i,s,o,u){var a=o*t;null!=i?(i=_n(n,i),s=_n(n,s),(o>0?s>i:i>s)&&(i+=o*ku)):(i=e+o*ku,s=e-.5*a);for(var f,l=i;o>0?l>s:s>l;l-=a)u.point((f=jt([n,-r*Math.cos(l),-r*Math.sin(l)]))[0],f[1])}}function _n(e,t){var n=Mt(t);n[0]-=e,Bt(n);var r=F(-n[1]);return((-n[2]<0?-r:r)+2*Math.PI-Au)%(2*Math.PI)}function Dn(e,t,n){var r=Jo.range(e,t-Au,n).concat(t);return function(e){return r.map(function(t){return[e,t]})}}function Pn(e,t,n){var r=Jo.range(e,t-Au,n).concat(t);return function(e){return r.map(function(t){return[t,e]})}}function Hn(e){return e.source}function Bn(e){return e.target}function jn(e,t,n,r){var i=Math.cos(t),s=Math.sin(t),o=Math.cos(r),u=Math.sin(r),a=i*Math.cos(e),f=i*Math.sin(e),l=o*Math.cos(n),c=o*Math.sin(n),h=2*Math.asin(Math.sqrt(z(r-t)+i*o*z(n-e))),p=1/Math.sin(h),d=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,r=n*a+t*l,i=n*f+t*c,o=n*s+t*u;return[Math.atan2(i,r)*_u,Math.atan2(o,Math.sqrt(r*r+i*i))*_u]}:function(){return[e*_u,t*_u]};return d.distance=h,d}function Fn(){function e(e,i){var s=Math.sin(i*=Mu),o=Math.cos(i),u=au((e*=Mu)-t),a=Math.cos(u);Fa+=Math.atan2(Math.sqrt((u=o*Math.sin(u))*u+(u=r*s-n*o*a)*u),n*s+r*o*a),t=e,n=s,r=o}var t,n,r;Ia.point=function(i,s){t=i*Mu,n=Math.sin(s*=Mu),r=Math.cos(s),Ia.point=e},Ia.lineEnd=function(){Ia.point=Ia.lineEnd=a}}function In(e,t){function n(t,n){var r=Math.cos(t),i=Math.cos(n),s=e(r*i);return[s*i*Math.sin(t),s*Math.sin(n)]}return n.invert=function(e,n){var r=Math.sqrt(e*e+n*n),i=t(r),s=Math.sin(i),o=Math.cos(i);return[Math.atan2(e*s,r*o),Math.asin(r&&n*s/r)]},n}function qn(e,t){function n(e,t){var n=au(au(t)-Lu)<Au?0:o/Math.pow(i(t),s);return[n*Math.sin(s*e),o-n*Math.cos(s*e)]}var r=Math.cos(e),i=function(e){return Math.tan(Cu/4+e/2)},s=e===t?Math.sin(e):Math.log(r/Math.cos(t))/Math.log(i(t)/i(e)),o=r*Math.pow(i(e),s)/s;return s?(n.invert=function(e,t){var n=o-t,r=j(s)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/s,2*Math.atan(Math.pow(o/r,1/s))-Lu]},n):Un}function Rn(e,t){function n(e,t){var n=s-t;return[n*Math.sin(i*e),s-n*Math.cos(i*e)]}var r=Math.cos(e),i=e===t?Math.sin(e):(r-Math.cos(t))/(t-e),s=r/i+e;return au(i)<Au?Nn:(n.invert=function(e,t){var n=s-t;return[Math.atan2(e,n)/i,s-j(i)*Math.sqrt(e*e+n*n)]},n)}function Un(e,t){return[e,Math.log(Math.tan(Cu/4+t/2))]}function zn(e){var t,n=Sn(e),r=n.scale,i=n.translate,s=n.clipExtent;return n.scale=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var o=s.apply(n,arguments);if(o===n){if(t=null==e){var u=Cu*r(),a=i();s([[a[0]-u,a[1]-u],[a[0]+u,a[1]+u]])}}else t&&(o=null);return o},n.clipExtent(null)}function Wn(e,t){var n=Math.cos(t)*Math.sin(e);return[Math.log((1+n)/(1-n))/2,Math.atan2(Math.tan(t),Math.cos(e))]}function Xn(e){return e[0]}function Vn(e){return e[1]}function $n(e,t,n,r){var i,s,o,u,a,f,l;return i=r[e],s=i[0],o=i[1],i=r[t],u=i[0],a=i[1],i=r[n],f=i[0],l=i[1],(l-o)*(u-s)-(a-o)*(f-s)>0}function Jn(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function Kn(e,t,n,r){var i=e[0],s=n[0],o=t[0]-i,u=r[0]-s,a=e[1],f=n[1],l=t[1]-a,c=r[1]-f,h=(u*(a-f)-c*(i-s))/(c*o-u*l);return[i+h*o,a+h*l]}function Qn(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function Gn(){yr(this),this.edge=this.site=this.circle=null}function Yn(e){var t=Ga.pop()||new Gn;return t.site=e,t}function Zn(e){fr(e),Ja.remove(e),Ga.push(e),yr(e)}function er(e){var t=e.circle,n=t.x,r=t.cy,i={x:n,y:r},s=e.P,o=e.N,u=[e];Zn(e);for(var a=s;a.circle&&au(n-a.circle.x)<Au&&au(r-a.circle.cy)<Au;)s=a.P,u.unshift(a),Zn(a),a=s;u.unshift(a),fr(a);for(var f=o;f.circle&&au(n-f.circle.x)<Au&&au(r-f.circle.cy)<Au;)o=f.N,u.push(f),Zn(f),f=o;u.push(f),fr(f);var l,c=u.length;for(l=1;c>l;++l)f=u[l],a=u[l-1],vr(f.edge,a.site,f.site,i);a=u[0],f=u[c-1],f.edge=pr(a.site,f.site,null,i),ar(a),ar(f)}function tr(e){for(var t,n,r,i,s=e.x,o=e.y,u=Ja._;u;)if(r=nr(u,o)-s,r>Au)u=u.L;else{if(i=s-rr(u,o),!(i>Au)){r>-Au?(t=u.P,n=u):i>-Au?(t=u,n=u.N):t=n=u;break}if(!u.R){t=u;break}u=u.R}var a=Yn(e);if(Ja.insert(t,a),t||n){if(t===n)return fr(t),n=Yn(t.site),Ja.insert(a,n),a.edge=n.edge=pr(t.site,a.site),ar(t),ar(n),void 0;if(!n)return a.edge=pr(t.site,a.site),void 0;fr(t),fr(n);var f=t.site,l=f.x,c=f.y,h=e.x-l,p=e.y-c,d=n.site,v=d.x-l,m=d.y-c,g=2*(h*m-p*v),y=h*h+p*p,b=v*v+m*m,w={x:(m*y-p*b)/g+l,y:(h*b-v*y)/g+c};vr(n.edge,f,d,w),a.edge=pr(f,e,null,w),n.edge=pr(e,d,null,w),ar(t),ar(n)}}function nr(e,t){var n=e.site,r=n.x,i=n.y,s=i-t;if(!s)return r;var o=e.P;if(!o)return-1/0;n=o.site;var u=n.x,a=n.y,f=a-t;if(!f)return u;var l=u-r,c=1/s-1/f,h=l/f;return c?(-h+Math.sqrt(h*h-2*c*(l*l/(-2*f)-a+f/2+i-s/2)))/c+r:(r+u)/2}function rr(e,t){var n=e.N;if(n)return nr(n,t);var r=e.site;return r.y===t?r.x:1/0}function ir(e){this.site=e,this.edges=[]}function sr(e){for(var t,n,r,i,s,o,u,a,f,l,c=e[0][0],h=e[1][0],p=e[0][1],d=e[1][1],v=$a,m=v.length;m--;)if(s=v[m],s&&s.prepare())for(u=s.edges,a=u.length,o=0;a>o;)l=u[o].end(),r=l.x,i=l.y,f=u[++o%a].start(),t=f.x,n=f.y,(au(r-t)>Au||au(i-n)>Au)&&(u.splice(o,0,new mr(dr(s.site,l,au(r-c)<Au&&d-i>Au?{x:c,y:au(t-c)<Au?n:d}:au(i-d)<Au&&h-r>Au?{x:au(n-d)<Au?t:h,y:d}:au(r-h)<Au&&i-p>Au?{x:h,y:au(t-h)<Au?n:p}:au(i-p)<Au&&r-c>Au?{x:au(n-p)<Au?t:c,y:p}:null),s.site,null)),++a)}function or(e,t){return t.angle-e.angle}function ur(){yr(this),this.x=this.y=this.arc=this.site=this.cy=null}function ar(e){var t=e.P,n=e.N;if(t&&n){var r=t.site,i=e.site,s=n.site;if(r!==s){var o=i.x,u=i.y,a=r.x-o,f=r.y-u,l=s.x-o,c=s.y-u,h=2*(a*c-f*l);if(!(h>=-Ou)){var p=a*a+f*f,d=l*l+c*c,v=(c*p-f*d)/h,m=(a*d-l*p)/h,c=m+u,g=Ya.pop()||new ur;g.arc=e,g.site=i,g.x=v+o,g.y=c+Math.sqrt(v*v+m*m),g.cy=c,e.circle=g;for(var y=null,b=Qa._;b;)if(g.y<b.y||g.y===b.y&&g.x<=b.x){if(!b.L){y=b.P;break}b=b.L}else{if(!b.R){y=b;break}b=b.R}Qa.insert(y,g),y||(Ka=g)}}}}function fr(e){var t=e.circle;t&&(t.P||(Ka=t.N),Qa.remove(t),Ya.push(t),yr(t),e.circle=null)}function lr(e){for(var t,n=Va,r=rn(e[0][0],e[0][1],e[1][0],e[1][1]),i=n.length;i--;)t=n[i],(!cr(t,e)||!r(t)||au(t.a.x-t.b.x)<Au&&au(t.a.y-t.b.y)<Au)&&(t.a=t.b=null,n.splice(i,1))}function cr(e,t){var n=e.b;if(n)return!0;var r,i,s=e.a,o=t[0][0],u=t[1][0],a=t[0][1],f=t[1][1],l=e.l,c=e.r,h=l.x,p=l.y,d=c.x,v=c.y,m=(h+d)/2,g=(p+v)/2;if(v===p){if(o>m||m>=u)return;if(h>d){if(s){if(s.y>=f)return}else s={x:m,y:a};n={x:m,y:f}}else{if(s){if(s.y<a)return}else s={x:m,y:f};n={x:m,y:a}}}else if(r=(h-d)/(v-p),i=g-r*m,-1>r||r>1)if(h>d){if(s){if(s.y>=f)return}else s={x:(a-i)/r,y:a};n={x:(f-i)/r,y:f}}else{if(s){if(s.y<a)return}else s={x:(f-i)/r,y:f};n={x:(a-i)/r,y:a}}else if(v>p){if(s){if(s.x>=u)return}else s={x:o,y:r*o+i};n={x:u,y:r*u+i}}else{if(s){if(s.x<o)return}else s={x:u,y:r*u+i};n={x:o,y:r*o+i}}return e.a=s,e.b=n,!0}function hr(e,t){this.l=e,this.r=t,this.a=this.b=null}function pr(e,t,n,r){var i=new hr(e,t);return Va.push(i),n&&vr(i,e,t,n),r&&vr(i,t,e,r),$a[e.i].edges.push(new mr(i,e,t)),$a[t.i].edges.push(new mr(i,t,e)),i}function dr(e,t,n){var r=new hr(e,null);return r.a=t,r.b=n,Va.push(r),r}function vr(e,t,n,r){e.a||e.b?e.l===n?e.b=r:e.a=r:(e.a=r,e.l=t,e.r=n)}function mr(e,t,n){var r=e.a,i=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(i.x-r.x,r.y-i.y):Math.atan2(r.x-i.x,i.y-r.y)}function gr(){this._=null}function yr(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function br(e,t){var n=t,r=t.R,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.R=r.L,n.R&&(n.R.U=n),r.L=n}function wr(e,t){var n=t,r=t.L,i=n.U;i?i.L===n?i.L=r:i.R=r:e._=r,r.U=i,n.U=r,n.L=r.R,n.L&&(n.L.U=n),r.R=n}function Er(e){for(;e.L;)e=e.L;return e}function Sr(e,t){var n,r,i,s=e.sort(xr).pop();for(Va=[],$a=new Array(e.length),Ja=new gr,Qa=new gr;;)if(i=Ka,s&&(!i||s.y<i.y||s.y===i.y&&s.x<i.x))(s.x!==n||s.y!==r)&&($a[s.i]=new ir(s),tr(s),n=s.x,r=s.y),s=e.pop();else{if(!i)break;er(i.arc)}t&&(lr(t),sr(t));var o={cells:$a,edges:Va};return Ja=Qa=Va=$a=null,o}function xr(e,t){return t.y-e.y||t.x-e.x}function Tr(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function Nr(e){return e.x}function Cr(e){return e.y}function kr(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function Lr(e,t,n,r,i,s){if(!e(t,n,r,i,s)){var o=.5*(n+i),u=.5*(r+s),a=t.nodes;a[0]&&Lr(e,a[0],n,r,o,u),a[1]&&Lr(e,a[1],o,r,i,u),a[2]&&Lr(e,a[2],n,u,o,s),a[3]&&Lr(e,a[3],o,u,i,s)}}function Ar(e,t){e=Jo.rgb(e),t=Jo.rgb(t);var n=e.r,r=e.g,i=e.b,s=t.r-n,o=t.g-r,u=t.b-i;return function(e){return"#"+at(Math.round(n+s*e))+at(Math.round(r+o*e))+at(Math.round(i+u*e))}}function Or(e,t){var n,r={},i={};for(n in e)n in t?r[n]=Dr(e[n],t[n]):i[n]=e[n];for(n in t)n in e||(i[n]=t[n]);return function(e){for(n in r)i[n]=r[n](e);return i}}function Mr(e,t){return t-=e=+e,function(n){return e+t*n}}function _r(e,t){var n,r,i,s,o,u=0,a=0,f=[],l=[];for(e+="",t+="",ef.lastIndex=0,r=0;n=ef.exec(t);++r)n.index&&f.push(t.substring(u,a=n.index)),l.push({i:f.length,x:n[0]}),f.push(null),u=ef.lastIndex;for(u<t.length&&f.push(t.substring(u)),r=0,s=l.length;(n=ef.exec(e))&&s>r;++r)if(o=l[r],o.x==n[0]){if(o.i)if(null==f[o.i+1])for(f[o.i-1]+=o.x,f.splice(o.i,1),i=r+1;s>i;++i)l[i].i--;else for(f[o.i-1]+=o.x+f[o.i+1],f.splice(o.i,2),i=r+1;s>i;++i)l[i].i-=2;else if(null==f[o.i+1])f[o.i]=o.x;else for(f[o.i]=o.x+f[o.i+1],f.splice(o.i+1,1),i=r+1;s>i;++i)l[i].i--;l.splice(r,1),s--,r--}else o.x=Mr(parseFloat(n[0]),parseFloat(o.x));for(;s>r;)o=l.pop(),null==f[o.i+1]?f[o.i]=o.x:(f[o.i]=o.x+f[o.i+1],f.splice(o.i+1,1)),s--;return 1===f.length?null==f[0]?(o=l[0].x,function(e){return o(e)+""}):function(){return t}:function(e){for(r=0;s>r;++r)f[(o=l[r]).i]=o.x(e);return f.join("")}}function Dr(e,t){for(var n,r=Jo.interpolators.length;--r>=0&&!(n=Jo.interpolators[r](e,t)););return n}function Pr(e,t){var n,r=[],i=[],s=e.length,o=t.length,u=Math.min(e.length,t.length);for(n=0;u>n;++n)r.push(Dr(e[n],t[n]));for(;s>n;++n)i[n]=e[n];for(;o>n;++n)i[n]=t[n];return function(e){for(n=0;u>n;++n)i[n]=r[n](e);return i}}function Hr(e){return function(t){return 0>=t?0:t>=1?1:e(t)}}function Br(e){return function(t){return 1-e(1-t)}}function jr(e){return function(t){return.5*(.5>t?e(2*t):2-e(2-2*t))}}function Fr(e){return e*e}function Ir(e){return e*e*e}function qr(e){if(0>=e)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(.5>e?n:3*(e-t)+n-.75)}function Rr(e){return function(t){return Math.pow(t,e)}}function Ur(e){return 1-Math.cos(e*Lu)}function zr(e){return Math.pow(2,10*(e-1))}function Wr(e){return 1-Math.sqrt(1-e*e)}function Xr(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/ku*Math.asin(1/e):(e=1,n=t/4),function(r){return 1+e*Math.pow(2,-10*r)*Math.sin((r-n)*ku/t)}}function Vr(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}}function $r(e){return 1/2.75>e?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Jr(e,t){e=Jo.hcl(e),t=Jo.hcl(t);var n=e.h,r=e.c,i=e.l,s=t.h-n,o=t.c-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.c:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return Q(n+s*e,r+o*e,i+u*e)+""}}function Kr(e,t){e=Jo.hsl(e),t=Jo.hsl(t);var n=e.h,r=e.s,i=e.l,s=t.h-n,o=t.s-r,u=t.l-i;return isNaN(o)&&(o=0,r=isNaN(r)?t.s:r),isNaN(s)?(s=0,n=isNaN(n)?t.h:n):s>180?s-=360:-180>s&&(s+=360),function(e){return $(n+s*e,r+o*e,i+u*e)+""}}function Qr(e,t){e=Jo.lab(e),t=Jo.lab(t);var n=e.l,r=e.a,i=e.b,s=t.l-n,o=t.a-r,u=t.b-i;return function(e){return Z(n+s*e,r+o*e,i+u*e)+""}}function Gr(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function Yr(e){var t=[e.a,e.b],n=[e.c,e.d],r=ei(t),i=Zr(t,n),s=ei(ti(n,t,-i))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,r*=-1,i*=-1),this.rotate=(r?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*_u,this.translate=[e.e,e.f],this.scale=[r,s],this.skew=s?Math.atan2(i,s)*_u:0}function Zr(e,t){return e[0]*t[0]+e[1]*t[1]}function ei(e){var t=Math.sqrt(Zr(e,e));return t&&(e[0]/=t,e[1]/=t),t}function ti(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function ni(e,t){var n,r=[],i=[],s=Jo.transform(e),o=Jo.transform(t),u=s.translate,a=o.translate,f=s.rotate,l=o.rotate,c=s.skew,h=o.skew,p=s.scale,d=o.scale;return u[0]!=a[0]||u[1]!=a[1]?(r.push("translate(",null,",",null,")"),i.push({i:1,x:Mr(u[0],a[0])},{i:3,x:Mr(u[1],a[1])})):a[0]||a[1]?r.push("translate("+a+")"):r.push(""),f!=l?(f-l>180?l+=360:l-f>180&&(f+=360),i.push({i:r.push(r.pop()+"rotate(",null,")")-2,x:Mr(f,l)})):l&&r.push(r.pop()+"rotate("+l+")"),c!=h?i.push({i:r.push(r.pop()+"skewX(",null,")")-2,x:Mr(c,h)}):h&&r.push(r.pop()+"skewX("+h+")"),p[0]!=d[0]||p[1]!=d[1]?(n=r.push(r.pop()+"scale(",null,",",null,")"),i.push({i:n-4,x:Mr(p[0],d[0])},{i:n-2,x:Mr(p[1],d[1])})):(1!=d[0]||1!=d[1])&&r.push(r.pop()+"scale("+d+")"),n=i.length,function(e){for(var t,s=-1;++s<n;)r[(t=i[s]).i]=t.x(e);return r.join("")}}function ri(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return(n-e)*t}}function ii(e,t){return t=t-(e=+e)?1/(t-e):0,function(n){return Math.max(0,Math.min(1,(n-e)*t))}}function si(e){for(var t=e.source,n=e.target,r=ui(t,n),i=[t];t!==r;)t=t.parent,i.push(t);for(var s=i.length;n!==r;)i.splice(s,0,n),n=n.parent;return i}function oi(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function ui(e,t){if(e===t)return e;for(var n=oi(e),r=oi(t),i=n.pop(),s=r.pop(),o=null;i===s;)o=i,i=n.pop(),s=r.pop();return o}function ai(e){e.fixed|=2}function fi(e){e.fixed&=-7}function li(e){e.fixed|=4,e.px=e.x,e.py=e.y}function ci(e){e.fixed&=-5}function hi(e,t,n){var r=0,i=0;if(e.charge=0,!e.leaf)for(var s,o=e.nodes,u=o.length,a=-1;++a<u;)s=o[a],null!=s&&(hi(s,t,n),e.charge+=s.charge,r+=s.charge*s.cx,i+=s.charge*s.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var f=t*n[e.point.index];e.charge+=e.pointCharge=f,r+=f*e.point.x,i+=f*e.point.y}e.cx=r/e.charge,e.cy=i/e.charge}function pi(e,t){return Jo.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=gi,e}function di(e){return e.children}function vi(e){return e.value}function mi(e,t){return t.value-e.value}function gi(e){return Jo.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function yi(e){return e.x}function bi(e){return e.y}function wi(e,t,n){e.y0=t,e.y=n}function Ei(e){return Jo.range(e.length)}function Si(e){for(var t=-1,n=e[0].length,r=[];++t<n;)r[t]=0;return r}function xi(e){for(var t,n=1,r=0,i=e[0][1],s=e.length;s>n;++n)(t=e[n][1])>i&&(r=n,i=t);return r}function Ti(e){return e.reduce(Ni,0)}function Ni(e,t){return e+t[1]}function Ci(e,t){return ki(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function ki(e,t){for(var n=-1,r=+e[0],i=(e[1]-r)/t,s=[];++n<=t;)s[n]=i*n+r;return s}function Li(e){return[Jo.min(e),Jo.max(e)]}function Ai(e,t){return e.parent==t.parent?1:2}function Oi(e){var t=e.children;return t&&t.length?t[0]:e._tree.thread}function Mi(e){var t,n=e.children;return n&&(t=n.length)?n[t-1]:e._tree.thread}function _i(e,t){var n=e.children;if(n&&(i=n.length))for(var r,i,s=-1;++s<i;)t(r=_i(n[s],t),e)>0&&(e=r);return e}function Di(e,t){return e.x-t.x}function Pi(e,t){return t.x-e.x}function Hi(e,t){return e.depth-t.depth}function Bi(e,t){function n(e,r){var i=e.children;if(i&&(o=i.length))for(var s,o,u=null,a=-1;++a<o;)s=i[a],n(s,u),u=s;t(e,r)}n(e,null)}function ji(e){for(var t,n=0,r=0,i=e.children,s=i.length;--s>=0;)t=i[s]._tree,t.prelim+=n,t.mod+=n,n+=t.shift+(r+=t.change)}function Fi(e,t,n){e=e._tree,t=t._tree;var r=n/(t.number-e.number);e.change+=r,t.change-=r,t.shift+=n,t.prelim+=n,t.mod+=n}function Ii(e,t,n){return e._tree.ancestor.parent==t.parent?e._tree.ancestor:n}function qi(e,t){return e.value-t.value}function Ri(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function Ui(e,t){e._pack_next=t,t._pack_prev=e}function zi(e,t){var n=t.x-e.x,r=t.y-e.y,i=e.r+t.r;return.999*i*i>n*n+r*r}function Wi(e){function t(e){l=Math.min(e.x-e.r,l),c=Math.max(e.x+e.r,c),h=Math.min(e.y-e.r,h),p=Math.max(e.y+e.r,p)}if((n=e.children)&&(f=n.length)){var n,r,i,s,o,u,a,f,l=1/0,c=-1/0,h=1/0,p=-1/0;if(n.forEach(Xi),r=n[0],r.x=-r.r,r.y=0,t(r),f>1&&(i=n[1],i.x=i.r,i.y=0,t(i),f>2))for(s=n[2],Ji(r,i,s),t(s),Ri(r,s),r._pack_prev=s,Ri(s,i),i=r._pack_next,o=3;f>o;o++){Ji(r,i,s=n[o]);var d=0,v=1,m=1;for(u=i._pack_next;u!==i;u=u._pack_next,v++)if(zi(u,s)){d=1;break}if(1==d)for(a=r._pack_prev;a!==u._pack_prev&&!zi(a,s);a=a._pack_prev,m++);d?(m>v||v==m&&i.r<r.r?Ui(r,i=u):Ui(r=a,i),o--):(Ri(r,s),i=s,t(s))}var g=(l+c)/2,y=(h+p)/2,b=0;for(o=0;f>o;o++)s=n[o],s.x-=g,s.y-=y,b=Math.max(b,s.r+Math.sqrt(s.x*s.x+s.y*s.y));e.r=b,n.forEach(Vi)}}function Xi(e){e._pack_next=e._pack_prev=e}function Vi(e){delete e._pack_next,delete e._pack_prev}function $i(e,t,n,r){var i=e.children;if(e.x=t+=r*e.x,e.y=n+=r*e.y,e.r*=r,i)for(var s=-1,o=i.length;++s<o;)$i(i[s],t,n,r)}function Ji(e,t,n){var r=e.r+n.r,i=t.x-e.x,s=t.y-e.y;if(r&&(i||s)){var o=t.r+n.r,u=i*i+s*s;o*=o,r*=r;var a=.5+(r-o)/(2*u),f=Math.sqrt(Math.max(0,2*o*(r+u)-(r-=u)*r-o*o))/(2*u);n.x=e.x+a*i+f*s,n.y=e.y+a*s-f*i}else n.x=e.x+r,n.y=e.y}function Ki(e){return 1+Jo.max(e,function(e){return e.y})}function Qi(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function Gi(e){var t=e.children;return t&&t.length?Gi(t[0]):e}function Yi(e){var t,n=e.children;return n&&(t=n.length)?Yi(n[t-1]):e}function Zi(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function es(e,t){var n=e.x+t[3],r=e.y+t[0],i=e.dx-t[1]-t[3],s=e.dy-t[0]-t[2];return 0>i&&(n+=i/2,i=0),0>s&&(r+=s/2,s=0),{x:n,y:r,dx:i,dy:s}}function ts(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function ns(e){return e.rangeExtent?e.rangeExtent():ts(e.range())}function rs(e,t,n,r){var i=n(e[0],e[1]),s=r(t[0],t[1]);return function(e){return s(i(e))}}function is(e,t){var n,r=0,i=e.length-1,s=e[r],o=e[i];return s>o&&(n=r,r=i,i=n,n=s,s=o,o=n),e[r]=t.floor(s),e[i]=t.ceil(o),e}function ss(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:cf}function os(e,t,n,r){var i=[],s=[],o=0,u=Math.min(e.length,t.length)-1;for(e[u]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<=u;)i.push(n(e[o-1],e[o])),s.push(r(t[o-1],t[o]));return function(t){var n=Jo.bisect(e,t,1,u)-1;return s[n](i[n](t))}}function us(e,t,n,r){function i(){var i=Math.min(e.length,t.length)>2?os:rs,a=r?ii:ri;return o=i(e,t,a,n),u=i(t,e,a,Dr),s}function s(e){return o(e)}var o,u;return s.invert=function(e){return u(e)},s.domain=function(t){return arguments.length?(e=t.map(Number),i()):e},s.range=function(e){return arguments.length?(t=e,i()):t},s.rangeRound=function(e){return s.range(e).interpolate(Gr)},s.clamp=function(e){return arguments.length?(r=e,i()):r},s.interpolate=function(e){return arguments.length?(n=e,i()):n},s.ticks=function(t){return cs(e,t)},s.tickFormat=function(t,n){return hs(e,t,n)},s.nice=function(t){return fs(e,t),i()},s.copy=function(){return us(e,t,n,r)},i()}function as(e,t){return Jo.rebind(e,t,"range","rangeRound","interpolate","clamp")}function fs(e,t){return is(e,ss(ls(e,t)[2]))}function ls(e,t){null==t&&(t=10);var n=ts(e),r=n[1]-n[0],i=Math.pow(10,Math.floor(Math.log(r/t)/Math.LN10)),s=t/r*i;return.15>=s?i*=10:.35>=s?i*=5:.75>=s&&(i*=2),n[0]=Math.ceil(n[0]/i)*i,n[1]=Math.floor(n[1]/i)*i+.5*i,n[2]=i,n}function cs(e,t){return Jo.range.apply(Jo,ls(e,t))}function hs(e,t,n){var r=ls(e,t);return Jo.format(n?n.replace(sa,function(e,t,n,i,s,o,u,a,f,l){return[t,n,i,s,o,u,a,f||"."+ds(l,r),l].join("")}):",."+ps(r[2])+"f")}function ps(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function ds(e,t){var n=ps(t[2]);return e in hf?Math.abs(n-ps(Math.max(Math.abs(t[0]),Math.abs(t[1]))))+ +("e"!==e):n-2*("%"===e)}function vs(e,t,n,r){function i(e){return(n?Math.log(0>e?0:e):-Math.log(e>0?0:-e))/Math.log(t)}function s(e){return n?Math.pow(t,e):-Math.pow(t,-e)}function o(t){return e(i(t))}return o.invert=function(t){return s(e.invert(t))},o.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((r=t.map(Number)).map(i)),o):r},o.base=function(n){return arguments.length?(t=+n,e.domain(r.map(i)),o):t},o.nice=function(){var t=is(r.map(i),n?Math:df);return e.domain(t),r=t.map(s),o},o.ticks=function(){var e=ts(r),o=[],u=e[0],a=e[1],f=Math.floor(i(u)),l=Math.ceil(i(a)),c=t%1?2:t;if(isFinite(l-f)){if(n){for(;l>f;f++)for(var h=1;c>h;h++)o.push(s(f)*h);o.push(s(f))}else for(o.push(s(f));f++<l;)for(var h=c-1;h>0;h--)o.push(s(f)*h);for(f=0;o[f]<u;f++);for(l=o.length;o[l-1]>a;l--);o=o.slice(f,l)}return o},o.tickFormat=function(e,t){if(!arguments.length)return pf;arguments.length<2?t=pf:"function"!=typeof t&&(t=Jo.format(t));var r,u=Math.max(.1,e/o.ticks().length),a=n?(r=1e-12,Math.ceil):(r=-1e-12,Math.floor);return function(e){return e/s(a(i(e)+r))<=u?t(e):""}},o.copy=function(){return vs(e.copy(),t,n,r)},as(o,e)}function ms(e,t,n){function r(t){return e(i(t))}var i=gs(t),s=gs(1/t);return r.invert=function(t){return s(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(i)),r):n},r.ticks=function(e){return cs(n,e)},r.tickFormat=function(e,t){return hs(n,e,t)},r.nice=function(e){return r.domain(fs(n,e))},r.exponent=function(o){return arguments.length?(i=gs(t=o),s=gs(1/t),e.domain(n.map(i)),r):t},r.copy=function(){return ms(e.copy(),t,n)},as(r,e)}function gs(e){return function(t){return 0>t?-Math.pow(-t,e):Math.pow(t,e)}}function ys(e,t){function n(n){return o[((s.get(n)||"range"===t.t&&s.set(n,e.push(n)))-1)%o.length]}function r(t,n){return Jo.range(e.length).map(function(e){return t+n*e})}var s,o,u;return n.domain=function(r){if(!arguments.length)return e;e=[],s=new i;for(var o,u=-1,a=r.length;++u<a;)s.has(o=r[u])||s.set(o,e.push(o));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(o=e,u=0,t={t:"range",a:arguments},n):o},n.rangePoints=function(i,s){arguments.length<2&&(s=0);var a=i[0],f=i[1],l=(f-a)/(Math.max(1,e.length-1)+s);return o=r(e.length<2?(a+f)/2:a+l*s/2,l),u=0,t={t:"rangePoints",a:arguments},n},n.rangeBands=function(i,s,a){arguments.length<2&&(s=0),arguments.length<3&&(a=s);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=(c-l)/(e.length-s+2*a);return o=r(l+h*a,h),f&&o.reverse(),u=h*(1-s),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(i,s,a){arguments.length<2&&(s=0),arguments.length<3&&(a=s);var f=i[1]<i[0],l=i[f-0],c=i[1-f],h=Math.floor((c-l)/(e.length-s+2*a)),p=c-l-(e.length-s)*h;return o=r(l+Math.round(p/2),h),f&&o.reverse(),u=Math.round(h*(1-s)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return u},n.rangeExtent=function(){return ts(t.a[0])},n.copy=function(){return ys(e,t)},n.domain(e)}function bs(e,t){function n(){var n=0,s=t.length;for(i=[];++n<s;)i[n-1]=Jo.quantile(e,n/s);return r}function r(e){return isNaN(e=+e)?void 0:t[Jo.bisect(i,e)]}var i;return r.domain=function(t){return arguments.length?(e=t.filter(function(e){return!isNaN(e)}).sort(Jo.ascending),n()):e},r.range=function(e){return arguments.length?(t=e,n()):t},r.quantiles=function(){return i},r.invertExtent=function(n){return n=t.indexOf(n),0>n?[0/0,0/0]:[n>0?i[n-1]:e[0],n<i.length?i[n]:e[e.length-1]]},r.copy=function(){return bs(e,t)},n()}function ws(e,t,n){function r(t){return n[Math.max(0,Math.min(o,Math.floor(s*(t-e))))]}function i(){return s=n.length/(t-e),o=n.length-1,r}var s,o;return r.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],i()):[e,t]},r.range=function(e){return arguments.length?(n=e,i()):n},r.invertExtent=function(t){return t=n.indexOf(t),t=0>t?0/0:t/s+e,[t,t+1/s]},r.copy=function(){return ws(e,t,n)},i()}function Es(e,t){function n(n){return n>=n?t[Jo.bisect(e,n)]:void 0}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]]},n.copy=function(){return Es(e,t)},n}function Ss(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return cs(e,t)},t.tickFormat=function(t,n){return hs(e,t,n)},t.copy=function(){return Ss(e)},t}function xs(e){return e.innerRadius}function Ts(e){return e.outerRadius}function Ns(e){return e.startAngle}function Cs(e){return e.endAngle}function ks(e){function t(t){function o(){f.push("M",s(e(l),u))}for(var a,f=[],l=[],c=-1,h=t.length,p=dt(n),d=dt(r);++c<h;)i.call(this,a=t[c],c)?l.push([+p.call(this,a,c),+d.call(this,a,c)]):l.length&&(o(),l=[]);return l.length&&o(),f.length?f.join(""):null}var n=Xn,r=Vn,i=Wt,s=Ls,o=s.key,u=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t.defined=function(e){return arguments.length?(i=e,t):i},t.interpolate=function(e){return arguments.length?(o="function"==typeof e?s=e:(s=Ef.get(e)||Ls).key,t):o},t.tension=function(e){return arguments.length?(u=e,t):u},t}function Ls(e){return e.join("L")}function As(e){return Ls(e)+"Z"}function Os(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("H",(r[0]+(r=e[t])[0])/2,"V",r[1]);return n>1&&i.push("H",r[0]),i.join("")}function Ms(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("V",(r=e[t])[1],"H",r[0]);return i.join("")}function _s(e){for(var t=0,n=e.length,r=e[0],i=[r[0],",",r[1]];++t<n;)i.push("H",(r=e[t])[0],"V",r[1]);return i.join("")}function Ds(e,t){return e.length<4?Ls(e):e[1]+Bs(e.slice(1,e.length-1),js(e,t))}function Ps(e,t){return e.length<3?Ls(e):e[0]+Bs((e.push(e[0]),e),js([e[e.length-2]].concat(e,[e[1]]),t))}function Hs(e,t){return e.length<3?Ls(e):e[0]+Bs(e,js(e,t))}function Bs(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return Ls(e);var n=e.length!=t.length,r="",i=e[0],s=e[1],o=t[0],u=o,a=1;if(n&&(r+="Q"+(s[0]-2*o[0]/3)+","+(s[1]-2*o[1]/3)+","+s[0]+","+s[1],i=e[1],a=2),t.length>1){u=t[1],s=e[a],a++,r+="C"+(i[0]+o[0])+","+(i[1]+o[1])+","+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1];for(var f=2;f<t.length;f++,a++)s=e[a],u=t[f],r+="S"+(s[0]-u[0])+","+(s[1]-u[1])+","+s[0]+","+s[1]}if(n){var l=e[a];r+="Q"+(s[0]+2*u[0]/3)+","+(s[1]+2*u[1]/3)+","+l[0]+","+l[1]}return r}function js(e,t){for(var n,r=[],i=(1-t)/2,s=e[0],o=e[1],u=1,a=e.length;++u<a;)n=s,s=o,o=e[u],r.push([i*(o[0]-n[0]),i*(o[1]-n[1])]);return r}function Fs(e){if(e.length<3)return Ls(e);var t=1,n=e.length,r=e[0],i=r[0],s=r[1],o=[i,i,i,(r=e[1])[0]],u=[s,s,s,r[1]],a=[i,",",s,"L",Us(Tf,o),",",Us(Tf,u)];for(e.push(e[n-1]);++t<=n;)r=e[t],o.shift(),o.push(r[0]),u.shift(),u.push(r[1]),zs(a,o,u);return e.pop(),a.push("L",r),a.join("")}function Is(e){if(e.length<4)return Ls(e);for(var t,n=[],r=-1,i=e.length,s=[0],o=[0];++r<3;)t=e[r],s.push(t[0]),o.push(t[1]);for(n.push(Us(Tf,s)+","+Us(Tf,o)),--r;++r<i;)t=e[r],s.shift(),s.push(t[0]),o.shift(),o.push(t[1]),zs(n,s,o);return n.join("")}function qs(e){for(var t,n,r=-1,i=e.length,s=i+4,o=[],u=[];++r<4;)n=e[r%i],o.push(n[0]),u.push(n[1]);for(t=[Us(Tf,o),",",Us(Tf,u)],--r;++r<s;)n=e[r%i],o.shift(),o.push(n[0]),u.shift(),u.push(n[1]),zs(t,o,u);return t.join("")}function Rs(e,t){var n=e.length-1;if(n)for(var r,i,s=e[0][0],o=e[0][1],u=e[n][0]-s,a=e[n][1]-o,f=-1;++f<=n;)r=e[f],i=f/n,r[0]=t*r[0]+(1-t)*(s+i*u),r[1]=t*r[1]+(1-t)*(o+i*a);return Fs(e)}function Us(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function zs(e,t,n){e.push("C",Us(Sf,t),",",Us(Sf,n),",",Us(xf,t),",",Us(xf,n),",",Us(Tf,t),",",Us(Tf,n))}function Ws(e,t){return(t[1]-e[1])/(t[0]-e[0])}function Xs(e){for(var t=0,n=e.length-1,r=[],i=e[0],s=e[1],o=r[0]=Ws(i,s);++t<n;)r[t]=(o+(o=Ws(i=s,s=e[t+1])))/2;return r[t]=o,r}function Vs(e){for(var t,n,r,i,s=[],o=Xs(e),u=-1,a=e.length-1;++u<a;)t=Ws(e[u],e[u+1]),au(t)<Au?o[u]=o[u+1]=0:(n=o[u]/t,r=o[u+1]/t,i=n*n+r*r,i>9&&(i=3*t/Math.sqrt(i),o[u]=i*n,o[u+1]=i*r));for(u=-1;++u<=a;)i=(e[Math.min(a,u+1)][0]-e[Math.max(0,u-1)][0])/(6*(1+o[u]*o[u])),s.push([i||0,o[u]*i||0]);return s}function $s(e){return e.length<3?Ls(e):e[0]+Bs(e,Vs(e))}function Js(e){for(var t,n,r,i=-1,s=e.length;++i<s;)t=e[i],n=t[0],r=t[1]+bf,t[0]=n*Math.cos(r),t[1]=n*Math.sin(r);return e}function Ks(e){function t(t){function a(){v.push("M",u(e(g),c),l,f(e(m.reverse()),c),"Z")}for(var h,p,d,v=[],m=[],g=[],y=-1,b=t.length,w=dt(n),E=dt(i),S=n===r?function(){return p}:dt(r),x=i===s?function(){return d}:dt(s);++y<b;)o.call(this,h=t[y],y)?(m.push([p=+w.call(this,h,y),d=+E.call(this,h,y)]),g.push([+S.call(this,h,y),+x.call(this,h,y)])):m.length&&(a(),m=[],g=[]);return m.length&&a(),v.length?v.join(""):null}var n=Xn,r=Xn,i=0,s=Vn,o=Wt,u=Ls,a=u.key,f=u,l="L",c=.7;return t.x=function(e){return arguments.length?(n=r=e,t):r},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(r=e,t):r},t.y=function(e){return arguments.length?(i=s=e,t):s},t.y0=function(e){return arguments.length?(i=e,t):i},t.y1=function(e){return arguments.length?(s=e,t):s},t.defined=function(e){return arguments.length?(o=e,t):o},t.interpolate=function(e){return arguments.length?(a="function"==typeof e?u=e:(u=Ef.get(e)||Ls).key,f=u.reverse||u,l=u.closed?"M":"L",t):a},t.tension=function(e){return arguments.length?(c=e,t):c},t}function Qs(e){return e.radius}function Gs(e){return[e.x,e.y]}function Ys(e){return function(){var t=e.apply(this,arguments),n=t[0],r=t[1]+bf;return[n*Math.cos(r),n*Math.sin(r)]}}function Zs(){return 64}function eo(){return"circle"}function to(e){var t=Math.sqrt(e/Cu);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+ -t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function no(e,t){return pu(e,Of),e.id=t,e}function ro(e,t,n,r){var i=e.id;return L(e,"function"==typeof n?function(e,s,o){e.__transition__[i].tween.set(t,r(n.call(e,e.__data__,s,o)))}:(n=r(n),function(e){e.__transition__[i].tween.set(t,n)}))}function io(e){return null==e&&(e=""),function(){this.textContent=e}}function so(e,t,n,r){var s=e.__transition__||(e.__transition__={active:0,count:0}),o=s[n];if(!o){var u=r.time;o=s[n]={tween:new i,time:u,ease:r.ease,delay:r.delay,duration:r.duration},++s.count,Jo.timer(function(r){function i(r){return s.active>n?f():(s.active=n,o.event&&o.event.start.call(e,l,t),o.tween.forEach(function(n,r){(r=r.call(e,l,t))&&v.push(r)}),Jo.timer(function(){return d.c=a(r||1)?Wt:a,1},0,u),void 0)}function a(r){if(s.active!==n)return f();for(var i=r/p,u=c(i),a=v.length;a>0;)v[--a].call(e,u);return i>=1?(o.event&&o.event.end.call(e,l,t),f()):void 0}function f(){return--s.count?delete s[n]:delete e.__transition__,1}var l=e.__data__,c=o.ease,h=o.delay,p=o.duration,d=Yu,v=[];return d.t=h+u,r>=h?i(r-h):(d.c=i,void 0)},0,u)}}function oo(e,t){e.attr("transform",function(e){return"translate("+t(e)+",0)"})}function uo(e,t){e.attr("transform",function(e){return"translate(0,"+t(e)+")"})}function ao(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function fo(e,t,n){function r(t){var n=e(t),r=s(n,1);return r-t>t-n?n:r}function i(n){return t(n=e(new jf(n-1)),1),n}function s(e,n){return t(e=new jf(+e),n),e}function o(e,r,s){var o=i(e),u=[];if(s>1)for(;r>o;)n(o)%s||u.push(new Date(+o)),t(o,1);else for(;r>o;)u.push(new Date(+o)),t(o,1);return u}function u(e,t,n){try{jf=ao;var r=new ao;return r._=e,o(r,t,n)}finally{jf=Date}}e.floor=e,e.round=r,e.ceil=i,e.offset=s,e.range=o;var a=e.utc=lo(e);return a.floor=a,a.round=lo(r),a.ceil=lo(i),a.offset=lo(s),a.range=u,e}function lo(e){return function(t,n){try{jf=ao;var r=new ao;return r._=t,e(r,n)._}finally{jf=Date}}}function co(e){function t(t){for(var r,i,s,o=[],u=-1,a=0;++u<n;)37===e.charCodeAt(u)&&(o.push(e.substring(a,u)),null!=(i=nl[r=e.charAt(++u)])&&(r=e.charAt(++u)),(s=rl[r])&&(r=s(t,null==i?"e"===r?" ":"0":i)),o.push(r),a=u+1);return o.push(e.substring(a,u)),o.join("")}var n=e.length;return t.parse=function(t){var n={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null},r=ho(n,e,t,0);if(r!=t.length)return null;"p"in n&&(n.H=n.H%12+12*n.p);var i=null!=n.Z&&jf!==ao,s=new(i?ao:jf);return"j"in n?s.setFullYear(n.y,0,n.j):"w"in n&&("W"in n||"U"in n)?(s.setFullYear(n.y,0,1),s.setFullYear(n.y,0,"W"in n?(n.w+6)%7+7*n.W-(s.getDay()+5)%7:n.w+7*n.U-(s.getDay()+6)%7)):s.setFullYear(n.y,n.m,n.d),s.setHours(n.H+Math.floor(n.Z/100),n.M+n.Z%100,n.S,n.L),i?s._:s},t.toString=function(){return e},t}function ho(e,t,n,r){for(var i,s,o,u=0,a=t.length,f=n.length;a>u;){if(r>=f)return-1;if(i=t.charCodeAt(u++),37===i){if(o=t.charAt(u++),s=il[o in nl?t.charAt(u++):o],!s||(r=s(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function po(e){return new RegExp("^(?:"+e.map(Jo.requote).join("|")+")","i")}function vo(e){for(var t=new i,n=-1,r=e.length;++n<r;)t.set(e[n].toLowerCase(),n);return t}function mo(e,t,n){var r=0>e?"-":"",i=(r?-e:e)+"",s=i.length;return r+(n>s?(new Array(n-s+1)).join(t)+i:i)}function go(e,t,n){Kf.lastIndex=0;var r=Kf.exec(t.substring(n));return r?(e.w=Qf.get(r[0].toLowerCase()),n+r[0].length):-1}function yo(e,t,n){$f.lastIndex=0;var r=$f.exec(t.substring(n));return r?(e.w=Jf.get(r[0].toLowerCase()),n+r[0].length):-1}function bo(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function wo(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n));return r?(e.U=+r[0],n+r[0].length):-1}function Eo(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n));return r?(e.W=+r[0],n+r[0].length):-1}function So(e,t,n){Zf.lastIndex=0;var r=Zf.exec(t.substring(n));return r?(e.m=el.get(r[0].toLowerCase()),n+r[0].length):-1}function xo(e,t,n){Gf.lastIndex=0;var r=Gf.exec(t.substring(n));return r?(e.m=Yf.get(r[0].toLowerCase()),n+r[0].length):-1}function To(e,t,n){return ho(e,rl.c.toString(),t,n)}function No(e,t,n){return ho(e,rl.x.toString(),t,n)}function Co(e,t,n){return ho(e,rl.X.toString(),t,n)}function ko(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function Lo(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+2));return r?(e.y=Oo(+r[0]),n+r[0].length):-1}function Ao(e,t,n){return/^[+-]\d{4}$/.test(t=t.substring(n,n+5))?(e.Z=+t,n+5):-1}function Oo(e){return e+(e>68?1900:2e3)}function Mo(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function _o(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Do(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+3));return r?(e.j=+r[0],n+r[0].length):-1}function Po(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Ho(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function Bo(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function jo(e,t,n){sl.lastIndex=0;var r=sl.exec(t.substring(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Fo(e,t,n){var r=ol.get(t.substring(n,n+=2).toLowerCase());return null==r?-1:(e.p=r,n)}function Io(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",r=~~(au(t)/60),i=au(t)%60;return n+mo(r,"0",2)+mo(i,"0",2)}function qo(e,t,n){tl.lastIndex=0;var r=tl.exec(t.substring(n,n+1));return r?n+r[0].length:-1}function Ro(e){function t(e){try{jf=ao;var t=new jf;return t._=e,n(t)}finally{jf=Date}}var n=co(e);return t.parse=function(e){try{jf=ao;var t=n.parse(e);return t&&t._}finally{jf=Date}},t.toString=n.toString,t}function Uo(e){return e.toISOString()}function zo(e,t,n){function r(t){return e(t)}function i(e,n){var r=e[1]-e[0],i=r/n,s=Jo.bisect(al,i);return s==al.length?[t.year,ls(e.map(function(e){return e/31536e6}),n)[2]]:s?t[i/al[s-1]<al[s]/i?s-1:s]:[hl,ls(e,n)[2]]}return r.invert=function(t){return Wo(e.invert(t))},r.domain=function(t){return arguments.length?(e.domain(t),r):e.domain().map(Wo)},r.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,Wo(+n+1),t).length}var s=r.domain(),o=ts(s),u=null==e?i(o,10):"number"==typeof e&&i(o,e);return u&&(e=u[0],t=u[1]),r.domain(is(s,t>1?{floor:function(t){for(;n(t=e.floor(t));)t=Wo(t-1);return t},ceil:function(t){for(;n(t=e.ceil(t));)t=Wo(+t+1);return t}}:e))},r.ticks=function(e,t){var n=ts(r.domain()),s=null==e?i(n,10):"number"==typeof e?i(n,e):!e.range&&[{range:e},t];return s&&(e=s[0],t=s[1]),e.range(n[0],Wo(+n[1]+1),1>t?1:t)},r.tickFormat=function(){return n},r.copy=function(){return zo(e.copy(),t,n)},as(r,e)}function Wo(e){return new Date(e)}function Xo(e){return function(t){for(var n=e.length-1,r=e[n];!r[1](t);)r=e[--n];return r[0](t)}}function Vo(e){return JSON.parse(e.responseText)}function $o(e){var t=Go.createRange();return t.selectNode(Go.body),t.createContextualFragment(e.responseText)}var Jo={version:"3.3.10"};Date.now||(Date.now=function(){return+(new Date)});var Ko=[].slice,Qo=function(e){return Ko.call(e)},Go=document,Yo=Go.documentElement,Zo=window;try{Qo(Yo.childNodes)[0].nodeType}catch(eu){Qo=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}try{Go.createElement("div").style.setProperty("opacity",0,"")}catch(tu){var nu=Zo.Element.prototype,ru=nu.setAttribute,iu=nu.setAttributeNS,su=Zo.CSSStyleDeclaration.prototype,ou=su.setProperty;nu.setAttribute=function(e,t){ru.call(this,e,t+"")},nu.setAttributeNS=function(e,t,n){iu.call(this,e,t,n+"")},su.setProperty=function(e,t,n){ou.call(this,e,t+"",n)}}Jo.ascending=function(e,t){return t>e?-1:e>t?1:e>=t?0:0/0},Jo.descending=function(e,t){return e>t?-1:t>e?1:t>=e?0:0/0},Jo.min=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);)n=void 0;for(;++i<s;)null!=(r=e[i])&&n>r&&(n=r)}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);)n=void 0;for(;++i<s;)null!=(r=t.call(e,e[i],i))&&n>r&&(n=r)}return n},Jo.max=function(e,t){var n,r,i=-1,s=e.length;if(1===arguments.length){for(;++i<s&&!(null!=(n=e[i])&&n>=n);)n=void 0;for(;++i<s;)null!=(r=e[i])&&r>n&&(n=r)}else{for(;++i<s&&!(null!=(n=t.call(e,e[i],i))&&n>=n);)n=void 0;for(;++i<s;)null!=(r=t.call(e,e[i],i))&&r>n&&(n=r)}return n},Jo.extent=function(e,t){var n,r,i,s=-1,o=e.length;if(1===arguments.length){for(;++s<o&&!(null!=(n=i=e[s])&&n>=n);)n=i=void 0;for(;++s<o;)null!=(r=e[s])&&(n>r&&(n=r),r>i&&(i=r))}else{for(;++s<o&&!(null!=(n=i=t.call(e,e[s],s))&&n>=n);)n=void 0;for(;++s<o;)null!=(r=t.call(e,e[s],s))&&(n>r&&(n=r),r>i&&(i=r))}return[n,i]},Jo.sum=function(e,t){var n,r=0,i=e.length,s=-1;if(1===arguments.length)for(;++s<i;)isNaN(n=+e[s])||(r+=n);else for(;++s<i;)isNaN(n=+t.call(e,e[s],s))||(r+=n);return r},Jo.mean=function(t,n){var r,i=t.length,s=0,o=-1,u=0;if(1===arguments.length)for(;++o<i;)e(r=t[o])&&(s+=(r-s)/++u);else for(;++o<i;)e(r=n.call(t,t[o],o))&&(s+=(r-s)/++u);return u?s:void 0},Jo.quantile=function(e,t){var n=(e.length-1)*t+1,r=Math.floor(n),i=+e[r-1],s=n-r;return s?i+s*(e[r]-i):i},Jo.median=function(t,n){return arguments.length>1&&(t=t.map(n)),t=t.filter(e),t.length?Jo.quantile(t.sort(Jo.ascending),.5):void 0},Jo.bisector=function(e){return{left:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;e.call(t,t[s],s)<n?r=s+1:i=s}return r},right:function(t,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=t.length);i>r;){var s=r+i>>>1;n<e.call(t,t[s],s)?i=s:r=s+1}return r}}};var uu=Jo.bisector(function(e){return e});Jo.bisectLeft=uu.left,Jo.bisect=Jo.bisectRight=uu.right,Jo.shuffle=function(e){for(var t,n,r=e.length;r;)n=0|Math.random()*r--,t=e[r],e[r]=e[n],e[n]=t;return e},Jo.permute=function(e,t){for(var n=t.length,r=new Array(n);n--;)r[n]=e[t[n]];return r},Jo.pairs=function(e){for(var t,n=0,r=e.length-1,i=e[0],s=new Array(0>r?0:r);r>n;)s[n]=[t=i,i=e[++n]];return s},Jo.zip=function(){if(!(i=arguments.length))return[];for(var e=-1,n=Jo.min(arguments,t),r=new Array(n);++e<n;)for(var i,s=-1,o=r[e]=new Array(i);++s<i;)o[s]=arguments[s][e];return r},Jo.transpose=function(e){return Jo.zip.apply(Jo,e)},Jo.keys=function(e){var t=[];for(var n in e)t.push(n);return t},Jo.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},Jo.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},Jo.merge=function(e){for(var t,n,r,i=e.length,s=-1,o=0;++s<i;)o+=e[s].length;for(n=new Array(o);--i>=0;)for(r=e[i],t=r.length;--t>=0;)n[--o]=r[t];return n};var au=Math.abs;Jo.range=function(e,t,r){if(arguments.length<3&&(r=1,arguments.length<2&&(t=e,e=0)),1/0===(t-e)/r)throw new Error("infinite range");var i,s=[],o=n(au(r)),u=-1;if(e*=o,t*=o,r*=o,0>r)for(;(i=e+r*++u)>t;)s.push(i/o);else for(;(i=e+r*++u)<t;)s.push(i/o);return s},Jo.map=function(e){var t=new i;if(e instanceof i)e.forEach(function(e,n){t.set(e,n)});else for(var n in e)t.set(n,e[n]);return t},r(i,{has:function(e){return fu+e in this},get:function(e){return this[fu+e]},set:function(e,t){return this[fu+e]=t},remove:function(e){return e=fu+e,e in this&&delete this[e]},keys:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},values:function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},entries:function(){var e=[];return this.forEach(function(t,n){e.push({key:t,value:n})}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===lu&&e.call(this,t.substring(1),this[t])}});var fu="\0",lu=fu.charCodeAt(0);Jo.nest=function(){function e(t,u,a){if(a>=o.length)return r?r.call(s,u):n?u.sort(n):u;for(var f,l,c,h,p=-1,d=u.length,v=o[a++],m=new i;++p<d;)(h=m.get(f=v(l=u[p])))?h.push(l):m.set(f,[l]);return t?(l=t(),c=function(n,r){l.set(n,e(t,r,a))}):(l={},c=function(n,r){l[n]=e(t,r,a)}),m.forEach(c),l}function t(e,n){if(n>=o.length)return e;var r=[],i=u[n++];return e.forEach(function(e,i){r.push({key:e,values:t(i,n)})}),i?r.sort(function(e,t){return i(e.key,t.key)}):r}var n,r,s={},o=[],u=[];return s.map=function(t,n){return e(n,t,0)},s.entries=function(n){return t(e(Jo.map,n,0),0)},s.key=function(e){return o.push(e),s},s.sortKeys=function(e){return u[o.length-1]=e,s},s.sortValues=function(e){return n=e,s},s.rollup=function(e){return r=e,s},s},Jo.set=function(e){var t=new s;if(e)for(var n=0,r=e.length;r>n;++n)t.add(e[n]);return t},r(s,{has:function(e){return fu+e in this},add:function(e){return this[fu+e]=!0,e},remove:function(e){return e=fu+e,e in this&&delete this[e]},values:function(){var e=[];return this.forEach(function(t){e.push(t)}),e},forEach:function(e){for(var t in this)t.charCodeAt(0)===lu&&e.call(this,t.substring(1))}}),Jo.behavior={},Jo.rebind=function(e,t){for(var n,r=1,i=arguments.length;++r<i;)e[n=arguments[r]]=o(e,t,t[n]);return e};var cu=["webkit","ms","moz","Moz","o","O"];Jo.dispatch=function(){for(var e=new f,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=l(e);return e},f.prototype.on=function(e,t){var n=e.indexOf("."),r="";if(n>=0&&(r=e.substring(n+1),e=e.substring(0,n)),e)return arguments.length<2?this[e].on(r):this[e].on(r,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(r,null);return this}},Jo.event=null,Jo.requote=function(e){return e.replace(hu,"\\$&")};var hu=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,pu={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},du=function(e,t){return t.querySelector(e)},vu=function(e,t){return t.querySelectorAll(e)},mu=Yo[u(Yo,"matchesSelector")],gu=function(e,t){return mu.call(e,t)};"function"==typeof Sizzle&&(du=function(e,t){return Sizzle(e,t)[0]||null},vu=function(e,t){return Sizzle.uniqueSort(Sizzle(e,t))},gu=Sizzle.matchesSelector),Jo.selection=function(){return Eu};var yu=Jo.selection.prototype=[];yu.select=function(e){var t,n,r,i,s=[];e=v(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]),t.parentNode=(r=this[o]).parentNode;for(var a=-1,f=r.length;++a<f;)(i=r[a])?(t.push(n=e.call(i,i.__data__,a,o)),n&&"__data__"in i&&(n.__data__=i.__data__)):t.push(null)}return d(s)},yu.selectAll=function(e){var t,n,r=[];e=m(e);for(var i=-1,s=this.length;++i<s;)for(var o=this[i],u=-1,a=o.length;++u<a;)(n=o[u])&&(r.push(t=Qo(e.call(n,n.__data__,u,i))),t.parentNode=n);return d(r)};var bu={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Jo.ns={prefix:bu,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.substring(0,t),e=e.substring(t+1)),bu.hasOwnProperty(n)?{space:bu[n],local:e}:e}},yu.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return e=Jo.ns.qualify(e),e.local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(g(t,e[t]));return this}return this.each(g(e,t))},yu.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),r=(e=e.trim().split(/^|\s+/g)).length,i=-1;if(t=n.classList){for(;++i<r;)if(!t.contains(e[i]))return!1}else for(t=n.getAttribute("class");++i<r;)if(!b(e[i]).test(t))return!1;return!0}for(t in e)this.each(w(t,e[t]));return this}return this.each(w(e,t))},yu.style=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t="");for(n in e)this.each(S(n,e[n],t));return this}if(2>r)return Zo.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(S(e,t,n))},yu.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(x(t,e[t]));return this}return this.each(x(e,t))},yu.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},yu.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},yu.append=function(e){return e=T(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},yu.insert=function(e,t){return e=T(e),t=v(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},yu.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},yu.data=function(e,t){function n(e,n){var r,s,o,u=e.length,c=n.length,h=Math.min(u,c),p=new Array(c),d=new Array(c),v=new Array(u);if(t){var m,g=new i,y=new i,b=[];for(r=-1;++r<u;)m=t.call(s=e[r],s.__data__,r),g.has(m)?v[r]=s:g.set(m,s),b.push(m);for(r=-1;++r<c;)m=t.call(n,o=n[r],r),(s=g.get(m))?(p[r]=s,s.__data__=o):y.has(m)||(d[r]=N(o)),y.set(m,o),g.remove(m);for(r=-1;++r<u;)g.has(b[r])&&(v[r]=e[r])}else{for(r=-1;++r<h;)s=e[r],o=n[r],s?(s.__data__=o,p[r]=s):d[r]=N(o);for(;c>r;++r)d[r]=N(n[r]);for(;u>r;++r)v[r]=e[r]}d.update=p,d.parentNode=p.parentNode=v.parentNode=e.parentNode,a.push(d),f.push(p),l.push(v)}var r,s,o=-1,u=this.length;if(!arguments.length){for(e=new Array(u=(r=this[0]).length);++o<u;)(s=r[o])&&(e[o]=s.__data__);return e}var a=A([]),f=d([]),l=d([]);if("function"==typeof e)for(;++o<u;)n(r=this[o],e.call(r,r.parentNode.__data__,o));else for(;++o<u;)n(r=this[o],e);return f.enter=function(){return a},f.exit=function(){return l},f},yu.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},yu.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=C(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]),t.parentNode=(n=this[s]).parentNode;for(var u=0,a=n.length;a>u;u++)(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r)}return d(i)},yu.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,r=this[e],i=r.length-1,s=r[i];--i>=0;)(n=r[i])&&(s&&s!==n.nextSibling&&s.parentNode.insertBefore(n,s),s=n);return this},yu.sort=function(e){e=k.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},yu.each=function(e){return L(this,function(t,n,r){e.call(t,t.__data__,n,r)})},yu.call=function(e){var t=Qo(arguments);return e.apply(t[0]=this,t),this},yu.empty=function(){return!this.node()},yu.node=function(){for(var e=0,t=this.length;t>e;e++)for(var n=this[e],r=0,i=n.length;i>r;r++){var s=n[r];if(s)return s}return null},yu.size=function(){var e=0;return this.each(function(){++e}),e};var wu=[];Jo.selection.enter=A,Jo.selection.enter.prototype=wu,wu.append=yu.append,wu.empty=yu.empty,wu.node=yu.node,wu.call=yu.call,wu.size=yu.size,wu.select=function(e){for(var t,n,r,i,s,o=[],u=-1,a=this.length;++u<a;){r=(i=this[u]).update,o.push(t=[]),t.parentNode=i.parentNode;for(var f=-1,l=i.length;++f<l;)(s=i[f])?(t.push(r[f]=n=e.call(i.parentNode,s.__data__,f,u)),n.__data__=s.__data__):t.push(null)}return d(o)},wu.insert=function(e,t){return arguments.length<2&&(t=O(this)),yu.insert.call(this,e,t)},yu.transition=function(){for(var e,t,n=Cf||++Mf,r=[],i=kf||{time:Date.now(),ease:qr,delay:0,duration:250},s=-1,o=this.length;++s<o;){r.push(e=[]);for(var u=this[s],a=-1,f=u.length;++a<f;)(t=u[a])&&so(t,a,n,i),e.push(t)}return no(r,n)},yu.interrupt=function(){return this.each(M)},Jo.select=function(e){var t=["string"==typeof e?du(e,Go):e];return t.parentNode=Yo,d([t])},Jo.selectAll=function(e){var t=Qo("string"==typeof e?vu(e,Go):e);return t.parentNode=Yo,d([t])};var Eu=Jo.select(Yo);yu.on=function(e,t,n){var r=arguments.length;if(3>r){if("string"!=typeof e){2>r&&(t=!1);for(n in e)this.each(_(n,e[n],t));return this}if(2>r)return(r=this.node()["__on"+e])&&r._;n=!1}return this.each(_(e,t,n))};var Su=Jo.map({mouseenter:"mouseover",mouseleave:"mouseout"});Su.forEach(function(e){"on"+e in Go&&Su.remove(e)});var xu="onselectstart"in Go?null:u(Yo.style,"userSelect"),Tu=0;Jo.mouse=function(e){return B(e,h())};var Nu=/WebKit/.test(Zo.navigator.userAgent)?-1:0;Jo.touches=function(e,t){return arguments.length<2&&(t=h().touches),t?Qo(t).map(function(t){var n=B(e,t);return n.identifier=t.identifier,n}):[]},Jo.behavior.drag=function(){function e(){this.on("mousedown.drag",o).on("touchstart.drag",u)}function t(){return Jo.event.changedTouches[0].identifier}function n(e,t){return Jo.touches(e).filter(function(e){return e.identifier===t})[0]}function r(e,t,n,r){return function(){function o(){var e=t(l,p),n=e[0]-v[0],r=e[1]-v[1];m|=n|r,v=e,c({type:"drag",x:e[0]+a[0],y:e[1]+a[1],dx:n,dy:r})}function u(){g.on(n+"."+d,null).on(r+"."+d,null),y(m&&Jo.event.target===h),c({type:"dragend"})}var a,f=this,l=f.parentNode,c=i.of(f,arguments),h=Jo.event.target,p=e(),d=null==p?"drag":"drag-"+p,v=t(l,p),m=0,g=Jo.select(Zo).on(n+"."+d,o).on(r+"."+d,u),y=H();s?(a=s.apply(f,arguments),a=[a.x-v[0],a.y-v[1]]):a=[0,0],c({type:"dragstart"})}}var i=p(e,"drag","dragstart","dragend"),s=null,o=r(a,Jo.mouse,"mousemove","mouseup"),u=r(t,n,"touchmove","touchend");return e.origin=function(t){return arguments.length?(s=t,e):s},Jo.rebind(e,i,"on")};var Cu=Math.PI,ku=2*Cu,Lu=Cu/2,Au=1e-6,Ou=Au*Au,Mu=Cu/180,_u=180/Cu,Du=Math.SQRT2,Pu=2,Hu=4;Jo.interpolateZoom=function(e,t){function n(e){var t=e*y;if(g){var n=R(v),o=s/(Pu*h)*(n*U(Du*t+v)-q(v));return[r+o*f,i+o*l,s*n/R(Du*t+v)]}return[r+e*f,i+e*l,s*Math.exp(Du*t)]}var r=e[0],i=e[1],s=e[2],o=t[0],u=t[1],a=t[2],f=o-r,l=u-i,c=f*f+l*l,h=Math.sqrt(c),p=(a*a-s*s+Hu*c)/(2*s*Pu*h),d=(a*a-s*s-Hu*c)/(2*a*Pu*h),v=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(d*d+1)-d),g=m-v,y=(g||Math.log(a/s))/Du;return n.duration=1e3*y,n},Jo.behavior.zoom=function(){function e(e){e.on(k,f).on(Fu+".zoom",h).on(L,d).on("dblclick.zoom",v).on(O,l)}function t(e){return[(e[0]-T.x)/T.k,(e[1]-T.y)/T.k]}function n(e){return[e[0]*T.k+T.x,e[1]*T.k+T.y]}function r(e){T.k=Math.max(C[0],Math.min(C[1],e))}function i(e,t){t=n(t),T.x+=e[0]-t[0],T.y+=e[1]-t[1]}function s(){E&&E.domain(w.range().map(function(e){return(e-T.x)/T.k}).map(w.invert)),x&&x.domain(S.range().map(function(e){return(e-T.y)/T.k}).map(S.invert))}function o(e){e({type:"zoomstart"})}function u(e){s(),e({type:"zoom",scale:T.k,translate:[T.x,T.y]})}function a(e){e({type:"zoomend"})}function f(){function e(){l=1,i(Jo.mouse(r),h),u(s)}function n(){c.on(L,Zo===r?d:null).on(A,null),p(l&&Jo.event.target===f),a(s)}var r=this,s=_.of(r,arguments),f=Jo.event.target,l=0,c=Jo.select(Zo).on(L,e).on(A,n),h=t(Jo.mouse(r)),p=H();M.call(r),o(s)}function l(){function e(){var e=Jo.touches(d);return p=T.k,e.forEach(function(e){e.identifier in m&&(m[e.identifier]=t(e))}),e}function n(){for(var t=Jo.event.changedTouches,n=0,s=t.length;s>n;++n)m[t[n].identifier]=null;var o=e(),a=Date.now();if(1===o.length){if(500>a-b){var f=o[0],l=m[f.identifier];r(2*T.k),i(f,l),c(),u(v)}b=a}else if(o.length>1){var f=o[0],h=o[1],p=f[0]-h[0],d=f[1]-h[1];g=p*p+d*d}}function s(){for(var e,t,n,s,o=Jo.touches(d),a=0,f=o.length;f>a;++a,s=null)if(n=o[a],s=m[n.identifier]){if(t)break;e=n,t=s}if(s){var l=(l=n[0]-e[0])*l+(l=n[1]-e[1])*l,c=g&&Math.sqrt(l/g);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+s[0])/2,(t[1]+s[1])/2],r(c*p)}b=null,i(e,t),u(v)}function h(){if(Jo.event.touches.length){for(var t=Jo.event.changedTouches,n=0,r=t.length;r>n;++n)delete m[t[n].identifier];for(var i in m)return void e()}S.on(w,null).on(E,null),x.on(k,f).on(O,l),N(),a(v)}var p,d=this,v=_.of(d,arguments),m={},g=0,y=Jo.event.changedTouches[0].identifier,w="touchmove.zoom-"+y,E="touchend.zoom-"+y,S=Jo.select(Zo).on(w,s).on(E,h),x=Jo.select(d).on(k,null).on(O,n),N=H();M.call(d),n(),o(v)}function h(){var e=_.of(this,arguments);y?clearTimeout(y):(M.call(this),o(e)),y=setTimeout(function(){y=null,a(e)},50),c();var n=g||Jo.mouse(this);m||(m=t(n)),r(Math.pow(2,.002*Bu())*T.k),i(n,m),u(e)}function d(){m=null}function v(){var e=_.of(this,arguments),n=Jo.mouse(this),s=t(n),f=Math.log(T.k)/Math.LN2;o(e),r(Math.pow(2,Jo.event.shiftKey?Math.ceil(f)-1:Math.floor(f)+1)),i(n,s),u(e),a(e)}var m,g,y,b,w,E,S,x,T={x:0,y:0,k:1},N=[960,500],C=ju,k="mousedown.zoom",L="mousemove.zoom",A="mouseup.zoom",O="touchstart.zoom",_=p(e,"zoomstart","zoom","zoomend");return e.event=function(e){e.each(function(){var e=_.of(this,arguments),t=T;Cf?Jo.select(this).transition().each("start.zoom",function(){T=this.__chart__||{x:0,y:0,k:1},o(e)}).tween("zoom:zoom",function(){var n=N[0],r=N[1],i=n/2,s=r/2,o=Jo.interpolateZoom([(i-T.x)/T.k,(s-T.y)/T.k,n/T.k],[(i-t.x)/t.k,(s-t.y)/t.k,n/t.k]);return function(t){var r=o(t),a=n/r[2];this.__chart__=T={x:i-r[0]*a,y:s-r[1]*a,k:a},u(e)}}).each("end.zoom",function(){a(e)}):(this.__chart__=T,o(e),u(e),a(e))})},e.translate=function(t){return arguments.length?(T={x:+t[0],y:+t[1],k:T.k},s(),e):[T.x,T.y]},e.scale=function(t){return arguments.length?(T={x:T.x,y:T.y,k:+t},s(),e):T.k},e.scaleExtent=function(t){return arguments.length?(C=null==t?ju:[+t[0],+t[1]],e):C},e.center=function(t){return arguments.length?(g=t&&[+t[0],+t[1]],e):g},e.size=function(t){return arguments.length?(N=t&&[+t[0],+t[1]],e):N},e.x=function(t){return arguments.length?(E=t,w=t.copy(),T={x:0,y:0,k:1},e):E},e.y=function(t){return arguments.length?(x=t,S=t.copy(),T={x:0,y:0,k:1},e):x},Jo.rebind(e,_,"on")};var Bu,ju=[0,1/0],Fu="onwheel"in Go?(Bu=function(){return-Jo.event.deltaY*(Jo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Go?(Bu=function(){return Jo.event.wheelDelta},"mousewheel"):(Bu=function(){return-Jo.event.detail},"MozMousePixelScroll");W.prototype.toString=function(){return this.rgb()+""},Jo.hsl=function(e,t,n){return 1===arguments.length?e instanceof V?X(e.h,e.s,e.l):ft(""+e,lt,X):X(+e,+t,+n)};var Iu=V.prototype=new W;Iu.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),X(this.h,this.s,this.l/e)},Iu.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),X(this.h,this.s,e*this.l)},Iu.rgb=function(){return $(this.h,this.s,this.l)},Jo.hcl=function(e,t,n){return 1===arguments.length?e instanceof K?J(e.h,e.c,e.l):e instanceof Y?et(e.l,e.a,e.b):et((e=ct((e=Jo.rgb(e)).r,e.g,e.b)).l,e.a,e.b):J(+e,+t,+n)};var qu=K.prototype=new W;qu.brighter=function(e){return J(this.h,this.c,Math.min(100,this.l+Ru*(arguments.length?e:1)))},qu.darker=function(e){return J(this.h,this.c,Math.max(0,this.l-Ru*(arguments.length?e:1)))},qu.rgb=function(){return Q(this.h,this.c,this.l).rgb()},Jo.lab=function(e,t,n){return 1===arguments.length?e instanceof Y?G(e.l,e.a,e.b):e instanceof K?Q(e.l,e.c,e.h):ct((e=Jo.rgb(e)).r,e.g,e.b):G(+e,+t,+n)};var Ru=18,Uu=.95047,zu=1,Wu=1.08883,Xu=Y.prototype=new W;Xu.brighter=function(e){return G(Math.min(100,this.l+Ru*(arguments.length?e:1)),this.a,this.b)},Xu.darker=function(e){return G(Math.max(0,this.l-Ru*(arguments.length?e:1)),this.a,this.b)},Xu.rgb=function(){return Z(this.l,this.a,this.b)},Jo.rgb=function(e,t,n){return 1===arguments.length?e instanceof ut?ot(e.r,e.g,e.b):ft(""+e,ot,$):ot(~~e,~~t,~~n)};var Vu=ut.prototype=new W;Vu.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,r=this.b,i=30;return t||n||r?(t&&i>t&&(t=i),n&&i>n&&(n=i),r&&i>r&&(r=i),ot(Math.min(255,~~(t/e)),Math.min(255,~~(n/e)),Math.min(255,~~(r/e)))):ot(i,i,i)},Vu.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),ot(~~(e*this.r),~~(e*this.g),~~(e*this.b))},Vu.hsl=function(){return lt(this.r,this.g,this.b)},Vu.toString=function(){return"#"+at(this.r)+at(this.g)+at(this.b)};var $u=Jo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});$u.forEach(function(e,t){$u.set(e,it(t))}),Jo.functor=dt,Jo.xhr=mt(vt),Jo.dsv=function(e,t){function n(e,n,s){arguments.length<3&&(s=n,n=null);var o=Jo.xhr(e,t,s);return o.row=function(e){return arguments.length?o.response(null==(n=e)?r:i(e)):n},o.row(n)}function r(e){return n.parse(e.responseText)}function i(e){return function(t){return n.parse(t.responseText,e)}}function o(t){return t.map(u).join(e)}function u(e){return a.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var a=new RegExp('["'+e+"\n]"),f=e.charCodeAt(0);return n.parse=function(e,t){var r;return n.parseRows(e,function(e,n){if(r)return r(e,n-1);var i=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");r=t?function(e,n){return t(i(e),n)}:i})},n.parseRows=function(e,t){function n(){if(l>=a)return o;if(i)return i=!1,s;var t=l;if(34===e.charCodeAt(t)){for(var n=t;n++<a;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}l=n+2;var r=e.charCodeAt(n+1);return 13===r?(i=!0,10===e.charCodeAt(n+2)&&++l):10===r&&(i=!0),e.substring(t+1,n).replace(/""/g,'"')}for(;a>l;){var r=e.charCodeAt(l++),u=1;if(10===r)i=!0;else if(13===r)i=!0,10===e.charCodeAt(l)&&(++l,++u);else if(r!==f)continue;return e.substring(t,l-u)}return e.substring(t)}for(var r,i,s={},o={},u=[],a=e.length,l=0,c=0;(r=n())!==o;){for(var h=[];r!==s&&r!==o;)h.push(r),r=n();(!t||(h=t(h,c++)))&&u.push(h)}return u},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var r=new s,i=[];return t.forEach(function(e){for(var t in e)r.has(t)||i.push(r.add(t))}),[i.map(u).join(e)].concat(t.map(function(t){return i.map(function(e){return u(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(o).join("\n")},n},Jo.csv=Jo.dsv(",","text/csv"),Jo.tsv=Jo.dsv("	","text/tab-separated-values");var Ju,Ku,Qu,Gu,Yu,Zu=Zo[u(Zo,"requestAnimationFrame")]||function(e){setTimeout(e,17)};Jo.timer=function(e,t,n){var r=arguments.length;2>r&&(t=0),3>r&&(n=Date.now());var i=n+t,s={c:e,t:i,f:!1,n:null};Ku?Ku.n=s:Ju=s,Ku=s,Qu||(Gu=clearTimeout(Gu),Qu=1,Zu(bt))},Jo.timer.flush=function(){wt(),Et()};var ea=".",ta=",",na=[3,3],ra="$",ia=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(St);Jo.formatPrefix=function(e,t){var n=0;return e&&(0>e&&(e*=-1),t&&(e=Jo.round(e,xt(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((0>=n?n+1:n-1)/3)))),ia[8+n/3]},Jo.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)},Jo.format=function(e){var t=sa.exec(e),n=t[1]||" ",r=t[2]||">",i=t[3]||"",s=t[4]||"",o=t[5],u=+t[6],a=t[7],f=t[8],l=t[9],c=1,h="",p=!1;switch(f&&(f=+f.substring(1)),(o||"0"===n&&"="===r)&&(o=n="0",r="=",a&&(u-=Math.floor((u-1)/4))),l){case"n":a=!0,l="g";break;case"%":c=100,h="%",l="f";break;case"p":c=100,h="%",l="r";break;case"b":case"o":case"x":case"X":"#"===s&&(s="0"+l.toLowerCase());case"c":case"d":p=!0,f=0;break;case"s":c=-1,l="r"}"#"===s?s="":"$"===s&&(s=ra),"r"!=l||f||(l="g"),null!=f&&("g"==l?f=Math.max(1,Math.min(21,f)):("e"==l||"f"==l)&&(f=Math.max(0,Math.min(20,f)))),l=oa.get(l)||Tt;var d=o&&a;return function(e){if(p&&e%1)return"";var t=0>e||0===e&&0>1/e?(e=-e,"-"):i;if(0>c){var v=Jo.formatPrefix(e,f);e=v.scale(e),h=v.symbol}else e*=c;e=l(e,f);var m=e.lastIndexOf("."),g=0>m?e:e.substring(0,m),y=0>m?"":ea+e.substring(m+1);!o&&a&&(g=ua(g));var b=s.length+g.length+y.length+(d?0:t.length),w=u>b?(new Array(b=u-b+1)).join(n):"";return d&&(g=ua(w+g)),t+=s,e=g+y,("<"===r?t+e+w:">"===r?w+t+e:"^"===r?w.substring(0,b>>=1)+t+e+w.substring(b):t+(d?e:w+e))+h}};var sa=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,oa=Jo.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=Jo.round(e,xt(e,t))).toFixed(Math.max(0,Math.min(20,xt(e*(1+1e-15),t))))}}),ua=vt;if(na){var aa=na.length;ua=function(e){for(var t=e.length,n=[],r=0,i=na[0];t>0&&i>0;)n.push(e.substring(t-=i,t+i)),i=na[r=(r+1)%aa];return n.reverse().join(ta)}}Jo.geo={},Nt.prototype={s:0,t:0,add:function(e){Ct(e,this.t,fa),Ct(fa.s,this.s,this),this.s?this.t+=fa.t:this.s=fa.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var fa=new Nt;Jo.geo.stream=function(e,t){e&&la.hasOwnProperty(e.type)?la[e.type](e,t):kt(e,t)};var la={Feature:function(e,t){kt(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,r=-1,i=n.length;++r<i;)kt(n[r].geometry,t)}},ca={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)e=n[r],t.point(e[0],e[1],e[2])},LineString:function(e,t){Lt(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)Lt(n[r],t,0)},Polygon:function(e,t){At(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,r=-1,i=n.length;++r<i;)At(n[r],t)},GeometryCollection:function(e,t){for(var n=e.geometries,r=-1,i=n.length;++r<i;)kt(n[r],t)}};Jo.geo.area=function(e){return ha=0,Jo.geo.stream(e,da),ha};var ha,pa=new Nt,da={sphere:function(){ha+=4*Cu},point:a,lineStart:a,lineEnd:a,polygonStart:function(){pa.reset(),da.lineStart=Ot},polygonEnd:function(){var e=2*pa;ha+=0>e?4*Cu+e:e,da.lineStart=da.lineEnd=da.point=a}};Jo.geo.bounds=function(){function e(e,t){b.push(w=[l=e,h=e]),c>t&&(c=t),t>p&&(p=t)}function t(t,n){var r=Mt([t*Mu,n*Mu]);if(g){var i=Dt(g,r),s=[i[1],-i[0],0],o=Dt(s,i);Bt(o),o=jt(o);var a=t-d,f=a>0?1:-1,v=o[0]*_u*f,m=au(a)>180;if(m^(v>f*d&&f*t>v)){var y=o[1]*_u;y>p&&(p=y)}else if(v=(v+360)%360-180,m^(v>f*d&&f*t>v)){var y=-o[1]*_u;c>y&&(c=y)}else c>n&&(c=n),n>p&&(p=n);m?d>t?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t):h>=l?(l>t&&(l=t),t>h&&(h=t)):t>d?u(l,t)>u(l,h)&&(h=t):u(t,h)>u(l,h)&&(l=t)}else e(t,n);g=r,d=t}function n(){E.point=t}function r(){w[0]=l,w[1]=h,E.point=e,g=null}function i(e,n){if(g){var r=e-d;y+=au(r)>180?r+(r>0?360:-360):r}else v=e,m=n;da.point(e,n),t(e,n)}function s(){da.lineStart()}function o(){i(v,m),da.lineEnd(),au(y)>Au&&(l=-(h=180)),w[0]=l,w[1]=h,g=null}function u(e,t){return(t-=e)<0?t+360:t}function a(e,t){return e[0]-t[0]}function f(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var l,c,h,p,d,v,m,g,y,b,w,E={point:e,lineStart:n,lineEnd:r,polygonStart:function(){E.point=i,E.lineStart=s,E.lineEnd=o,y=0,da.polygonStart()},polygonEnd:function(){da.polygonEnd(),E.point=e,E.lineStart=n,E.lineEnd=r,0>pa?(l=-(h=180),c=-(p=90)):y>Au?p=90:-Au>y&&(c=-90),w[0]=l,w[1]=h}};return function(e){p=h=-(l=c=1/0),b=[],Jo.geo.stream(e,E);var t=b.length;if(t){b.sort(a);for(var n,r=1,i=b[0],s=[i];t>r;++r)n=b[r],f(n[0],i)||f(n[1],i)?(u(i[0],n[1])>u(i[0],i[1])&&(i[1]=n[1]),u(n[0],i[1])>u(i[0],i[1])&&(i[0]=n[0])):s.push(i=n);for(var o,n,d=-1/0,t=s.length-1,r=0,i=s[t];t>=r;i=n,++r)n=s[r],(o=u(i[1],n[0]))>d&&(d=o,l=n[0],h=i[1])}return b=w=null,1/0===l||1/0===c?[[0/0,0/0],[0/0,0/0]]:[[l,c],[h,p]]}}(),Jo.geo.centroid=function(e){va=ma=ga=ya=ba=wa=Ea=Sa=xa=Ta=Na=0,Jo.geo.stream(e,Ca);var t=xa,n=Ta,r=Na,i=t*t+n*n+r*r;return Ou>i&&(t=wa,n=Ea,r=Sa,Au>ma&&(t=ga,n=ya,r=ba),i=t*t+n*n+r*r,Ou>i)?[0/0,0/0]:[Math.atan2(n,t)*_u,I(r/Math.sqrt(i))*_u]};var va,ma,ga,ya,ba,wa,Ea,Sa,xa,Ta,Na,Ca={sphere:a,point:It,lineStart:Rt,lineEnd:Ut,polygonStart:function(){Ca.lineStart=zt},polygonEnd:function(){Ca.lineStart=Rt}},ka=Jt(Wt,Zt,tn,[-Cu,-Cu/2]),La=1e9;Jo.geo.clipExtent=function(){var e,t,n,r,i,s,o={stream:function(e){return i&&(i.valid=!1),i=s(e),i.valid=!0,i},extent:function(u){return arguments.length?(s=sn(e=+u[0][0],t=+u[0][1],n=+u[1][0],r=+u[1][1]),i&&(i.valid=!1,i=null),o):[[e,t],[n,r]]}};return o.extent([[0,0],[960,500]])},(Jo.geo.conicEqualArea=function(){return un(an)}).raw=an,Jo.geo.albers=function(){return Jo.geo.conicEqualArea().rotate([96,0]).center([-0.6,38.7]).parallels([29.5,45.5]).scale(1070)},Jo.geo.albersUsa=function(){function e(e){var s=e[0],o=e[1];return t=null,n(s,o),t||(r(s,o),t)||i(s,o),t}var t,n,r,i,s=Jo.geo.albers(),o=Jo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),u=Jo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),a={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=s.scale(),n=s.translate(),r=(e[0]-n[0])/t,i=(e[1]-n[1])/t;return(i>=.12&&.234>i&&r>=-0.425&&-0.214>r?o:i>=.166&&.234>i&&r>=-0.214&&-0.115>r?u:s).invert(e)},e.stream=function(e){var t=s.stream(e),n=o.stream(e),r=u.stream(e);return{point:function(e,i){t.point(e,i),n.point(e,i),r.point(e,i)},sphere:function(){t.sphere(),n.sphere(),r.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),r.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),r.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),r.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),r.polygonEnd()}}},e.precision=function(t){return arguments.length?(s.precision(t),o.precision(t),u.precision(t),e):s.precision()},e.scale=function(t){return arguments.length?(s.scale(t),o.scale(.35*t),u.scale(t),e.translate(s.translate())):s.scale()},e.translate=function(t){if(!arguments.length)return s.translate();var f=s.scale(),l=+t[0],c=+t[1];return n=s.translate(t).clipExtent([[l-.455*f,c-.238*f],[l+.455*f,c+.238*f]]).stream(a).point,r=o.translate([l-.307*f,c+.201*f]).clipExtent([[l-.425*f+Au,c+.12*f+Au],[l-.214*f-Au,c+.234*f-Au]]).stream(a).point,i=u.translate([l-.205*f,c+.212*f]).clipExtent([[l-.214*f+Au,c+.166*f+Au],[l-.115*f-Au,c+.234*f-Au]]).stream(a).point,e},e.scale(1070)};var Aa,Oa,Ma,_a,Da,Pa,Ha={point:a,lineStart:a,lineEnd:a,polygonStart:function(){Oa=0,Ha.lineStart=fn},polygonEnd:function(){Ha.lineStart=Ha.lineEnd=Ha.point=a,Aa+=au(Oa/2)}},Ba={point:ln,lineStart:a,lineEnd:a,polygonStart:a,polygonEnd:a},ja={point:pn,lineStart:dn,lineEnd:vn,polygonStart:function(){ja.lineStart=mn},polygonEnd:function(){ja.point=pn,ja.lineStart=dn,ja.lineEnd=vn}};Jo.geo.path=function(){function e(e){return e&&("function"==typeof u&&s.pointRadius(+u.apply(this,arguments)),o&&o.valid||(o=i(s)),Jo.geo.stream(e,o)),s.result()}function t(){return o=null,e}var n,r,i,s,o,u=4.5;return e.area=function(e){return Aa=0,Jo.geo.stream(e,i(Ha)),Aa},e.centroid=function(e){return ga=ya=ba=wa=Ea=Sa=xa=Ta=Na=0,Jo.geo.stream(e,i(ja)),Na?[xa/Na,Ta/Na]:Sa?[wa/Sa,Ea/Sa]:ba?[ga/ba,ya/ba]:[0/0,0/0]},e.bounds=function(e){return Da=Pa=-(Ma=_a=1/0),Jo.geo.stream(e,i(Ba)),[[Ma,_a],[Da,Pa]]},e.projection=function(e){return arguments.length?(i=(n=e)?e.stream||bn(e):vt,t()):n},e.context=function(e){return arguments.length?(s=null==(r=e)?new cn:new gn(e),"function"!=typeof u&&s.pointRadius(u),t()):r},e.pointRadius=function(t){return arguments.length?(u="function"==typeof t?t:(s.pointRadius(+t),+t),e):u},e.projection(Jo.geo.albersUsa()).context(null)},Jo.geo.transform=function(e){return{stream:function(t){var n=new wn(t);for(var r in e)n[r]=e[r];return n}}},wn.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Jo.geo.projection=Sn,Jo.geo.projectionMutator=xn,(Jo.geo.equirectangular=function(){return Sn(Nn)}).raw=Nn.invert=Nn,Jo.geo.rotation=function(e){function t(t){return t=e(t[0]*Mu,t[1]*Mu),t[0]*=_u,t[1]*=_u,t}return e=kn(e[0]%360*Mu,e[1]*Mu,e.length>2?e[2]*Mu:0),t.invert=function(t){return t=e.invert(t[0]*Mu,t[1]*Mu),t[0]*=_u,t[1]*=_u,t},t},Cn.invert=Nn,Jo.geo.circle=function(){function e(){var e="function"==typeof r?r.apply(this,arguments):r,t=kn(-e[0]*Mu,-e[1]*Mu,0).invert,i=[];return n(null,null,1,{point:function(e,n){i.push(e=t(e,n)),e[0]*=_u,e[1]*=_u}}),{type:"Polygon",coordinates:[i]}}var t,n,r=[0,0],i=6;return e.origin=function(t){return arguments.length?(r=t,e):r},e.angle=function(r){return arguments.length?(n=Mn((t=+r)*Mu,i*Mu),e):t},e.precision=function(r){return arguments.length?(n=Mn(t*Mu,(i=+r)*Mu),e):i},e.angle(90)},Jo.geo.distance=function(e,t){var n,r=(t[0]-e[0])*Mu,i=e[1]*Mu,s=t[1]*Mu,o=Math.sin(r),u=Math.cos(r),a=Math.sin(i),f=Math.cos(i),l=Math.sin(s),c=Math.cos(s);return Math.atan2(Math.sqrt((n=c*o)*n+(n=f*l-a*c*u)*n),a*l+f*c*u)},Jo.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return Jo.range(Math.ceil(s/m)*m,i,m).map(h).concat(Jo.range(Math.ceil(f/g)*g,a,g).map(p)).concat(Jo.range(Math.ceil(r/d)*d,n,d).filter(function(e){return au(e%m)>Au}).map(l)).concat(Jo.range(Math.ceil(u/v)*v,o,v).filter(function(e){return au(e%g)>Au}).map(c))}var n,r,i,s,o,u,a,f,l,c,h,p,d=10,v=d,m=90,g=360,y=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(s).concat(p(a).slice(1),h(i).reverse().slice(1),p(f).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(s=+t[0][0],i=+t[1][0],f=+t[0][1],a=+t[1][1],s>i&&(t=s,s=i,i=t),f>a&&(t=f,f=a,a=t),e.precision(y)):[[s,f],[i,a]]},e.minorExtent=function(t){return arguments.length?(r=+t[0][0],n=+t[1][0],u=+t[0][1],o=+t[1][1],r>n&&(t=r,r=n,n=t),u>o&&(t=u,u=o,o=t),e.precision(y)):[[r,u],[n,o]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(m=+t[0],g=+t[1],e):[m,g]},e.minorStep=function(t){return arguments.length?(d=+t[0],v=+t[1],e):[d,v]},e.precision=function(t){return arguments.length?(y=+t,l=Dn(u,o,90),c=Pn(r,n,y),h=Dn(f,a,90),p=Pn(s,i,y),e):y},e.majorExtent([[-180,-90+Au],[180,90-Au]]).minorExtent([[-180,-80-Au],[180,80+Au]])},Jo.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||r.apply(this,arguments),n||i.apply(this,arguments)]}}var t,n,r=Hn,i=Bn;return e.distance=function(){return Jo.geo.distance(t||r.apply(this,arguments),n||i.apply(this,arguments))},e.source=function(n){return arguments.length?(r=n,t="function"==typeof n?null:n,e):r},e.target=function(t){return arguments.length?(i=t,n="function"==typeof t?null:t,e):i},e.precision=function(){return arguments.length?e:0},e},Jo.geo.interpolate=function(e,t){return jn(e[0]*Mu,e[1]*Mu,t[0]*Mu,t[1]*Mu)},Jo.geo.length=function(e){return Fa=0,Jo.geo.stream(e,Ia),Fa};var Fa,Ia={sphere:a,point:a,lineStart:Fn,lineEnd:a,polygonStart:a,polygonEnd:a},qa=In(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(Jo.geo.azimuthalEqualArea=function(){return Sn(qa)}).raw=qa;var Ra=In(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},vt);(Jo.geo.azimuthalEquidistant=function(){return Sn(Ra)}).raw=Ra,(Jo.geo.conicConformal=function(){return un(qn)}).raw=qn,(Jo.geo.conicEquidistant=function(){return un(Rn)}).raw=Rn;var Ua=In(function(e){return 1/e},Math.atan);(Jo.geo.gnomonic=function(){return Sn(Ua)}).raw=Ua,Un.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-Lu]},(Jo.geo.mercator=function(){return zn(Un)}).raw=Un;var za=In(function(){return 1},Math.asin);(Jo.geo.orthographic=function(){return Sn(za)}).raw=za;var Wa=In(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(Jo.geo.stereographic=function(){return Sn(Wa)}).raw=Wa,Wn.invert=function(e,t){return[Math.atan2(q(e),Math.cos(t)),I(Math.sin(t)/R(e))]},(Jo.geo.transverseMercator=function(){return zn(Wn)}).raw=Wn,Jo.geom={},Jo.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,i,s,o,u,a,f,l,c,h,p,d,v=dt(n),m=dt(r),g=e.length,y=g-1,b=[],w=[],E=0;if(v===Xn&&r===Vn)t=e;else for(s=0,t=[];g>s;++s)t.push([+v.call(this,i=e[s],s),+m.call(this,i,s)]);for(s=1;g>s;++s)(t[s][1]<t[E][1]||t[s][1]==t[E][1]&&t[s][0]<t[E][0])&&(E=s);for(s=0;g>s;++s)s!==E&&(a=t[s][1]-t[E][1],u=t[s][0]-t[E][0],b.push({angle:Math.atan2(a,u),index:s}));for(b.sort(function(e,t){return e.angle-t.angle}),p=b[0].angle,h=b[0].index,c=0,s=1;y>s;++s){if(o=b[s].index,p==b[s].angle){if(u=t[h][0]-t[E][0],a=t[h][1]-t[E][1],f=t[o][0]-t[E][0],l=t[o][1]-t[E][1],u*u+a*a>=f*f+l*l){b[s].index=-1;continue}b[c].index=-1}p=b[s].angle,c=s,h=o}for(w.push(E),s=0,o=0;2>s;++o)b[o].index>-1&&(w.push(b[o].index),s++);for(d=w.length;y>o;++o)if(!(b[o].index<0)){for(;!$n(w[d-2],w[d-1],b[o].index,t);)--d;w[d++]=b[o].index}var S=[];for(s=d-1;s>=0;--s)S.push(e[w[s]]);return S}var n=Xn,r=Vn;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(r=e,t):r},t)},Jo.geom.polygon=function(e){return pu(e,Xa),e};var Xa=Jo.geom.polygon.prototype=[];Xa.area=function(){for(var e,t=-1,n=this.length,r=this[n-1],i=0;++t<n;)e=r,r=this[t],i+=e[1]*r[0]-e[0]*r[1];return.5*i},Xa.centroid=function(e){var t,n,r=-1,i=this.length,s=0,o=0,u=this[i-1];for(arguments.length||(e=-1/(6*this.area()));++r<i;)t=u,u=this[r],n=t[0]*u[1]-u[0]*t[1],s+=(t[0]+u[0])*n,o+=(t[1]+u[1])*n;return[s*e,o*e]},Xa.clip=function(e){for(var t,n,r,i,s,o,u=Qn(e),a=-1,f=this.length-Qn(this),l=this[f-1];++a<f;){for(t=e.slice(),e.length=0,i=this[a],s=t[(r=t.length-u)-1],n=-1;++n<r;)o=t[n],Jn(o,l,i)?(Jn(s,l,i)||e.push(Kn(s,o,l,i)),e.push(o)):Jn(s,l,i)&&e.push(Kn(s,o,l,i)),s=o;u&&e.push(e[0]),l=i}return e};var Va,$a,Ja,Ka,Qa,Ga=[],Ya=[];ir.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)e=t[n].edge,e.b&&e.a||t.splice(n,1);return t.sort(or),t.length},mr.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},gr.prototype={insert:function(e,t){var n,r,i;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=Er(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)r=n.U,n===r.L?(i=r.R,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.R&&(br(this,n),e=n,n=e.U),n.C=!1,r.C=!0,wr(this,r))):(i=r.L,i&&i.C?(n.C=i.C=!1,r.C=!0,e=r):(e===n.L&&(wr(this,n),e=n,n=e.U),n.C=!1,r.C=!0,br(this,r))),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,r,i=e.U,s=e.L,o=e.R;if(n=s?o?Er(o):s:o,i?i.L===e?i.L=n:i.R=n:this._=n,s&&o?(r=n.C,n.C=e.C,n.L=s,s.U=n,n!==o?(i=n.U,n.U=e.U,e=n.R,i.L=e,n.R=o,o.U=n):(n.U=i,i=n,e=n.R)):(r=e.C,e=n),e&&(e.U=i),!r){if(e&&e.C)return e.C=!1,void 0;do{if(e===this._)break;if(e===i.L){if(t=i.R,t.C&&(t.C=!1,i.C=!0,br(this,i),t=i.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,wr(this,t),t=i.R),t.C=i.C,i.C=t.R.C=!1,br(this,i),e=this._;break}}else if(t=i.L,t.C&&(t.C=!1,i.C=!0,wr(this,i),t=i.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,br(this,t),t=i.L),t.C=i.C,i.C=t.L.C=!1,wr(this,i),e=this._;break}t.C=!0,e=i,i=i.U}while(!e.C);e&&(e.C=!1)}}},Jo.geom.voronoi=function(e){function t(e){var t=new Array(e.length),r=u[0][0],i=u[0][1],s=u[1][0],o=u[1][1];return Sr(n(e),u).cells.forEach(function(n,u){var a=n.edges,f=n.site,l=t[u]=a.length?a.map(function(e){var t=e.start();return[t.x,t.y]}):f.x>=r&&f.x<=s&&f.y>=i&&f.y<=o?[[r,o],[s,o],[s,i],[r,i]]:[];l.point=e[u]}),t}function n(e){return e.map(function(e,t){return{x:Math.round(s(e,t)/Au)*Au,y:Math.round(o(e,t)/Au)*Au,i:t}})}var r=Xn,i=Vn,s=r,o=i,u=Za;return e?t(e):(t.links=function(e){return Sr(n(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},t.triangles=function(e){var t=[];return Sr(n(e)).cells.forEach(function(n,r){for(var i,s,o=n.site,u=n.edges.sort(or),a=-1,f=u.length,l=u[f-1].edge,c=l.l===o?l.r:l.l;++a<f;)i=l,s=c,l=u[a].edge,c=l.l===o?l.r:l.l,r<s.i&&r<c.i&&Tr(o,s,c)<0&&t.push([e[r],e[s.i],e[c.i]])}),t},t.x=function(e){return arguments.length?(s=dt(r=e),t):r},t.y=function(e){return arguments.length?(o=dt(i=e),t):i},t.clipExtent=function(e){return arguments.length?(u=null==e?Za:e,t):u===Za?null:u},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):u===Za?null:u&&u[1]},t)};var Za=[[-1e6,-1e6],[1e6,1e6]];Jo.geom.delaunay=function(e){return Jo.geom.voronoi().triangles(e)},Jo.geom.quadtree=function(e,t,n,r,i){function s(e){function s(e,t,n,r,i,s,o,u){if(!isNaN(n)&&!isNaN(r))if(e.leaf){var a=e.x,l=e.y;if(null!=a)if(au(a-n)+au(l-r)<.01)f(e,t,n,r,i,s,o,u);else{var c=e.point;e.x=e.y=e.point=null,f(e,c,a,l,i,s,o,u),f(e,t,n,r,i,s,o,u)}else e.x=n,e.y=r,e.point=t}else f(e,t,n,r,i,s,o,u)}function f(e,t,n,r,i,o,u,a){var f=.5*(i+u),l=.5*(o+a),c=n>=f,h=r>=l,p=(h<<1)+c;e.leaf=!1,e=e.nodes[p]||(e.nodes[p]=kr()),c?i=f:u=f,h?o=l:a=l,s(e,t,n,r,i,o,u,a)}var l,c,h,p,d,v,m,g,y,b=dt(u),w=dt(a);if(null!=t)v=t,m=n,g=r,y=i;else if(g=y=-(v=m=1/0),c=[],h=[],d=e.length,o)for(p=0;d>p;++p)l=e[p],l.x<v&&(v=l.x),l.y<m&&(m=l.y),l.x>g&&(g=l.x),l.y>y&&(y=l.y),c.push(l.x),h.push(l.y);else for(p=0;d>p;++p){var E=+b(l=e[p],p),S=+w(l,p);v>E&&(v=E),m>S&&(m=S),E>g&&(g=E),S>y&&(y=S),c.push(E),h.push(S)}var x=g-v,T=y-m;x>T?y=m+x:g=v+T;var N=kr();if(N.add=function(e){s(N,e,+b(e,++p),+w(e,p),v,m,g,y)},N.visit=function(e){Lr(e,N,v,m,g,y)},p=-1,null==t){for(;++p<d;)s(N,e[p],c[p],h[p],v,m,g,y);--p}else e.forEach(N.add);return c=h=e=l=null,N}var o,u=Xn,a=Vn;return(o=arguments.length)?(u=Nr,a=Cr,3===o&&(i=n,r=t,n=t=0),s(e)):(s.x=function(e){return arguments.length?(u=e,s):u},s.y=function(e){return arguments.length?(a=e,s):a},s.extent=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=+e[0][0],n=+e[0][1],r=+e[1][0],i=+e[1][1]),s):null==t?null:[[t,n],[r,i]]},s.size=function(e){return arguments.length?(null==e?t=n=r=i=null:(t=n=0,r=+e[0],i=+e[1]),s):null==t?null:[r-t,i-n]},s)},Jo.interpolateRgb=Ar,Jo.interpolateObject=Or,Jo.interpolateNumber=Mr,Jo.interpolateString=_r;var ef=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g;Jo.interpolate=Dr,Jo.interpolators=[function(e,t){var n=typeof t;return("string"===n?$u.has(t)||/^(#|rgb\(|hsl\()/.test(t)?Ar:_r:t instanceof W?Ar:"object"===n?Array.isArray(t)?Pr:Or:Mr)(e,t)}],Jo.interpolateArray=Pr;var tf=function(){return vt},nf=Jo.map({linear:tf,poly:Rr,quad:function(){return Fr},cubic:function(){return Ir},sin:function(){return Ur},exp:function(){return zr},circle:function(){return Wr},elastic:Xr,back:Vr,bounce:function(){return $r}}),rf=Jo.map({"in":vt,out:Br,"in-out":jr,"out-in":function(e){return jr(Br(e))}});Jo.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.substring(0,t):e,r=t>=0?e.substring(t+1):"in";return n=nf.get(n)||tf,r=rf.get(r)||vt,Hr(r(n.apply(null,Ko.call(arguments,1))))},Jo.interpolateHcl=Jr,Jo.interpolateHsl=Kr,Jo.interpolateLab=Qr,Jo.interpolateRound=Gr,Jo.transform=function(e){var t=Go.createElementNS(Jo.ns.prefix.svg,"g");return(Jo.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new Yr(n?n.matrix:sf)})(e)},Yr.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var sf={a:1,b:0,c:0,d:1,e:0,f:0};Jo.interpolateTransform=ni,Jo.layout={},Jo.layout.bundle=function(){return function(e){for(var t=[],n=-1,r=e.length;++n<r;)t.push(si(e[n]));return t}},Jo.layout.chord=function(){function e(){var e,f,c,h,p,d={},v=[],m=Jo.range(s),g=[];for(n=[],r=[],e=0,h=-1;++h<s;){for(f=0,p=-1;++p<s;)f+=i[h][p];v.push(f),g.push(Jo.range(s)),e+=f}for(o&&m.sort(function(e,t){return o(v[e],v[t])}),u&&g.forEach(function(e,t){e.sort(function(e,n){return u(i[t][e],i[t][n])})}),e=(ku-l*s)/e,f=0,h=-1;++h<s;){for(c=f,p=-1;++p<s;){var y=m[h],b=g[y][p],w=i[y][b],E=f,S=f+=w*e;d[y+"-"+b]={index:y,subindex:b,startAngle:E,endAngle:S,value:w}}r[y]={index:y,startAngle:c,endAngle:f,value:(f-c)/e},f+=l}for(h=-1;++h<s;)for(p=h-1;++p<s;){var x=d[h+"-"+p],T=d[p+"-"+h];(x.value||T.value)&&n.push(x.value<T.value?{source:T,target:x}:{source:x,target:T})}a&&t()}function t(){n.sort(function(e,t){return a((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,r,i,s,o,u,a,f={},l=0;return f.matrix=function(e){return arguments.length?(s=(i=e)&&i.length,n=r=null,f):i},f.padding=function(e){return arguments.length?(l=e,n=r=null,f):l},f.sortGroups=function(e){return arguments.length?(o=e,n=r=null,f):o},f.sortSubgroups=function(e){return arguments.length?(u=e,n=null,f):u},f.sortChords=function(e){return arguments.length?(a=e,n&&t(),f):a},f.chords=function(){return n||e(),n},f.groups=function(){return r||e(),r},f},Jo.layout.force=function(){function e(e){return function(t,n,r,i){if(t.point!==e){var s=t.cx-e.x,o=t.cy-e.y,u=1/Math.sqrt(s*s+o*o);if(v>(i-n)*u){var a=t.charge*u*u;return e.px-=s*a,e.py-=o*a,!0}if(t.point&&isFinite(u)){var a=t.pointCharge*u*u;e.px-=s*a,e.py-=o*a}}return!t.charge}}function t(e){e.px=Jo.event.x,e.py=Jo.event.y,u.resume()}var n,r,i,s,o,u={},a=Jo.dispatch("start","tick","end"),f=[1,1],l=.9,c=of,h=uf,p=-30,d=.1,v=.8,m=[],g=[];return u.tick=function(){if((r*=.99)<.005)return a.end({type:"end",alpha:r=0}),!0;var t,n,u,c,h,v,y,b,w,E=m.length,S=g.length;for(n=0;S>n;++n)u=g[n],c=u.source,h=u.target,b=h.x-c.x,w=h.y-c.y,(v=b*b+w*w)&&(v=r*s[n]*((v=Math.sqrt(v))-i[n])/v,b*=v,w*=v,h.x-=b*(y=c.weight/(h.weight+c.weight)),h.y-=w*y,c.x+=b*(y=1-y),c.y+=w*y);if((y=r*d)&&(b=f[0]/2,w=f[1]/2,n=-1,y))for(;++n<E;)u=m[n],u.x+=(b-u.x)*y,u.y+=(w-u.y)*y;if(p)for(hi(t=Jo.geom.quadtree(m),r,o),n=-1;++n<E;)(u=m[n]).fixed||t.visit(e(u));for(n=-1;++n<E;)u=m[n],u.fixed?(u.x=u.px,u.y=u.py):(u.x-=(u.px-(u.px=u.x))*l,u.y-=(u.py-(u.py=u.y))*l);a.tick({type:"tick",alpha:r})},u.nodes=function(e){return arguments.length?(m=e,u):m},u.links=function(e){return arguments.length?(g=e,u):g},u.size=function(e){return arguments.length?(f=e,u):f},u.linkDistance=function(e){return arguments.length?(c="function"==typeof e?e:+e,u):c},u.distance=u.linkDistance,u.linkStrength=function(e){return arguments.length?(h="function"==typeof e?e:+e,u):h},u.friction=function(e){return arguments.length?(l=+e,u):l},u.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,u):p},u.gravity=function(e){return arguments.length?(d=+e,u):d},u.theta=function(e){return arguments.length?(v=+e,u):v},u.alpha=function(e){return arguments.length?(e=+e,r?r=e>0?e:0:e>0&&(a.start({type:"start",alpha:r=e}),Jo.timer(u.tick)),u):r},u.start=function(){function e(e,r){if(!n){for(n=new Array(a),u=0;a>u;++u)n[u]=[];for(u=0;f>u;++u){var i=g[u];n[i.source.index].push(i.target),n[i.target.index].push(i.source)}}for(var s,o=n[t],u=-1,f=o.length;++u<f;)if(!isNaN(s=o[u][e]))return s;return Math.random()*r}var t,n,r,a=m.length,l=g.length,d=f[0],v=f[1];for(t=0;a>t;++t)(r=m[t]).index=t,r.weight=0;for(t=0;l>t;++t)r=g[t],"number"==typeof r.source&&(r.source=m[r.source]),"number"==typeof r.target&&(r.target=m[r.target]),++r.source.weight,++r.target.weight;for(t=0;a>t;++t)r=m[t],isNaN(r.x)&&(r.x=e("x",d)),isNaN(r.y)&&(r.y=e("y",v)),isNaN(r.px)&&(r.px=r.x),isNaN(r.py)&&(r.py=r.y);if(i=[],"function"==typeof c)for(t=0;l>t;++t)i[t]=+c.call(this,g[t],t);else for(t=0;l>t;++t)i[t]=c;if(s=[],"function"==typeof h)for(t=0;l>t;++t)s[t]=+h.call(this,g[t],t);else for(t=0;l>t;++t)s[t]=h;if(o=[],"function"==typeof p)for(t=0;a>t;++t)o[t]=+p.call(this,m[t],t);else for(t=0;a>t;++t)o[t]=p;return u.resume()},u.resume=function(){return u.alpha(.1)},u.stop=function(){return u.alpha(0)},u.drag=function(){return n||(n=Jo.behavior.drag().origin(vt).on("dragstart.force",ai).on("drag.force",t).on("dragend.force",fi)),arguments.length?(this.on("mouseover.force",li).on("mouseout.force",ci).call(n),void 0):n},Jo.rebind(u,a,"on")};var of=20,uf=1;Jo.layout.hierarchy=function(){function e(t,o,u){var a=i.call(n,t,o);if(t.depth=o,u.push(t),a&&(f=a.length)){for(var f,l,c=-1,h=t.children=new Array(f),p=0,d=o+1;++c<f;)l=h[c]=e(a[c],d,u),l.parent=t,p+=l.value;r&&h.sort(r),s&&(t.value=p)}else delete t.children,s&&(t.value=+s.call(n,t,o)||0);return t}function t(e,r){var i=e.children,o=0;if(i&&(u=i.length))for(var u,a=-1,f=r+1;++a<u;)o+=t(i[a],f);else s&&(o=+s.call(n,e,r)||0);return s&&(e.value=o),o}function n(t){var n=[];return e(t,0,n),n}var r=mi,i=di,s=vi;return n.sort=function(e){return arguments.length?(r=e,n):r},n.children=function(e){return arguments.length?(i=e,n):i},n.value=function(e){return arguments.length?(s=e,n):s},n.revalue=function(e){return t(e,0),e},n},Jo.layout.partition=function(){function e(t,n,r,i){var s=t.children;if(t.x=n,t.y=t.depth*i,t.dx=r,t.dy=i,s&&(o=s.length)){var o,u,a,f=-1;for(r=t.value?r/t.value:0;++f<o;)e(u=s[f],n,a=u.value*r,i),n+=a}}function t(e){var n=e.children,r=0;if(n&&(i=n.length))for(var i,s=-1;++s<i;)r=Math.max(r,t(n[s]));return 1+r}function n(n,s){var o=r.call(this,n,s);return e(o[0],0,i[0],i[1]/t(o[0])),o}var r=Jo.layout.hierarchy(),i=[1,1];return n.size=function(e){return arguments.length?(i=e,n):i},pi(n,r)},Jo.layout.pie=function(){function e(s){var o=s.map(function(n,r){return+t.call(e,n,r)}),u=+("function"==typeof r?r.apply(this,arguments):r),a=(("function"==typeof i?i.apply(this,arguments):i)-u)/Jo.sum(o),f=Jo.range(s.length);null!=n&&f.sort(n===af?function(e,t){return o[t]-o[e]}:function(e,t){return n(s[e],s[t])});var l=[];return f.forEach(function(e){var t;l[e]={data:s[e],value:t=o[e],startAngle:u,endAngle:u+=t*a}}),l}var t=Number,n=af,r=0,i=ku;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(r=t,e):r},e.endAngle=function(t){return arguments.length?(i=t,e):i},e};var af={};Jo.layout.stack=function(){function e(u,a){var f=u.map(function(n,r){return t.call(e,n,r)}),l=f.map(function(t){return t.map(function(t,n){return[s.call(e,t,n),o.call(e,t,n)]})}),c=n.call(e,l,a);f=Jo.permute(f,c),l=Jo.permute(l,c);var h,p,d,v=r.call(e,l,a),m=f.length,g=f[0].length;for(p=0;g>p;++p)for(i.call(e,f[0][p],d=v[p],l[0][p][1]),h=1;m>h;++h)i.call(e,f[h][p],d+=l[h-1][p][1],l[h][p][1]);return u}var t=vt,n=Ei,r=Si,i=wi,s=yi,o=bi;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:ff.get(t)||Ei,e):n},e.offset=function(t){return arguments.length?(r="function"==typeof t?t:lf.get(t)||Si,e):r},e.x=function(t){return arguments.length?(s=t,e):s},e.y=function(t){return arguments.length?(o=t,e):o},e.out=function(t){return arguments.length?(i=t,e):i},e};var ff=Jo.map({"inside-out":function(e){var t,n,r=e.length,i=e.map(xi),s=e.map(Ti),o=Jo.range(r).sort(function(e,t){return i[e]-i[t]}),u=0,a=0,f=[],l=[];for(t=0;r>t;++t)n=o[t],a>u?(u+=s[n],f.push(n)):(a+=s[n],l.push(n));return l.reverse().concat(f)},reverse:function(e){return Jo.range(e.length).reverse()},"default":Ei}),lf=Jo.map({silhouette:function(e){var t,n,r,i=e.length,s=e[0].length,o=[],u=0,a=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++)r+=e[t][n][1];r>u&&(u=r),o.push(r)}for(n=0;s>n;++n)a[n]=(u-o[n])/2;return a},wiggle:function(e){var t,n,r,i,s,o,u,a,f,l=e.length,c=e[0],h=c.length,p=[];for(p[0]=a=f=0,n=1;h>n;++n){for(t=0,i=0;l>t;++t)i+=e[t][n][1];for(t=0,s=0,u=c[n][0]-c[n-1][0];l>t;++t){for(r=0,o=(e[t][n][1]-e[t][n-1][1])/(2*u);t>r;++r)o+=(e[r][n][1]-e[r][n-1][1])/u;s+=o*e[t][n][1]}p[n]=a-=i?s/i*u:0,f>a&&(f=a)}for(n=0;h>n;++n)p[n]-=f;return p},expand:function(e){var t,n,r,i=e.length,s=e[0].length,o=1/i,u=[];for(n=0;s>n;++n){for(t=0,r=0;i>t;t++)r+=e[t][n][1];if(r)for(t=0;i>t;t++)e[t][n][1]/=r;else for(t=0;i>t;t++)e[t][n][1]=o}for(n=0;s>n;++n)u[n]=0;return u},zero:Si});Jo.layout.histogram=function(){function e(e,s){for(var o,u,a=[],f=e.map(n,this),l=r.call(this,f,s),c=i.call(this,l,f,s),s=-1,h=f.length,p=c.length-1,d=t?1:1/h;++s<p;)o=a[s]=[],o.dx=c[s+1]-(o.x=c[s]),o.y=0;if(p>0)for(s=-1;++s<h;)u=f[s],u>=l[0]&&u<=l[1]&&(o=a[Jo.bisect(c,u,1,p)-1],o.y+=d,o.push(e[s]));return a}var t=!0,n=Number,r=Li,i=Ci;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(r=dt(t),e):r},e.bins=function(t){return arguments.length?(i="number"==typeof t?function(e){return ki(e,t)}:dt(t),e):i},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},Jo.layout.tree=function(){function e(e,s){function o(e,t){var r=e.children,i=e._tree;if(r&&(s=r.length)){for(var s,u,f,l=r[0],c=l,h=-1;++h<s;)f=r[h],o(f,u),c=a(f,u,c),u=f;ji(e);var p=.5*(l._tree.prelim+f._tree.prelim);t?(i.prelim=t._tree.prelim+n(e,t),i.mod=i.prelim-p):i.prelim=p}else t&&(i.prelim=t._tree.prelim+n(e,t))}function u(e,t){e.x=e._tree.prelim+t;var n=e.children;if(n&&(r=n.length)){var r,i=-1;for(t+=e._tree.mod;++i<r;)u(n[i],t)}}function a(e,t,r){if(t){for(var i,s=e,o=e,u=t,a=e.parent.children[0],f=s._tree.mod,l=o._tree.mod,c=u._tree.mod,h=a._tree.mod;u=Mi(u),s=Oi(s),u&&s;)a=Oi(a),o=Mi(o),o._tree.ancestor=e,i=u._tree.prelim+c-s._tree.prelim-f+n(u,s),i>0&&(Fi(Ii(u,e,r),e,i),f+=i,l+=i),c+=u._tree.mod,f+=s._tree.mod,h+=a._tree.mod,l+=o._tree.mod;u&&!Mi(o)&&(o._tree.thread=u,o._tree.mod+=c-l),s&&!Oi(a)&&(a._tree.thread=s,a._tree.mod+=f-h,r=e)}return r}var f=t.call(this,e,s),l=f[0];Bi(l,function(e,t){e._tree={ancestor:e,prelim:0,mod:0,change:0,shift:0,number:t?t._tree.number+1:0}}),o(l),u(l,-l._tree.prelim);var c=_i(l,Pi),h=_i(l,Di),p=_i(l,Hi),d=c.x-n(c,h)/2,v=h.x+n(h,c)/2,m=p.depth||1;return Bi(l,i?function(e){e.x*=r[0],e.y=e.depth*r[1],delete e._tree}:function(e){e.x=(e.x-d)/(v-d)*r[0],e.y=e.depth/m*r[1],delete e._tree}),f}var t=Jo.layout.hierarchy().sort(null).value(null),n=Ai,r=[1,1],i=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(i=null==(r=t),e):i?null:r},e.nodeSize=function(t){return arguments.length?(i=null!=(r=t),e):i?r:null},pi(e,t)},Jo.layout.pack=function(){function e(e,s){var o=n.call(this,e,s),u=o[0],a=i[0],f=i[1],l=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(u.x=u.y=0,Bi(u,function(e){e.r=+l(e.value)}),Bi(u,Wi),r){var c=r*(t?1:Math.max(2*u.r/a,2*u.r/f))/2;Bi(u,function(e){e.r+=c}),Bi(u,Wi),Bi(u,function(e){e.r-=c})}return $i(u,a/2,f/2,t?1:1/Math.max(2*u.r/a,2*u.r/f)),o}var t,n=Jo.layout.hierarchy().sort(qi),r=0,i=[1,1];return e.size=function(t){return arguments.length?(i=t,e):i},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t},e.padding=function(t){return arguments.length?(r=+t,e):r},pi(e,n)},Jo.layout.cluster=function(){function e(e,s){var o,u=t.call(this,e,s),a=u[0],f=0;Bi(a,function(e){var t=e.children;t&&t.length?(e.x=Qi(t),e.y=Ki(t)):(e.x=o?f+=n(e,o):0,e.y=0,o=e)});var l=Gi(a),c=Yi(a),h=l.x-n(l,c)/2,p=c.x+n(c,l)/2;return Bi(a,i?function(e){e.x=(e.x-a.x)*r[0],e.y=(a.y-e.y)*r[1]}:function(e){e.x=(e.x-h)/(p-h)*r[0],e.y=(1-(a.y?e.y/a.y:1))*r[1]}),u}var t=Jo.layout.hierarchy().sort(null).value(null),n=Ai,r=[1,1],i=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(i=null==(r=t),e):i?null:r},e.nodeSize=function(t){return arguments.length?(i=null!=(r=t),e):i?r:null},pi(e,t)},Jo.layout.treemap=function(){function e(e,t){for(var n,r,i=-1,s=e.length;++i<s;)r=(n=e[i]).value*(0>t?0:t),n.area=isNaN(r)||0>=r?0:r}function t(n){var s=n.children;if(s&&s.length){var o,u,a,f=c(n),l=[],h=s.slice(),d=1/0,v="slice"===p?f.dx:"dice"===p?f.dy:"slice-dice"===p?1&n.depth?f.dy:f.dx:Math.min(f.dx,f.dy);for(e(h,f.dx*f.dy/n.value),l.area=0;(a=h.length)>0;)l.push(o=h[a-1]),l.area+=o.area,"squarify"!==p||(u=r(l,v))<=d?(h.pop(),d=u):(l.area-=l.pop().area,i(l,v,f,!1),v=Math.min(f.dx,f.dy),l.length=l.area=0,d=1/0);l.length&&(i(l,v,f,!0),l.length=l.area=0),s.forEach(t)}}function n(t){var r=t.children;if(r&&r.length){var s,o=c(t),u=r.slice(),a=[];for(e(u,o.dx*o.dy/t.value),a.area=0;s=u.pop();)a.push(s),a.area+=s.area,null!=s.z&&(i(a,s.z?o.dx:o.dy,o,!u.length),a.length=a.area=0);r.forEach(n)}}function r(e,t){for(var n,r=e.area,i=0,s=1/0,o=-1,u=e.length;++o<u;)(n=e[o].area)&&(s>n&&(s=n),n>i&&(i=n));return r*=r,t*=t,r?Math.max(t*i*d/r,r/(t*s*d)):1/0}function i(e,t,n,r){var i,s=-1,o=e.length,u=n.x,f=n.y,l=t?a(e.area/t):0;if(t==n.dx){for((r||l>n.dy)&&(l=n.dy);++s<o;)i=e[s],i.x=u,i.y=f,i.dy=l,u+=i.dx=Math.min(n.x+n.dx-u,l?a(i.area/l):0);i.z=!0,i.dx+=n.x+n.dx-u,n.y+=l,n.dy-=l}else{for((r||l>n.dx)&&(l=n.dx);++s<o;)i=e[s],i.x=u,i.y=f,i.dx=l,f+=i.dy=Math.min(n.y+n.dy-f,l?a(i.area/l):0);i.z=!1,i.dy+=n.y+n.dy-f,n.x+=l,n.dx-=l}}function s(r){var i=o||u(r),s=i[0];return s.x=0,s.y=0,s.dx=f[0],s.dy=f[1],o&&u.revalue(s),e([s],s.dx*s.dy/s.value),(o?n:t)(s),h&&(o=i),i}var o,u=Jo.layout.hierarchy(),a=Math.round,f=[1,1],l=null,c=Zi,h=!1,p="squarify",d=.5*(1+Math.sqrt(5));return s.size=function(e){return arguments.length?(f=e,s):f},s.padding=function(e){function t(t){var n=e.call(s,t,t.depth);return null==n?Zi(t):es(t,"number"==typeof n?[n,n,n,n]:n)}function n(t){return es(t,e)}if(!arguments.length)return l;var r;return c=null==(l=e)?Zi:"function"==(r=typeof e)?t:"number"===r?(e=[e,e,e,e],n):n,s},s.round=function(e){return arguments.length?(a=e?Math.round:Number,s):a!=Number},s.sticky=function(e){return arguments.length?(h=e,o=null,s):h},s.ratio=function(e){return arguments.length?(d=e,s):d},s.mode=function(e){return arguments.length?(p=e+"",s):p},pi(s,u)},Jo.random={normal:function(e,t){var n=arguments.length;return 2>n&&(t=1),1>n&&(e=0),function(){var n,r,i;do n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r;while(!i||i>1);return e+t*n*Math.sqrt(-2*Math.log(i)/i)}},logNormal:function(){var e=Jo.random.normal.apply(Jo,arguments);return function(){return Math.exp(e())}},irwinHall:function(e){return function(){for(var t=0,n=0;e>n;n++)t+=Math.random();return t/e}}},Jo.scale={};var cf={floor:vt,ceil:vt};Jo.scale.linear=function(){return us([0,1],[0,1],Dr,!1)};var hf={s:1,g:1,p:1,r:1,e:1};Jo.scale.log=function(){return vs(Jo.scale.linear().domain([0,1]),10,!0,[1,10])};var pf=Jo.format(".0e"),df={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};Jo.scale.pow=function(){return ms(Jo.scale.linear(),1,[0,1])},Jo.scale.sqrt=function(){return Jo.scale.pow().exponent(.5)},Jo.scale.ordinal=function(){return ys([],{t:"range",a:[[]]})},Jo.scale.category10=function(){return Jo.scale.ordinal().range(vf)},Jo.scale.category20=function(){return Jo.scale.ordinal().range(mf)},Jo.scale.category20b=function(){return Jo.scale.ordinal().range(gf)},Jo.scale.category20c=function(){return Jo.scale.ordinal().range(yf)};var vf=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(st),mf=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(st),gf=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(st),yf=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(st);Jo.scale.quantile=function(){return bs([],[])},Jo.scale.quantize=function(){return ws(0,1,[0,1])},Jo.scale.threshold=function(){return Es([.5],[0,1])},Jo.scale.identity=function(){return Ss([0,1])},Jo.svg={},Jo.svg.arc=function(){function e(){var e=t.apply(this,arguments),s=n.apply(this,arguments),o=r.apply(this,arguments)+bf,u=i.apply(this,arguments)+bf,a=(o>u&&(a=o,o=u,u=a),u-o),f=Cu>a?"0":"1",l=Math.cos(o),c=Math.sin(o),h=Math.cos(u),p=Math.sin(u);return a>=wf?e?"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+ -e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+s+"A"+s+","+s+" 0 1,1 0,"+ -s+"A"+s+","+s+" 0 1,1 0,"+s+"Z":e?"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+f+",0 "+e*l+","+e*c+"Z":"M"+s*l+","+s*c+"A"+s+","+s+" 0 "+f+",1 "+s*h+","+s*p+"L0,0"+"Z"}var t=xs,n=Ts,r=Ns,i=Cs;return e.innerRadius=function(n){return arguments.length?(t=dt(n),e):t},e.outerRadius=function(t){return arguments.length?(n=dt(t),e):n},e.startAngle=function(t){return arguments.length?(r=dt(t),e):r},e.endAngle=function(t){return arguments.length?(i=dt(t),e):i},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,s=(r.apply(this,arguments)+i.apply(this,arguments))/2+bf;return[Math.cos(s)*e,Math.sin(s)*e]},e};var bf=-Lu,wf=ku-Au;Jo.svg.line=function(){return ks(vt)};var Ef=Jo.map({linear:Ls,"linear-closed":As,step:Os,"step-before":Ms,"step-after":_s,basis:Fs,"basis-open":Is,"basis-closed":qs,bundle:Rs,cardinal:Hs,"cardinal-open":Ds,"cardinal-closed":Ps,monotone:$s});Ef.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var Sf=[0,2/3,1/3,0],xf=[0,1/3,2/3,0],Tf=[0,1/6,2/3,1/6];Jo.svg.line.radial=function(){var e=ks(Js);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},Ms.reverse=_s,_s.reverse=Ms,Jo.svg.area=function(){return Ks(vt)},Jo.svg.area.radial=function(){var e=Ks(Js);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},Jo.svg.chord=function(){function e(e,u){var a=t(this,s,e,u),f=t(this,o,e,u);return"M"+a.p0+r(a.r,a.p1,a.a1-a.a0)+(n(a,f)?i(a.r,a.p1,a.r,a.p0):i(a.r,a.p1,f.r,f.p0)+r(f.r,f.p1,f.a1-f.a0)+i(f.r,f.p1,a.r,a.p0))+"Z"}function t(e,t,n,r){var i=t.call(e,n,r),s=u.call(e,i,r),o=a.call(e,i,r)+bf,l=f.call(e,i,r)+bf;return{r:s,a0:o,a1:l,p0:[s*Math.cos(o),s*Math.sin(o)],p1:[s*Math.cos(l),s*Math.sin(l)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function r(e,t,n){return"A"+e+","+e+" 0 "+ +(n>Cu)+",1 "+t}function i(e,t,n,r){return"Q 0,0 "+r}var s=Hn,o=Bn,u=Qs,a=Ns,f=Cs;return e.radius=function(t){return arguments.length?(u=dt(t),e):u},e.source=function(t){return arguments.length?(s=dt(t),e):s},e.target=function(t){return arguments.length?(o=dt(t),e):o},e.startAngle=function(t){return arguments.length?(a=dt(t),e):a},e.endAngle=function(t){return arguments.length?(f=dt(t),e):f},e},Jo.svg.diagonal=function(){function e(e,i){var s=t.call(this,e,i),o=n.call(this,e,i),u=(s.y+o.y)/2,a=[s,{x:s.x,y:u},{x:o.x,y:u},o];return a=a.map(r),"M"+a[0]+"C"+a[1]+" "+a[2]+" "+a[3]}var t=Hn,n=Bn,r=Gs;return e.source=function(n){return arguments.length?(t=dt(n),e):t},e.target=function(t){return arguments.length?(n=dt(t),e):n},e.projection=function(t){return arguments.length?(r=t,e):r},e},Jo.svg.diagonal.radial=function(){var e=Jo.svg.diagonal(),t=Gs,n=e.projection;return e.projection=function(e){return arguments.length?n(Ys(t=e)):t},e},Jo.svg.symbol=function(){function e(e,r){return(Nf.get(t.call(this,e,r))||to)(n.call(this,e,r))}var t=eo,n=Zs;return e.type=function(n){return arguments.length?(t=dt(n),e):t},e.size=function(t){return arguments.length?(n=dt(t),e):n},e};var Nf=Jo.map({circle:to,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+ -3*t+","+ -t+"H"+ -t+"V"+ -3*t+"H"+t+"V"+ -t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+ -t+"V"+t+"H"+ -3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*Af)),n=t*Af;return"M0,"+ -t+"L"+n+",0"+" 0,"+t+" "+ -n+",0"+"Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+ -t+","+ -t+"L"+t+","+ -t+" "+t+","+t+" "+ -t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/Lf),n=t*Lf/2;return"M0,"+n+"L"+t+","+ -n+" "+ -t+","+ -n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/Lf),n=t*Lf/2;return"M0,"+ -n+"L"+t+","+n+" "+ -t+","+n+"Z"}});Jo.svg.symbolTypes=Nf.keys();var Cf,kf,Lf=Math.sqrt(3),Af=Math.tan(30*Mu),Of=[],Mf=0;Of.call=yu.call,Of.empty=yu.empty,Of.node=yu.node,Of.size=yu.size,Jo.transition=function(e){return arguments.length?Cf?e.transition():e:Eu.transition()},Jo.transition.prototype=Of,Of.select=function(e){var t,n,r,i=this.id,s=[];e=v(e);for(var o=-1,u=this.length;++o<u;){s.push(t=[]);for(var a=this[o],f=-1,l=a.length;++f<l;)(r=a[f])&&(n=e.call(r,r.__data__,f,o))?("__data__"in r&&(n.__data__=r.__data__),so(n,f,i,r.__transition__[i]),t.push(n)):t.push(null)}return no(s,i)},Of.selectAll=function(e){var t,n,r,i,s,o=this.id,u=[];e=m(e);for(var a=-1,f=this.length;++a<f;)for(var l=this[a],c=-1,h=l.length;++c<h;)if(r=l[c]){s=r.__transition__[o],n=e.call(r,r.__data__,c,a),u.push(t=[]);for(var p=-1,d=n.length;++p<d;)(i=n[p])&&so(i,p,o,s),t.push(i)}return no(u,o)},Of.filter=function(e){var t,n,r,i=[];"function"!=typeof e&&(e=C(e));for(var s=0,o=this.length;o>s;s++){i.push(t=[]);for(var n=this[s],u=0,a=n.length;a>u;u++)(r=n[u])&&e.call(r,r.__data__,u,s)&&t.push(r)}return no(i,this.id)},Of.tween=function(e,t){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(e):L(this,null==t?function(t){t.__transition__[n].tween.remove(e)}:function(r){r.__transition__[n].tween.set(e,t)})},Of.attr=function(e,t){function n(){this.removeAttribute(u)}function r(){this.removeAttributeNS(u.space,u.local)}function i(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(u);return n!==e&&(t=o(n,e),function(e){this.setAttribute(u,t(e))})})}function s(e){return null==e?r:(e+="",function(){var t,n=this.getAttributeNS(u.space,u.local);return n!==e&&(t=o(n,e),function(e){this.setAttributeNS(u.space,u.local,t(e))})})}if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var o="transform"==e?ni:Dr,u=Jo.ns.qualify(e);return ro(this,"attr."+e,t,u.local?s:i)},Of.attrTween=function(e,t){function n(e,n){var r=t.call(this,e,n,this.getAttribute(i));return r&&function(e){this.setAttribute(i,r(e))}}function r(e,n){var r=t.call(this,e,n,this.getAttributeNS(i.space,i.local));return r&&function(e){this.setAttributeNS(i.space,i.local,r(e))}}var i=Jo.ns.qualify(e);return this.tween("attr."+e,i.local?r:n)},Of.style=function(e,t,n){function r(){this.style.removeProperty(e)}function i(t){return null==t?r:(t+="",function(){var r,i=Zo.getComputedStyle(this,null).getPropertyValue(e);return i!==t&&(r=Dr(i,t),function(t){this.style.setProperty(e,r(t),n)})})}var s=arguments.length;if(3>s){if("string"!=typeof e){2>s&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return ro(this,"style."+e,t,i)},Of.styleTween=function(e,t,n){function r(r,i){var s=t.call(this,r,i,Zo.getComputedStyle(this,null).getPropertyValue(e));return s&&function(t){this.style.setProperty(e,s(t),n)}}return arguments.length<3&&(n=""),this.tween("style."+e,r)},Of.text=function(e){return ro(this,"text",e,io)},Of.remove=function(){return this.each("end.transition",function(){var e;this.__transition__.count<2&&(e=this.parentNode)&&e.removeChild(this)})},Of.ease=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof e&&(e=Jo.ease.apply(Jo,arguments)),L(this,function(n){n.__transition__[t].ease=e}))},Of.delay=function(e){var t=this.id;return L(this,"function"==typeof e?function(n,r,i){n.__transition__[t].delay=+e.call(n,n.__data__,r,i)}:(e=+e,function(n){n.__transition__[t].delay=e}))},Of.duration=function(e){var t=this.id;return L(this,"function"==typeof e?function(n,r,i){n.__transition__[t].duration=Math.max(1,e.call(n,n.__data__,r,i))}:(e=Math.max(1,e),function(n){n.__transition__[t].duration=e}))},Of.each=function(e,t){var n=this.id;if(arguments.length<2){var r=kf,i=Cf;Cf=n,L(this,function(t,r,i){kf=t.__transition__[n],e.call(t,t.__data__,r,i)}),kf=r,Cf=i}else L(this,function(r){var i=r.__transition__[n];(i.event||(i.event=Jo.dispatch("start","end"))).on(e,t)});return this},Of.transition=function(){for(var e,t,n,r,i=this.id,s=++Mf,o=[],u=0,a=this.length;a>u;u++){o.push(e=[]);for(var t=this[u],f=0,l=t.length;l>f;f++)(n=t[f])&&(r=Object.create(n.__transition__[i]),r.delay+=r.duration,so(n,f,s,r)),e.push(n)}return no(o,s)},Jo.svg.axis=function(){function e(e){e.each(function(){var e,f=Jo.select(this),l=this.__chart__||n,c=this.__chart__=n.copy(),h=null==a?c.ticks?c.ticks.apply(c,u):c.domain():a,p=null==t?c.tickFormat?c.tickFormat.apply(c,u):vt:t,d=f.selectAll(".tick").data(h,c),v=d.enter().insert("g",".domain").attr("class","tick").style("opacity",Au),m=Jo.transition(d.exit()).style("opacity",Au).remove(),g=Jo.transition(d).style("opacity",1),y=ns(c),b=f.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),Jo.transition(b));v.append("line"),v.append("text");var E=v.select("line"),S=g.select("line"),x=d.select("text").text(p),T=v.select("text"),N=g.select("text");switch(r){case"bottom":e=oo,E.attr("y2",i),T.attr("y",Math.max(i,0)+o),S.attr("x2",0).attr("y2",i),N.attr("x",0).attr("y",Math.max(i,0)+o),x.attr("dy",".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+s+"V0H"+y[1]+"V"+s);break;case"top":e=oo,E.attr("y2",-i),T.attr("y",-(Math.max(i,0)+o)),S.attr("x2",0).attr("y2",-i),N.attr("x",0).attr("y",-(Math.max(i,0)+o)),x.attr("dy","0em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+ -s+"V0H"+y[1]+"V"+ -s);break;case"left":e=uo,E.attr("x2",-i),T.attr("x",-(Math.max(i,0)+o)),S.attr("x2",-i).attr("y2",0),N.attr("x",-(Math.max(i,0)+o)).attr("y",0),x.attr("dy",".32em").style("text-anchor","end"),w.attr("d","M"+ -s+","+y[0]+"H0V"+y[1]+"H"+ -s);break;case"right":e=uo,E.attr("x2",i),T.attr("x",Math.max(i,0)+o),S.attr("x2",i).attr("y2",0),N.attr("x",Math.max(i,0)+o).attr("y",0),x.attr("dy",".32em").style("text-anchor","start"),w.attr("d","M"+s+","+y[0]+"H0V"+y[1]+"H"+s)}if(c.rangeBand){var C=c,k=C.rangeBand()/2;l=c=function(e){return C(e)+k}}else l.rangeBand?l=c:m.call(e,c);v.call(e,l),g.call(e,c)})}var t,n=Jo.scale.linear(),r=_f,i=6,s=6,o=3,u=[10],a=null;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(r=t in Df?t+"":_f,e):r},e.ticks=function(){return arguments.length?(u=arguments,e):u},e.tickValues=function(t){return arguments.length?(a=t,e):a},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t){var n=arguments.length;return n?(i=+t,s=+arguments[n-1],e):i},e.innerTickSize=function(t){return arguments.length?(i=+t,e):i},e.outerTickSize=function(t){return arguments.length?(s=+t,e):s},e.tickPadding=function(t){return arguments.length?(o=+t,e):o},e.tickSubdivide=function(){return arguments.length&&e},e};var _f="bottom",Df={top:1,right:1,bottom:1,left:1};Jo.svg.brush=function(){function e(s){s.each(function(){var s=Jo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",i).on("touchstart.brush",i),o=s.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),s.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var u=s.selectAll(".resize").data(m,vt);u.exit().remove(),u.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return Pf[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),u.style("display",e.empty()?"none":null);var l,c=Jo.transition(s),h=Jo.transition(o);a&&(l=ns(a),h.attr("x",l[0]).attr("width",l[1]-l[0]),n(c)),f&&(l=ns(f),h.attr("y",l[0]).attr("height",l[1]-l[0]),r(c)),t(c)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+l[+/e$/.test(e)]+","+h[+/^s/.test(e)]+")"})}function n(e){e.select(".extent").attr("x",l[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",l[1]-l[0])}function r(e){e.select(".extent").attr("y",h[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",h[1]-h[0])}function i(){function i(){32==Jo.event.keyCode&&(L||(b=null,O[0]-=l[1],O[1]-=h[1],L=2),c())}function p(){32==Jo.event.keyCode&&2==L&&(O[0]+=l[1],O[1]+=h[1],L=0,c())}function m(){var e=Jo.mouse(E),i=!1;w&&(e[0]+=w[0],e[1]+=w[1]),L||(Jo.event.altKey?(b||(b=[(l[0]+l[1])/2,(h[0]+h[1])/2]),O[0]=l[+(e[0]<b[0])],O[1]=h[+(e[1]<b[1])]):b=null),C&&g(e,a,0)&&(n(T),i=!0),k&&g(e,f,1)&&(r(T),i=!0),i&&(t(T),x({type:"brush",mode:L?"move":"resize"}))}function g(e,t,n){var r,i,u=ns(t),a=u[0],f=u[1],c=O[n],p=n?h:l,m=p[1]-p[0];return L&&(a-=c,f-=m+c),r=(n?v:d)?Math.max(a,Math.min(f,e[n])):e[n],L?i=(r+=c)+m:(b&&(c=Math.max(a,Math.min(f,2*b[n]-r))),r>c?(i=r,r=c):i=c),p[0]!=r||p[1]!=i?(n?o=null:s=null,p[0]=r,p[1]=i,!0):void 0}function y(){m(),T.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),Jo.select("body").style("cursor",null),M.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),A(),x({type:"brushend"})}var b,w,E=this,S=Jo.select(Jo.event.target),x=u.of(E,arguments),T=Jo.select(E),N=S.datum(),C=!/^(n|s)$/.test(N)&&a,k=!/^(e|w)$/.test(N)&&f,L=S.classed("extent"),A=H(),O=Jo.mouse(E),M=Jo.select(Zo).on("keydown.brush",i).on("keyup.brush",p);if(Jo.event.changedTouches?M.on("touchmove.brush",m).on("touchend.brush",y):M.on("mousemove.brush",m).on("mouseup.brush",y),T.interrupt().selectAll("*").interrupt(),L)O[0]=l[0]-O[0],O[1]=h[0]-O[1];else if(N){var _=+/w$/.test(N),D=+/^n/.test(N);w=[l[1-_]-O[0],h[1-D]-O[1]],O[0]=l[_],O[1]=h[D]}else Jo.event.altKey&&(b=O.slice());T.style("pointer-events","none").selectAll(".resize").style("display",null),Jo.select("body").style("cursor",S.style("cursor")),x({type:"brushstart"}),m()}var s,o,u=p(e,"brushstart","brush","brushend"),a=null,f=null,l=[0,0],h=[0,0],d=!0,v=!0,m=Hf[0];return e.event=function(e){e.each(function(){var e=u.of(this,arguments),t={x:l,y:h,i:s,j:o},n=this.__chart__||t;this.__chart__=t,Cf?Jo.select(this).transition().each("start.brush",function(){s=n.i,o=n.j,l=n.x,h=n.y,e({type:"brushstart"})}).tween("brush:brush",function(){var n=Pr(l,t.x),r=Pr(h,t.y);return s=o=null,function(i){l=t.x=n(i),h=t.y=r(i),e({type:"brush",mode:"resize"})}}).each("end.brush",function(){s=t.i,o=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"})}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}))})},e.x=function(t){return arguments.length?(a=t,m=Hf[!a<<1|!f],e):a},e.y=function(t){return arguments.length?(f=t,m=Hf[!a<<1|!f],e):f},e.clamp=function(t){return arguments.length?(a&&f?(d=!!t[0],v=!!t[1]):a?d=!!t:f&&(v=!!t),e):a&&f?[d,v]:a?d:f?v:null},e.extent=function(t){var n,r,i,u,c;return arguments.length?(a&&(n=t[0],r=t[1],f&&(n=n[0],r=r[0]),s=[n,r],a.invert&&(n=a(n),r=a(r)),n>r&&(c=n,n=r,r=c),(n!=l[0]||r!=l[1])&&(l=[n,r])),f&&(i=t[0],u=t[1],a&&(i=i[1],u=u[1]),o=[i,u],f.invert&&(i=f(i),u=f(u)),i>u&&(c=i,i=u,u=c),(i!=h[0]||u!=h[1])&&(h=[i,u])),e):(a&&(s?(n=s[0],r=s[1]):(n=l[0],r=l[1],a.invert&&(n=a.invert(n),r=a.invert(r)),n>r&&(c=n,n=r,r=c))),f&&(o?(i=o[0],u=o[1]):(i=h[0],u=h[1],f.invert&&(i=f.invert(i),u=f.invert(u)),i>u&&(c=i,i=u,u=c))),a&&f?[[n,i],[r,u]]:a?[n,r]:f&&[i,u])},e.clear=function(){return e.empty()||(l=[0,0],h=[0,0],s=o=null),e},e.empty=function(){return!!a&&l[0]==l[1]||!!f&&h[0]==h[1]},Jo.rebind(e,u,"on")};var Pf={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Hf=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Bf=Jo.time={},jf=Date,Ff=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];ao.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){If.setUTCDate.apply(this._,arguments)},setDay:function(){If.setUTCDay.apply(this._,arguments)},setFullYear:function(){If.setUTCFullYear.apply(this._,arguments)},setHours:function(){If.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){If.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){If.setUTCMinutes.apply(this._,arguments)},setMonth:function(){If.setUTCMonth.apply(this._,arguments)},setSeconds:function(){If.setUTCSeconds.apply(this._,arguments)},setTime:function(){If.setTime.apply(this._,arguments)}};var If=Date.prototype,qf="%a %b %e %X %Y",Rf="%m/%d/%Y",Uf="%H:%M:%S",zf=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],Wf=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Xf=["January","February","March","April","May","June","July","August","September","October","November","December"],Vf=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];Bf.year=fo(function(e){return e=Bf.day(e),e.setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),Bf.years=Bf.year.range,Bf.years.utc=Bf.year.utc.range,Bf.day=fo(function(e){var t=new jf(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),Bf.days=Bf.day.range,Bf.days.utc=Bf.day.utc.range,Bf.dayOfYear=function(e){var t=Bf.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},Ff.forEach(function(e,t){e=e.toLowerCase(),t=7-t;var n=Bf[e]=fo(function(e){return(e=Bf.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=Bf.year(e).getDay();return Math.floor((Bf.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});Bf[e+"s"]=n.range,Bf[e+"s"].utc=n.utc.range,Bf[e+"OfYear"]=function(e){var n=Bf.year(e).getDay();return Math.floor((Bf.dayOfYear(e)+(n+t)%7)/7)}}),Bf.week=Bf.sunday,Bf.weeks=Bf.sunday.range,Bf.weeks.utc=Bf.sunday.utc.range,Bf.weekOfYear=Bf.sundayOfYear,Bf.format=co;var $f=po(zf),Jf=vo(zf),Kf=po(Wf),Qf=vo(Wf),Gf=po(Xf),Yf=vo(Xf),Zf=po(Vf),el=vo(Vf),tl=/^%/,nl={"-":"",_:" ",0:"0"},rl={a:function(e){return Wf[e.getDay()]},A:function(e){return zf[e.getDay()]},b:function(e){return Vf[e.getMonth()]},B:function(e){return Xf[e.getMonth()]},c:co(qf),d:function(e,t){return mo(e.getDate(),t,2)},e:function(e,t){return mo(e.getDate(),t,2)},H:function(e,t){return mo(e.getHours(),t,2)},I:function(e,t){return mo(e.getHours()%12||12,t,2)},j:function(e,t){return mo(1+Bf.dayOfYear(e),t,3)},L:function(e,t){return mo(e.getMilliseconds(),t,3)},m:function(e,t){return mo(e.getMonth()+1,t,2)},M:function(e,t){return mo(e.getMinutes(),t,2)},p:function(e){return e.getHours()>=12?"PM":"AM"},S:function(e,t){return mo(e.getSeconds(),t,2)},U:function(e,t){return mo(Bf.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return mo(Bf.mondayOfYear(e),t,2)},x:co(Rf),X:co(Uf),y:function(e,t){return mo(e.getFullYear()%100,t,2)},Y:function(e,t){return mo(e.getFullYear()%1e4,t,4)},Z:Io,"%":function(){return"%"}},il={a:go,A:yo,b:So,B:xo,c:To,d:_o,e:_o,H:Po,I:Po,j:Do,L:jo,m:Mo,M:Ho,p:Fo,S:Bo,U:wo,w:bo,W:Eo,x:No,X:Co,y:Lo,Y:ko,Z:Ao,"%":qo},sl=/^\s*\d+/,ol=Jo.map({am:0,pm:1});co.utc=Ro;var ul=Ro("%Y-%m-%dT%H:%M:%S.%LZ");co.iso=Date.prototype.toISOString&&+(new Date("2000-01-01T00:00:00.000Z"))?Uo:ul,Uo.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},Uo.toString=ul.toString,Bf.second=fo(function(e){return new jf(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),Bf.seconds=Bf.second.range,Bf.seconds.utc=Bf.second.utc.range,Bf.minute=fo(function(e){return new jf(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),Bf.minutes=Bf.minute.range,Bf.minutes.utc=Bf.minute.utc.range,Bf.hour=fo(function(e){var t=e.getTimezoneOffset()/60;return new jf(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),Bf.hours=Bf.hour.range,Bf.hours.utc=Bf.hour.utc.range,Bf.month=fo(function(e){return e=Bf.day(e),e.setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),Bf.months=Bf.month.range,Bf.months.utc=Bf.month.utc.range;var al=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],fl=[[Bf.second,1],[Bf.second,5],[Bf.second,15],[Bf.second,30],[Bf.minute,1],[Bf.minute,5],[Bf.minute,15],[Bf.minute,30],[Bf.hour,1],[Bf.hour,3],[Bf.hour,6],[Bf.hour,12],[Bf.day,1],[Bf.day,2],[Bf.week,1],[Bf.month,1],[Bf.month,3],[Bf.year,1]],ll=[[co("%Y"),Wt],[co("%B"),function(e){return e.getMonth()}],[co("%b %d"),function(e){return 1!=e.getDate()}],[co("%a %d"),function(e){return e.getDay()&&1!=e.getDate()}],[co("%I %p"),function(e){return e.getHours()}],[co("%I:%M"),function(e){return e.getMinutes()}],[co(":%S"),function(e){return e.getSeconds()}],[co(".%L"),function(e){return e.getMilliseconds()}]],cl=Xo(ll);fl.year=Bf.year,Bf.scale=function(){return zo(Jo.scale.linear(),fl,cl)};var hl={range:function(e,t,n){return Jo.range(+e,+t,n).map(Wo)}},pl=fl.map(function(e){return[e[0].utc,e[1]]}),dl=[[Ro("%Y"),Wt],[Ro("%B"),function(e){return e.getUTCMonth()}],[Ro("%b %d"),function(e){return 1!=e.getUTCDate()}],[Ro("%a %d"),function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],[Ro("%I %p"),function(e){return e.getUTCHours()}],[Ro("%I:%M"),function(e){return e.getUTCMinutes()}],[Ro(":%S"),function(e){return e.getUTCSeconds()}],[Ro(".%L"),function(e){return e.getUTCMilliseconds()}]],vl=Xo(dl);return pl.year=Bf.year.utc,Bf.scale.utc=function(){return zo(Jo.scale.linear(),pl,vl)},Jo.text=mt(function(e){return e.responseText}),Jo.json=function(e,t){return gt(e,"application/json",Vo,t)},Jo.html=function(e,t){return gt(e,"text/html",$o,t)},Jo.xml=mt(function(e){return e.responseXML}),Jo}(),define("d3",function(e){return function(){var t,n;return t||e.d3}}(this)),function(){function i(e){return _.chain(_.range(e,10)).reverse().map(function(e){return'g[data-index="'+e+'"]'}).value().join(", ")}function s(e,t){var n=e.getAttribute("class");return(n!==null?n.replace(/color\d+/g,""):"")+" color"+t}function a(e,t){return _.chain(e).pluck("data").flatten().pluck(t).uniq().filter(function(e){return e!==undefined&&e!==null}).value().sort(d3.ascending)}function f(e,t){var n=e[0],r=e[1],i,s;return n===r&&(s=Math.max(Math.round(n/10),4),n-=s,r+=s),i=r-n,n=n?n-i/10:n,n=e[0]>0?Math.max(n,0):n,r=r?r+i/10:r,r=e[1]<0?Math.min(r,0):r,[n,r]}function l(e,t,n,r){var i,s=_.chain(t).pluck("data").flatten().value();return i={x:d3.extent(s,function(e){return e.x}),y:d3.extent(s,function(e){return e.y})},_.each([n,r],function(t,n){var r=n?"y":"x",o;i[r]=d3.extent(s,function(e){return e[r]});if(t==="ordinal")return;_.each([r+"Min",r+"Max"],function(n,s){t!=="time"&&(o=f(i[r])),e.hasOwnProperty(n)&&e[n]!==null?i[r][s]=e[n]:t!=="time"&&(i[r][s]=o[s])})}),i}function p(){var e=document;return!!e.createElementNS&&!!e.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect}function e(e,t,n,r){var i=this,s;i._options=r=_.defaults(r||{},h);if(p()===!1)return r.unsupported(n);i._selector=n,i._container=d3.select(n),i._drawSvg(),i._mainStorage={},i._compStorage={},t=_.clone(t),e&&!t.type&&(t.type=e),i.setData(t),d3.select(window).on("resize.for."+n,function(){s&&clearTimeout(s),s=setTimeout(function(){s=null,i._resize()},500)})}var e,t={},n={},r={};(function(){var e=this,t=e._,n={},r=Array.prototype,i=Object.prototype,s=Function.prototype,o=r.push,u=r.slice,a=r.concat,f=i.toString,l=i.hasOwnProperty,c=r.forEach,h=r.map,p=r.reduce,d=r.reduceRight,v=r.filter,m=r.every,g=r.some,y=r.indexOf,b=r.lastIndexOf,w=Array.isArray,E=Object.keys,S=s.bind,x=function(e){return e instanceof x?e:this instanceof x?(this._wrapped=e,void 0):new x(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=x),exports._=x):e._=x,x.VERSION="1.4.3";var T=x.each=x.forEach=function(e,t,r){if(null!=e)if(c&&e.forEach===c)e.forEach(t,r);else if(e.length===+e.length){for(var i=0,s=e.length;s>i;i++)if(t.call(r,e[i],i,e)===n)return}else for(var o in e)if(x.has(e,o)&&t.call(r,e[o],o,e)===n)return};x.map=x.collect=function(e,t,n){var r=[];return null==e?r:h&&e.map===h?e.map(t,n):(T(e,function(e,i,s){r[r.length]=t.call(n,e,i,s)}),r)};var N="Reduce of empty array with no initial value";x.reduce=x.foldl=x.inject=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),p&&e.reduce===p)return r&&(t=x.bind(t,r)),i?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){i?n=t.call(r,n,e,s,o):(n=e,i=!0)}),!i)throw new TypeError(N);return n},x.reduceRight=x.foldr=function(e,t,n,r){var i=arguments.length>2;if(null==e&&(e=[]),d&&e.reduceRight===d)return r&&(t=x.bind(t,r)),i?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=x.keys(e);s=o.length}if(T(e,function(u,a,f){a=o?o[--s]:--s,i?n=t.call(r,n,e[a],a,f):(n=e[a],i=!0)}),!i)throw new TypeError(N);return n},x.find=x.detect=function(e,t,n){var r;return C(e,function(e,i,s){return t.call(n,e,i,s)?(r=e,!0):void 0}),r},x.filter=x.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(T(e,function(e,i,s){t.call(n,e,i,s)&&(r[r.length]=e)}),r)},x.reject=function(e,t,n){return x.filter(e,function(e,r,i){return!t.call(n,e,r,i)},n)},x.every=x.all=function(e,t,r){t||(t=x.identity);var i=!0;return null==e?i:m&&e.every===m?e.every(t,r):(T(e,function(e,s,o){return(i=i&&t.call(r,e,s,o))?void 0:n}),!!i)};var C=x.some=x.any=function(e,t,r){t||(t=x.identity);var i=!1;return null==e?i:g&&e.some===g?e.some(t,r):(T(e,function(e,s,o){return i||(i=t.call(r,e,s,o))?n:void 0}),!!i)};x.contains=x.include=function(e,t){return null==e?!1:y&&e.indexOf===y?-1!=e.indexOf(t):C(e,function(e){return e===t})},x.invoke=function(e,t){var n=u.call(arguments,2);return x.map(e,function(e){return(x.isFunction(t)?t:e[t]).apply(e,n)})},x.pluck=function(e,t){return x.map(e,function(e){return e[t]})},x.where=function(e,t){return x.isEmpty(t)?[]:x.filter(e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},x.max=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.max.apply(Math,e);if(!t&&x.isEmpty(e))return-1/0;var r={computed:-1/0,value:-1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;o>=r.computed&&(r={value:e,computed:o})}),r.value},x.min=function(e,t,n){if(!t&&x.isArray(e)&&e[0]===+e[0]&&65535>e.length)return Math.min.apply(Math,e);if(!t&&x.isEmpty(e))return 1/0;var r={computed:1/0,value:1/0};return T(e,function(e,i,s){var o=t?t.call(n,e,i,s):e;r.computed>o&&(r={value:e,computed:o})}),r.value},x.shuffle=function(e){var t,n=0,r=[];return T(e,function(e){t=x.random(n++),r[n-1]=r[t],r[t]=e}),r};var k=function(e){return x.isFunction(e)?e:function(t){return t[e]}};x.sortBy=function(e,t,n){var r=k(t);return x.pluck(x.map(e,function(e,t,i){return{value:e,index:t,criteria:r.call(n,e,t,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index<t.index?-1:1}),"value")};var L=function(e,t,n,r){var i={},s=k(t||x.identity);return T(e,function(t,o){var u=s.call(n,t,o,e);r(i,u,t)}),i};x.groupBy=function(e,t,n){return L(e,t,n,function(e,t,n){(x.has(e,t)?e[t]:e[t]=[]).push(n)})},x.countBy=function(e,t,n){return L(e,t,n,function(e,t){x.has(e,t)||(e[t]=0),e[t]++})},x.sortedIndex=function(e,t,n,r){n=null==n?x.identity:k(n);for(var i=n.call(r,t),s=0,o=e.length;o>s;){var u=s+o>>>1;i>n.call(r,e[u])?s=u+1:o=u}return s},x.toArray=function(e){return e?x.isArray(e)?u.call(e):e.length===+e.length?x.map(e,x.identity):x.values(e):[]},x.size=function(e){return null==e?0:e.length===+e.length?e.length:x.keys(e).length},x.first=x.head=x.take=function(e,t,n){return null==e?void 0:null==t||n?e[0]:u.call(e,0,t)},x.initial=function(e,t,n){return u.call(e,0,e.length-(null==t||n?1:t))},x.last=function(e,t,n){return null==e?void 0:null==t||n?e[e.length-1]:u.call(e,Math.max(e.length-t,0))},x.rest=x.tail=x.drop=function(e,t,n){return u.call(e,null==t||n?1:t)},x.compact=function(e){return x.filter(e,x.identity)};var A=function(e,t,n){return T(e,function(e){x.isArray(e)?t?o.apply(n,e):A(e,t,n):n.push(e)}),n};x.flatten=function(e,t){return A(e,t,[])},x.without=function(e){return x.difference(e,u.call(arguments,1))},x.uniq=x.unique=function(e,t,n,r){x.isFunction(t)&&(r=n,n=t,t=!1);var i=n?x.map(e,n,r):e,s=[],o=[];return T(i,function(n,r){(t?r&&o[o.length-1]===n:x.contains(o,n))||(o.push(n),s.push(e[r]))}),s},x.union=function(){return x.uniq(a.apply(r,arguments))},x.intersection=function(e){var t=u.call(arguments,1);return x.filter(x.uniq(e),function(e){return x.every(t,function(t){return x.indexOf(t,e)>=0})})},x.difference=function(e){var t=a.apply(r,u.call(arguments,1));return x.filter(e,function(e){return!x.contains(t,e)})},x.zip=function(){for(var e=u.call(arguments),t=x.max(x.pluck(e,"length")),n=Array(t),r=0;t>r;r++)n[r]=x.pluck(e,""+r);return n},x.object=function(e,t){if(null==e)return{};for(var n={},r=0,i=e.length;i>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},x.indexOf=function(e,t,n){if(null==e)return-1;var r=0,i=e.length;if(n){if("number"!=typeof n)return r=x.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,i+n):n}if(y&&e.indexOf===y)return e.indexOf(t,n);for(;i>r;r++)if(e[r]===t)return r;return-1},x.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(b&&e.lastIndexOf===b)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var i=r?n:e.length;i--;)if(e[i]===t)return i;return-1},x.range=function(e,t,n){1>=arguments.length&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),i=0,s=Array(r);r>i;)s[i++]=e,e+=n;return s};var O=function(){};x.bind=function(e,t){var n,r;if(e.bind===S&&S)return S.apply(e,u.call(arguments,1));if(!x.isFunction(e))throw new TypeError;return n=u.call(arguments,2),r=function(){if(this instanceof r){O.prototype=e.prototype;var i=new O;O.prototype=null;var s=e.apply(i,n.concat(u.call(arguments)));return Object(s)===s?s:i}return e.apply(t,n.concat(u.call(arguments)))}},x.bindAll=function(e){var t=u.call(arguments,1);return 0==t.length&&(t=x.functions(e)),T(t,function(t){e[t]=x.bind(e[t],e)}),e},x.memoize=function(e,t){var n={};return t||(t=x.identity),function(){var r=t.apply(this,arguments);return x.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},x.delay=function(e,t){var n=u.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},x.defer=function(e){return x.delay.apply(x,[e,1].concat(u.call(arguments,1)))},x.throttle=function(e,t){var n,r,i,s,o=0,u=function(){o=new Date,i=null,s=e.apply(n,r)};return function(){var a=new Date,f=t-(a-o);return n=this,r=arguments,0>=f?(clearTimeout(i),i=null,o=a,s=e.apply(n,r)):i||(i=setTimeout(u,f)),s}},x.debounce=function(e,t,n){var r,i;return function(){var s=this,o=arguments,u=function(){r=null,n||(i=e.apply(s,o))},a=n&&!r;return clearTimeout(r),r=setTimeout(u,t),a&&(i=e.apply(s,o)),i}},x.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},x.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},x.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},x.after=function(e,t){return 0>=e?t():function(){return 1>--e?t.apply(this,arguments):void 0}},x.keys=E||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)x.has(e,n)&&(t[t.length]=n);return t},x.values=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push(e[n]);return t},x.pairs=function(e){var t=[];for(var n in e)x.has(e,n)&&t.push([n,e[n]]);return t},x.invert=function(e){var t={};for(var n in e)x.has(e,n)&&(t[e[n]]=n);return t},x.functions=x.methods=function(e){var t=[];for(var n in e)x.isFunction(e[n])&&t.push(n);return t.sort()},x.extend=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},x.pick=function(e){var t={},n=a.apply(r,u.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},x.omit=function(e){var t={},n=a.apply(r,u.call(arguments,1));for(var i in e)x.contains(n,i)||(t[i]=e[i]);return t},x.defaults=function(e){return T(u.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},x.clone=function(e){return x.isObject(e)?x.isArray(e)?e.slice():x.extend({},e):e},x.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof x&&(e=e._wrapped),t instanceof x&&(t=t._wrapped);var i=f.call(e);if(i!=f.call(t))return!1;switch(i){case"[object String]":return e==t+"";case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var s=n.length;s--;)if(n[s]==e)return r[s]==t;n.push(e),r.push(t);var o=0,u=!0;if("[object Array]"==i){if(o=e.length,u=o==t.length)for(;o--&&(u=M(e[o],t[o],n,r)););}else{var a=e.constructor,l=t.constructor;if(a!==l&&!(x.isFunction(a)&&a instanceof a&&x.isFunction(l)&&l instanceof l))return!1;for(var c in e)if(x.has(e,c)&&(o++,!(u=x.has(t,c)&&M(e[c],t[c],n,r))))break;if(u){for(c in t)if(x.has(t,c)&&!(o--))break;u=!o}}return n.pop(),r.pop(),u};x.isEqual=function(e,t){return M(e,t,[],[])},x.isEmpty=function(e){if(null==e)return!0;if(x.isArray(e)||x.isString(e))return 0===e.length;for(var t in e)if(x.has(e,t))return!1;return!0},x.isElement=function(e){return!!e&&1===e.nodeType},x.isArray=w||function(e){return"[object Array]"==f.call(e)},x.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){x["is"+e]=function(t){return f.call(t)=="[object "+e+"]"}}),x.isArguments(arguments)||(x.isArguments=function(e){return!!e&&!!x.has(e,"callee")}),x.isFunction=function(e){return"function"==typeof e},x.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},x.isNaN=function(e){return x.isNumber(e)&&e!=+e},x.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==f.call(e)},x.isNull=function(e){return null===e},x.isUndefined=function(e){return void 0===e},x.has=function(e,t){return l.call(e,t)},x.noConflict=function(){return e._=t,this},x.identity=function(e){return e},x.times=function(e,t,n){for(var r=Array(e),i=0;e>i;i++)r[i]=t.call(n,i);return r},x.random=function(e,t){return null==t&&(t=e,e=0),e+(0|Math.random()*(t-e+1))};var _={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};_.unescape=x.invert(_.escape);var D={escape:RegExp("["+x.keys(_.escape).join("")+"]","g"),unescape:RegExp("("+x.keys(_.unescape).join("|")+")","g")};x.each(["escape","unescape"],function(e){x[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return _[e][t]})}}),x.result=function(e,t){if(null==e)return null;var n=e[t];return x.isFunction(n)?n.call(e):n},x.mixin=function(e){T(x.functions(e),function(t){var n=x[t]=e[t];x.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),F.call(this,n.apply(x,e))}})};var P=0;x.uniqueId=function(e){var t=""+ ++P;return e?e+t:t},x.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var H=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},j=/\\|'|\r|\n|\t|\u2028|\u2029/g;x.template=function(e,t,n){n=x.defaults({},n,x.templateSettings);var r=RegExp([(n.escape||H).source,(n.interpolate||H).source,(n.evaluate||H).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(r,function(t,n,r,o,u){return s+=e.slice(i,u).replace(j,function(e){return"\\"+B[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=u+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{var o=Function(n.variable||"obj","_",s)}catch(u){throw u.source=s,u}if(t)return o(t,x);var a=function(e){return o.call(this,e,x)};return a.source="function("+(n.variable||"obj")+"){\n"+s+"}",a},x.chain=function(e){return x(e).chain()};var F=function(e){return this._chain?x(e).chain():e};x.mixin(x),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=r[e];x.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],F.call(this,n)}}),T(["concat","join","slice"],function(e){var t=r[e];x.prototype[e]=function(){return F.call(this,t.apply(this._wrapped,arguments))}}),x.extend(x.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(this),r={getInsertionPoint:i,colorClass:s};var o=this,u=.25;n.ordinal=function(e,t,n,r){var i=a(e,t);return d3.scale.ordinal().domain(i).rangeRoundBands(n,u)},n.linear=function(e,t,n,r){return d3.scale.linear().domain(r).nice().rangeRound(n)},n.exponential=function(e,t,n,r){return d3.scale.pow().exponent(.65).domain(r).nice().rangeRound(n)},n.time=function(e,t,n,r){return d3.time.scale().domain(_.map(r,function(e){return new Date(e)})).range(n)},n.xy=function(t,n,r,i){var s=t._options,o=l(s,n,r,i),u={},a=[s.axisPaddingLeft,t._width],f=[t._height,s.axisPaddingTop],c,h;return _.each([r,i],function(t,r){var i=r===0?"x":"y",s=r===0?a:f,l=e.getScale(t);u[i]=l(n,i,s,o[i])}),u},function(){function s(e,t,n,r){e.xScale2=d3.scale.ordinal().domain(d3.range(0,n.length)).rangeRoundBands([0,e.xScale.rangeBand()],.08)}function o(t,s,o,u,a){var f,l,c=t.yZero;f=t._g.selectAll(n+o).data(u,function(e){return e.className}),f.enter().insert("g",i).attr("data-index",e).style("opacity",0).attr("class",function(e,t){var n=_.uniq((o+e.className).split(".")).join(" ");return n+" bar "+r.colorClass(this,t)}).attr("transform",function(e,n){return"translate("+t.xScale2(n)+",0)"}),l=f.selectAll("rect").data(function(e){return e.data},function(e){return e.x}),l.enter().append("rect").attr("width",0).attr("rx",3).attr("ry",3).attr("x",function(e){return t.xScale(e.x)+t.xScale2.rangeBand()/2}).attr("height",function(e){return Math.abs(c-t.yScale(e.y))}).attr("y",function(e){return e.y<0?c:t.yScale(e.y)}).on("mouseover",a.mouseover).on("mouseout",a.mouseout).on("click",a.click),s.barGroups=f,s.bars=l}function u(e,t,n){var i=e.yZero;t.barGroups.attr("class",function(e,t){return r.colorClass(this,t)}).transition().duration(n).style("opacity",1).attr("transform",function(t,n){return"translate("+e.xScale2(n)+",0)"}),t.bars.transition().duration(n).attr("width",e.xScale2.rangeBand()).attr("x",function(t){return e.xScale(t.x)}).attr("height",function(t){return Math.abs(i-e.yScale(t.y))}).attr("y",function(t){return t.y<0?i:e.yScale(t.y)})}function a(e,t,n){t.bars.exit().transition().duration(n).attr("width",0).remove(),t.barGroups.exit().transition().duration(n).style("opacity",0).remove()}function f(e,t,n){var r=e.xScale2?e.xScale2.rangeBand()/2:0;delete e.xScale2,t.bars.transition().duration(n).attr("width",0).attr("x",function(t){return e.xScale(t.x)+r})}var e=2,n="g.bar",i=r.getInsertionPoint(e);t.bar={postUpdateScale:s,enter:o,update:u,exit:a,destroy:f}}(),function(){function s(t,s,o,u,a){function g(e){return[e.data]}var f=t._options.interpolation,l=function(e,n){return!t.xScale2&&!t.xScale.rangeBand?t.xScale(e.x):t.xScale(e.x)+t.xScale.rangeBand()/2},c=function(e){return t.yScale(e.y)},h=d3.svg.line().x(l).interpolate(f),p=d3.svg.area().x(l).y1(t.yZero).interpolate(f),d,v,m;d=t._g.selectAll(n+o).data(u,function(e){return e.className}),d.enter().insert("g",i).attr("data-index",e).attr("class",function(e,t){var n=_.uniq((o+e.className).split(".")).join(" ");return n+" line "+r.colorClass(this,t)}),v=d.selectAll("path.fill").data(g),v.enter().append("path").attr("class","fill").style("opacity",0).attr("d",p.y0(c)),m=d.selectAll("path.line").data(g),m.enter().append("path").attr("class","line").style("opacity",0).attr("d",h.y(c)),s.lineContainers=d,s.lineFills=v,s.linePaths=m,s.lineX=l,s.lineY=c,s.lineA=p,s.line=h}function o(e,t,n){t.lineContainers.attr("class",function(e,t){return r.colorClass(this,t)}),t.lineFills.transition().duration(n).style("opacity",1).attr("d",t.lineA.y0(t.lineY)),t.linePaths.transition().duration(n).style("opacity",1).attr("d",t.line.y(t.lineY))}function u(e,t){t.linePaths.exit().style("opacity",0).remove(),t.lineFills.exit().style("opacity",0).remove(),t.lineContainers.exit().remove()}function a(e,t,n){t.linePaths.transition().duration(n).style("opacity",0),t.lineFills.transition().duration(n).style("opacity",0)}var e=3,n="g.line",i=r.getInsertionPoint(e);t.line={enter:s,update:o,exit:u,destroy:a}}(),function(){function n(t,n,r,i,s){var o;e.enter(t,n,r,i,s),o=n.lineContainers.selectAll("circle").data(function(e){return e.data},function(e){return e.x}),o.enter().append("circle").style("opacity",0).attr("cx",n.lineX).attr("cy",n.lineY).attr("r",5).on("mouseover",s.mouseover).on("mouseout",s.mouseout).on("click",s.click),n.lineCircles=o}function r(t,n,r){e.update.apply(null,_.toArray(arguments)),n.lineCircles.transition().duration(r).style("opacity",1).attr("cx",n.lineX).attr("cy",n.lineY)}function i(t,n){n.lineCircles.exit().remove(),e.exit.apply(null,_.toArray(arguments))}function s(t,n,r){e.destroy.apply(null,_.toArray(arguments));if(!n.lineCircles)return;n.lineCircles.transition().duration(r).style("opacity",0)}var e=t.line;t["line-dotted"]={enter:n,update:r,exit:i,destroy:s}}(),function(){function n(t,n,r,i,s){e.enter(t,n,r,i,s)}function r(e){function t(e,t){return e+t.y}var n=_.map(e,function(e){var n=e.data.length,r=_.clone(e.data);e=_.clone(e);while(n)n-=1,r[n]=_.clone(e.data[n]),r[n].y0=e.data[n].y,r[n].y=_.reduce(_.first(e.data,n),t,e.data[n].y);return _.extend(e,{data:r})});return n}function i(e){if(!e.hasOwnProperty("cumulativeOMainData"))return;e._mainData=e.cumulativeOMainData,delete e.cumulativeOMainData,e._compData=e.cumulativeOCompData,delete e.cumulativeOCompData}function s(e,t){i(e),e.cumulativeOMainData=e._mainData,e._mainData=r(e._mainData),e.cumulativeOCompData=e._compData,e._compData=r(e._compData)}function o(t,n,r){i(t),e.destroy.apply(null,_.toArray(arguments))}var e=t["line-dotted"];t.cumulative={preUpdateScale:s,enter:n,update:e.update,exit:e.exit,destroy:o}}();var c=[[]],h={mouseover:function(e,t){},mouseout:function(e,t){},click:function(e,t){},axisPaddingTop:0,axisPaddingRight:0,axisPaddingBottom:5,axisPaddingLeft:20,paddingTop:0,paddingRight:0,paddingBottom:20,paddingLeft:60,tickHintX:10,tickFormatX:function(e){return e},tickHintY:10,tickFormatY:function(e){return e},xMin:null,xMax:null,yMin:null,yMax:null,dataFormatX:function(e){return e},dataFormatY:function(e){return e},unsupported:function(e){d3.select(e).text("SVG is not supported on your browser")},empty:function(e,t,n){},notempty:function(e,t){},timing:750,interpolation:"monotone",sortX:function(e,t){return!e.x&&!t.x?0:e.x<t.x?-1:1}};e.setVis=function(e,n){if(t.hasOwnProperty(e))throw'Cannot override vis type "'+e+'".';t[e]=n},e.getVis=function(e){if(!t.hasOwnProperty(e))throw'Vis type "'+e+'" does not exist.';return _.clone(t[e])},e.setScale=function(e,t){if(n.hasOwnProperty(e))throw'Scale type "'+e+'" already exists.';n[e]=t},e.getScale=function(e){if(!n.hasOwnProperty(e))throw'Scale type "'+e+'" does not exist.';return n[e]},e.visutils=r,_.defaults(e.prototype,{setType:function(e,n){var r=this;if(r._type&&e===r._type)return;if(!t.hasOwnProperty(e))throw'Vis type "'+e+'" is not defined.';r._type&&r._destroy(r._vis,r._mainStorage),r._type=e,r._vis=t[e],n||r._draw()},setData:function(e){function i(e){var t=_.map(_.clone(e.data),function(e){var t=_.clone(e);return e.hasOwnProperty("x")&&(t.x=n.dataFormatX(e.x)),e.hasOwnProperty("y")&&(t.y=n.dataFormatY(e.y)),t}).sort(n.sortX);return _.extend(_.clone(e),{data:t})}var t=this,n=t._options,r=_.clone(e);if(!e.hasOwnProperty("main"))throw'No "main" key found in given chart data.';switch(e.type){case"bar":e.xScale="ordinal";break;case undefined:e.type=t._type}n.xMin=isNaN(parseInt(e.xMin,10))?n.xMin:e.xMin,n.xMax=isNaN(parseInt(e.xMax,10))?n.xMax:e.xMax,n.yMin=isNaN(parseInt(e.yMin,10))?n.yMin:e.yMin,n.yMax=isNaN(parseInt(e.yMax,10))?n.yMax:e.yMax,t._vis&&t._destroy(t._vis,t._mainStorage),t.setType(e.type,!0),r.main=_.map(r.main,i),t._mainData=r.main,t._xScaleType=r.xScale,t._yScaleType=r.yScale,r.hasOwnProperty("comp")?(r.comp=_.map(r.comp,i),t._compData=r.comp):t._compData=[],t._draw()},setScale:function(e,t){var n=this;switch(e){case"x":n._xScaleType=t;break;case"y":n._yScaleType=t;break;default:throw'Cannot change scale of unknown axis "'+e+'".'}n._draw()},_drawSvg:function(){var e=this,t=e._container,n=e._options,r=parseInt(t.style("width").replace("px",""),10),i=parseInt(t.style("height").replace("px",""),10),s,o,u;s=t.selectAll("svg").data(c),s.enter().append("svg").attr("height",i).attr("width",r).attr("class","xchart"),s.transition().attr("width",r).attr("height",i),o=s.selectAll("g").data(c),o.enter().append("g").attr("transform","translate("+n.paddingLeft+","+n.paddingTop+")"),u=o.selectAll("g.scale").data(c),u.enter().append("g").attr("class","scale"),e._svg=s,e._g=o,e._gScale=u,e._height=i-n.paddingTop-n.paddingBottom-n.axisPaddingTop-n.axisPaddingBottom,e._width=r-n.paddingLeft-n.paddingRight-n.axisPaddingLeft-n.axisPaddingRight},_resize:function(e){var t=this;t._drawSvg(),t._draw()},_drawAxes:function(){if(this._noData)return;var e=this,t=e._options,n=e._gScale.transition().duration(t.timing),r=t.tickHintX,i=t.tickHintY,s=e._height+t.axisPaddingTop+t.axisPaddingBottom,o=d3.svg.line().x(function(e){return e}),u,a,f,l,h,p,d;l=d3.svg.axis().scale(e.xScale).ticks(r).tickSize(-e._height).tickFormat(t.tickFormatX).orient("bottom"),f=e._gScale.selectAll("g.axisX").data(c),f.enter().append("g").attr("class","axis axisX").attr("transform","translate(0,"+s+")"),f.call(l),d=e._gScale.selectAll(".axisX g")[0],d.length>e._width/80&&(d.sort(function(e,t){var n=/translate\(([^,)]+)/;return e=e.getAttribute("transform").match(n),t=t.getAttribute("transform").match(n),parseFloat(e[1],10)-parseFloat(t[1],10)}),d3.selectAll(d).filter(function(e,t){return t%(Math.ceil(d.length/r)+1)}).remove()),p=d3.svg.axis().scale(e.yScale).ticks(i).tickSize(-e._width-t.axisPaddingRight-t.axisPaddingLeft).tickFormat(t.tickFormatY).orient("left"),h=e._gScale.selectAll("g.axisY").data(c),h.enter().append("g").attr("class","axis axisY").attr("transform","translate(0,0)"),n.selectAll("g.axisY").call(p),u=e._gScale.selectAll("g.axisZero").data([[]]),u.enter().append("g").attr("class","axisZero"),a=u.selectAll("line").data([[]]),a.enter().append("line").attr("x1",0).attr("x2",e._width+t.axisPaddingLeft+t.axisPaddingRight).attr("y1",e.yZero).attr("y2",e.yZero),a.transition().duration(t.timing).attr("y1",e.yZero).attr("y2",e.yZero)},_updateScale:function(){var e=this,t=function(){return _.union(e._mainData,e._compData)},r=t(),i=e._vis,s,o;delete e.xScale,delete e.yScale,delete e.yZero,i.hasOwnProperty("preUpdateScale")&&i.preUpdateScale(e,r,e._mainData,e._compData),r=t(),s=n.xy(e,r,e._xScaleType,e._yScaleType),e.xScale=s.x,e.yScale=s.y,o=e.yScale.domain()[0],e.yZero=o>0?e.yScale(o):e.yScale(0),i.hasOwnProperty("postUpdateScale")&&i.postUpdateScale(e,r,e._mainData,e._compData)},_enter:function(e,t,n,r){var i=this,s={click:i._options.click,mouseover:i._options.mouseover,mouseout:i._options.mouseout};i._checkVisMethod(e,"enter"),e.enter(i,t,r,n,s)},_update:function(e,t){var n=this;n._checkVisMethod(e,"update"),e.update(n,t,n._options.timing)},_exit:function(e,t){var n=this;n._checkVisMethod(e,"exit"),e.exit(n,t,n._options.timing)},_destroy:function(e,t){var n=this;n._checkVisMethod(e,"destroy");try{e.destroy(n,t,n._options.timing)}catch(r){}},_draw:function(){var e=this,n=e._options,r,i;e._noData=_.flatten(_.pluck(e._mainData,"data").concat(_.pluck(e._compData,"data"))).length===0,e._updateScale(),e._drawAxes(),e._enter(e._vis,e._mainStorage,e._mainData,".main"),e._exit(e._vis,e._mainStorage),e._update(e._vis,e._mainStorage),r=_.chain(e._compData).groupBy(function(e){return e.type}),i=r.keys(),_.each(e._compStorage,function(n,r){if(-1===i.indexOf(r).value()){var s=t[r];e._enter(s,n,[],".comp."+r.replace(/\W+/g,"")),e._exit(s,n)}}),r.each(function(n,r){var i=t[r],s;e._compStorage.hasOwnProperty(r)||(e._compStorage[r]={}),s=e._compStorage[r],e._enter(i,s,n,".comp."+r.replace(/\W+/g,"")),e._exit(i,s),e._update(i,s)}),e._noData?n.empty(e,e._selector,e._mainData):n.notempty(e,e._selector)},_checkVisMethod:function(e,t){var n=this;if(!e[t])throw'Required method "'+t+'" not found on vis type "'+n._type+'".'}});if(typeof define=="function"&&define.amd&&typeof define.amd=="object"){define("xchart",[],function(){return e});return}window.xChart=e}(),define("app/components/dashboard",["jquery","can","d3","xchart","../../lib/mywash/constructs/map.helpers","../../lib/mywash/components/tabs","toastr","nanobar","datepicker","momentjs"],function(e,t,n,r,i,s,o,u){var a=s[0],f=s[1];return t.Component.extend({tag:"order-freq-tag",template:"",scope:f.extend({init:function(){this.total_users=t.compute(0)},getTotalUsers:function(){}}),_pollData:function(t,n,r,i){n&&(n=this.getFormattedDate(moment(n))),r&&(r=this.getFormattedTime(moment(r))),i||(i=!1);var s="";r?s="/api/pickup/"+n+"/"+r:s="/api/pickup/"+n,this.nanobar.go(30),e.ajax({url:s,type:"get",context:this,dataType:"json",success:function(e){this.nanobar.go(50),e.data&&(i?this._updateData(e.data):this._addData(e.data)),this.nanobar.go(100)}})},events:{inserted:function(){}}})}),require.config({shim:{bootstrap:{deps:["jquery"]},dcjqaccordion:{deps:["jquery"]},scrollTo:{deps:["jquery"]},slidebars:{deps:["jquery"]},nicescroll:{deps:["jquery"]},common_scripts:{deps:["jquery"]},datepicker:{deps:["jquery"]},jqprint:{deps:["jquery"]},ajaxForm:{deps:["jquery"]},toastr:{deps:["jquery"]},selectize:{deps:["jquery"]},d3:{exports:"d3"},xchart:{deps:["d3"],exports:"xchart"},respondjs:{exports:"respondjs"},daterangepicker:{deps:["jquery"],exports:"daterangepicker"}},paths:{jquery:"./lib/misc/jquery-2.1.3.min",can:"./lib/canjs/can",bootstrap:"./lib/misc/bootstrap.min",dcjqaccordion:"./lib/misc/jquery.dcjqaccordion.2.7",scrollTo:"./lib/misc/jquery.scrollTo.min",slidebars:"./lib/misc/slidebars.min",nicescroll:"./lib/misc/jquery.nicescroll",respondjs:"./lib/misc/respond.min",common_scripts:"./lib/misc/common-scripts",datepicker:"./lib/assets/bootstrap-datepicker/js/bootstrap-datepicker.min",momentjs:"./lib/assets/bootstrap-daterangepicker/moment.min",summernote:"./lib/assets/summernote/dist/summernote.min",toastr:"./lib/assets/toastr-master/build/toastr.min",selectize:"./lib/assets/selectize/js/standalone/selectize",nanobar:"./lib/assets/nanobar/nanobar.min",d3:"./lib/assets/xchart/d3.v3.min",xchart:"./lib/assets/xchart/xcharts.min",jqprint:"./lib/misc/jquery.print.min",ajaxForm:"./lib/misc/jquery.ajaxform.min",async:"./lib/requirejs/async",daterangepicker:"./lib/assets/bootstrap-daterangepicker/daterangepicker"},waitSeconds:0}),define("gmaps",["async!https://maps.googleapis.com/maps/api/js?libraries=geometry,places&sensor=false"],function(){return window.google.maps}),require(["jquery","can","common_scripts","can/route/pushstate","bootstrap","dcjqaccordion","scrollTo","slidebars","nicescroll","respondjs","./app/components/leftSidebar","./app/components/pickupOrders","./app/components/deliveryOrders","./app/components/cleaningItemsConf","./app/components/cancelledOrders","./app/components/completedOrders","./app/components/allOrders","./app/components/taggingOrders","./app/components/packageOrders","./app/components/usersList","./app/components/vendorsList","./app/components/logisticStaffs","./app/components/failureReasonsConf","./app/components/deliveryProgress","./app/components/timeslotsBlockConf","./app/components/dashboard"],function(e,t,n){e(function(){t.route.ready(),t.route("/:sidebarmenu",{tabname:"frameworks"});var r=e.ajax({url:"/api/statuslist",type:"get",dataType:"json"}),i=e.ajax({url:"/api/timeslot",type:"get",dataType:"json"}),s=e.ajax({url:"/api/servicetype",type:"get",dataType:"json"});e.when(r,i,s).done(function(r,i,s){r=r[0],i=i[0],s=s[0],localStorage.setItem("statuses",JSON.stringify(r.data)),localStorage.setItem("timeslots",JSON.stringify(i.data)),localStorage.setItem("servicetype",JSON.stringify(s)),e("#container").html(t.view("core-template",{})),n(),e("#loading-screen").remove(),t.route.attr("sidebarmenu","main-content-dashboard"),e("#logout-btn").click(function(){e.ajax({url:"/logout",type:"get",dataType:"json",success:function(){location.reload()}})})})})}),define("main",function(){});